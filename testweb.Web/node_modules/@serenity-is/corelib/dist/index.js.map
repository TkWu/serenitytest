{
  "version": 3,
  "sources": ["../src/index.ts", "../src/decorators/index.ts", "../src/interfaces/ibooleanvalue.ts", "../src/interfaces/idoublevalue.ts", "../src/interfaces/idialog.ts", "../src/interfaces/ieditdialog.ts", "../src/interfaces/igeteditvalue.ts", "../src/interfaces/ireadonly.ts", "../src/interfaces/iseteditvalue.ts", "../src/interfaces/istringvalue.ts", "../src/interfaces/ivalidaterequired.ts", "../src/types/captureoperationtype.ts", "../src/types/reflectionutils.ts", "../src/types/dialogtyperegistry.ts", "../src/types/editortyperegistry.ts", "../src/types/enumtyperegistry.ts", "../src/ui/datagrid/islickformatter.ts", "../src/ui/helpers/lazyloadhelper.ts", "../src/ui/widgets/prefixedcontext.ts", "../src/patch/jquerypatch.ts", "../src/ui/widgets/widget.ts", "../src/ui/widgets/toolbar.ts", "../src/ui/widgets/templatedwidget.ts", "../src/ui/dialogs/templateddialog.ts", "../src/ui/widgets/flexify.ts", "../src/ui/dialogs/dialogextensions.ts", "../src/ui/widgets/templatedpanel.ts", "../src/ui/helpers/validationhelper.ts", "../src/ui/editors/cascadedwidgetlink.ts", "../src/ui/helpers/tabsextensions.ts", "../src/ui/widgets/reflectionoptionssetter.ts", "../src/ui/widgets/propertygrid.ts", "../src/ui/editors/editorutils.ts", "../src/ui/widgets/propertypanel.ts", "../src/ui/helpers/subdialoghelper.ts", "../src/ui/dialogs/propertydialog.ts", "../src/ui/editors/stringeditor.ts", "../src/ui/editors/passwordeditor.ts", "../src/ui/editors/textareaeditor.ts", "../src/ui/editors/booleaneditor.ts", "../src/ui/editors/decimaleditor.ts", "../src/ui/editors/integereditor.ts", "../src/ui/editors/dateeditor.ts", "../src/ui/editors/datetimeeditor.ts", "../src/ui/editors/timeeditor.ts", "../src/ui/editors/emaileditor.ts", "../src/ui/editors/emailaddresseditor.ts", "../src/ui/editors/urleditor.ts", "../src/ui/editors/radiobuttoneditor.ts", "../src/ui/editors/select2editor.ts", "../src/ui/editors/selecteditor.ts", "../src/ui/editors/dateyeareditor.ts", "../src/ui/editors/enumeditor.ts", "../src/ui/editors/lookupeditor.ts", "../src/ui/editors/servicelookupeditor.ts", "../src/ui/editors/htmlcontenteditor.ts", "../src/ui/editors/maskededitor.ts", "../src/ui/editors/recaptcha.ts", "../src/ui/helpers/uploadhelper.ts", "../src/ui/editors/uploadeditors.ts", "../src/ui/datagrid/quickfilterbar.ts", "../src/ui/datagrid/quicksearchinput.ts", "../src/ui/filtering/filteroperator.ts", "../src/ui/filtering/filterstore.ts", "../src/ui/filtering/filtering.ts", "../src/ui/filtering/filterwidgetbase.ts", "../src/ui/filtering/filterpanel.ts", "../src/ui/filtering/filterdialog.ts", "../src/ui/filtering/filterdisplaybar.ts", "../src/ui/datagrid/slickpager.ts", "../src/ui/helpers/slickhelpers.ts", "../src/ui/formatters/formatters.ts", "../src/ui/datagrid/datagrid.ts", "../src/ui/datagrid/columnpickerdialog.ts", "../src/ui/datagrid/treegridmixin.ts", "../src/ui/editors/checktreeeditor.ts", "../src/ui/datagrid/entitygrid.ts", "../src/ui/dialogs/entitydialog.ts", "../src/ui/widgets/reporting.ts", "../src/ui/editors/asynclookupeditor.ts", "../src/ui/widgets/scriptcontext.ts", "../src/interfaces/iasyncinit.ts", "../src/ui/widgets/wx.ts", "../src/ui/widgets/googlemap.ts", "../src/ui/editors/select2ajaxeditor.ts"],
  "sourcesContent": ["\uFEFFexport * from \"./globals/select2\";\r\nexport * from \"./globals/jquerystatic\";\r\nexport * from \"./globals/validate\";\r\n\r\nexport type { ServiceError, ServiceResponse, ServiceRequest, ServiceOptions, SaveRequest, SaveRequestWithAttachment, SaveResponse, SaveWithLocalizationRequest, DeleteRequest, DeleteResponse, UndeleteRequest, UndeleteResponse, ListRequest, ListResponse, RetrieveRequest, RetrieveResponse, RetrieveLocalizationRequest, RetrieveLocalizationResponse, PropertyItem, PropertyItemsData } from \"@serenity-is/corelib/q\";\r\nexport { ColumnSelection, RetrieveColumnSelection, SummaryType, Criteria } from \"@serenity-is/corelib/q\";\r\n\r\nexport * from \"./interfaces\";\r\nexport * from \"./types\";\r\nexport * from \"./ui/datagrid/islickformatter\";\r\nexport * from \"./decorators\";\r\nexport * from \"./ui/helpers/lazyloadhelper\";\r\nexport * from \"./ui/widgets/prefixedcontext\";\r\nexport * from \"./ui/widgets/widget\";\r\nexport * from \"./ui/widgets/jquerywidgetfn\";\r\nexport * from \"./ui/widgets/toolbar\";\r\nexport * from \"./ui/widgets/templatedwidget\";\r\nexport * from \"./ui/dialogs/templateddialog\";\r\nexport * from \"./ui/widgets/templatedpanel\";\r\nexport * from \"./ui/helpers/validationhelper\";\r\nexport * from \"./ui/editors/cascadedwidgetlink\";\r\nexport * from \"./ui/helpers/tabsextensions\";\r\nexport * from \"./ui/widgets/reflectionoptionssetter\";\r\nexport * from \"./ui/widgets/propertygrid\";\r\nexport * from \"./ui/widgets/propertypanel\";\r\nexport * from \"./ui/helpers/subdialoghelper\";\r\nexport * from \"./ui/dialogs/dialogextensions\";\r\nexport * from \"./ui/dialogs/propertydialog\";\r\nexport * from \"./ui/editors/editorutils\";\r\nexport * from \"./ui/editors/stringeditor\";\r\nexport * from \"./ui/editors/passwordeditor\";\r\nexport * from \"./ui/editors/textareaeditor\";\r\nexport * from \"./ui/editors/booleaneditor\";\r\nexport * from \"./ui/editors/decimaleditor\";\r\nexport * from \"./ui/editors/integereditor\";\r\nexport * from \"./ui/editors/dateeditor\";\r\nexport * from \"./ui/editors/datetimeeditor\";\r\nexport * from \"./ui/editors/timeeditor\";\r\nexport * from \"./ui/editors/emaileditor\";\r\nexport * from \"./ui/editors/emailaddresseditor\";\r\nexport * from \"./ui/editors/urleditor\";\r\nexport * from \"./ui/editors/radiobuttoneditor\";\r\nexport * from \"./ui/editors/select2editor\";\r\nexport * from \"./ui/editors/selecteditor\";\r\nexport * from \"./ui/editors/dateyeareditor\";\r\nexport * from \"./ui/editors/enumeditor\";\r\nexport * from \"./ui/editors/lookupeditor\";\r\nexport * from \"./ui/editors/servicelookupeditor\";\r\nexport * from \"./ui/editors/htmlcontenteditor\";\r\nexport * from \"./ui/editors/maskededitor\";\r\nexport * from \"./ui/editors/recaptcha\";\r\nexport * from \"./ui/helpers/uploadhelper\";\r\nexport * from \"./ui/editors/uploadeditors\";\r\nexport * from \"./ui/datagrid/quickfilter\";\r\nexport * from \"./ui/datagrid/quickfilterbar\";\r\nexport * from \"./ui/datagrid/quicksearchinput\";\r\nexport * from \"./ui/filtering/filteroperator\";\r\nexport * from \"./ui/filtering/filterline\";\r\nexport * from \"./ui/filtering/filterstore\";\r\nexport * from \"./ui/filtering/filtering\";\r\nexport * from \"./ui/filtering/filterwidgetbase\";\r\nexport * from \"./ui/filtering/filterpanel\";\r\nexport * from \"./ui/filtering/filterdialog\";\r\nexport * from \"./ui/filtering/filterdisplaybar\";\r\nexport * from \"./ui/datagrid/slickpager\";\r\nexport * from \"./ui/datagrid/idatagrid\";\r\nexport * from \"./ui/helpers/slickhelpers\";\r\nexport * from \"./ui/formatters/formatters\";\r\nexport * from \"./ui/datagrid/datagrid\";\r\nexport * from \"./ui/datagrid/columnpickerdialog\";\r\nexport * from \"./ui/datagrid/treegridmixin\";\r\nexport * from \"./ui/editors/checktreeeditor\";\r\nexport * from \"./ui/datagrid/entitygrid\";\r\nexport * from \"./ui/dialogs/entitydialog\";\r\n\r\n// legacy\r\nexport * from \"./ui/widgets/reporting\";\r\nexport * from \"./ui/editors/asynclookupeditor\";\r\nexport * from \"./ui/widgets/scriptcontext\";\r\nexport * from \"./interfaces/iasyncinit\";\r\nexport * from \"./ui/widgets/wx\";\r\nexport * from \"./ui/widgets/flexify\";\r\nexport * from \"./ui/widgets/googlemap\";\r\nexport * from \"./ui/editors/select2ajaxeditor\";\r\n\r\nexport type Constructor<T> = new (...args: any[]) => T;", "import {\r\n    addAttribute, addTypeMember, isEnum, MemberType, ISlickFormatter,\r\n    registerClass as regClass, registerInterface as regIntf, registerEnum as regEnum,\r\n    startsWith\r\n} from \"@serenity-is/corelib/q\";\r\n\r\nfunction Attr(name: string) {\r\n    return function (target: Function) {\r\n        return regClass(target, 'Serenity.' + name + 'Attribute');\r\n    }\r\n}\r\n\r\n@Attr('EnumKey')\r\nexport class EnumKeyAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('DisplayName')\r\nexport class DisplayNameAttribute {\r\n    constructor(public displayName: string) {\r\n    }\r\n}\r\n\r\n@Attr('Category')\r\nexport class CategoryAttribute {\r\n    constructor(public category: string) {\r\n    }\r\n}\r\n\r\n@Attr('ColumnsKey')\r\nexport class ColumnsKeyAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('CssClass')\r\nexport class CssClassAttribute {\r\n    constructor(public cssClass: string) {\r\n    }\r\n}\r\n\r\n@Attr('DefaultValue')\r\nexport class DefaultValueAttribute {\r\n    constructor(public value: any) {\r\n    }\r\n}\r\n\r\n@Attr('DialogType')\r\nexport class DialogTypeAttribute {\r\n    constructor(public value: any) {\r\n    }\r\n}\r\n\r\n@Attr('Editor')\r\nexport class EditorAttribute {\r\n    constructor() {\r\n    }\r\n    key: string;\r\n}\r\n\r\n@Attr('EditorOption')\r\nexport class EditorOptionAttribute {\r\n    constructor(public key: string, public value: any) {\r\n    }\r\n}\r\n\r\nexport class EditorTypeAttributeBase {\r\n    constructor(public editorType: string) {\r\n    }\r\n\r\n    public setParams(editorParams: any): void {\r\n    }\r\n}\r\n\r\nregClass(EditorTypeAttributeBase, 'Serenity.EditorTypeAttributeBase');\r\n\r\n@Attr('EditorType')\r\nexport class EditorTypeAttribute extends EditorTypeAttributeBase {\r\n    constructor(editorType: string) {\r\n        super(editorType);\r\n    }\r\n}\r\n\r\n@Attr('Element')\r\nexport class ElementAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('EntityType')\r\nexport class EntityTypeAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('Filterable')\r\nexport class FilterableAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('Flexify')\r\nexport class FlexifyAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('FormKey')\r\nexport class FormKeyAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('GeneratedCode')\r\nexport class GeneratedCodeAttribute {\r\n    constructor(public origin?: string) {\r\n    }\r\n}\r\n\r\n@Attr('Hidden')\r\nexport class HiddenAttribute {\r\n    constructor() {\r\n    }\r\n}\r\n\r\n@Attr('Hint')\r\nexport class HintAttribute {\r\n    constructor(public hint: string) {\r\n    }\r\n}\r\n\r\n@Attr('IdProperty')\r\nexport class IdPropertyAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('Insertable')\r\nexport class InsertableAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('IsActiveProperty')\r\nexport class IsActivePropertyAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('ItemName')\r\nexport class ItemNameAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('LocalTextPrefix')\r\nexport class LocalTextPrefixAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('Maximizable')\r\nexport class MaximizableAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('MaxLength')\r\nexport class MaxLengthAttribute {\r\n    constructor(public maxLength: number) {\r\n    }\r\n}\r\n\r\n@Attr('NameProperty')\r\nexport class NamePropertyAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('OneWay')\r\nexport class OneWayAttribute {\r\n}\r\n\r\n@Attr('Option')\r\nexport class OptionAttribute {\r\n}\r\n\r\n@Attr('OptionsType')\r\nexport class OptionsTypeAttribute {\r\n    constructor(public value: Function) {\r\n    }\r\n}\r\n\r\n@Attr('Panel')\r\nexport class PanelAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('Placeholder')\r\nexport class PlaceholderAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('ReadOnly')\r\nexport class ReadOnlyAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('Required')\r\nexport class RequiredAttribute {\r\n    constructor(public isRequired = true) {\r\n    }\r\n}\r\n\r\n@Attr('Resizable')\r\nexport class ResizableAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('Responsive')\r\nexport class ResponsiveAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\n@Attr('Service')\r\nexport class ServiceAttribute {\r\n    constructor(public value: string) {\r\n    }\r\n}\r\n\r\n@Attr('Updatable')\r\nexport class UpdatableAttribute {\r\n    constructor(public value = true) {\r\n    }\r\n}\r\n\r\nexport namespace Decorators {\r\n\r\n    export function registerClass(nameOrIntf?: string | any[], intf2?: any[]) {\r\n        return function (target: Function) {\r\n            if (typeof nameOrIntf == \"string\")\r\n                regClass(target, nameOrIntf, intf2);\r\n            else\r\n                regClass(target, null, nameOrIntf);\r\n        }\r\n    }\r\n\r\n    export function registerInterface(nameOrIntf?: string | any[], intf2?: any[]) {\r\n        return function (target: Function) {\r\n\r\n            if (typeof nameOrIntf == \"string\")\r\n                regIntf(target, nameOrIntf, intf2);\r\n            else\r\n                regIntf(target, null, nameOrIntf);\r\n        }\r\n    }\r\n\r\n    export function registerEditor(nameOrIntf?: string | any[], intf2?: any[]) {\r\n        return registerClass(nameOrIntf, intf2);\r\n    }\r\n\r\n    export function registerEnum(target: any, enumKey?: string, name?: string) {\r\n        regEnum(target, name);\r\n        if (enumKey)\r\n            addAttribute(target, new EnumKeyAttribute(enumKey));\r\n    }\r\n\r\n    export function registerEnumType(target: any, name?: string, enumKey?: string) {\r\n        registerEnum(target, enumKey ?? name, name);\r\n    }\r\n\r\n    export function registerFormatter(nameOrIntf: string | any[] = [ISlickFormatter],\r\n        intf2: any[] = [ISlickFormatter]) {\r\n        return registerClass(nameOrIntf, intf2);\r\n    }\r\n\r\n    export function enumKey(value: string) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new EnumKeyAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function option() {\r\n        return function (target: Object, propertyKey: string): void {\r\n\r\n            var isGetSet = startsWith(propertyKey, 'get_') || startsWith(propertyKey, 'set_');\r\n            var memberName = isGetSet ? propertyKey.substr(4) : propertyKey;\r\n\r\n            addTypeMember(target.constructor, {\r\n                name: memberName,\r\n                attr: [new OptionAttribute()],\r\n                type: isGetSet ? MemberType.property : MemberType.field,\r\n                getter: isGetSet ? ('get_' + memberName) : null,\r\n                setter: isGetSet ? ('set_' + memberName) : null\r\n            });\r\n        }\r\n    }\r\n\r\n    export function dialogType(value: any) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new DialogTypeAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function editor(key?: string) {\r\n        return function (target: Function) {\r\n            var attr = new EditorAttribute();\r\n            if (key !== undefined)\r\n                attr.key = key;\r\n            addAttribute(target, attr);\r\n        }\r\n    }\r\n\r\n    export function element(value: string) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new ElementAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function filterable(value = true) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new FilterableAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function flexify(value = true) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new FlexifyAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function itemName(value: string) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new ItemNameAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function maximizable(value = true) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new MaximizableAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function optionsType(value: Function) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new OptionsTypeAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function panel(value = true) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new PanelAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function resizable(value = true) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new ResizableAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function responsive(value = true) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new ResponsiveAttribute(value));\r\n        }\r\n    }\r\n\r\n    export function service(value: string) {\r\n        return function (target: Function) {\r\n            addAttribute(target, new ServiceAttribute(value));\r\n        }\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\n@Decorators.registerInterface()\r\nexport class IBooleanValue {\r\n}\r\n\r\nexport interface IBooleanValue {\r\n    get_value(): boolean;\r\n    set_value(value: boolean): void;\r\n}\r\n", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\n@Decorators.registerInterface()\r\nexport class IDoubleValue {\r\n}\r\n\r\nexport interface IDoubleValue {\r\n    get_value(): any;\r\n    set_value(value: any): void;\r\n}", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\n@Decorators.registerInterface('Serenity.IDialog')\r\nexport class IDialog {\r\n}\r\n\r\nexport interface IDialog {\r\n    dialogOpen(asPanel?: boolean): void;\r\n}", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\n@Decorators.registerInterface('Serenity.IEditDialog')\r\nexport class IEditDialog {\r\n}\r\n\r\nexport interface IEditDialog {\r\n    load(entityOrId: any, done: () => void, fail: (p1: any) => void): void;\r\n}\r\n", "\uFEFFimport { Decorators } from \"../decorators\";\r\nimport { PropertyItem } from \"@serenity-is/corelib/q\";\r\n\r\n@Decorators.registerInterface()\r\nexport class IGetEditValue {\r\n}\r\n\r\nexport interface IGetEditValue {\r\n    getEditValue(property: PropertyItem, target: any): void;\r\n}", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\nexport interface IReadOnly {\r\n    get_readOnly(): boolean;\r\n    set_readOnly(value: boolean): void;\r\n}\r\n\r\n@Decorators.registerInterface('Serenity.IReadOnly')\r\nexport class IReadOnly {\r\n}\r\n", "\uFEFFimport { Decorators } from \"../decorators\";\r\nimport { PropertyItem } from \"@serenity-is/corelib/q\";\r\n\r\n@Decorators.registerInterface()\r\nexport class ISetEditValue {\r\n}\r\n\r\nexport interface ISetEditValue {\r\n    setEditValue(source: any, property: PropertyItem): void;\r\n}", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\n@Decorators.registerInterface()\r\nexport class IStringValue {\r\n}\r\n\r\nexport interface IStringValue {\r\n    get_value(): string;\r\n    set_value(value: string): void;\r\n}", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\nexport interface IValidateRequired {\r\n    get_required(): boolean;\r\n    set_required(value: boolean): void;\r\n}\r\n\r\n@Decorators.registerInterface('Serenity.IValidateRequired')\r\nexport class IValidateRequired {\r\n}", "\uFEFFimport { registerEnum } from \"@serenity-is/corelib/q\";\r\n\r\nexport {}\r\n\r\nexport enum CaptureOperationType {\r\n    Before = 0,\r\n    Delete = 1,\r\n    Insert = 2,\r\n    Update = 3\r\n}\r\n\r\nregisterEnum(CaptureOperationType, 'Serenity.CaptureOperationType');", "\uFEFFimport { isEmptyOrNull } from \"@serenity-is/corelib/q\";\r\n\r\nexport namespace ReflectionUtils {\r\n\r\n    export function getPropertyValue(o: any, property: string): any {\r\n        var d = o;\r\n        var getter = d['get_' + property];\r\n        if (!!!(typeof (getter) === 'undefined')) {\r\n            return getter.apply(o);\r\n        }\r\n        var camelCase = makeCamelCase(property);\r\n        getter = d['get_' + camelCase];\r\n        if (!!!(typeof (getter) === 'undefined')) {\r\n            return getter.apply(o);\r\n        }\r\n        return d[camelCase];\r\n    }\r\n\r\n    export function setPropertyValue(o: any, property: string, value: any): void {\r\n        var d = o;\r\n        var setter = d['set_' + property];\r\n        if (!!!(typeof (setter) === 'undefined')) {\r\n            setter.apply(o, [value]);\r\n            return;\r\n        }\r\n        var camelCase = makeCamelCase(property);\r\n        setter = d['set_' + camelCase];\r\n        if (!!!(typeof (setter) === 'undefined')) {\r\n            setter.apply(o, [value]);\r\n            return;\r\n        }\r\n        d[camelCase] = value;\r\n    }\r\n\r\n    export function makeCamelCase(s: string): string {\r\n        if (isEmptyOrNull(s)) {\r\n            return s;\r\n        }\r\n\r\n        if (s === 'ID') {\r\n            return 'id';\r\n        }\r\n\r\n        var hasNonUppercase = false;\r\n        var numUppercaseChars = 0;\r\n        for (var index = 0; index < s.length; index++) {\r\n            if (s.charCodeAt(index) >= 65 && s.charCodeAt(index) <= 90) {\r\n                numUppercaseChars++;\r\n            }\r\n            else {\r\n                hasNonUppercase = true;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!hasNonUppercase && s.length !== 1 || numUppercaseChars === 0) {\r\n            return s;\r\n        }\r\n        else if (numUppercaseChars > 1) {\r\n            return s.substr(0, numUppercaseChars - 1).toLowerCase() + s.substr(numUppercaseChars - 1);\r\n        }\r\n        else if (s.length === 1) {\r\n            return s.toLowerCase();\r\n        }\r\n        else {\r\n            return s.substr(0, 1).toLowerCase() + s.substr(1);\r\n        }\r\n    }\r\n}", "\uFEFFimport { Config, Exception, notifyError, endsWith, getType, isAssignableFrom } from \"@serenity-is/corelib/q\";\r\nimport { IDialog } from \"../interfaces\";\r\n\r\nexport namespace DialogTypeRegistry {\r\n\r\n    function search(typeName: string) {\r\n\r\n        var dialogType = getType(typeName);\r\n        if (dialogType != null && isAssignableFrom(IDialog, dialogType)) {\r\n            return dialogType;\r\n        }\r\n\r\n        for (var ns of Config.rootNamespaces) {\r\n            dialogType = getType(ns + '.' + typeName);\r\n            if (dialogType != null && isAssignableFrom(IDialog, dialogType)) {\r\n                return dialogType;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    var knownTypes: { [key: string]: any } = {};\r\n\r\n    export function tryGet(key: string): any {\r\n        if (knownTypes[key] == null) {\r\n            var typeName = key;\r\n            var dialogType = search(typeName);\r\n\r\n            if (dialogType == null && !endsWith(key, 'Dialog')) {\r\n                typeName = key + 'Dialog';\r\n                dialogType = search(typeName);\r\n            }\r\n\r\n            if (dialogType == null) {\r\n                return null;\r\n            }\r\n\r\n            knownTypes[key] = dialogType as any;\r\n            return dialogType as any;\r\n        }\r\n\r\n        return knownTypes[key];\r\n    }\r\n\r\n    export function get(key: string): any {\r\n\r\n        var type = tryGet(key);\r\n\r\n        if (type == null) {\r\n            var message = key + ' dialog class is not found! Make sure there is a dialog class with this name, ' +\r\n                'it is under your project root namespace, and your namespace parts start with capital letters, ' +\r\n                'e.g. MyProject.Pascal.Cased namespace. If you got this error from an editor with InplaceAdd option ' +\r\n                'check that lookup key and dialog type name matches (case sensitive, excluding Dialog suffix). ' +\r\n                \"You need to change lookup key or specify DialogType property in LookupEditor attribute if that's not the case.\";\r\n\r\n            notifyError(message, '', null);\r\n\r\n            throw new Exception(message);\r\n        }\r\n\r\n        return type;\r\n    }\r\n}", "\uFEFFimport { EditorAttribute } from \"../decorators\";\r\nimport { ArgumentNullException, Config, endsWith, Exception, format, getAttributes, getType, getTypeFullName, getTypes, isEmptyOrNull, startsWith } from \"@serenity-is/corelib/q\";\r\n\r\n// @ts-ignore\r\nlet globalObj: any = typeof (global) !== \"undefined\" ? global : (typeof (window) !== \"undefined\" ? window : (typeof (self) !== \"undefined\" ? self : null));\r\n\r\nlet knownTypes: { [key: string] : any };\r\n\r\nexport namespace EditorTypeRegistry {\r\n    export function get(key: string): any {\r\n\r\n        if (isEmptyOrNull(key)) {\r\n            throw new ArgumentNullException('key');\r\n        }\r\n\r\n        initialize();\r\n\r\n        var editorType = knownTypes[key.toLowerCase()];\r\n        if (editorType == null) {\r\n\r\n            var type = getType(key) ?? getType(key, globalObj);\r\n            if (type != null) {\r\n                knownTypes[key.toLowerCase()] = type as any;\r\n                return type as any;\r\n            }\r\n\r\n            throw new Exception(format(\"Can't find {0} editor type!\", key));\r\n        }\r\n        return editorType;\r\n\r\n    }\r\n\r\n    function initialize(): void {\r\n\r\n        if (knownTypes != null)\r\n            return;\r\n\r\n        knownTypes = {};\r\n\r\n        for (var type of getTypes()) {\r\n\r\n            var fullName = getTypeFullName(type).toLowerCase();\r\n            knownTypes[fullName] = type;\r\n\r\n            var editorAttr = getAttributes(type, EditorAttribute, false);\r\n            if (editorAttr != null && editorAttr.length > 0) {\r\n                var attrKey = editorAttr[0].key;\r\n                if (!isEmptyOrNull(attrKey)) {\r\n                    knownTypes[attrKey.toLowerCase()] = type;\r\n                }\r\n            }\r\n\r\n            for (var k of Config.rootNamespaces) {\r\n                if (startsWith(fullName, k.toLowerCase() + '.')) {\r\n                    var kx = fullName.substr(k.length + 1).toLowerCase();\r\n                    if (knownTypes[kx] == null) {\r\n                        knownTypes[kx] = type;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        setTypeKeysWithoutEditorSuffix();\r\n    }\r\n\r\n    export function reset(): void {\r\n        knownTypes = null;\r\n    }\r\n\r\n    function setTypeKeysWithoutEditorSuffix() {\r\n        var keys = Object.keys(knownTypes);\r\n        for (var k of keys) {\r\n            setWithoutSuffix(k, knownTypes[k]);\r\n        }\r\n    }\r\n\r\n    function setWithoutSuffix(key: string, t: any) {\r\n        var suffix = 'editor';\r\n\r\n        if (!endsWith(key, suffix))\r\n            return;\r\n\r\n        var p = key.substr(0, key.length - suffix.length);\r\n\r\n        if (isEmptyOrNull(p))\r\n            return;\r\n\r\n        if (knownTypes[p] != null)\r\n            return;\r\n\r\n        knownTypes[p] = knownTypes[key];\r\n    }\r\n}", "\uFEFFimport { EnumKeyAttribute } from \"../decorators\";\r\nimport { Config, Exception, format, getAttributes, getTypeFullName, getTypes, isEnum, notifyError, startsWith } from \"@serenity-is/corelib/q\";\r\n\r\nexport namespace EnumTypeRegistry {\r\n\r\n    let knownTypes: { [key: string]: Function }\r\n\r\n    export function tryGet(key: string): Function {\r\n\r\n        if (knownTypes == null) {\r\n            knownTypes = {};\r\n            for (var type of getTypes()) {\r\n                if (isEnum(type)) {\r\n                    var fullName = getTypeFullName(type);\r\n                    knownTypes[fullName] = type;\r\n                    var enumKeyAttr = getAttributes(type, EnumKeyAttribute, false);\r\n                    if (enumKeyAttr != null && enumKeyAttr.length > 0) {\r\n                        knownTypes[enumKeyAttr[0].value] = type;\r\n                    }\r\n\r\n                    for (var k of Config.rootNamespaces) {\r\n                        if (startsWith(fullName, k + '.')) {\r\n                            knownTypes[fullName.substr(k.length + 1)] = type;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (knownTypes[key] == null)\r\n            return null;\r\n\r\n        return knownTypes[key];\r\n    }\r\n\r\n    export function get(key: string): Function {\r\n        var type = EnumTypeRegistry.tryGet(key);\r\n        if (type == null) {\r\n            var message = format(\"Can't find {0} enum type! If you have recently defined this enum type \" + \r\n                \"in server side code, make sure your project builds successfully and transform T4 templates. \" +\r\n                \"Also make sure that enum is under your project root namespace, and your namespace parts starts \" + \r\n                \"with capital letters, e.g.MyProject.Pascal.Cased namespace\", key);\r\n\r\n            notifyError(message, '', null);\r\n            throw new Exception(message);\r\n        }\r\n\r\n        return type;\r\n    }\r\n}", "\uFEFFexport { ISlickFormatter } from \"@serenity-is/corelib/q\";\r\nexport type { Formatter } from \"@serenity-is/corelib/slick\";\r\n", "\uFEFFimport { executeOnceWhenVisible, executeEverytimeWhenVisible } from \"@serenity-is/corelib/q\";\r\n\r\nexport namespace LazyLoadHelper {\r\n    export const executeOnceWhenShown = executeOnceWhenVisible \r\n    export const executeEverytimeWhenShown = executeEverytimeWhenVisible;\r\n}", "\uFEFFexport {}\r\n\r\nexport class PrefixedContext {\r\n    constructor(public readonly idPrefix: string) {\r\n    }\r\n\r\n    byId(id: string): JQuery {\r\n        return $('#' + this.idPrefix + id);\r\n    }\r\n\r\n    w<TWidget>(id: string, type: { new (...args: any[]): TWidget }): TWidget {\r\n        return $('#' + this.idPrefix + id).getWidget<TWidget>(type);\r\n    }\r\n}", "\uFEFFexport function jQueryPatch($: any) {\r\n    \r\n    function applyJQueryUIFixes(): boolean {\r\n        if (typeof $ == \"undefined\" || !$.ui || !$.ui.dialog || !$.ui.dialog.prototype)\r\n            return false;\r\n            \r\n        $.ui.dialog.prototype._allowInteraction = function (event: any) {\r\n            if ($(event.target).closest(\".ui-dialog\").length) {\r\n                return true;\r\n            }\r\n            return !!$(event.target).closest(\".ui-datepicker, .select2-drop, .cke, .cke_dialog, .modal, #support-modal\").length;\r\n        };\r\n\r\n        (function (orig) {\r\n            $.ui.dialog.prototype._focusTabbable = function () {\r\n                if ($(document.documentElement).hasClass('mobile-device')) {\r\n                    this.uiDialog && this.uiDialog.focus();\r\n                    return;\r\n                }\r\n                orig.call(this);\r\n            }\r\n        })($.ui.dialog.prototype._focusTabbable);\r\n\r\n        (function (orig) {\r\n            $.ui.dialog.prototype._createTitlebar = function () {\r\n                orig.call(this);\r\n                this.uiDialogTitlebar.find('.ui-dialog-titlebar-close').html('<i class=\"fa fa-times\" />');\r\n            }\r\n        })($.ui.dialog.prototype._createTitlebar);\r\n    }\r\n\r\n    !applyJQueryUIFixes() && typeof $ !== \"undefined\" && $.fn && $(applyJQueryUIFixes);\r\n\r\n    if (typeof $ !== \"undefined\" && $.fn) {\r\n\r\n        // for backward compatibility\r\n        if (!$.toJSON)\r\n            $.toJSON = JSON.stringify;\r\n        if (!$.parseJSON)\r\n            $.parseJSON = JSON.parse;\r\n\r\n        ($ as any).cleanData = (function (orig) {\r\n            return function (elems: any[]) {\r\n                var events, elem, i, e;\r\n                var cloned = elems;\r\n                for (i = 0; (elem = cloned[i]) != null; i++) {\r\n                    try {\r\n                        events = ($ as any)._data(elem, \"events\");\r\n                        if (events && events.remove) {\r\n                            // html collection might change during remove event, so clone it!\r\n                            if (cloned === elems)\r\n                                cloned = Array.prototype.slice.call(elems);\r\n                            $(elem).triggerHandler(\"remove\");\r\n                            delete events.remove;\r\n                        }\r\n                    } catch (e) { }\r\n                }\r\n                orig(elems);\r\n            };\r\n        })(($ as any).cleanData);\r\n    }\r\n}", "\uFEFFimport { jQueryPatch } from \"../../patch/jquerypatch\";\r\nimport { Decorators, ElementAttribute } from \"../../decorators\";\r\nimport { IDialog } from \"../../interfaces\";\r\nimport { addValidationRule as addValRule, ArgumentNullException, Config, Exception, format, getAttributes, getInstanceType, getTypeFullName, getTypeName, isAssignableFrom, notifyError, replaceAll, startsWith } from \"@serenity-is/corelib/q\";\r\n\r\nexport interface WidgetClass<TOptions = object> {\r\n    new(element: JQuery, options?: TOptions): Widget<TOptions>;\r\n    element: JQuery;\r\n}\r\n\r\nexport interface WidgetDialogClass<TOptions = object> {\r\n    new(options?: TOptions): Widget<TOptions> & IDialog;\r\n    element: JQuery;\r\n}\r\n\r\nexport type AnyWidgetClass<TOptions = object> = WidgetClass<TOptions> | WidgetDialogClass<TOptions>;\r\n\r\nexport function reactPatch() {\r\n    // @ts-ignore check for global\r\n    let globalObj: any = typeof (global) !== \"undefined\" ? global : (typeof (window) !== \"undefined\" ? window : (typeof (self) !== \"undefined\" ? self : null));\r\n\r\n    // @ts-ignore\r\n    if (typeof React === \"undefined\" && typeof globalObj !== \"undefined\") {\r\n        if (globalObj['preact'] != null) {\r\n            globalObj['React'] = globalObj['ReactDOM'] = globalObj['preact'];\r\n            // @ts-ignore\r\n            (React as any).Fragment = (React as any).Fragment ?? \"x-fragment\";\r\n        }\r\n        else if (globalObj['Nerv'] != null) {\r\n            globalObj['React'] = globalObj['ReactDOM'] = globalObj['Nerv'];\r\n            // @ts-ignore\r\n            (React as any).Fragment = (React as any).Fragment ?? \"x-fragment\";\r\n        }\r\n        else {\r\n            globalObj['React'] = {\r\n                Component: function () { } as any,\r\n                Fragment: \"x-fragment\" as any,\r\n                createElement: function () { return { _reactNotLoaded: true }; } as any\r\n            } as any\r\n            globalObj['ReactDOM'] = {\r\n                render: function () { throw Error(\"To use React, it should be included before Serenity.CoreLib.js\"); }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nreactPatch();\r\n\r\nexport interface CreateWidgetParams<TWidget extends Widget<TOptions>, TOptions> {\r\n    type?: new (element: JQuery, options?: TOptions) => TWidget;\r\n    options?: TOptions;\r\n    container?: JQuery;\r\n    element?: (e: JQuery) => void;\r\n    init?: (w: TWidget) => void;\r\n}\r\n\r\n@Decorators.registerClass('Serenity.Widget')\r\nexport class Widget<TOptions = any> {\r\n    private static nextWidgetNumber = 0;\r\n    public element: JQuery;\r\n    protected options: TOptions;\r\n    protected widgetName: string;\r\n    protected uniqueName: string;\r\n    protected idPrefix: string;\r\n\r\n    constructor(element: JQuery, options?: TOptions) {\r\n\r\n        this.element = element;\r\n        this.options = options || ({} as TOptions);\r\n\r\n        this.widgetName = Widget.getWidgetName(getInstanceType(this));\r\n        this.uniqueName = this.widgetName + (Widget.nextWidgetNumber++).toString();\r\n\r\n        if (element.data(this.widgetName)) {\r\n            throw new Exception(format(\"The element already has widget '{0}'!\", this.widgetName));\r\n        }\r\n\r\n        element.on('remove.' + this.widgetName, e => {\r\n            if (e.bubbles || e.cancelable) {\r\n                return;\r\n            }\r\n            this.destroy();\r\n        }).data(this.widgetName, this);\r\n\r\n        this.addCssClass();\r\n\r\n        this.idPrefix = this.uniqueName + '_';\r\n        this.renderContents();\r\n    }\r\n\r\n    public destroy(): void {\r\n        if (this.element) {\r\n            this.element.removeClass('s-' + getTypeName(getInstanceType(this)));\r\n            this.element.off('.' + this.widgetName).off('.' + this.uniqueName).removeData(this.widgetName);\r\n            this.element = null;\r\n        }\r\n    }\r\n\r\n    protected addCssClass(): void {\r\n        this.element.addClass(this.getCssClass());\r\n    }\r\n\r\n    protected getCssClass(): string {\r\n        var type = getInstanceType(this);\r\n        var classList: string[] = [];\r\n        var fullClass = replaceAll(getTypeFullName(type), '.', '-');\r\n        classList.push(fullClass);\r\n\r\n        for (let k of Config.rootNamespaces) {\r\n            if (startsWith(fullClass, k + '-')) {\r\n                classList.push(fullClass.substr(k.length + 1));\r\n                break;\r\n            }\r\n        }\r\n\r\n        classList.push(getTypeName(type));\r\n        return classList\r\n            .filter((v, i, a) => a.indexOf(v) === i)\r\n            .map(s => 's-' + s)\r\n            .join(\" \");\r\n    }\r\n\r\n    public static getWidgetName(type: Function): string {\r\n        return replaceAll(getTypeFullName(type), '.', '_');\r\n    }\r\n\r\n    public static elementFor<TWidget>(editorType: { new (...args: any[]): TWidget }): JQuery {\r\n        var elementAttr = getAttributes(editorType, ElementAttribute, true);\r\n        var elementHtml = ((elementAttr.length > 0) ? elementAttr[0].value : '<input/>');\r\n        return $(elementHtml);\r\n    };\r\n\r\n    public addValidationRule(eventClass: string, rule: (p1: JQuery) => string): JQuery {\r\n        return addValRule(this.element, eventClass, rule);\r\n    }\r\n\r\n    public getGridField(): JQuery {\r\n        return this.element.closest('.field');\r\n    } \r\n\r\n    public change(handler: (e: JQueryEventObject) => void) {\r\n        this.element.on('change.' + this.uniqueName, handler);\r\n    };\r\n\r\n    public changeSelect2(handler: (e: JQueryEventObject) => void) {\r\n        this.element.on('change.' + this.uniqueName, function (e, valueSet) {\r\n            if (valueSet !== true)\r\n                handler(e);\r\n        });\r\n    };\r\n\r\n    public static create<TWidget extends Widget<TOpt>, TOpt>(params: CreateWidgetParams<TWidget, TOpt>) {\r\n        let widget: TWidget;\r\n\r\n        if (isAssignableFrom(IDialog, params.type)) {\r\n            widget = new (params.type as any)(params.options);\r\n            if (params.container)\r\n                widget.element.appendTo(params.container);\r\n            params.element && params.element(widget.element);\r\n        }\r\n        else {\r\n            var e = Widget.elementFor(params.type);\r\n            if (params.container)\r\n                e.appendTo(params.container);\r\n            params.element && params.element(e);\r\n            widget = new params.type(e, params.options);\r\n        }\r\n\r\n        widget.init(null);\r\n        params.init && params.init(widget);\r\n\r\n        return widget;\r\n    }\r\n\r\n    public initialize(): void {\r\n    }\r\n\r\n    public init(action?: (widget: any) => void): this {\r\n        action && action(this);\r\n        return this;\r\n    }\r\n\r\n    protected renderContents(): void {\r\n    }\r\n\r\n    private static __isWidgetType = true;\r\n}\r\n\r\nif (typeof $ !== \"undefined\" && $.fn) {\r\n    ($.fn as any).tryGetWidget = function (this: JQuery, type: any) {\r\n        var element = this;\r\n        var w;\r\n        if (isAssignableFrom(Widget, type)) {\r\n            var widgetName = Widget.getWidgetName(type);\r\n            w = element.data(widgetName);\r\n            if (w != null && !isAssignableFrom(type, getInstanceType(w))) {\r\n                w = null;\r\n            }\r\n            if (w != null) {\r\n                return w;\r\n            }\r\n        }\r\n\r\n        var data = element.data();\r\n        if (data == null) {\r\n            return null;\r\n        }\r\n\r\n        for (var key of Object.keys(data)) {\r\n            w = data[key];\r\n            if (w != null && isAssignableFrom(type, getInstanceType(w))) {\r\n                return w;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    ($.fn as any).getWidget = function<TWidget>(this: JQuery, type: { new (...args: any[]): TWidget }) {\r\n        if (this == null) {\r\n            throw new ArgumentNullException('element');\r\n        }\r\n        if (this.length === 0) {\r\n            throw new Exception(format(\"Searching for widget of type '{0}' on a non-existent element! ({1})\",\r\n                getTypeFullName(type), this.selector));\r\n        }\r\n\r\n        var w = (this as any).tryGetWidget(type);\r\n        if (w == null) {\r\n            var message = format(\"Element has no widget of type '{0}'! If you have recently changed \" +\r\n                \"editor type of a property in a form class, or changed data type in row (which also changes \" +\r\n                \"editor type) your script side Form definition might be out of date. Make sure your project \" +\r\n                \"builds successfully and transform T4 templates\", getTypeFullName(type));\r\n            notifyError(message, '', null);\r\n            throw new Exception(message);\r\n        }\r\n        return w;\r\n    };\r\n}\r\n\r\nexport interface WidgetComponentProps<W extends Widget<any>> {\r\n    id?: string;\r\n    name?: string;\r\n    className?: string;\r\n    maxLength?: number;\r\n    placeholder?: string;\r\n    setOptions?: any;\r\n    required?: boolean;\r\n    readOnly?: boolean;\r\n    oneWay?: boolean;\r\n    onChange?: (e: JQueryEventObject) => void;\r\n    onChangeSelect2?: (e: JQueryEventObject) => void;\r\n    value?: any;\r\n    defaultValue?: any;\r\n}\r\n\r\nexport declare interface Widget<TOptions> {\r\n    change(handler: (e: JQueryEventObject) => void): void;\r\n    changeSelect2(handler: (e: JQueryEventObject) => void): void;\r\n}\r\n\r\nif (typeof jQuery === \"function\") {\r\n    jQueryPatch(jQuery);\r\n}\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { htmlEncode, isEmptyOrNull, startsWith } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"./widget\";\r\n\r\nexport interface ToolButton {\r\n    title?: string;\r\n    hint?: string;\r\n    cssClass?: string;\r\n    icon?: string;\r\n    onClick?: any;\r\n    htmlEncode?: any;\r\n    hotkey?: string;\r\n    hotkeyAllowDefault?: boolean;\r\n    hotkeyContext?: any;\r\n    separator?: (false | true | 'left' | 'right' | 'both');\r\n    visible?: boolean | (() => boolean);\r\n    disabled?: boolean | (() => boolean);\r\n}\r\n\r\nexport interface PopupMenuButtonOptions {\r\n    menu?: JQuery;\r\n    onPopup?: () => void;\r\n    positionMy?: string;\r\n    positionAt?: string;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.PopupMenuButton')\r\nexport class PopupMenuButton extends Widget<PopupMenuButtonOptions> {\r\n    constructor(div: JQuery, opt: PopupMenuButtonOptions) {\r\n        super(div, opt);\r\n\r\n        div.addClass('s-PopupMenuButton');\r\n        div.click(e => {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            if (this.options.onPopup != null) {\r\n                this.options.onPopup();\r\n            }\r\n\r\n            var menu = this.options.menu;\r\n            menu.show().position({\r\n                my: this.options.positionMy ?? 'left top',\r\n                at: this.options.positionAt ?? 'left bottom',\r\n                of: this.element\r\n            });\r\n\r\n            var uq = this.uniqueName;\r\n            $(document).one('click.' + uq, function (x) {\r\n                menu.hide();\r\n            });\r\n        });\r\n\r\n        this.options.menu.hide().appendTo(document.body)\r\n            .addClass('s-PopupMenu').menu();\r\n    }\r\n\r\n    destroy() {\r\n        if (this.options.menu != null) { \r\n            this.options.menu.remove();\r\n            this.options.menu = null;\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n}\r\n\r\n\r\nexport interface PopupToolButtonOptions extends PopupMenuButtonOptions {\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.PopupToolButton')\r\nexport class PopupToolButton extends PopupMenuButton {\r\n    constructor(div: JQuery, opt: PopupToolButtonOptions) {\r\n        super(div, opt);\r\n\r\n        div.addClass('s-PopupToolButton');\r\n        $('<b/>').appendTo(div.children('.button-outer').children('span'));\r\n    }\r\n}\r\n\r\nexport interface ToolbarOptions {\r\n    buttons?: ToolButton[];\r\n    hotkeyContext?: any;\r\n}\r\n\r\n@Decorators.registerClass('Serenity.Toolbar')\r\nexport class Toolbar extends Widget<ToolbarOptions> {\r\n    constructor(div: JQuery, options: ToolbarOptions) {\r\n        super(div, options);\r\n\r\n        this.element.addClass('s-Toolbar clearfix')\r\n            .html('<div class=\"tool-buttons\"><div class=\"buttons-outer\">' +\r\n                '<div class=\"buttons-inner\"></div></div></div>');\r\n\r\n        this.createButtons();\r\n    }\r\n\r\n    destroy() {\r\n        this.element.find('div.tool-button').unbind('click');\r\n        if (this.mouseTrap) {\r\n            if (!!this.mouseTrap.destroy) {\r\n                this.mouseTrap.destroy();\r\n            }\r\n            else {\r\n                this.mouseTrap.reset();\r\n            }\r\n            this.mouseTrap = null;\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    protected mouseTrap: any;\r\n\r\n    protected createButtons() {\r\n        var container: JQuery = $('div.buttons-inner', this.element).last();\r\n        var buttons = this.options.buttons;\r\n        var currentCount = 0;\r\n        for (var i = 0; i < buttons.length; i++) {\r\n            var button = buttons[i];\r\n            if (button.separator && currentCount > 0) {\r\n                container = $('<div class=\"buttons-inner\"></div>').appendTo(container.parent());\r\n                currentCount = 0;\r\n            }\r\n            this.createButton(container, button);\r\n            currentCount++;\r\n        }\r\n    }\r\n\r\n    protected createButton(container: JQuery, b: ToolButton) {\r\n        var cssClass = b.cssClass ?? '';\r\n\r\n        var btn = $('<div class=\"tool-button\"><div class=\"button-outer\">' +\r\n            '<span class=\"button-inner\"></span></div></div>')\r\n            .appendTo(container);\r\n\r\n        if (b.separator === 'right' || b.separator === 'both') {\r\n            $('<div class=\"separator\"></div>').appendTo(container);\r\n        }\r\n\r\n        if (cssClass.length > 0) {\r\n            btn.addClass(cssClass);\r\n        }\r\n\r\n        if (!isEmptyOrNull(b.hint)) {\r\n            btn.attr('title', b.hint);\r\n        }\r\n\r\n        btn.click(function (e) {\r\n            if (btn.hasClass('disabled')) {\r\n                return;\r\n            }\r\n            b.onClick(e);\r\n        });\r\n\r\n        var text = b.title;\r\n        if (b.htmlEncode !== false) {\r\n            text = htmlEncode(b.title);\r\n        }\r\n\r\n        if (!isEmptyOrNull(b.icon)) {\r\n            btn.addClass('icon-tool-button');\r\n            var klass = b.icon;\r\n            if (startsWith(klass, 'fa-')) {\r\n                klass = 'fa ' + klass;\r\n            }\r\n            else if (startsWith(klass, 'glyphicon-')) {\r\n                klass = 'glyphicon ' + klass;\r\n            }\r\n            text = \"<i class='\" + klass + \"'></i> \" + text;\r\n        }\r\n        if (text == null || text.length === 0) {\r\n            btn.addClass('no-text');\r\n        }\r\n        else {\r\n            btn.find('span').html(text);\r\n        }\r\n\r\n        if (b.visible === false)\r\n            btn.hide();\r\n\r\n        if (b.disabled != null && typeof b.disabled !== \"function\")\r\n            btn.toggleClass('disabled', !!b.disabled);\r\n\r\n        if (typeof b.visible === \"function\" || typeof b.disabled == \"function\") {\r\n            btn.on('updateInterface', () => {\r\n                if (typeof b.visible === \"function\")\r\n                    btn.toggle(!!b.visible());\r\n\r\n                if (typeof b.disabled === \"function\")\r\n                    btn.toggleClass(\"disabled\", !!b.disabled());\r\n            });\r\n        }\r\n\r\n        if (!!(!isEmptyOrNull(b.hotkey) && window['Mousetrap'] != null)) {\r\n            this.mouseTrap = this.mouseTrap || window['Mousetrap'](\r\n                b.hotkeyContext || this.options.hotkeyContext || window.document.documentElement);\r\n\r\n            this.mouseTrap.bind(b.hotkey, function (e1: BaseJQueryEventObject, action: any) {\r\n                if (btn.is(':visible')) {\r\n                    btn.triggerHandler('click');\r\n                }\r\n                return b.hotkeyAllowDefault;\r\n            });\r\n        }\r\n    }\r\n\r\n    findButton(className: string): JQuery {\r\n        if (className != null && startsWith(className, '.')) {\r\n            className = className.substr(1);\r\n        }\r\n        return $('div.tool-button.' + className, this.element);\r\n    }\r\n\r\n    updateInterface() {\r\n        this.element.find('.tool-button').each(function (i: number, el: Element) {\r\n            $(el).triggerHandler('updateInterface')\r\n        });\r\n    }\r\n}\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { canLoadScriptData, Config, format, getBaseType, getInstanceType, getTemplate, getTypeFullName, getTypeName, replaceAll, startsWith, text } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"./widget\";\r\n\r\n@Decorators.registerClass(\"Serenity.TemplatedWidget\")\r\nexport class TemplatedWidget<TOptions> extends Widget<TOptions> {\r\n\r\n    private static templateNames: { [key: string]: string } = {};\r\n\r\n    protected byId(id: string): JQuery {\r\n        return $('#' + this.idPrefix + id);\r\n    }\r\n\r\n    private byID<TWidget>(id: string, type: { new (...args: any[]): TWidget }) {\r\n        return this.byId(id).getWidget(type);\r\n    }\r\n\r\n    private static noGeneric(s: string): string {\r\n        var dollar = s.indexOf('$');\r\n        if (dollar >= 0) {\r\n            return s.substr(0, dollar);\r\n        }\r\n        return s;\r\n    }\r\n\r\n    private getDefaultTemplateName(): string {\r\n        return TemplatedWidget.noGeneric(getTypeName(\r\n            getInstanceType(this)));\r\n    }\r\n\r\n    protected getTemplateName(): string {\r\n\r\n        var type = getInstanceType(this);\r\n        var fullName = getTypeFullName(type);\r\n\r\n        var templateNames = TemplatedWidget.templateNames;\r\n\r\n        var cachedName = TemplatedWidget.templateNames[fullName];\r\n        if (cachedName != null) {\r\n            return cachedName;\r\n        }\r\n        \r\n        while (type && type !== Widget) {\r\n            var name = TemplatedWidget.noGeneric(getTypeFullName(type));\r\n\r\n            for (let k of Config.rootNamespaces) {\r\n                if (startsWith(name, k + '.')) {\r\n                    name = name.substr(k.length + 1);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if (canLoadScriptData('Template.' + name)) {\r\n                templateNames[fullName] = name;\r\n                return name;\r\n            }\r\n\r\n            name = replaceAll(name, '.', '_');\r\n            if (canLoadScriptData('Template.' + name) ||\r\n                $('script#Template_' + name).length > 0) {\r\n                templateNames[fullName] = name;\r\n                return name;\r\n            }\r\n\r\n            name = TemplatedWidget.noGeneric(getTypeName(type));\r\n            if (canLoadScriptData('Template.' + name) ||\r\n                $('script#Template_' + name).length > 0) {\r\n                TemplatedWidget.templateNames[fullName] = name;\r\n                return name;\r\n            }\r\n\r\n            type = getBaseType(type);\r\n        }\r\n\r\n        templateNames[fullName] = cachedName = this.getDefaultTemplateName();\r\n        return cachedName;\r\n    }\r\n\r\n    protected getFallbackTemplate(): string {\r\n        return null;\r\n    }\r\n\r\n    protected getTemplate(): string {\r\n        var templateName = this.getTemplateName();\r\n\r\n        var script = $('script#Template_' + templateName);\r\n        if (script.length > 0) {\r\n            return script.html();\r\n        }\r\n\r\n        let template: string;\r\n        if (!canLoadScriptData('Template.' + templateName) &&\r\n            this.getDefaultTemplateName() == templateName) {\r\n            template = this.getFallbackTemplate();\r\n            if (template != null)\r\n                return template;\r\n        }\r\n            \r\n        template = getTemplate(templateName);\r\n\r\n        if (template == null) {\r\n            throw new Error(format(\r\n                \"Can't locate template for widget '{0}' with name '{1}'!\",\r\n                getTypeName(getInstanceType(this)), templateName));\r\n        }\r\n\r\n        return template;\r\n    }\r\n\r\n    protected renderContents(): void {\r\n        var widgetMarkup = this.getTemplate().replace(new RegExp('~_', 'g'), this.idPrefix);\r\n\r\n        // for compatibility with older templates based on JsRender\r\n        var end = 0;\r\n        while (true) {\r\n            var idx = widgetMarkup.indexOf('{{text:\"', end);\r\n            if (idx < 0)\r\n                break;\r\n            var end = widgetMarkup.indexOf('\"}}', idx);\r\n            if (end < 0)\r\n                break;\r\n            var key = widgetMarkup.substr(idx + 8, end - idx - 8);\r\n            var txt = text(key);\r\n            widgetMarkup = widgetMarkup.substr(0, idx) + txt + widgetMarkup.substr(end + 3);\r\n            end = idx + txt.length;\r\n        }\r\n\r\n        this.element.html(widgetMarkup);\r\n    }\r\n}", "\uFEFFimport { Decorators, FlexifyAttribute, MaximizableAttribute, PanelAttribute, ResizableAttribute, ResponsiveAttribute } from \"../../decorators\";\r\nimport { IDialog } from \"../../interfaces\";\r\nimport { bsModalMarkup, closePanel, Config, DialogButton, dialogButtonToBS, dialogButtonToUI, endsWith, getAttributes, getInstanceType, isEmptyOrNull, layoutFillHeight, newBodyDiv, parseInteger, positionToastContainer, validateOptions } from \"@serenity-is/corelib/q\";\r\nimport { TemplatedWidget } from \"../widgets/templatedwidget\";\r\nimport { Toolbar, ToolButton } from \"../widgets/toolbar\";\r\nimport { DialogExtensions } from \"./dialogextensions\";\r\n\r\n@Decorators.registerClass('Serenity.TemplatedDialog', [IDialog])\r\nexport class TemplatedDialog<TOptions> extends TemplatedWidget<TOptions> {\r\n\r\n    protected tabs: JQuery;\r\n    protected toolbar: Toolbar;\r\n    protected validator: JQueryValidation.Validator;\r\n\r\n    constructor(options?: TOptions) {\r\n        super(newBodyDiv().addClass('s-TemplatedDialog hidden'), options);\r\n\r\n        this.element.attr(\"id\", this.uniqueName);\r\n\r\n        this.initValidator();\r\n        this.initTabs();\r\n        this.initToolbar();\r\n    }\r\n\r\n    private get isMarkedAsPanel() {\r\n        var panelAttr = getAttributes(getInstanceType(this),\r\n            PanelAttribute, true) as PanelAttribute[];\r\n        return panelAttr.length > 0 && panelAttr[panelAttr.length - 1].value !== false;\r\n    }\r\n\r\n    private get isResponsive() {\r\n        return Config.responsiveDialogs ||\r\n            getAttributes(getInstanceType(this), ResponsiveAttribute, true).length > 0;\r\n    }\r\n\r\n    private static getCssSize(element: JQuery, name: string): number {\r\n        var cssSize = element.css(name);\r\n        if (cssSize == null) {\r\n            return null;\r\n        }\r\n\r\n        if (!endsWith(cssSize, 'px')) {\r\n            return null;\r\n        }\r\n\r\n        cssSize = cssSize.substr(0, cssSize.length - 2);\r\n        let i = parseInteger(cssSize);\r\n        if (i == null || isNaN(i) || i == 0)\r\n            return null;\r\n\r\n        return i;\r\n    }\r\n\r\n    private static applyCssSizes(opt: JQueryUI.DialogOptions, dialogClass: string) {\r\n        let size: number;\r\n        let dialog = $('<div/>').hide().addClass(dialogClass).appendTo(document.body);\r\n        try {\r\n            var sizeHelper = $('<div/>').addClass('size').appendTo(dialog);\r\n            size = TemplatedDialog.getCssSize(sizeHelper, 'minWidth'); \r\n            if (size != null)\r\n                opt.minWidth = size;\r\n\r\n            size = TemplatedDialog.getCssSize(sizeHelper, 'width');\r\n            if (size != null)\r\n                opt.width = size;\r\n\r\n            size = TemplatedDialog.getCssSize(sizeHelper, 'height');\r\n            if (size != null)\r\n                opt.height = size;\r\n\r\n            size = TemplatedDialog.getCssSize(sizeHelper, 'minHeight');\r\n            if (size != null)\r\n                opt.minHeight = size;\r\n        }\r\n        finally {\r\n            dialog.remove();\r\n        }\r\n    };\r\n\r\n    public destroy(): void {\r\n        this.tabs && this.tabs.tabs('destroy');\r\n        this.tabs = null;\r\n        this.toolbar && this.toolbar.destroy();\r\n        this.toolbar = null;\r\n        this.validator && this.byId('Form').remove();\r\n        this.validator = null;\r\n        if (this.element != null &&\r\n            this.element.hasClass('ui-dialog-content')) {\r\n            this.element.dialog('destroy');\r\n            this.element.removeClass('ui-dialog-content');\r\n        }\r\n        else if (this.element != null &&\r\n            this.element.hasClass('modal-body')) {\r\n            var modal = this.element.closest('.modal').data('bs.modal', null);\r\n            this.element && this.element.removeClass('modal-body');\r\n            window.setTimeout(() => modal.remove(), 0);\r\n        }\r\n        \r\n        $(window).unbind('.' + this.uniqueName);\r\n        super.destroy();\r\n    }\r\n\r\n    protected initDialog(): void {\r\n        if (this.element.hasClass('ui-dialog-content'))\r\n            return;\r\n\r\n        this.element.removeClass('hidden');\r\n\r\n        this.element.dialog(this.getDialogOptions());\r\n        this.element.closest('.ui-dialog').on('resize', e => this.arrange());\r\n\r\n        let type = getInstanceType(this);\r\n\r\n        if (this.isResponsive) {\r\n            DialogExtensions.dialogResizable(this.element);\r\n\r\n            $(window).bind('resize.' + this.uniqueName, e => {\r\n                if (this.element && this.element.is(':visible')) {\r\n                    this.handleResponsive();\r\n                }\r\n            });\r\n\r\n            this.element.closest('.ui-dialog').addClass('flex-layout');\r\n        }\r\n        else if (DialogExtensions[\"dialogFlexify\"] &&\r\n            getAttributes(type, FlexifyAttribute, true).length > 0) {\r\n            DialogExtensions[\"dialogFlexify\"](this.element);\r\n            DialogExtensions.dialogResizable(this.element);\r\n        }\r\n        \r\n        if (getAttributes(type, MaximizableAttribute, true).length > 0) {\r\n            DialogExtensions.dialogMaximizable(this.element);\r\n        }\r\n\r\n        var self = this;\r\n        this.element.bind('dialogopen.' + this.uniqueName, () => {\r\n            $(document.body).addClass('modal-dialog-open');\r\n\r\n            if (this.isResponsive) {\r\n                this.handleResponsive();\r\n            }\r\n\r\n            self.onDialogOpen();\r\n        });\r\n\r\n        this.element.bind('dialogclose.' + this.uniqueName, () => {\r\n            $(document.body).toggleClass('modal-dialog-open', $('.ui-dialog:visible').length > 0);\r\n            self.onDialogClose();\r\n        });\r\n    }\r\n\r\n    protected getModalOptions(): ModalOptions {\r\n        return {\r\n            backdrop: false,\r\n            keyboard: false,\r\n            size: 'lg',\r\n            modalClass: this.getCssClass()\r\n        }\r\n    }\r\n\r\n    protected initModal(): void {\r\n        if (this.element.hasClass('modal-body'))\r\n            return;\r\n        \r\n        var title = this.element.data('dialogtitle') ?? this.getDialogTitle() ?? '';\r\n        var opt = this.getModalOptions();\r\n        opt[\"show\"] = false;\r\n        var modalClass = \"s-Modal\";\r\n        \r\n        if (opt.modalClass)\r\n            modalClass += ' ' + opt.modalClass;\r\n\r\n        var markup = bsModalMarkup(title, '', modalClass);\r\n        var modal = $(markup).eq(0).appendTo(document.body).addClass('flex-layout');\r\n        modal.one('shown.bs.modal.' + this.uniqueName, () => {\r\n            this.element.triggerHandler('shown.bs.modal');\r\n            this.onDialogOpen();\r\n        });\r\n\r\n        modal.one('hidden.bs.modal.' + this.uniqueName, () => {\r\n            $(document.body).toggleClass('modal-open', $('.modal.show').length + $('.modal.in').length > 0);\r\n            this.onDialogClose();\r\n        });\r\n        if (opt.size)\r\n            modal.find('.modal-dialog').addClass('modal-' + opt.size);\r\n\r\n        var footer = modal.find('.modal-footer');\r\n        var buttons = this.getDialogButtons();\r\n        if (buttons != null) {\r\n            for (var x of buttons) {\r\n                $(dialogButtonToBS(x)).appendTo(footer).click(x.click);\r\n            }\r\n        }\r\n        else\r\n            footer.hide();\r\n\r\n        (modal as any).modal(opt);\r\n        modal.find('.modal-body').replaceWith(this.element.removeClass('hidden').addClass('modal-body'));\r\n        $(window).on('resize.' + this.uniqueName, this.arrange.bind(this));\r\n    }\r\n\r\n    protected initToolbar(): void {\r\n        var toolbarDiv = this.byId('Toolbar');\r\n        if (toolbarDiv.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var hotkeyContext = this.element.closest('.ui-dialog');\r\n        if (hotkeyContext.length === 0) {\r\n            hotkeyContext = this.element.closest('.modal');\r\n            if (hotkeyContext.length == 0)\r\n                hotkeyContext = this.element;\r\n        }\r\n\r\n        var opt = { buttons: this.getToolbarButtons(), hotkeyContext: hotkeyContext[0] };\r\n        this.toolbar = new Toolbar(toolbarDiv, opt);\r\n    }\r\n\r\n    protected getToolbarButtons(): ToolButton[] {\r\n        return [];\r\n    }\r\n\r\n    protected getValidatorOptions(): JQueryValidation.ValidationOptions {\r\n        return {};\r\n    }\r\n\r\n    protected initValidator(): void {\r\n        var form = this.byId('Form');\r\n        if (form.length > 0) {\r\n            var valOptions = this.getValidatorOptions();\r\n            this.validator = form.validate(validateOptions(valOptions));\r\n        }\r\n    }\r\n\r\n    protected resetValidation() {\r\n        this.validator && (this.validator as any).resetAll();\r\n    }\r\n\r\n    protected validateForm() {\r\n        return this.validator == null || !!this.validator.form();\r\n    }\r\n\r\n    public dialogOpen(asPanel?: boolean): void {\r\n        asPanel = asPanel ?? this.isMarkedAsPanel;\r\n        if (asPanel) {\r\n            if (!this.element.hasClass('s-Panel')) {\r\n                // so that panel title is created if needed\r\n                this.element.on('panelopen.' + this.uniqueName, () => {\r\n                    this.onDialogOpen();\r\n                });\r\n                this.element.on('panelclose.' + this.uniqueName, () => {\r\n                    this.onDialogClose();\r\n                });\r\n            }\r\n\r\n            TemplatedDialog.openPanel(this.element, this.uniqueName);\r\n            this.setupPanelTitle();\r\n        }\r\n        else if (this.useBSModal()) {\r\n            this.initModal();\r\n            (this.element.closest('.modal') as any).modal('show');\r\n        }\r\n        else {\r\n            this.initDialog();\r\n            this.element.dialog('open');\r\n        }\r\n    }\r\n\r\n    private useBSModal() {\r\n        return !!((!$.ui || !$.ui.dialog) || TemplatedDialog.bootstrapModal);\r\n    }\r\n\r\n    public static bootstrapModal: boolean;\r\n\r\n    public static openPanel(element: JQuery, uniqueName: string) {\r\n        var container = $('.panels-container');\r\n        if (!container.length)\r\n            container = $('section.content');\r\n\r\n        element.data('paneluniquename', uniqueName);\r\n\r\n        if (container.length) {\r\n            container = container.last();\r\n            container.children()\r\n                .not(element)\r\n                .not('.panel-hidden')\r\n                .addClass('panel-hidden panel-hidden-' + uniqueName);\r\n\r\n            if (element[0].parentElement !== container[0])\r\n                element.appendTo(container);\r\n        }\r\n\r\n        $('.ui-dialog:visible, .ui-widget-overlay:visible, .modal.show, .modal.in')\r\n            .not(element)\r\n            .addClass('panel-hidden panel-hidden-' + uniqueName);\r\n\r\n        element\r\n            .removeClass('hidden')\r\n            .removeClass('panel-hidden')\r\n            .addClass('s-Panel')\r\n            .trigger('panelopen');\r\n    }\r\n\r\n    public static closePanel(element: JQuery, e?: JQueryEventObject) {\r\n        return closePanel(element, e);\r\n    }\r\n\r\n    protected onDialogOpen(): void {\r\n        if (!$(document.documentElement).hasClass('mobile-device'))\r\n            $(':input', this.element).not('button').eq(0).focus();\r\n        this.arrange();\r\n        this.tabs && this.tabs.tabs('option', 'active', 0);\r\n    }\r\n\r\n    protected arrange(): void {\r\n        this.element.find('.require-layout').filter(':visible').each(function (i, e) {\r\n            $(e).triggerHandler('layout');\r\n        });\r\n    }\r\n\r\n    protected onDialogClose() {\r\n        $(document).trigger('click');\r\n\r\n        // for tooltips etc.\r\n        if (($ as any).qtip) {\r\n            $(document.body).children('.qtip').each(function (index, el) {\r\n                ($(el) as any).qtip('hide');\r\n            });\r\n        }\r\n\r\n        window.setTimeout(() => {\r\n            var element = this.element;\r\n            this.destroy();\r\n            element.remove();\r\n            positionToastContainer(false, null);\r\n        }, 0);\r\n    }\r\n\r\n    protected addCssClass(): void {\r\n        if (this.isMarkedAsPanel) {\r\n            super.addCssClass();\r\n\r\n            if (this.isResponsive)\r\n                this.element.addClass(\"flex-layout\");\r\n        }\r\n    }\r\n\r\n    protected getDialogButtons(): DialogButton[] {\r\n        return undefined;\r\n    }\r\n\r\n    protected getDialogOptions(): JQueryUI.DialogOptions {\r\n        var opt: JQueryUI.DialogOptions = {};\r\n        var dialogClass = 's-Dialog ' + this.getCssClass();\r\n        opt.dialogClass = dialogClass;\r\n        var buttons = this.getDialogButtons();\r\n        if (buttons != null)\r\n            opt.buttons = buttons.map(dialogButtonToUI);\r\n        opt.width = 920;\r\n        TemplatedDialog.applyCssSizes(opt, dialogClass);\r\n        opt.autoOpen = false;\r\n        let type = getInstanceType(this);\r\n        opt.resizable = getAttributes(type, ResizableAttribute, true).length > 0;\r\n        opt.modal = true;\r\n        opt.position = { my: 'center', at: 'center', of: $(window.window) };\r\n        opt.title = this.element.data('dialogtitle') ?? this.getDialogTitle() ?? '';\r\n        return opt;\r\n    }\r\n\r\n    protected getDialogTitle() {\r\n        return \"\";\r\n    }\r\n\r\n    public dialogClose(): void {\r\n        if (this.element.hasClass('ui-dialog-content'))\r\n            this.element.dialog().dialog('close');\r\n        else if (this.element.hasClass('modal-body'))\r\n            (this.element.closest('.modal') as any).modal('hide');\r\n        else if (this.element.hasClass('s-Panel') && !this.element.hasClass('hidden')) {\r\n            TemplatedDialog.closePanel(this.element);\r\n        }\r\n    }\r\n\r\n    public get dialogTitle(): string {\r\n        if (this.element.hasClass('ui-dialog-content'))\r\n            return this.element.dialog('option', 'title');\r\n        else if (this.element.hasClass('modal-body'))\r\n            return this.element.closest('.modal').find('.modal-header').children('h5').text();\r\n\r\n        return this.element.data('dialogtitle');\r\n    }\r\n\r\n    private setupPanelTitle() {\r\n        var value = this.dialogTitle ?? this.getDialogTitle();\r\n        var pt = this.element.children('.panel-titlebar');\r\n\r\n        if (isEmptyOrNull(value)) {\r\n            pt.remove();\r\n        }\r\n        else {\r\n            if (!this.element.children('.panel-titlebar').length) {\r\n                pt = $(\"<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>\")\r\n                    .prependTo(this.element);\r\n            }\r\n            pt.children('.panel-titlebar-text').text(value);\r\n\r\n            if (this.element.hasClass('s-Panel')) {\r\n                if (!pt.children('.panel-titlebar-close').length) {\r\n                    $('<button class=\"panel-titlebar-close\">&nbsp;</button>')\r\n                        .prependTo(pt)\r\n                        .click(e => {\r\n                            TemplatedDialog.closePanel(this.element, e);\r\n                        });\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public set dialogTitle(value: string) {\r\n        var oldTitle = this.dialogTitle;\r\n        this.element.data('dialogtitle', value);\r\n\r\n        if (this.element.hasClass('ui-dialog-content'))\r\n            this.element.dialog('option', 'title', value);\r\n        else if (this.element.hasClass('modal-body')) {\r\n            this.element.closest('.modal').find('.modal-header').children('h5').text(value ?? '');\r\n        }\r\n        else if (this.element.hasClass('s-Panel')) {\r\n            if (oldTitle != this.dialogTitle) {\r\n                this.setupPanelTitle();\r\n                this.arrange();\r\n            }\r\n\r\n        }\r\n    }\r\n\r\n    public set_dialogTitle(value: string) {\r\n        this.dialogTitle = value;\r\n    }\r\n\r\n    protected initTabs(): void {\r\n        var tabsDiv = this.byId('Tabs');\r\n        if (tabsDiv.length === 0) {\r\n            return;\r\n        }\r\n        this.tabs = tabsDiv.tabs({});\r\n        this.tabs.bind('tabsactivate', () => this.arrange());\r\n    }\r\n\r\n    protected handleResponsive(): void {\r\n        var dlg = this.element.dialog();\r\n        var uiDialog = this.element.closest('.ui-dialog');\r\n        if ($(document.documentElement).hasClass('mobile-device')) {\r\n            var data = this.element.data('responsiveData');\r\n            if (!data) {\r\n                data = {};\r\n                data.draggable = dlg.dialog('option', 'draggable');\r\n                data.resizable = dlg.dialog('option', 'resizable');\r\n                data.position = dlg.css('position');\r\n                var pos = uiDialog.position();\r\n                data.left = pos.left;\r\n                data.top = pos.top;\r\n                data.width = uiDialog.width();\r\n                data.height = uiDialog.height();\r\n                data.contentHeight = this.element.height();\r\n                this.element.data('responsiveData', data);\r\n                dlg.dialog('option', 'draggable', false);\r\n                dlg.dialog('option', 'resizable', false);\r\n            }\r\n            uiDialog.addClass('mobile-layout');\r\n            uiDialog.css({ left: '0px', top: '0px', width: $(window).width() + 'px', height: $(window).height() + 'px', position: 'fixed' });\r\n            $(document.body).scrollTop(0);\r\n            layoutFillHeight(this.element);\r\n        }\r\n        else {\r\n            var d = this.element.data('responsiveData');\r\n            if (d) {\r\n                dlg.dialog('option', 'draggable', d.draggable);\r\n                dlg.dialog('option', 'resizable', d.resizable);\r\n                this.element.closest('.ui-dialog').css({ left: '0px', top: '0px', width: d.width + 'px', height: d.height + 'px', position: d.position });\r\n                this.element.height(d.contentHeight);\r\n                uiDialog.removeClass('mobile-layout');\r\n                this.element.removeData('responsiveData');\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport interface ModalOptions {\r\n    backdrop?: boolean | 'static',\r\n    keyboard?: boolean,\r\n    size?: 'lg' | 'sm',\r\n    modalClass?: string;\r\n}", "\uFEFFimport { Widget } from \"./widget\";\r\nimport { LazyLoadHelper } from \"../helpers/lazyloadhelper\";\r\n\r\nif (typeof $ !== \"undefined\" && $.fn) {\r\n    $.fn.flexHeightOnly = function (flexY: number = 1) {\r\n        return this.flexWidthHeight(0, flexY);\r\n    }\r\n\r\n    $.fn.flexWidthOnly = function (flexX: number = 1) {\r\n        return this.flexWidthHeight(flexX, 0);\r\n    }\r\n\r\n    $.fn.flexWidthHeight = function (flexX: number = 1, flexY: number = 1) {\r\n        return this.addClass('flexify').data('flex-x', flexX).data('flex-y', flexY);\r\n    }\r\n\r\n    $.fn.flexX = function (flexX: number): JQuery {\r\n        return this.data('flex-x', flexX);\r\n    }\r\n\r\n    $.fn.flexY = function (flexY: number): JQuery {\r\n        return this.data('flex-y', flexY);\r\n    }\r\n}\r\n\r\nexport class Flexify extends Widget<FlexifyOptions> {\r\n    private xDifference = 0;\r\n    private yDifference = 0;\r\n    constructor(container: JQuery, options: FlexifyOptions) {\r\n        super(container, options);\r\n\r\n        LazyLoadHelper.executeOnceWhenShown(container, () => {\r\n            this.storeInitialSize();\r\n        });\r\n    }\r\n\r\n    storeInitialSize() {\r\n        if (!!this.element.data('flexify-init')) {\r\n            return;\r\n        }\r\n\r\n        var designWidth = this.options.designWidth;\r\n        if (designWidth == null)\r\n            designWidth = this.element.width();\r\n        this.element.data('flexify-width', designWidth);\r\n\r\n        var designHeight = this.options.designHeight;\r\n        if (designHeight == null)\r\n            designHeight = this.element.height();\r\n        this.element.data('flexify-height', designHeight);\r\n\r\n        this.element.data('flexify-init', true);\r\n\r\n        this.element.on('resize.' + this.uniqueName, () =>\r\n            this.resizeElements());\r\n\r\n        this.element.on('resizestop.' + this.uniqueName, () =>\r\n            this.resizeElements());\r\n        \r\n        var tabs = this.element.find('.ui-tabs');\r\n        if (tabs.length > 0) {\r\n            tabs.on('tabsactivate.' + this.uniqueName, () =>\r\n                this.resizeElements());\r\n        }\r\n\r\n        if (this.options.designWidth != null || this.options.designHeight != null) \r\n            this.resizeElements();\r\n    }\r\n\r\n    private getXFactor(element: JQuery): number {\r\n        var xFactor = null;\r\n        if (this.options.getXFactor != null)\r\n            xFactor = this.options.getXFactor(element);\r\n\r\n        if (xFactor == null)\r\n            xFactor = element.data('flex-x');\r\n\r\n        return xFactor ?? 1;\r\n    }\r\n\r\n    private getYFactor(element: JQuery): number {\r\n        var yFactor = null;\r\n\r\n        if (this.options.getYFactor != null) \r\n            yFactor = this.options.getYFactor(element);\r\n\r\n        if (yFactor == null) \r\n            yFactor = element.data('flex-y');\r\n\r\n        return yFactor ?? 0;\r\n    }\r\n\r\n    private resizeElements(): void {\r\n        var width = this.element.width();\r\n        var initialWidth = this.element.data('flexify-width');\r\n        if (initialWidth == null) {\r\n            this.element.data('flexify-width', width);\r\n            initialWidth = width;\r\n        }\r\n\r\n        var height = this.element.height();\r\n        var initialHeight = this.element.data('flexify-height');\r\n        if (initialHeight == null) {\r\n            this.element.data('flexify-height', height);\r\n            initialHeight = height;\r\n        }\r\n\r\n        this.xDifference = width - initialWidth;\r\n        this.yDifference = height - initialHeight;\r\n\r\n        var containers = this.element;\r\n        var tabPanels = this.element.find('.ui-tabs-panel');\r\n\r\n        if (tabPanels.length > 0) {\r\n            containers = tabPanels.filter(':visible');\r\n        }\r\n\r\n        containers.find('.flexify')\r\n            .add(tabPanels.filter('.flexify:visible'))\r\n            .each((i, e) => {\r\n                this.resizeElement($(e as any));\r\n            });\r\n    }\r\n\r\n    private resizeElement(element: JQuery): void {\r\n        var xFactor = this.getXFactor(element);\r\n        if(xFactor !== 0) {\r\n            var initialWidth = element.data('flexify-width');\r\n            if (initialWidth == null) {\r\n                var width = element.width();\r\n                element.data('flexify-width', width);\r\n                initialWidth = width;\r\n            }\r\n\r\n            element.width(initialWidth + xFactor * this.xDifference | 0);\r\n        }\r\n\r\n        var yFactor = this.getYFactor(element);\r\n        if (yFactor !== 0) {\r\n            var initialHeight = element.data('flexify-height');\r\n            if (initialHeight == null) {\r\n                var height = element.height();\r\n                element.data('flexify-height', height);\r\n                initialHeight = height;\r\n            }\r\n            element.height(initialHeight + yFactor * this.yDifference | 0);\r\n        }\r\n\r\n        if (element.hasClass('require-layout')) {\r\n            element.triggerHandler('layout');\r\n        }\r\n    }\r\n}\r\n\r\nexport interface FlexifyOptions {\r\n    getXFactor?: (p1: JQuery) => any;\r\n    getYFactor?: (p1: JQuery) => any;\r\n    designWidth?: any;\r\n    designHeight?: any;\r\n}", "\uFEFFimport { Flexify } from \"../widgets/flexify\";\r\n\r\nexport namespace DialogExtensions {\r\n\r\n    export function dialogResizable(dialog: JQuery, w?: any, h?: any, mw?: any, mh?: any): JQuery {\r\n        var dlg = dialog.dialog();\r\n        dlg.dialog('option', 'resizable', true);\r\n        if (mw != null) {\r\n            dlg.dialog('option', 'minWidth', mw);\r\n        }\r\n        if (w != null) {\r\n            dlg.dialog('option', 'width', w);\r\n        }\r\n        if (mh != null) {\r\n            dlg.dialog('option', 'minHeight', mh);\r\n        }\r\n        if (h != null) {\r\n            dlg.dialog('option', 'height', h);\r\n        }\r\n        return dialog;\r\n    }\r\n\r\n    export function dialogMaximizable(dialog: JQuery): JQuery {\r\n        (dialog as any).dialogExtend({\r\n            closable: true,\r\n            maximizable: true,\r\n            dblclick: 'maximize',\r\n            icons: { maximize: 'ui-icon-maximize-window' }\r\n        });\r\n\r\n        return dialog;\r\n    }\r\n\r\n    export function dialogFlexify(dialog: JQuery): JQuery {\r\n        new Flexify(dialog.closest('.ui-dialog'), {});\r\n        return dialog;\r\n    }\r\n}", "\uFEFFimport { validateOptions } from \"@serenity-is/corelib/q\";\r\nimport { TemplatedWidget } from \"./templatedwidget\";\r\nimport { Toolbar, ToolButton } from \"./toolbar\";\r\n\r\nexport class TemplatedPanel<TOptions> extends TemplatedWidget<TOptions> {\r\n    constructor(container: JQuery, options?: TOptions) {\r\n        super(container, options);\r\n\r\n        this.initValidator();\r\n        this.initTabs();\r\n        this.initToolbar();\r\n    }\r\n\r\n    destroy() {\r\n        if (this.tabs) {\r\n            this.tabs.tabs('destroy');\r\n            this.tabs = null;\r\n        }\r\n\r\n        if (this.toolbar) {\r\n            this.toolbar.destroy();\r\n            this.toolbar = null;\r\n        }\r\n\r\n        if (this.validator) {\r\n            this.byId('Form').remove();\r\n            this.validator = null;\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    protected tabs: JQuery;\r\n    protected toolbar: Toolbar;\r\n    protected validator: JQueryValidation.Validator;\r\n    protected isPanel: boolean;\r\n    protected responsive: boolean;\r\n\r\n    protected arrange(): void {\r\n        this.element.find('.require-layout').filter(':visible').each(function (i, e) {\r\n            $(e).triggerHandler('layout');\r\n        });\r\n    }\r\n\r\n    protected getToolbarButtons(): ToolButton[] {\r\n        return [];\r\n    }\r\n\r\n    protected getValidatorOptions(): JQueryValidation.ValidationOptions {\r\n        return {};\r\n    }\r\n\r\n    protected initTabs(): void {\r\n        var tabsDiv = this.byId('Tabs');\r\n        if (tabsDiv.length === 0) {\r\n            return;\r\n        }\r\n        this.tabs = tabsDiv.tabs({});\r\n    }\r\n\r\n    protected initToolbar(): void {\r\n        var toolbarDiv = this.byId('Toolbar');\r\n        if (toolbarDiv.length === 0) {\r\n            return;\r\n        }\r\n        var opt = { buttons: this.getToolbarButtons() };\r\n        this.toolbar = new Toolbar(toolbarDiv, opt);\r\n    }\r\n\r\n    protected initValidator(): void {\r\n        var form = this.byId('Form');\r\n        if (form.length > 0) {\r\n            var valOptions = this.getValidatorOptions();\r\n            this.validator = form.validate(validateOptions(valOptions));\r\n        }\r\n    }\r\n\r\n    protected resetValidation(): void {\r\n        if (this.validator) {\r\n            (this.validator as any).resetAll();\r\n        }\r\n    }\r\n\r\n    protected validateForm(): boolean {\r\n        return this.validator == null || !!this.validator.form();\r\n    }\r\n}", "\uFEFFimport { Exception, validatorAbortHandler } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport namespace ValidationHelper {\r\n    export function asyncSubmit(form: JQuery, validateBeforeSave: () => boolean, submitHandler: () => void): boolean {\r\n        var validator = form.validate();\r\n        var valSettings = validator.settings;\r\n        if ((valSettings as any).abortHandler) {\r\n            return false;\r\n        }\r\n        if (validateBeforeSave != null && validateBeforeSave() === false) {\r\n            return false;\r\n        }\r\n        valSettings['abortHandler'] = validatorAbortHandler;\r\n        valSettings['submitHandler'] = function () {\r\n            if (submitHandler != null) {\r\n                submitHandler();\r\n            }\r\n            return false;\r\n        };\r\n        form.trigger('submit');\r\n        return true;\r\n    }\r\n\r\n    export function submit(form: JQuery, validateBeforeSave: () => boolean, submitHandler: () => void): boolean {\r\n        var validator = form.validate();\r\n        var valSettings = validator.settings;\r\n        if ((valSettings as any).abortHandler != null) {\r\n            return false;\r\n        }\r\n        if (validateBeforeSave != null && validateBeforeSave() === false) {\r\n            return false;\r\n        }\r\n        if (!validator.form()) {\r\n            return false;\r\n        }\r\n        if (submitHandler != null) {\r\n            submitHandler();\r\n        }\r\n        return true;\r\n    }\r\n\r\n    export function getValidator(element: JQuery): JQueryValidation.Validator {\r\n        var form = element.closest('form');\r\n        if (form.length === 0) {\r\n            return null;\r\n        }\r\n        return form.data('validator');\r\n    }\r\n}\r\n\r\nexport namespace VX {\r\n    export function addValidationRule(element: JQuery, eventClass: string, rule: (p1: JQuery) => string): JQuery {\r\n        if (!element.length)\r\n        return element;\r\n        if (rule == null)\r\n            throw new Exception('rule is null!');\r\n        element.addClass('customValidate').bind('customValidate.' + eventClass, rule as any);\r\n        return element;        \r\n    }\r\n\r\n    export function removeValidationRule(element: JQuery, eventClass: string): JQuery {\r\n        element.unbind('customValidate.' + eventClass);\r\n        return element;\r\n    }    \r\n\r\n    export function validateElement(validator: JQueryValidation.Validator, widget: Widget<any>): boolean {\r\n        return validator.element(widget.element[0] as any);\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { findElementWithRelativeId, isEmptyOrNull, notifyError } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\n@Decorators.registerClass('Serenity.CascadedWidgetLink')\r\nexport class CascadedWidgetLink<TParent extends Widget<any>> {\r\n\r\n    constructor(private parentType: { new(...args: any[]): TParent },\r\n        private widget: Widget<any>,\r\n        private parentChange: (p1: TParent) => void) {\r\n        this.bind();\r\n        this.widget.element.bind('remove.' + (widget as any).uniqueName + 'cwh', e => {\r\n            this.unbind();\r\n            this.widget = null;\r\n            this.parentChange = null;\r\n        });\r\n    }\r\n\r\n    private _parentID: string;\r\n\r\n    bind() {\r\n\r\n        if (isEmptyOrNull(this._parentID)) {\r\n            return null;\r\n        }\r\n\r\n        var parent = findElementWithRelativeId(this.widget.element, this._parentID)\r\n            .tryGetWidget(this.parentType);\r\n\r\n        if (parent != null) {\r\n            parent.element.bind('change.' + (this.widget as any).uniqueName, () => {\r\n                this.parentChange(parent);\r\n            });\r\n            return parent;\r\n        }\r\n        else {\r\n            notifyError(\"Can't find cascaded parent element with ID: \" + this._parentID + '!', '', null);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    unbind() {\r\n\r\n        if (isEmptyOrNull(this._parentID)) {\r\n            return null;\r\n        }\r\n\r\n        var parent = findElementWithRelativeId(this.widget.element, this._parentID).tryGetWidget(this.parentType);\r\n\r\n        if (parent != null) {\r\n            parent.element.unbind('.' + (this.widget as any).uniqueName);\r\n        }\r\n\r\n        return parent;\r\n    }\r\n\r\n    get_parentID() {\r\n        return this._parentID;\r\n    }\r\n\r\n    set_parentID(value: string) {\r\n\r\n        if (this._parentID !== value) {\r\n            this.unbind();\r\n            this._parentID = value;\r\n            this.bind();\r\n        }\r\n    }\r\n}\r\n", "\uFEFFexport {}\r\n\r\nexport namespace TabsExtensions {\r\n    export function setDisabled(tabs: JQuery, tabKey: string, isDisabled: boolean) {\r\n        if (!tabs)\r\n            return;\r\n\r\n        var ibk = indexByKey(tabs);\r\n        if (!ibk)\r\n            return;\r\n\r\n        var index = ibk[tabKey];\r\n        if (index == null) {\r\n            return;\r\n        }\r\n\r\n        if (isDisabled && index === tabs.tabs('option', 'active')) {\r\n            tabs.tabs('option', 'active', 0);\r\n        }\r\n\r\n        tabs.tabs(isDisabled ? 'disable' : 'enable', index);\r\n    }\r\n\r\n    export function toggle(tabs: JQuery, tabKey: string, visible: boolean) {\r\n        if (!tabs)\r\n            return;\r\n\r\n        var ibk = indexByKey(tabs);\r\n        if (!ibk)\r\n            return;\r\n\r\n        var index = ibk[tabKey];\r\n        if (index == null) {\r\n            return;\r\n        }\r\n\r\n        if (!visible && index === tabs.tabs('option', 'active')) {\r\n            tabs.tabs('option', 'active', 0);\r\n        }\r\n\r\n        tabs.children('ul').children('li').eq(index).toggle(visible);\r\n    }\r\n\r\n    export function activeTabKey(tabs: JQuery) {\r\n        var href = tabs.children('ul')\r\n            .children('li')\r\n            .eq(tabs.tabs('option', 'active'))\r\n            .children('a')\r\n            .attr('href')\r\n            .toString();\r\n\r\n        var prefix = '_Tab';\r\n        var lastIndex = href.lastIndexOf(prefix);\r\n        if (lastIndex >= 0) {\r\n            href = href.substr(lastIndex + prefix.length);\r\n        }\r\n        return href;\r\n    }\r\n\r\n    export function indexByKey(tabs: JQuery): any {\r\n        var indexByKey = tabs.data('indexByKey');\r\n        if (!indexByKey) {\r\n            indexByKey = {};\r\n            tabs.children('ul').children('li').children('a').each(function (index, el) {\r\n                var href = el.getAttribute('href').toString();\r\n                var prefix = '_Tab';\r\n                var lastIndex = href.lastIndexOf(prefix);\r\n                if (lastIndex >= 0) {\r\n                    href = href.substr(lastIndex + prefix.length);\r\n                }\r\n                indexByKey[href] = index;\r\n            });\r\n            tabs.data('indexByKey', indexByKey);\r\n        }\r\n\r\n        return indexByKey;\r\n    }\r\n    \r\n    export function selectTab(tabs: JQuery, tabKey: string) {\r\n        var ibk = indexByKey(tabs);\r\n        if (!ibk)\r\n            return;\r\n        var index = ibk[tabKey];\r\n        if (index == null) {\r\n            return;\r\n        }\r\n        if (index !== tabs.tabs('option', 'active')) {\r\n            tabs.tabs('option', 'active', index);\r\n        }\r\n    }\r\n}\r\n", "\uFEFFimport { DisplayNameAttribute, OptionAttribute } from \"../../decorators\";\r\nimport { getInstanceType, getMembers, isInstanceOfType, MemberType } from \"@serenity-is/corelib/q\";\r\nimport { ReflectionUtils } from \"../../types/reflectionutils\";\r\n\r\nexport namespace ReflectionOptionsSetter {\r\n    export function set(target: any, options: any): void {\r\n        if (options == null) {\r\n            return;\r\n        }\r\n\r\n        var type = getInstanceType(target);\r\n\r\n        if (type === Object) {\r\n            return;\r\n        }\r\n\r\n        var propByName = type.__propByName;\r\n        var fieldByName = type.__fieldByName;\r\n        if (propByName == null) {\r\n            var props = getMembers(type, MemberType.property);\r\n            var propList = props.filter(function (x: any) {\r\n                return !!x.setter && ((x.attr || []).filter(function (a: any) {\r\n                    return isInstanceOfType(a, OptionAttribute);\r\n                }).length > 0 || (x.attr || []).filter(function (a: any) {\r\n                    return isInstanceOfType(a, DisplayNameAttribute);\r\n                }).length > 0);\r\n            });\r\n\r\n            propByName = {};\r\n            for (var k of propList) {\r\n                propByName[ReflectionUtils.makeCamelCase(k.name)] = k;\r\n            }\r\n\r\n            type.__propByName = propByName;\r\n        }\r\n\r\n        if (fieldByName == null) {\r\n            var fields = getMembers(type, MemberType.field);\r\n            var fieldList = fields.filter(function (x1: any) {\r\n                return (x1.attr || []).filter(function (a: any) {\r\n                    return isInstanceOfType(a, OptionAttribute);\r\n                }).length > 0 || (x1.attr || []).filter(function (a: any) {\r\n                    return isInstanceOfType(a, DisplayNameAttribute);\r\n                }).length > 0;\r\n            });\r\n\r\n            fieldByName = {};\r\n            for (var $t2 = 0; $t2 < fieldList.length; $t2++) {\r\n                var k1 = fieldList[$t2];\r\n                fieldByName[ReflectionUtils.makeCamelCase(k1.name)] = k1;\r\n            }\r\n            type.__fieldByName = fieldByName;\r\n        }\r\n\r\n        var keys = Object.keys(options);\r\n        for (var k2 of keys) {\r\n            var v = options[k2];\r\n            var cc = ReflectionUtils.makeCamelCase(k2);\r\n            var p = propByName[cc] || propByName[k2];\r\n            if (p != null) {\r\n                var func = (target[p.setter] as Function);\r\n                func && func.call(target, v);\r\n            }\r\n            else {\r\n                var f = fieldByName[cc] || fieldByName[k2];\r\n                f && (target[f.name] = v);\r\n            }\r\n        }\r\n    }\r\n}", "\uFEFFimport { Decorators, ElementAttribute, OptionsTypeAttribute } from \"../../decorators\";\r\nimport { any, Authorization, Culture, extend, getAttributes, getTypeName, isBS3, isBS5Plus, isEmptyOrNull, PropertyItem, startsWith, text, trimToEmpty, trimToNull, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { EditorTypeRegistry } from \"../../types/editortyperegistry\";\r\nimport { EditorUtils } from \"../editors/editorutils\";\r\nimport { ReflectionOptionsSetter } from \"./reflectionoptionssetter\";\r\nimport { Widget } from \"./widget\";\r\n\r\n@Decorators.registerClass('Serenity.PropertyGrid')\r\nexport class PropertyGrid extends Widget<PropertyGridOptions> {\r\n\r\n    private editors: Widget<any>[];\r\n    private items: PropertyItem[];\r\n\r\n    constructor(div: JQuery, opt: PropertyGridOptions) {\r\n        super(div, opt);\r\n\r\n        if (opt.mode == null)\r\n            opt.mode = 1;\r\n\r\n        div.addClass('s-PropertyGrid');\r\n        this.editors = [];\r\n        var items = this.options.items || [];\r\n        this.items = [];\r\n\r\n        var useTabs = any(items, function (x) {\r\n            return !isEmptyOrNull(x.tab);\r\n        });\r\n\r\n        if (useTabs) {\r\n            var itemsWithoutTab = items.filter(f => isEmptyOrNull(f.tab));\r\n            if (itemsWithoutTab.length > 0) {\r\n                this.createItems(this.element, itemsWithoutTab);\r\n\r\n                $(\"<div class='pad'></div>\").appendTo(this.element);\r\n            }\r\n\r\n            var itemsWithTab = items.filter(f => !isEmptyOrNull(f.tab));\r\n\r\n            var ul = $(\"<ul class='nav nav-tabs property-tabs' role='tablist'></ul>\")\r\n                .appendTo(this.element);\r\n\r\n            var tc = $(\"<div class='tab-content property-panes'></div>\")\r\n                .appendTo(this.element);\r\n\r\n            var tabIndex = 0;\r\n            var i = 0;\r\n            while (i < itemsWithTab.length) {\r\n                var tab = { $: trimToEmpty(itemsWithTab[i].tab) };\r\n                var tabItems = [];\r\n\r\n                var j = i;\r\n                do {\r\n                    tabItems.push(itemsWithTab[j]);\r\n                } while (++j < itemsWithTab.length &&\r\n                    trimToEmpty(itemsWithTab[j].tab) === tab.$);\r\n                i = j;\r\n\r\n                var li = $(isBS3() ? '<li><a data-toggle=\"tab\" role=\"tab\"></a></li>' :\r\n                        `<li class=\"nav-item\"><a class=\"nav-link\" data-${isBS5Plus() ? \"bs-\" :  \"\"}toggle=\"tab\" role=\"tab\"></a></li>`)\r\n                    .appendTo(ul);\r\n\r\n                if (tabIndex === 0) {\r\n                    if (isBS3())\r\n                        li.addClass('active');\r\n                    else\r\n                        li.children('a').addClass('active');\r\n                }\r\n\r\n                var tabID = this.uniqueName + '_Tab' + tabIndex;\r\n\r\n                li.children('a').attr('href', '#' + tabID)\r\n                    .text(this.determineText(tab.$, function (prefix: string) {\r\n                        return prefix + 'Tabs.' + this.tab.$;\r\n                    }.bind({\r\n                        tab: tab\r\n                    })));\r\n\r\n                var pane = $(\"<div class='tab-pane fade' role='tabpanel'>\")\r\n                    .appendTo(tc);\r\n\r\n                if (tabIndex === 0) {\r\n                    pane.addClass(isBS3() ? 'in active' : 'show active');\r\n                }\r\n\r\n                pane.attr('id', tabID);\r\n                this.createItems(pane, tabItems);\r\n                tabIndex++;\r\n            }\r\n        }\r\n        else {\r\n            this.createItems(this.element, items);\r\n        }\r\n\r\n        this.updateInterface();\r\n    }\r\n\r\n    destroy() {\r\n        if (this.editors != null) {\r\n            for (var i = 0; i < this.editors.length; i++) {\r\n                this.editors[i].destroy();\r\n            }\r\n            this.editors = null;\r\n        }\r\n        this.element.find('a.category-link').unbind('click',\r\n            this.categoryLinkClick).remove();\r\n\r\n        Widget.prototype.destroy.call(this);\r\n    }\r\n\r\n    private createItems(container: JQuery, items: PropertyItem[]) {\r\n        var categoryIndexes = {};\r\n        var categoriesDiv = container;\r\n\r\n        var useCategories = this.options.useCategories !== false && any(items, function (x) {\r\n            return !isEmptyOrNull(x.category);\r\n        });\r\n\r\n        if (useCategories) {\r\n            var linkContainer = $('<div/>').addClass('category-links');\r\n            categoryIndexes = this.createCategoryLinks(linkContainer, items);\r\n            if (Object.keys(categoryIndexes).length > 1) {\r\n                linkContainer.appendTo(container);\r\n            }\r\n            else {\r\n                linkContainer.find('a.category-link').unbind('click',\r\n                    this.categoryLinkClick).remove();\r\n            }\r\n        }\r\n\r\n        categoriesDiv = $('<div/>').addClass('categories').appendTo(container);\r\n        var fieldContainer;\r\n        if (useCategories) {\r\n            fieldContainer = categoriesDiv;\r\n        }\r\n        else {\r\n            fieldContainer = $('<div/>').addClass('category').appendTo(categoriesDiv);\r\n        }\r\n        var priorCategory = null;\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            var category = item.category;\r\n            if (category == null) {\r\n                category = this.options.defaultCategory ?? '';\r\n            }\r\n\r\n            if (useCategories && priorCategory !== category) {\r\n                var categoryDiv = this.createCategoryDiv(categoriesDiv,\r\n                    categoryIndexes, category,\r\n                    ((item.collapsible !== true) ? null :\r\n                        item.collapsed ?? false));\r\n\r\n                if (priorCategory == null) {\r\n                    categoryDiv.addClass('first-category');\r\n                }\r\n                priorCategory = category;\r\n                fieldContainer = categoryDiv;\r\n            }\r\n            var editor = this.createField(fieldContainer, item);\r\n            this.items.push(item);\r\n            this.editors.push(editor);\r\n        }\r\n    }\r\n\r\n    private createCategoryDiv(categoriesDiv: JQuery,\r\n        categoryIndexes: { [key: string]: number }, category: string, collapsed: boolean) {\r\n\r\n        var categoryDiv = $('<div/>').addClass('category')\r\n            .appendTo(categoriesDiv);\r\n\r\n        var title = $('<div/>').addClass('category-title')\r\n            .append($('<a/>').addClass('category-anchor')\r\n            .text(this.determineText(category, function (prefix) {\r\n                return prefix + 'Categories.' + category;\r\n            }))\r\n            .attr('name', this.options.idPrefix + \r\n                'Category' + categoryIndexes[category].toString()))\r\n            .appendTo(categoryDiv);\r\n\r\n        if (collapsed != null) {\r\n            categoryDiv.addClass(((collapsed === true) ?\r\n                'collapsible collapsed' : 'collapsible'));\r\n\r\n            var img = $('<i/>').addClass(((collapsed === true) ?\r\n                'fa fa-plus' : 'fa fa-minus')).appendTo(title);\r\n\r\n            title.click(function (e) {\r\n                categoryDiv.toggleClass('collapsed');\r\n                img.toggleClass('fa-plus').toggleClass('fa-minus');\r\n            });\r\n        }\r\n\r\n        return categoryDiv;\r\n    }\r\n\r\n    private categoryLinkClick = (e: JQueryEventObject) => {\r\n        e.preventDefault();\r\n\r\n        var title = $('a[name=' + e.target.getAttribute('href')\r\n            .toString().substr(1) + ']');\r\n\r\n        if (title.closest('.category').hasClass('collapsed'))\r\n            title.closest('.category').children('.category-title').click();\r\n\r\n        var animate = function () {\r\n            title.fadeTo(100, 0.5, function () {\r\n                title.fadeTo(100, 1, function () {\r\n                });\r\n            });\r\n        };\r\n\r\n        var intoView = title.closest('.category');\r\n        if (intoView.closest(':scrollable(both)').length === 0)\r\n            animate();\r\n        else {\r\n            (intoView as any).scrollintoview({\r\n                duration: 'fast',\r\n                direction: 'y',\r\n                complete: animate\r\n            });\r\n        }\r\n    }\r\n\r\n    private determineText(text: string, getKey: (s: string) => string) {\r\n        if (text != null && !startsWith(text, '`')) {\r\n            var local = tryGetText(text);\r\n            if (local != null) {\r\n                return local;\r\n            }\r\n        }\r\n\r\n        if (text != null && startsWith(text, '`')) {\r\n            text = text.substr(1);\r\n        }\r\n\r\n        if (!isEmptyOrNull(this.options.localTextPrefix)) {\r\n            var local1 = tryGetText(getKey(this.options.localTextPrefix));\r\n            if (local1 != null) {\r\n                return local1;\r\n            }\r\n        }\r\n\r\n        return text;\r\n    }\r\n\r\n    private createField(container: JQuery, item: PropertyItem) {\r\n        var fieldDiv = $('<div/>').addClass('field')\r\n            .addClass(item.name).data('PropertyItem', item).appendTo(container);\r\n\r\n        if (!isEmptyOrNull(item.cssClass)) {\r\n            fieldDiv.addClass(item.cssClass);\r\n        }\r\n\r\n        if (!isEmptyOrNull(item.formCssClass)) {\r\n            fieldDiv.addClass(item.formCssClass);\r\n            if (item.formCssClass.indexOf('line-break-') >= 0) {\r\n                var splitted = item.formCssClass.split(String.fromCharCode(32));\r\n                if (splitted.indexOf('line-break-xs') >= 0) {\r\n                    $(\"<div class='line-break' style='width: 100%' />\")\r\n                        .insertBefore(fieldDiv);\r\n                }\r\n                else if (splitted.indexOf('line-break-sm') >= 0) {\r\n                    $(\"<div class='line-break hidden-xs' style='width: 100%' />\")\r\n                        .insertBefore(fieldDiv);\r\n                }\r\n                else if (splitted.indexOf('line-break-md') >= 0) {\r\n                    $(\"<div class='line-break hidden-sm' style='width: 100%' />\")\r\n                        .insertBefore(fieldDiv);\r\n                }\r\n                else if (splitted.indexOf('line-break-lg') >= 0) {\r\n                    $(\"<div class='line-break hidden-md' style='width: 100%' />\")\r\n                        .insertBefore(fieldDiv);\r\n                }\r\n            }\r\n        }\r\n        var editorId = this.options.idPrefix + item.name;\r\n        var title = this.determineText(item.title, function (prefix) {\r\n            return prefix + item.name;\r\n        });\r\n\r\n        var hint = this.determineText(item.hint, function (prefix1) {\r\n            return prefix1 + item.name + '_Hint';\r\n        });\r\n\r\n        var placeHolder = this.determineText(item.placeholder, function (prefix2) {\r\n            return prefix2 + item.name + '_Placeholder';\r\n        });\r\n\r\n        if (hint == null) {\r\n            hint = title ?? '';\r\n        }\r\n\r\n        var label = $('<label/>')\r\n            .addClass('caption').attr('for', editorId)\r\n            .attr('title', hint).html(title ?? '')\r\n            .appendTo(fieldDiv);\r\n\r\n        if (!isEmptyOrNull(item.labelWidth)) {\r\n            if (item.labelWidth === '0') {\r\n                label.hide();\r\n            }\r\n            else {\r\n                label.css('width', item.labelWidth);\r\n            }\r\n        }\r\n\r\n        if (item.required === true) {\r\n            $('<sup>*</sup>').attr('title',\r\n                text('Controls.PropertyGrid.RequiredHint'))\r\n                .prependTo(label);\r\n        }\r\n\r\n        var editorType = EditorTypeRegistry\r\n            .get(item.editorType ?? 'String');\r\n        var elementAttr = getAttributes(editorType,\r\n            ElementAttribute, true);\r\n        var elementHtml = ((elementAttr.length > 0) ?\r\n            elementAttr[0].value : '<input/>');\r\n\r\n        var element = Widget.elementFor(editorType as any)\r\n            .addClass('editor')\r\n            .attr('id', editorId).appendTo(fieldDiv);\r\n\r\n        if (element.is(':input')) {\r\n            element.attr('name', item.name ?? '');\r\n        }\r\n\r\n        if (!isEmptyOrNull(placeHolder)) {\r\n            element.attr('placeholder', placeHolder);\r\n        }\r\n        var editorParams = item.editorParams;\r\n        var optionsType = null;\r\n        var optionsAttr = getAttributes(editorType,\r\n            OptionsTypeAttribute, true);\r\n\r\n        if (optionsAttr != null && optionsAttr.length > 0) {\r\n            optionsType = optionsAttr[0].optionsType;\r\n        }\r\n        var editor;\r\n        if (optionsType != null) {\r\n            editorParams = extend(new optionsType(), item.editorParams);\r\n            editor = new (editorType as any)(element, editorParams);\r\n        }\r\n        else {\r\n            editorParams = extend(new Object(), item.editorParams);\r\n            editor = new (editorType as any)(element, editorParams);\r\n        }\r\n\r\n        editor.initialize();\r\n\r\n        if (getTypeName(editor) == \"BooleanEditor\" &&\r\n            (item.editorParams == null || !!!item.editorParams['labelFor'])) {\r\n            label.removeAttr('for');\r\n        }\r\n\r\n        if (getTypeName(editor) == \"RadioButtonEditor\" &&\r\n            (item.editorParams == null || !!!item.editorParams['labelFor'])) {\r\n            label.removeAttr('for');\r\n        }\r\n\r\n        if (item.maxLength != null) {\r\n            PropertyGrid.setMaxLength(editor, item.maxLength);\r\n        }\r\n\r\n        if (item.editorParams != null) {\r\n            ReflectionOptionsSetter.set(editor, item.editorParams);\r\n        }\r\n\r\n        $('<div/>').addClass('vx').appendTo(fieldDiv);\r\n        $('<div/>').addClass('clear').appendTo(fieldDiv);\r\n\r\n        return editor;\r\n    }\r\n\r\n    private getCategoryOrder(items: PropertyItem[]) {\r\n        var order = 0;\r\n        var result = {};\r\n        var categoryOrder = trimToNull(this.options.categoryOrder);\r\n        if (categoryOrder != null) {\r\n            var split = categoryOrder.split(';');\r\n            for (var s of split) {\r\n                var x = trimToNull(s);\r\n                if (x == null) {\r\n                    continue;\r\n                }\r\n                if (result[x] != null) {\r\n                    continue;\r\n                }\r\n                result[x] = order++;\r\n            }\r\n        }\r\n\r\n        for (var x1 of items) {\r\n            var category = x1.category;\r\n            if (category == null) {\r\n                category = this.options.defaultCategory ?? '';\r\n            }\r\n            if (result[category] == null) {\r\n                result[category] = order++;\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private createCategoryLinks(container: JQuery, items: PropertyItem[]) {\r\n        var idx = 0;\r\n        var itemIndex = {};\r\n        var itemCategory = {};\r\n        for (var x of items) {\r\n            var name1 = x.name;\r\n            var cat1 = x.category;\r\n            if (cat1 == null) {\r\n                cat1 = this.options.defaultCategory ?? '';\r\n            }\r\n            itemCategory[name1] = cat1;\r\n            itemIndex[x.name] = idx++;\r\n        }\r\n\r\n        var self = this;\r\n        var categoryOrder = this.getCategoryOrder(items);\r\n\r\n        items.sort(function (x1, y) {\r\n            var c = 0;\r\n            var xcategory = itemCategory[x1.name];\r\n            var ycategory = itemCategory[y.name];\r\n            if (xcategory != ycategory) {\r\n                var c1 = categoryOrder[xcategory];\r\n                var c2 = categoryOrder[ycategory];\r\n                if (c1 != null && c2 != null) {\r\n                    c = c1 - c2;\r\n                }\r\n                else if (c1 != null) {\r\n                    c = -1;\r\n                }\r\n                else if (c2 != null) {\r\n                    c = 1;\r\n                }\r\n            }\r\n            if (c === 0) {\r\n                c = Culture.stringCompare(xcategory, ycategory);\r\n            }\r\n            if (c === 0) {\r\n                c = itemIndex[x1.name] < itemIndex[y.name] ? -1 : (itemIndex[x1.name] > itemIndex[y.name] ? 1 : 0)\r\n            }\r\n            return c;\r\n        });\r\n\r\n        var categoryIndexes = {};\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            var category = { $: itemCategory[item.name] };\r\n            if (categoryIndexes[category.$] == null) {\r\n                var index = Object.keys(categoryIndexes).length + 1;\r\n                categoryIndexes[category.$] = index;\r\n                if (index > 1) {\r\n                    $('<span/>').addClass('separator').text('|').prependTo(container);\r\n                }\r\n                $('<a/>').addClass('category-link').text(\r\n                    this.determineText(category.$,\r\n                        function (prefix: string) {\r\n                            return prefix + 'Categories.' + this.category.$;\r\n                        }.bind({ category: category })))\r\n                    .attr('tabindex', '-1')\r\n                    .attr('href', '#' + this.options.idPrefix +\r\n                        'Category' + index.toString())\r\n                    .click(this.categoryLinkClick)\r\n                    .prependTo(container);\r\n            }\r\n        }\r\n\r\n        $('<div/>').addClass('clear').appendTo(container);\r\n        return categoryIndexes;\r\n    }\r\n\r\n    get_editors(): Widget<any>[] {\r\n        return this.editors;\r\n    }\r\n\r\n    get_items(): PropertyItem[] {\r\n        return this.items;\r\n    }\r\n\r\n    get_idPrefix(): string {\r\n        return this.options.idPrefix;\r\n    }\r\n\r\n    get_mode(): PropertyGridMode {\r\n        return this.options.mode;\r\n    }\r\n\r\n    set_mode(value: PropertyGridMode) {\r\n        if(this.options.mode !== value) {\r\n            this.options.mode = value;\r\n            this.updateInterface();\r\n        }\r\n    }\r\n\r\n    // Obsolete\r\n    static loadEditorValue(editor: Widget<any>,\r\n        item: PropertyItem, source: any): void {\r\n    }\r\n\r\n    // Obsolete\r\n    static saveEditorValue(editor: Widget<any>,\r\n        item: PropertyItem, target: any): void {\r\n\r\n        EditorUtils.saveValue(editor, item, target);\r\n    }\r\n\r\n    // Obsolete\r\n    private static setReadOnly(widget: Widget<any>, isReadOnly: boolean): void {\r\n        EditorUtils.setReadOnly(widget, isReadOnly);\r\n    }\r\n\r\n    // Obsolete\r\n    private static setReadonly(elements: JQuery, isReadOnly: boolean): JQuery {\r\n        return EditorUtils.setReadonly(elements, isReadOnly);\r\n    }\r\n\r\n    // Obsolete\r\n    private static setRequired(widget: Widget<any>, isRequired: boolean): void {\r\n        EditorUtils.setRequired(widget, isRequired);\r\n    }\r\n\r\n    private static setMaxLength(widget: Widget<any>, maxLength: number) {\r\n        if (widget.element.is(':input')) {\r\n            if (maxLength > 0) {\r\n                widget.element.attr('maxlength', maxLength);\r\n            }\r\n            else {\r\n                widget.element.removeAttr('maxlength');\r\n            }\r\n        }\r\n    }\r\n\r\n    load(source: any): void {\r\n        for (var i = 0; i < this.editors.length; i++) {\r\n            var item = this.items[i];\r\n            var editor = this.editors[i];\r\n            if (!!(this.get_mode() === 1 && item.defaultValue != null) &&\r\n                typeof (source[item.name]) === 'undefined') {\r\n                source[item.name] = item.defaultValue;\r\n            }\r\n\r\n            EditorUtils.loadValue(editor, item, source);\r\n        }\r\n    }\r\n\r\n    save(target?: any): any {\r\n        if (target == null)\r\n            target = Object.create(null);\r\n        for (var i = 0; i < this.editors.length; i++) {\r\n            var item = this.items[i];\r\n            if (item.oneWay !== true && this.canModifyItem(item)) {\r\n                var editor = this.editors[i];\r\n                EditorUtils.saveValue(editor, item, target);\r\n            }\r\n        }\r\n        return target;\r\n    }\r\n\r\n    public get value(): any {\r\n        return this.save();\r\n    }\r\n\r\n    public set value(val: any) {\r\n        if (val == null)\r\n            val = Object.create(null);\r\n        this.load(val);\r\n    }\r\n\r\n    private canModifyItem(item: PropertyItem) {\r\n        if (this.get_mode() === PropertyGridMode.insert) {\r\n            if (item.insertable === false) {\r\n                return false;\r\n            }\r\n\r\n            if (item.insertPermission == null) {\r\n                return true;\r\n            }\r\n\r\n            return Authorization.hasPermission(item.insertPermission);\r\n        }\r\n        else if (this.get_mode() === PropertyGridMode.update) {\r\n            if (item.updatable === false) {\r\n                return false;\r\n            }\r\n\r\n            if (item.updatePermission == null) {\r\n                return true;\r\n            }\r\n\r\n            return Authorization.hasPermission(item.updatePermission);\r\n        }\r\n        return true;\r\n    }\r\n\r\n    updateInterface() {\r\n        for (var i = 0; i < this.editors.length; i++) {\r\n            var item = this.items[i];\r\n            var editor = this.editors[i];\r\n            var readOnly = item.readOnly === true || !this.canModifyItem(item);\r\n            EditorUtils.setReadOnly(editor, readOnly);\r\n            EditorUtils.setRequired(editor, !readOnly &&\r\n                !!item.required && item.editorType !== 'Boolean');\r\n            if (item.visible === false || item.readPermission != null ||\r\n                item.insertPermission != null || item.updatePermission != null ||\r\n                item.hideOnInsert === true || item.hideOnUpdate === true) {\r\n                var hidden = (item.readPermission != null &&\r\n                    !Authorization.hasPermission(item.readPermission)) ||\r\n                    item.visible === false ||\r\n                    (this.get_mode() === PropertyGridMode.insert && item.hideOnInsert === true) ||\r\n                    (this.get_mode() === 2 && item.hideOnUpdate === true);\r\n\r\n                editor.getGridField().toggle(!hidden);\r\n            }\r\n        }\r\n    }\r\n\r\n    enumerateItems(callback: (p1: PropertyItem, p2: Widget<any>) => void): void {\r\n        for (var i = 0; i < this.editors.length; i++) {\r\n            var item = this.items[i];\r\n            var editor = this.editors[i];\r\n            callback(item, editor);\r\n        }\r\n    }\r\n}\r\n\r\nexport enum PropertyGridMode {\r\n    insert = 1,\r\n    update = 2\r\n}\r\n\r\nexport interface PropertyGridOptions {\r\n    idPrefix?: string;\r\n    items?: PropertyItem[];\r\n    useCategories?: boolean;\r\n    categoryOrder?: string;\r\n    defaultCategory?: string;\r\n    localTextPrefix?: string;\r\n    mode?: PropertyGridMode;\r\n}", "\uFEFFimport { IBooleanValue, IDoubleValue, IGetEditValue, IReadOnly, ISetEditValue, IStringValue, IValidateRequired } from \"../../interfaces\";\r\nimport { cast, isInstanceOfType, isTrimmedEmpty, parseDecimal, PropertyItem, safeCast, text, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport namespace EditorUtils {\r\n    export function getDisplayText(editor: Widget<any>): string {\r\n\r\n        var select2 = editor.element.data('select2');\r\n\r\n        if (select2 != null) {\r\n            var data = editor.element.select2('data');\r\n            if (data == null)\r\n                return '';\r\n\r\n            return data.text ?? '';\r\n        }\r\n\r\n        var value = getValue(editor);\r\n        if (value == null) {\r\n            return '';\r\n        }\r\n\r\n        if (typeof value === \"string\")\r\n            return value;\r\n\r\n        if (value instanceof Boolean)\r\n            return (!!value ? (tryGetText('Controls.FilterPanel.OperatorNames.true') ?? 'True') :\r\n                (tryGetText('Controls.FilterPanel.OperatorNames.true') ?? 'False'));\r\n\r\n        return value.toString();\r\n    }\r\n\r\n    var dummy: PropertyItem = { name: '_' };\r\n\r\n    export function getValue(editor: Widget<any>): any {\r\n        var target = {};\r\n        saveValue(editor, dummy, target);\r\n        return target['_'];\r\n    }\r\n\r\n    export function saveValue(editor: Widget<any>, item: PropertyItem, target: any): void {\r\n\r\n        var getEditValue = safeCast(editor, IGetEditValue);\r\n\r\n        if (getEditValue != null) {\r\n            getEditValue.getEditValue(item, target);\r\n            return;\r\n        }\r\n\r\n        var stringValue = safeCast(editor, IStringValue);\r\n        if (stringValue != null) {\r\n            target[item.name] = stringValue.get_value();\r\n            return;\r\n        }\r\n\r\n        var booleanValue = safeCast(editor, IBooleanValue);\r\n        if (booleanValue != null) {\r\n            target[item.name] = booleanValue.get_value();\r\n            return;\r\n        }\r\n\r\n        var doubleValue = safeCast(editor, IDoubleValue);\r\n        if (doubleValue != null) {\r\n            var value = doubleValue.get_value();\r\n            target[item.name] = (isNaN(value) ? null : value);\r\n            return;\r\n        }\r\n\r\n        if ((editor as any).getEditValue != null) {\r\n            (editor as any).getEditValue(item, target);\r\n            return;\r\n        }\r\n\r\n        if (editor.element.is(':input')) {\r\n            target[item.name] = editor.element.val();\r\n            return;\r\n        }\r\n    }\r\n\r\n    export function setValue(editor: Widget<any>, value: any): void {\r\n        var source = { _: value };\r\n        loadValue(editor, dummy, source);\r\n    }\r\n\r\n    export function loadValue(editor: Widget<any>, item: PropertyItem, source: any): void {\r\n\r\n        var setEditValue = safeCast(editor, ISetEditValue);\r\n        if (setEditValue != null) {\r\n            setEditValue.setEditValue(source, item);\r\n            return;\r\n        }\r\n\r\n        var stringValue = safeCast(editor, IStringValue);\r\n        if (stringValue != null) {\r\n            var value = source[item.name];\r\n            if (value != null) {\r\n                value = value.toString();\r\n            }\r\n            stringValue.set_value(cast(value, String));\r\n            return;\r\n        }\r\n\r\n        var booleanValue = safeCast(editor, IBooleanValue);\r\n        if (booleanValue != null) {\r\n            var value1 = source[item.name];\r\n            if (typeof (value1) === 'number') {\r\n                booleanValue.set_value(value1 > 0);\r\n            }\r\n            else {\r\n                booleanValue.set_value(!!value1);\r\n            }\r\n            return;\r\n        }\r\n\r\n        var doubleValue = safeCast(editor, IDoubleValue);\r\n        if (doubleValue != null) {\r\n            var d = source[item.name];\r\n            if (!!(d == null || isInstanceOfType(d, String) && isTrimmedEmpty(cast(d, String)))) {\r\n                doubleValue.set_value(null);\r\n            }\r\n            else if (isInstanceOfType(d, String)) {\r\n                doubleValue.set_value(cast(parseDecimal(cast(d, String)), Number));\r\n            }\r\n            else if (isInstanceOfType(d, Boolean)) {\r\n                doubleValue.set_value((!!d ? 1 : 0));\r\n            }\r\n            else {\r\n                doubleValue.set_value(cast(d, Number));\r\n            }\r\n            return;\r\n        }\r\n\r\n        if ((editor as any).setEditValue != null) {\r\n            (editor as any).setEditValue(source, item);\r\n            return;\r\n        }\r\n\r\n        if (editor.element.is(':input')) {\r\n            var v = source[item.name];\r\n            if (v == null) {\r\n                editor.element.val('');\r\n            }\r\n            else {\r\n                editor.element.val(v);\r\n            }\r\n            return;\r\n        }\r\n    }\r\n\r\n    export function setReadonly(elements: JQuery, isReadOnly: boolean): JQuery {\r\n        elements.each(function (index, el) {\r\n            var elx = $(el);\r\n            var type = elx.attr('type');\r\n            if (elx.is('select') || type === 'radio' || type === 'checkbox') {\r\n                if (isReadOnly) {\r\n                    elx.addClass('readonly').attr('disabled', 'disabled');\r\n                }\r\n                else {\r\n                    elx.removeClass('readonly').removeAttr('disabled');\r\n                }\r\n            }\r\n            else if (isReadOnly) {\r\n                elx.addClass('readonly').attr('readonly', 'readonly');\r\n            }\r\n            else {\r\n                elx.removeClass('readonly').removeAttr('readonly');\r\n            }\r\n            return true;\r\n        });\r\n        return elements;\r\n    }\r\n\r\n    export function setReadOnly(widget: Widget<any>, isReadOnly: boolean): void {\r\n\r\n        var readOnly = safeCast(widget, IReadOnly);\r\n\r\n        if (readOnly != null) {\r\n            readOnly.set_readOnly(isReadOnly);\r\n        }\r\n        else if (widget.element.is(':input')) {\r\n            setReadonly(widget.element, isReadOnly);\r\n        }\r\n    }\r\n\r\n    export function setRequired(widget: Widget<any>, isRequired: boolean): void {\r\n        var req = safeCast(widget, IValidateRequired);\r\n        if (req != null) {\r\n            req.set_required(isRequired);\r\n        }\r\n        else if (widget.element.is(':input')) {\r\n            widget.element.toggleClass('required', !!isRequired);\r\n        }\r\n        var gridField = widget.element.closest('.field');\r\n        var hasSupItem = gridField.find('sup').get().length > 0;\r\n        if (isRequired && !hasSupItem) {\r\n            $('<sup>*</sup>').attr('title', text('Controls.PropertyGrid.RequiredHint'))\r\n                .prependTo(gridField.find('.caption')[0]);\r\n        }\r\n        else if (!isRequired && hasSupItem) {\r\n            $(gridField.find('sup')[0]).remove();\r\n        }\r\n    }\r\n\r\n    export function setContainerReadOnly(container: JQuery, readOnly: boolean) {\r\n\r\n        if (!readOnly) {\r\n\r\n            if (!container.hasClass('readonly-container'))\r\n                return;\r\n\r\n            container.removeClass('readonly-container').find(\".editor.container-readonly\")\r\n                .removeClass('container-readonly').each((i, e) => {\r\n                    var w = $(e).tryGetWidget(Widget);\r\n                    if (w != null)\r\n                        EditorUtils.setReadOnly(w, false);\r\n                    else\r\n                        EditorUtils.setReadonly($(e), false);\r\n                });\r\n\r\n            return;\r\n        }\r\n\r\n        container.addClass('readonly-container').find(\".editor\")\r\n            .not('.container-readonly')\r\n            .each((i, e) => {\r\n                var w = $(e).tryGetWidget(Widget);\r\n                if (w != null) {\r\n\r\n                    if (w['get_readOnly']) {\r\n                        if (w['get_readOnly']())\r\n                            return;\r\n                    }\r\n                    else if ($(e).is('[readonly]') || $(e).is('[disabled]') || $(e).is('.readonly') || $(e).is('.disabled'))\r\n                        return;\r\n\r\n                    $(e).addClass('container-readonly');\r\n                    EditorUtils.setReadOnly(w, true);\r\n\r\n                }\r\n                else {\r\n                    if ($(e).is('[readonly]') || $(e).is('[disabled]') || $(e).is('.readonly') || $(e).is('.disabled'))\r\n                        return;\r\n\r\n                    EditorUtils.setReadonly($(e).addClass('container-readonly'), true);\r\n                }\r\n            });\r\n    }\r\n}", "\uFEFFimport { Decorators, FormKeyAttribute } from \"../../decorators\";\r\nimport { endsWith, getAttributes, getForm, getInstanceType, getTypeFullName, PropertyItem } from \"@serenity-is/corelib/q\";\r\nimport { PropertyGrid, PropertyGridOptions } from \"./propertygrid\";\r\nimport { TemplatedPanel } from \"./templatedpanel\";\r\n\r\n@Decorators.registerClass('Serenity.PropertyPanel')\r\nexport class PropertyPanel<TItem, TOptions> extends TemplatedPanel<TOptions> {\r\n\r\n    private _entity: TItem;\r\n    private _entityId: any;\r\n\r\n    constructor(container: JQuery, options?: TOptions) {\r\n        super(container, options);\r\n\r\n        this.initPropertyGrid();\r\n        this.loadInitialEntity();\r\n    }\r\n\r\n    destroy() {\r\n        if (this.propertyGrid) {\r\n            this.propertyGrid.destroy();\r\n            this.propertyGrid = null;\r\n        }\r\n        if (this.validator) {\r\n            this.byId('Form').remove();\r\n            this.validator = null;\r\n        }\r\n        super.destroy();\r\n    }\r\n\r\n    protected initPropertyGrid() {\r\n        var pgDiv = this.byId('PropertyGrid');\r\n        if (pgDiv.length <= 0) {\r\n            return;\r\n        }\r\n        var pgOptions = this.getPropertyGridOptions();\r\n        this.propertyGrid = (new PropertyGrid(pgDiv, pgOptions)).init(null);\r\n        if (this.element.closest('.ui-Panel').hasClass('s-Flexify')) {\r\n            this.propertyGrid.element.children('.categories').flexHeightOnly(1);\r\n        }\r\n    }\r\n\r\n    protected loadInitialEntity(): void {\r\n        if (this.propertyGrid) {\r\n            this.propertyGrid.load(new Object());\r\n        }\r\n    }\r\n\r\n    protected getFormKey(): string {\r\n        var attributes = getAttributes(\r\n            getInstanceType(this), FormKeyAttribute, true);\r\n\r\n        if (attributes.length >= 1) {\r\n            return attributes[0].value;\r\n        }\r\n        var name = getTypeFullName(getInstanceType(this));\r\n        var px = name.indexOf('.');\r\n        if (px >= 0) {\r\n            name = name.substring(px + 1);\r\n        }\r\n        if (endsWith(name, 'Panel')) {\r\n            name = name.substr(0, name.length - 6);\r\n        }\r\n        else if (endsWith(name, 'Panel')) {\r\n            name = name.substr(0, name.length - 5);\r\n        }\r\n        return name;\r\n    }\r\n\r\n    protected getPropertyGridOptions(): PropertyGridOptions {\r\n        return {\r\n            idPrefix: this.idPrefix,\r\n            items: this.getPropertyItems(),\r\n            mode: 1,\r\n            useCategories: false,\r\n            localTextPrefix: 'Forms.' + this.getFormKey() + '.'\r\n        };\r\n    }\r\n\r\n    protected getPropertyItems(): PropertyItem[] {\r\n        var formKey = this.getFormKey();\r\n        return getForm(formKey);\r\n    }\r\n\r\n    protected getSaveEntity(): TItem {\r\n        var entity = new Object();\r\n        if (this.propertyGrid) {\r\n            this.propertyGrid.save(entity);\r\n        }\r\n        return entity as TItem;\r\n    }\r\n\r\n    protected get_entity(): TItem {\r\n        return this._entity;\r\n    }\r\n\r\n    protected get_entityId(): any {\r\n        return this._entityId;\r\n    }\r\n    \r\n    protected set_entity(value: TItem): void {\r\n        this._entity = value ?? new Object() as any;\r\n    }\r\n\r\n    protected set_entityId(value: any): void {\r\n        this._entityId = value;\r\n    }\r\n\r\n    protected validateBeforeSave(): boolean {\r\n        return this.validator.form();\r\n    }\r\n\r\n    protected propertyGrid: PropertyGrid;\r\n}", "\uFEFFimport { DataChangeInfo } from \"../../types/datachangeinfo\";\r\nimport type { Widget } from \"../widgets/widget\";\r\n\r\nexport namespace SubDialogHelper {\r\n    export function bindToDataChange(dialog: any, owner: Widget<any>,\r\n        dataChange: (p1: any, p2: DataChangeInfo) => void, useTimeout?: boolean): any {\r\n        var widgetName = (owner as any).widgetName;\r\n        dialog.element.bind('ondatachange.' + widgetName, function (e: JQueryEventObject, dci: any) {\r\n            if (useTimeout) {\r\n                window.setTimeout(function () {\r\n                    dataChange(e, dci);\r\n                }, 0);\r\n            }\r\n            else {\r\n                dataChange(e, dci);\r\n            }\r\n        }).bind('remove.' + widgetName, function () {\r\n            dialog.element.unbind('ondatachange.' + widgetName);\r\n        });\r\n        return dialog;\r\n    }\r\n\r\n    export function triggerDataChange(dialog: Widget<any>): any {\r\n        dialog.element.triggerHandler('ondatachange');\r\n        return dialog;\r\n    }\r\n\r\n    export function triggerDataChanged(element: JQuery): JQuery {\r\n        element.triggerHandler('ondatachange');\r\n        return element;\r\n    }\r\n\r\n    export function bubbleDataChange(dialog: any, owner: Widget<any>, useTimeout?: boolean): any {\r\n        return bindToDataChange(dialog, owner, function (e, dci) {\r\n            owner.element.triggerHandler('ondatachange');\r\n        }, useTimeout);\r\n    }\r\n\r\n    export function cascade(cascadedDialog: any, ofElement: JQuery): any {\r\n        cascadedDialog.element.one('dialogopen', function (e: JQueryEventObject) {\r\n            cascadedDialog.element.dialog().dialog('option', 'position', cascadedDialogOffset(ofElement));\r\n        });\r\n        return cascadedDialog;\r\n    }\r\n\r\n    export function cascadedDialogOffset(element: JQuery): any {\r\n        return { my: 'left top', at: 'left+20 top+20', of: element[0] };\r\n    }\r\n}", "\uFEFFimport { Decorators, FormKeyAttribute } from \"../../decorators\";\r\nimport { DialogButton, endsWith, getAttributes, getForm, getFormData, getFormDataAsync, getInstanceType, getTypeFullName, isEmptyOrNull, PropertyItem, PropertyItemsData, ScriptData, text } from \"@serenity-is/corelib/q\";\r\nimport { PropertyGrid, PropertyGridOptions } from \"../widgets/propertygrid\";\r\nimport { TemplatedDialog } from \"./templateddialog\";\r\n\r\n@Decorators.registerClass('Serenity.PropertyDialog')\r\nexport class PropertyDialog<TItem, TOptions> extends TemplatedDialog<TOptions> {\r\n    protected entity: TItem;\r\n    protected entityId: any;\r\n    protected propertyItemsData: PropertyItemsData;\r\n\r\n    constructor(opt?: TOptions) {\r\n        super(opt);\r\n\r\n        if (this.useAsync())\r\n            this.initAsync();\r\n        else \r\n            this.initSync();        \r\n    }\r\n\r\n    internalInit() {\r\n        this.initPropertyGrid();\r\n        this.loadInitialEntity();\r\n    }\r\n\r\n    protected initSync() {\r\n        this.propertyItemsData = this.getPropertyItemsData();\r\n        this.internalInit();\r\n        this.afterInit();\r\n    }\r\n\r\n    protected async initAsync() {\r\n        this.propertyItemsData = await this.getPropertyItemsDataAsync();\r\n        this.internalInit();\r\n        this.afterInit();\r\n    }\r\n\r\n    protected afterInit() {\r\n    }    \r\n\r\n    protected useAsync() {\r\n        return false;\r\n    }\r\n\r\n    destroy() {\r\n        if (this.propertyGrid) {\r\n            this.propertyGrid.destroy();\r\n            this.propertyGrid = null;\r\n        }\r\n\r\n        if (this.validator) {\r\n            this.byId('Form').remove();\r\n            this.validator = null;\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    protected getDialogOptions() {\r\n        var opt = super.getDialogOptions();\r\n        opt.width = 400;\r\n        return opt;\r\n    }\r\n\r\n    protected getDialogButtons() {\r\n        super.getDialogButtons();\r\n        return <DialogButton[]>[{\r\n            text: text('Dialogs.OkButton'),\r\n            cssClass: \"btn btn-primary\",\r\n            click: () => this.okClick()\r\n        }, {\r\n            text: text('Dialogs.CancelButton'),\r\n            click: () => this.cancelClick()\r\n        }];\r\n    }\r\n\r\n    protected okClick() {\r\n        if (!this.validateBeforeSave()) {\r\n            return;\r\n        }\r\n\r\n        this.okClickValidated();\r\n    }\r\n\r\n    protected okClickValidated() {\r\n        this.dialogClose();\r\n    }\r\n\r\n    protected cancelClick() {\r\n        this.dialogClose();\r\n    }\r\n\r\n    protected initPropertyGrid() {\r\n        var pgDiv = this.byId('PropertyGrid');\r\n        if (pgDiv.length <= 0) {\r\n            return;\r\n        }\r\n        var pgOptions = this.getPropertyGridOptions();\r\n        this.propertyGrid = (new PropertyGrid(pgDiv, pgOptions)).init(null);\r\n        if (this.element.closest('.ui-dialog').hasClass('s-Flexify')) {\r\n            this.propertyGrid.element.children('.categories').flexHeightOnly(1);\r\n        }\r\n    }\r\n\r\n    protected getFormKey(): string {\r\n        var attributes = getAttributes(\r\n            getInstanceType(this), FormKeyAttribute, true);\r\n        if (attributes.length >= 1) {\r\n            return attributes[0].value;\r\n        }\r\n        else {\r\n            var name = getTypeFullName(getInstanceType(this));\r\n            var px = name.indexOf('.');\r\n            if (px >= 0) {\r\n                name = name.substring(px + 1);\r\n            }\r\n            if (endsWith(name, 'Dialog')) {\r\n                name = name.substr(0, name.length - 6);\r\n            }\r\n            else if (endsWith(name, 'Panel')) {\r\n                name = name.substr(0, name.length - 5);\r\n            }\r\n            return name;\r\n        }\r\n    }\r\n\r\n    protected getPropertyGridOptions(): PropertyGridOptions {\r\n        return {\r\n            idPrefix: this.idPrefix,\r\n            items: this.getPropertyItems(),\r\n            mode: 1,\r\n            useCategories: false,\r\n            localTextPrefix: 'Forms.' + this.getFormKey() + '.'\r\n        };\r\n    }\r\n\r\n    protected getPropertyItems() {\r\n        return this.propertyItemsData?.items || [];\r\n    }\r\n\r\n    protected getPropertyItemsData(): PropertyItemsData {\r\n        var formKey = this.getFormKey();\r\n\r\n        if (this.getFormKey === PropertyDialog.prototype.getFormKey &&\r\n            this.getPropertyItems !== PropertyDialog.prototype.getPropertyItems &&\r\n            !ScriptData.canLoad('Form.' + formKey)) {\r\n            return {\r\n                items: this.getPropertyItems(),\r\n                additionalItems: []\r\n            }\r\n        }\r\n\r\n        if (!isEmptyOrNull(formKey)) {\r\n            return getFormData(formKey);\r\n        }\r\n\r\n        return { items: [], additionalItems: [] };\r\n    }\r\n\r\n    protected async getPropertyItemsDataAsync(): Promise<PropertyItemsData> {\r\n        var formKey = this.getFormKey();\r\n        if (!isEmptyOrNull(formKey)) {\r\n            return await getFormDataAsync(formKey);\r\n        }\r\n\r\n        return { items: [], additionalItems: [] };\r\n    }\r\n\r\n    protected getSaveEntity(): TItem {\r\n        var entity = new Object();\r\n        if (this.propertyGrid) {\r\n            this.propertyGrid.save(entity);\r\n        }\r\n        return entity as TItem;\r\n    }\r\n\r\n    protected loadInitialEntity(): void {\r\n        this.propertyGrid && this.propertyGrid.load(new Object());\r\n    }\r\n\r\n    protected get_entity() {\r\n        return this.entity;\r\n    }\r\n\r\n    protected set_entity(value: TItem) {\r\n        this.entity = (value ?? new Object()) as any;\r\n    }\r\n\r\n    protected get_entityId() {\r\n        return this.entityId;\r\n    }\r\n\r\n    protected set_entityId(value: any): void {\r\n        this.entityId = value;\r\n    }\r\n\r\n    protected validateBeforeSave(): boolean {\r\n        return this.validator.form();\r\n    }\r\n\r\n    protected updateTitle() {\r\n    }\r\n\r\n    protected propertyGrid: PropertyGrid;\r\n\r\n    protected getFallbackTemplate() {\r\n        return `<div>\r\n    <div class=\"s-Form\">\r\n        <form id=\"~_Form\" action=\"\">\r\n            <div class=\"fieldset\">\r\n                <div id=\"~_PropertyGrid\"></div>\r\n                <div class=\"clear\"></div>\r\n            </div>\r\n        </form> \r\n    </div>\r\n</div>`;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IStringValue } from \"../../interfaces\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\n@Decorators.registerEditor('Serenity.StringEditor', [IStringValue])\r\n@Decorators.element(\"<input type=\\\"text\\\"/>\")\r\nexport class StringEditor extends Widget<any> {\r\n\r\n    constructor(input: JQuery) {\r\n        super(input);\r\n    }\r\n\r\n    public get value(): string {\r\n        return this.element.val();\r\n    }\r\n\r\n    protected get_value(): string {\r\n        return this.value;\r\n    }\r\n\r\n    public set value(value: string) {\r\n        this.element.val(value);\r\n    }\r\n\r\n    protected set_value(value: string): void {\r\n        this.value = value;\r\n    }\r\n}\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { StringEditor } from \"./stringeditor\";\r\n\r\n@Decorators.registerEditor('Serenity.PasswordEditor')\r\nexport class PasswordEditor extends StringEditor {\r\n    constructor(input: JQuery) {\r\n        super(input);\r\n\r\n        input.attr('type', 'password');\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IStringValue } from \"../../interfaces\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface TextAreaEditorOptions {\r\n    cols?: number;\r\n    rows?: number;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.TextAreaEditor', [IStringValue])\r\n@Decorators.element(\"<textarea />\")\r\nexport class TextAreaEditor extends Widget<TextAreaEditorOptions> {\r\n\r\n    constructor(input: JQuery, opt?: TextAreaEditorOptions) {\r\n        super(input, opt);\r\n\r\n        if (this.options.cols !== 0) {\r\n            input.attr('cols', (this.options.cols ?? 80));\r\n        }\r\n        if (this.options.rows !== 0) {\r\n            input.attr('rows', (this.options.rows ?? 6));\r\n        }\r\n    }\r\n\r\n    public get value(): string {\r\n        return this.element.val();\r\n    }\r\n\r\n    protected get_value(): string {\r\n        return this.value;\r\n    }\r\n\r\n    public set value(value: string) {\r\n        this.element.val(value);\r\n    }\r\n\r\n    protected set_value(value: string): void {\r\n        this.value = value;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IBooleanValue } from \"../../interfaces\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\n@Decorators.registerEditor('Serenity.BooleanEditor', [IBooleanValue])\r\n@Decorators.element('<input type=\"checkbox\"/>')\r\nexport class BooleanEditor extends Widget<any> {\r\n\r\n    public get value(): boolean {\r\n        return this.element.is(\":checked\");\r\n    }\r\n\r\n    protected get_value(): boolean {\r\n        return this.value;\r\n    }\r\n\r\n    public set value(value: boolean) {\r\n        this.element.prop(\"checked\", !!value);\r\n    }\r\n\r\n    protected set_value(value: boolean): void {\r\n        this.value = value;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IDoubleValue } from \"../../interfaces\";\r\nimport { Culture, extend, formatNumber, parseDecimal } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface DecimalEditorOptions {\r\n    minValue?: string;\r\n    maxValue?: string;\r\n    decimals?: any;\r\n    padDecimals?: any;\r\n    allowNegatives?: boolean;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.DecimalEditor', [IDoubleValue])\r\n@Decorators.element('<input type=\"text\"/>')\r\nexport class DecimalEditor extends Widget<DecimalEditorOptions> implements IDoubleValue {\r\n\r\n    constructor(input: JQuery, opt?: DecimalEditorOptions) {\r\n        super(input, opt);\r\n\r\n        input.addClass('decimalQ');\r\n        var numericOptions = extend(DecimalEditor.defaultAutoNumericOptions(), {\r\n            vMin: (this.options.minValue ?? (this.options.allowNegatives ? (this.options.maxValue != null ? (\"-\" + this.options.maxValue) : '-999999999999.99') : '0.00')),\r\n            vMax: (this.options.maxValue ?? '999999999999.99')\r\n        });\r\n\r\n        if (this.options.decimals != null) {\r\n            numericOptions.mDec = this.options.decimals;\r\n        }\r\n\r\n        if (this.options.padDecimals != null) {\r\n            numericOptions.aPad = this.options.padDecimals;\r\n        }\r\n\r\n        if (($.fn as any).autoNumeric)\r\n            (input as any).autoNumeric(numericOptions);\r\n    }\r\n\r\n    get_value(): number {\r\n        if (($.fn as any).autoNumeric) {\r\n            var val = (this.element as any).autoNumeric('get');\r\n\r\n            if (!!(val == null || val === ''))\r\n                return null;\r\n\r\n            return parseFloat(val);\r\n        }\r\n\r\n        var val = this.element.val();\r\n        return parseDecimal(val);\r\n    }\r\n\r\n    get value(): number {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: number) {\r\n        if (value == null || (value as any) === '') {\r\n            this.element.val('');\r\n        }\r\n        else if (($.fn as any).autoNumeric) {\r\n            (this.element as any).autoNumeric('set', value);\r\n        }\r\n        else\r\n            this.element.val(formatNumber(value));\r\n    }\r\n\r\n    set value(v: number) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    get_isValid(): boolean {\r\n        return !isNaN(this.get_value());\r\n    }\r\n\r\n    static defaultAutoNumericOptions(): any {\r\n        return {\r\n            aDec: Culture.decimalSeparator,\r\n            altDec: ((Culture.decimalSeparator === '.') ? ',' : '.'),\r\n            aSep: ((Culture.decimalSeparator === '.') ? ',' : '.'),\r\n            aPad: true\r\n        };\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IDoubleValue } from \"../../interfaces\";\r\nimport { extend, formatNumber, isTrimmedEmpty, parseInteger, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { DecimalEditor } from \"./decimaleditor\";\r\n\r\nexport interface IntegerEditorOptions {\r\n    minValue?: number;\r\n    maxValue?: number;\r\n    allowNegatives?: boolean;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.IntegerEditor', [IDoubleValue])\r\n@Decorators.element('<input type=\"text\"/>')\r\nexport class IntegerEditor extends Widget<IntegerEditorOptions> implements IDoubleValue {\r\n\r\n    constructor(input: JQuery, opt?: IntegerEditorOptions) {\r\n        super(input, opt);\r\n\r\n        input.addClass('integerQ');\r\n        var numericOptions = extend(DecimalEditor.defaultAutoNumericOptions(),\r\n            {\r\n                vMin: (this.options.minValue ?? this.options.allowNegatives ? (this.options.maxValue != null ? (\"-\" + this.options.maxValue) : '-2147483647') : '0'),\r\n                vMax: (this.options.maxValue ?? 2147483647),\r\n                aSep: null\r\n            });\r\n\r\n        if (($.fn as any).autoNumeric)\r\n            (input as any).autoNumeric(numericOptions);\r\n    }\r\n\r\n    get_value(): number {\r\n        if (($.fn as any).autoNumeric) {\r\n            var val = (this.element as any).autoNumeric('get') as string;\r\n            if (!!isTrimmedEmpty(val))\r\n                return null;\r\n            else \r\n                return parseInt(val, 10);\r\n        } \r\n        else {\r\n            var val = trimToNull(this.element.val());\r\n            if (val == null)\r\n                return null;\r\n            return parseInteger(val)\r\n        }\r\n\r\n    }\r\n\r\n    get value(): number {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: number) {\r\n        if (value == null || (value as any) === '')\r\n            this.element.val('');\r\n        else if (($.fn as any).autoNumeric)\r\n            (this.element as any).autoNumeric('set', value);\r\n        else\r\n            this.element.val(formatNumber(value));\r\n    }\r\n\r\n    set value(v: number) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    get_isValid(): boolean {\r\n        return !isNaN(this.get_value());\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IReadOnly, IStringValue } from \"../../interfaces\";\r\nimport { addValidationRule, Culture, format, formatDate, Invariant, isEmptyOrNull, parseDate, parseISODateTime, replaceAll, text, today } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport let datePickerIconSvg = '<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" viewBox=\"0 0 17 17\"><g></g><path d=\"M14 2v-1h-3v1h-5v-1h-3v1h-3v15h17v-15h-3zM12 2h1v2h-1v-2zM4 2h1v2h-1v-2zM16 16h-15v-8.921h15v8.921zM1 6.079v-3.079h2v2h3v-2h5v2h3v-2h2v3.079h-15z\" fill=\"currentColor\"></path></svg>';\r\n\r\n@Decorators.registerEditor('Serenity.DateEditor', [IStringValue, IReadOnly])\r\n@Decorators.element('<input type=\"text\"/>')\r\nexport class DateEditor extends Widget<any> implements IStringValue, IReadOnly {\r\n\r\n    private minValue: string;\r\n    private maxValue: string;\r\n    private minDate: string;\r\n    private maxDate: string;\r\n    private sqlMinMax: boolean;\r\n\r\n    constructor(input: JQuery) {\r\n        super(input);\r\n\r\n        // @ts-ignore\r\n        if (typeof flatpickr !== \"undefined\" && (DateEditor.useFlatpickr || !$.fn.datepicker)) {\r\n            // @ts-ignore\r\n            flatpickr(input[0], DateEditor.flatPickrOptions(input));\r\n        }\r\n        else if ($.fn.datepicker) {\r\n            input.datepicker({\r\n                showOn: 'button',\r\n                beforeShow: (inp, inst) => {\r\n                    return !input.hasClass('readonly') as any;\r\n                },\r\n                yearRange: (this.yearRange ?? '-100:+50')\r\n            });\r\n\r\n        }\r\n        else {\r\n            input.attr('type', 'date');\r\n        }\r\n\r\n        input.on('keyup.' + this.uniqueName, e => {\r\n            if (e.which === 32 && !this.get_readOnly()) {\r\n                if (this.get_valueAsDate() != today()) {\r\n                    this.set_valueAsDate(today());\r\n                    this.element.trigger('change');\r\n                }\r\n            }\r\n            else {\r\n                DateEditor.dateInputKeyup(e);\r\n            }\r\n        });\r\n\r\n        input.on('change.' + this.uniqueName, DateEditor.dateInputChange);\r\n\r\n        addValidationRule(input, this.uniqueName, e1 => {\r\n            var value = this.get_value();\r\n            if (isEmptyOrNull(value)) {\r\n                return null;\r\n            }\r\n\r\n            if (!isEmptyOrNull(this.get_minValue()) && Invariant.stringCompare(formatDate(value, 'yyyy-MM-dd'), formatDate(this.get_minValue(), 'yyyy-MM-dd')) < 0) {\r\n                return format(text('Validation.MinDate'), formatDate(this.get_minValue(), null));\r\n            }\r\n\r\n            if (!isEmptyOrNull(this.get_maxValue()) && Invariant.stringCompare(formatDate(value, 'yyyy-MM-dd'), formatDate(this.get_maxValue(), 'yyyy-MM-dd')) > 0) {\r\n                return format(text('Validation.MaxDate'), formatDate(this.get_maxValue(), null));\r\n            }\r\n\r\n            return null;\r\n        });\r\n\r\n        this.set_sqlMinMax(true)\r\n    }\r\n\r\n    public static useFlatpickr: boolean;\r\n\r\n    public static flatPickrOptions(input: JQuery) {\r\n        return {\r\n            clickOpens: true,\r\n            allowInput: true,\r\n            dateFormat: Culture.dateOrder.split('').join(Culture.dateSeparator).replace('y', 'Y'),\r\n            onChange: function() {\r\n                input.triggerHandler('change');\r\n            }\r\n        }\r\n    }\r\n\r\n    get_value(): string {\r\n        var value = this.element.val().trim();\r\n        if (value != null && value.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        return formatDate(value, 'yyyy-MM-dd');\r\n    }\r\n\r\n    get value(): string {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: string) {\r\n        if (value == null) {\r\n            this.element.val('');\r\n        }\r\n        else if (value.toLowerCase() === 'today' || value.toLowerCase() === 'now') {\r\n            this.element.val(formatDate(today(), null));\r\n        }\r\n        else {\r\n            this.element.val(formatDate(value, null));\r\n        }\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    private get_valueAsDate(): Date {\r\n        if (isEmptyOrNull(this.get_value())) {\r\n            return null;\r\n        }\r\n\r\n        return parseISODateTime(this.get_value());\r\n    }\r\n\r\n    get valueAsDate(): Date {\r\n        return this.get_valueAsDate();\r\n    }\r\n\r\n    private set_valueAsDate(value: Date): void {\r\n        if (value == null) {\r\n            this.set_value(null);\r\n        }\r\n\r\n        this.set_value(formatDate(value, 'yyyy-MM-dd'));\r\n    }\r\n\r\n    set valueAsDate(v: Date) {\r\n        this.set_valueAsDate(v);\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return this.element.hasClass('readonly');\r\n    }\r\n\r\n    set_readOnly(value: boolean): void {\r\n\r\n        if (value !== this.get_readOnly()) {\r\n            if (value) {\r\n                this.element.addClass('readonly').attr('readonly', 'readonly');\r\n                this.element.nextAll('.ui-datepicker-trigger').css('opacity', '0.1');\r\n            }\r\n            else {\r\n                this.element.removeClass('readonly').removeAttr('readonly');\r\n                this.element.nextAll('.ui-datepicker-trigger').css('opacity', '1');\r\n            }\r\n        }\r\n    }\r\n\r\n    @Decorators.option()\r\n    public yearRange: string;\r\n\r\n    @Decorators.option()\r\n    get_minValue(): string {\r\n        return this.minValue;\r\n    }\r\n\r\n    set_minValue(value: string) {\r\n        this.minValue = value;\r\n    }\r\n\r\n    @Decorators.option()\r\n    get_maxValue(): string {\r\n        return this.maxValue;\r\n    }\r\n\r\n    set_maxValue(value: string): void {\r\n        this.maxValue = value;\r\n    }\r\n\r\n    get_minDate(): Date {\r\n        return parseISODateTime(this.get_minValue());\r\n    }\r\n\r\n    set_minDate(value: Date): void {\r\n        this.set_minValue(formatDate(value, 'yyyy-MM-dd'));\r\n    }\r\n\r\n    @Decorators.option()\r\n    get_maxDate(): Date {\r\n        return parseISODateTime(this.get_maxValue());\r\n    }\r\n\r\n    set_maxDate(value: Date) {\r\n        this.set_maxValue(formatDate(value, 'yyyy-MM-dd'));\r\n    }\r\n\r\n    @Decorators.option()\r\n    get_sqlMinMax(): boolean {\r\n        return this.get_minValue() === '1753-01-01' && this.get_maxValue() === '9999-12-31';\r\n    }\r\n\r\n    set_sqlMinMax(value: boolean) {\r\n        if (value) {\r\n            this.set_minValue('1753-01-01');\r\n            this.set_maxValue('9999-12-31');\r\n        }\r\n        else {\r\n            this.set_minValue(null);\r\n            this.set_maxValue(null);\r\n        }\r\n    }\r\n\r\n    static dateInputChange = function (e: JQueryEventObject) {\r\n        if (Culture.dateOrder !== 'dmy') {\r\n            return;\r\n        }\r\n        var input = $(e.target);\r\n        if (!input.is(':input') || input.attr(\"type\") == \"date\") {\r\n            return;\r\n        }\r\n        var val = input.val() ?? '';\r\n        var x = {};\r\n        if (val.length >= 6 && /^[0-9]*$/g.test(val)) {\r\n            input.val(val.substr(0, 2) + Culture.dateSeparator + val.substr(2, 2) + Culture.dateSeparator + val.substr(4));\r\n        }\r\n        val = input.val() ?? '';\r\n        if (!!(val.length >= 5 && parseDate(val) !== false)) {\r\n            var d = parseDate(val);\r\n            input.val(formatDate(d, null));\r\n        }\r\n    };\r\n\r\n    static flatPickrTrigger(input: JQuery): JQuery {\r\n        return $('<i class=\"ui-datepicker-trigger\" href=\"javascript:;\">' + datePickerIconSvg + '</i>')\r\n            .insertAfter(input)\r\n            .click(() => {\r\n                if (!input.hasClass('readonly'))\r\n                    (input[0] as any)._flatpickr.open();\r\n            });\r\n    }\r\n\r\n    static dateInputKeyup(e: JQueryEventObject) {\r\n\r\n        if (Culture.dateOrder !== 'dmy') {\r\n            return;\r\n        }\r\n\r\n        var input = $(e.target);\r\n        if (!input.is(':input') || input.attr(\"type\") == \"date\") {\r\n            // for browser date editors, format might not match culture setting\r\n            return;\r\n        }\r\n\r\n        if (input.is('[readonly]') || input.is(':disabled')) {\r\n            return;\r\n        }\r\n\r\n        var val: string = input.val() ?? '';\r\n        if (!!(val.length === 0 || (input[0] as any).selectionEnd !== val.length)) {\r\n            return;\r\n        }\r\n\r\n        if (val.indexOf(Culture.dateSeparator + Culture.dateSeparator) !== -1) {\r\n            input.val(replaceAll(val, Culture.dateSeparator + Culture.dateSeparator,\r\n                Culture.dateSeparator));\r\n            return;\r\n        }\r\n\r\n        function isNumeric(c: number): boolean {\r\n            return c >= 48 && c <= 57;\r\n        }\r\n\r\n        if (e.which === 47 || e.which === 111) {\r\n\r\n            if (val.length >= 2 && val.charAt(val.length - 1) === Culture.dateSeparator &&\r\n                val.charAt(val.length - 2) === Culture.dateSeparator) {\r\n                input.val(val.substr(0, val.length - 1));\r\n                return;\r\n            }\r\n\r\n            if (val.charAt(val.length - 1) !== Culture.dateSeparator) {\r\n                return;\r\n            }\r\n\r\n            switch (val.length) {\r\n                case 2: {\r\n                    if (isNumeric(val.charCodeAt(0))) {\r\n                        val = '0' + val;\r\n                        break;\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                case 4: {\r\n                    if (isNumeric(val.charCodeAt(0)) &&\r\n                        isNumeric(val.charCodeAt(2)) &&\r\n                        val.charAt(1) == Culture.dateSeparator) {\r\n                        val = '0' + val.charAt(0) + Culture.dateSeparator + '0' +\r\n                            val.charAt(2) + Culture.dateSeparator;\r\n                        break;\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                case 5: {\r\n                    if (isNumeric(val.charCodeAt(0)) &&\r\n                        isNumeric(val.charCodeAt(2)) &&\r\n                        isNumeric(val.charCodeAt(3)) &&\r\n                        val.charAt(1) === Culture.dateSeparator) {\r\n                        val = '0' + val;\r\n                        break;\r\n                    }\r\n                    else if (isNumeric(val.charCodeAt(0)) &&\r\n                        isNumeric(val.charCodeAt(1)) &&\r\n                        isNumeric(val.charCodeAt(3)) &&\r\n                        val.charAt(2) === Culture.dateSeparator) {\r\n                        val = val.charAt(0) + val.charAt(1) +\r\n                            Culture.dateSeparator + '0' + val.charAt(3) + Culture.dateSeparator;\r\n                        break;\r\n                    }\r\n                    else {\r\n                        break;\r\n                    }\r\n                }\r\n                default: {\r\n                    return;\r\n                }\r\n            }\r\n            input.val(val);\r\n        }\r\n\r\n        if (val.length < 6 && (e.which >= 48 && e.which <= 57 || e.which >= 96 && e.which <= 105) &&\r\n            isNumeric(val.charCodeAt(val.length - 1))) {\r\n            switch (val.length) {\r\n                case 1: {\r\n                    if (val.charCodeAt(0) <= 51) {\r\n                        return;\r\n                    }\r\n                    val = '0' + val;\r\n                    break;\r\n                }\r\n\r\n                case 2: {\r\n                    if (!isNumeric(val.charCodeAt(0))) {\r\n                        return;\r\n                    }\r\n                    break;\r\n                }\r\n\r\n                case 3: {\r\n                    if (!isNumeric(val.charCodeAt(0)) ||\r\n                        val.charAt(1) !== Culture.dateSeparator ||\r\n                        val.charCodeAt(2) <= 49) {\r\n                        return;\r\n                    }\r\n\r\n                    val = '0' + val.charAt(0) + Culture.dateSeparator + '0' + val.charAt(2);\r\n                    break;\r\n                }\r\n\r\n                case 4: {\r\n                    if (val.charAt(1) == Culture.dateSeparator) {\r\n                        if (!isNumeric(val.charCodeAt(0)) ||\r\n                            !isNumeric(val.charCodeAt(2))) {\r\n                            return;\r\n                        }\r\n\r\n                        val = '0' + val;\r\n                        break;\r\n                    }\r\n                    else if (val.charAt(2) == Culture.dateSeparator) {\r\n                        if (!isNumeric(val.charCodeAt(0)) ||\r\n                            !isNumeric(val.charCodeAt(1)) ||\r\n                            val.charCodeAt(3) <= 49) {\r\n                            return;\r\n                        }\r\n\r\n                        val = val.charAt(0) + val.charAt(1) + Culture.dateSeparator +\r\n                            '0' + val.charAt(3);\r\n                        break;\r\n                    }\r\n                    else {\r\n                        return;\r\n                    }\r\n                }\r\n                case 5: {\r\n                    if (val.charAt(2) !== Culture.dateSeparator ||\r\n                        !isNumeric(val.charCodeAt(0)) ||\r\n                        !isNumeric(val.charCodeAt(1)) ||\r\n                        !isNumeric(val.charCodeAt(3))) {\r\n                        return;\r\n                    }\r\n\r\n                    break;\r\n                }\r\n\r\n                default: {\r\n                    return;\r\n                }\r\n            }\r\n\r\n            input.val(val + Culture.dateSeparator);\r\n        }\r\n    };\r\n}\r\n\r\nfunction jQueryDatepickerInitialization(): boolean {\r\n    if (!$.datepicker || !$.datepicker.regional || !$.datepicker.regional.en)\r\n        return false;\r\n    let order = Culture.dateOrder;\r\n    let s = Culture.dateSeparator;\r\n    let culture = ($('html').attr('lang') || 'en').toLowerCase();\r\n    if (!$.datepicker.regional[culture]) {\r\n        culture = culture.split('-')[0];\r\n        if (!$.datepicker.regional[culture]) {\r\n            culture = 'en';\r\n        }\r\n    }\r\n    $.datepicker.setDefaults($.datepicker.regional['en']);\r\n    $.datepicker.setDefaults($.datepicker.regional[culture]);\r\n    $.datepicker.setDefaults({\r\n        dateFormat: (order == 'mdy' ? 'mm' + s + 'dd' + s + 'yy' :\r\n            (order == 'ymd' ? 'yy' + s + 'mm' + s + 'dd' :\r\n                'dd' + s + 'mm' + s + 'yy')),\r\n        buttonImage: 'data:image/svg+xml,' + encodeURIComponent(datePickerIconSvg),\r\n        buttonImageOnly: true,\r\n        showOn: 'both',\r\n        showButtonPanel: true,\r\n        changeMonth: true,\r\n        changeYear: true\r\n    });\r\n\r\n    if ($.ui && $.ui.version <= '1.12.1') {\r\n        $.datepicker.setDefaults({\r\n            buttonImage: null,\r\n            buttonImageOnly: false,\r\n            buttonText: '<i class=\"fa fa-calendar\"></i>'\r\n        });\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\ntypeof $ !== \"undefined\" && $.fn && !jQueryDatepickerInitialization() && $(jQueryDatepickerInitialization);\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IReadOnly, IStringValue } from \"../../interfaces\";\r\nimport { addOption, addValidationRule, Culture, format, formatDate, formatISODateTimeUTC, Invariant, isEmptyOrNull, parseDate, parseISODateTime, round, text, today, trunc, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { DateEditor } from \"./dateeditor\";\r\nimport { EditorUtils } from \"./editorutils\";\r\n\r\n@Decorators.registerEditor('Serenity.DateTimeEditor', [IStringValue, IReadOnly])\r\n@Decorators.element('<input type=\"text\"/>')\r\nexport class DateTimeEditor extends Widget<DateTimeEditorOptions> implements IStringValue, IReadOnly {\r\n\r\n    private minValue: string;\r\n    private maxValue: string;\r\n    private time: JQuery;\r\n    private lastSetValue: string;\r\n    private lastSetValueGet: string;\r\n\r\n    constructor(input: JQuery, opt?: DateTimeEditorOptions) {\r\n        super(input, opt);\r\n        \r\n        input.addClass('s-DateTimeEditor');\r\n\r\n        if (this.options.inputOnly) {\r\n            input.addClass('dateTimeQ');\r\n            // just a basic input, usually read only display\r\n        }\r\n        // @ts-ignore\r\n        else if (typeof flatpickr !== \"undefined\" && (DateEditor.useFlatpickr || !$.fn.datepicker || this.options.seconds)) {\r\n            input.addClass('dateTimeQ');\r\n            // @ts-ignore\r\n            flatpickr(input[0], this.getFlatpickrOptions());\r\n        }\r\n        else if ($.fn.datepicker) {\r\n            input.addClass('dateQ');\r\n\r\n            input.datepicker({\r\n                showOn: 'button',\r\n                beforeShow: function () {\r\n                    return !input.hasClass('readonly');\r\n                } as any,\r\n                yearRange: (this.options.yearRange ?? '-100:+50')\r\n            });\r\n\r\n            input.bind('change.' + this.uniqueName, (e) => {\r\n                this.lastSetValue = null;\r\n                DateEditor.dateInputChange(e);\r\n            });\r\n\r\n            this.time = $('<select/>').addClass('editor s-DateTimeEditor time');\r\n            var after = input.next('.ui-datepicker-trigger');\r\n            if (after.length > 0) {\r\n                this.time.insertAfter(after);\r\n            }\r\n            else {\r\n                after = input.prev('.ui-datepicker-trigger');\r\n                if (after.length > 0) {\r\n                    this.time.insertBefore(after);\r\n                }\r\n                else {\r\n                    this.time.insertAfter(input);\r\n                }\r\n            }\r\n\r\n            this.time.on('change', function (e3) {\r\n                this.lastSetValue = null;\r\n                input.triggerHandler('change');\r\n            });\r\n\r\n            var timeOpt = DateTimeEditor.getTimeOptions(\r\n                (this.options.startHour ?? 0), 0,\r\n                (this.options.endHour ?? 23), 59,\r\n                (this.options.intervalMinutes ?? 5));\r\n\r\n            for (var t of timeOpt) {\r\n                addOption(this.time, t, t);\r\n            }\r\n\r\n            addValidationRule(input, this.uniqueName, e1 => {\r\n                var value = this.get_value();\r\n                if (isEmptyOrNull(value)) {\r\n                    return null;\r\n                }\r\n\r\n                if (!isEmptyOrNull(this.get_minValue()) && Invariant.stringCompare(value, this.get_minValue()) < 0) {\r\n                    return format(text('Validation.MinDate'), formatDate(this.get_minValue(), null));\r\n                }\r\n    \r\n                if (!isEmptyOrNull(this.get_maxValue()) && Invariant.stringCompare(value, this.get_maxValue()) > 0) {\r\n                    return format(text('Validation.MaxDate'), formatDate(this.get_maxValue(), null));\r\n                }\r\n\r\n                return null;\r\n            });   \r\n        }\r\n        else \r\n            input.attr('type', 'datetime').addClass('dateTimeQ');\r\n\r\n        input.bind('keyup.' + this.uniqueName, e => {\r\n            if (this.get_readOnly())\r\n                return;\r\n            \r\n            if (this.time) {\r\n                if (e.which === 32) {\r\n                    if (this.get_valueAsDate() !== new Date()) {\r\n                        this.set_valueAsDate(new Date());\r\n                        this.element.trigger('change');\r\n                    }\r\n                }\r\n                else {\r\n                    var before = this.element.val();\r\n                    DateEditor.dateInputKeyup(e);\r\n                    if (before != this.element.val())\r\n                        this.lastSetValue = null;\r\n                }\r\n            }\r\n        });\r\n\r\n        this.set_sqlMinMax(true);\r\n\r\n        if (!this.options.inputOnly) {\r\n            $(\"<i class='inplace-button inplace-now'><b></b></div>\")\r\n                .attr('title', this.getInplaceNowText())\r\n                .insertAfter(this.time).click(e2 => {\r\n                    if (this.element.hasClass('readonly')) {\r\n                        return;\r\n                    }\r\n                    this.lastSetValue = null;\r\n                    this.set_valueAsDate(new Date());\r\n                    input.triggerHandler('change');\r\n                });\r\n        }\r\n    }\r\n\r\n    getFlatpickrOptions(): any {\r\n        return {\r\n            clickOpens: true,\r\n            allowInput: true,\r\n            enableTime: true,\r\n            time_24hr: true,\r\n            enableSeconds: !!this.options.seconds,\r\n            minuteIncrement: this.options.intervalMinutes ?? 5,\r\n            dateFormat: Culture.dateOrder.split('').join(Culture.dateSeparator).replace('y', 'Y') + \" H:i\" + (this.options.seconds ? \":S\" : \"\"),\r\n            onChange: () => {\r\n                this.lastSetValue = null;\r\n                this.element && this.element.triggerHandler('change');\r\n            }\r\n        }\r\n    }\r\n\r\n    get_value(): string {           \r\n        var value = this.element.val().trim();\r\n        if (value != null && value.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        var result: string;\r\n        if (this.time) {\r\n            var datePart = formatDate(value, 'yyyy-MM-dd');\r\n            var timePart = this.time.val();\r\n                result = datePart + 'T' + timePart + ':00.000';\r\n        }\r\n        else\r\n            result = formatDate(parseDate(this.element.val()), \"yyyy-MM-ddTHH:mm:ss.fff\");\r\n\r\n        if (this.options.useUtc)\r\n            result = formatISODateTimeUTC(parseISODateTime(result));\r\n\r\n        if (this.lastSetValue != null &&\r\n            this.lastSetValueGet == result)\r\n            return this.lastSetValue;\r\n\r\n        return result;\r\n    }\r\n\r\n    get value(): string {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: string) {\r\n        if (isEmptyOrNull(value)) {\r\n            this.element.val('');\r\n            this.time && this.time.val('00:00');\r\n        }\r\n        else if (value.toLowerCase() === 'today') {\r\n            if (this.time) {\r\n                this.element.val(formatDate(today(), null));\r\n                this.time.val('00:00');\r\n            }\r\n            else {\r\n                this.element.val(this.getDisplayFormat())\r\n            }\r\n        }\r\n        else {\r\n            var val = ((value.toLowerCase() === 'now') ? new Date() : parseISODateTime(value));\r\n            if (this.time) {\r\n                val = DateTimeEditor.roundToMinutes(val, (this.options.intervalMinutes ?? 5));\r\n                this.element.val(formatDate(val, null));\r\n                this.time.val(formatDate(val, 'HH:mm'));\r\n            }\r\n            else\r\n                this.element.val(formatDate(val, this.getDisplayFormat()));\r\n        }\r\n\r\n        this.lastSetValue = null;\r\n        if (!isEmptyOrNull(value) && value.toLowerCase() != 'today' && value.toLowerCase() != 'now') {\r\n            this.lastSetValueGet = this.get_value();\r\n            this.lastSetValue = value;\r\n        }\r\n    }\r\n\r\n    private getInplaceNowText(): string {\r\n        return tryGetText('Controls.DateTimeEditor.SetToNow') ?? 'set to now';\r\n    }\r\n\r\n    private getDisplayFormat(): string {\r\n        return (this.options.seconds ? Culture.dateTimeFormat : Culture.dateTimeFormat.replace(':ss', ''));\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    private get_valueAsDate(): Date {\r\n        if (isEmptyOrNull(this.get_value())) {\r\n            return null;\r\n        }\r\n\r\n        return parseISODateTime(this.get_value());\r\n    }\r\n\r\n    get valueAsDate() {\r\n        return this.get_valueAsDate();\r\n    }\r\n\r\n    private set_valueAsDate(value: Date) {\r\n        if (value == null) {\r\n            this.set_value(null);\r\n        }\r\n\r\n        this.set_value(formatDate(value, 'yyyy-MM-ddTHH:mm' + (this.options.seconds ? ':ss' : '')));\r\n    }\r\n\r\n    set valueAsDate(value: Date) {\r\n        this.set_valueAsDate(value);\r\n    }\r\n\r\n    @Decorators.option()\r\n    get_minValue(): string {\r\n        return this.minValue;\r\n    }\r\n\r\n    set_minValue(value: string) {\r\n        this.minValue = value;\r\n    }\r\n\r\n    @Decorators.option()\r\n    get_maxValue(): string {\r\n        return this.maxValue;\r\n    }\r\n\r\n    set_maxValue(value: string): void {\r\n        this.maxValue = value;\r\n    }\r\n\r\n    get_minDate(): Date {\r\n        return parseISODateTime(this.get_minValue());\r\n    }\r\n\r\n    set_minDate(value: Date): void {\r\n        this.set_minValue(formatDate(value, 'yyyy-MM-ddTHH:mm:ss'));\r\n    }\r\n\r\n    @Decorators.option()\r\n    get_maxDate(): Date {\r\n        return parseISODateTime(this.get_maxValue());\r\n    }\r\n\r\n    set_maxDate(value: Date) {\r\n        this.set_maxValue(formatDate(value, 'yyyy-MM-ddTHH:mm:ss'));\r\n    }\r\n\r\n    @Decorators.option()\r\n    get_sqlMinMax(): boolean {\r\n        return this.get_minValue() === '1753-01-01' && this.get_maxValue() === '9999-12-31';\r\n    }\r\n\r\n    set_sqlMinMax(value: boolean) {\r\n        if (value) {\r\n            this.set_minValue('1753-01-01');\r\n            this.set_maxValue('9999-12-31');\r\n        }\r\n        else {\r\n            this.set_minValue(null);\r\n            this.set_maxValue(null);\r\n        }\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return this.element.hasClass('readonly');\r\n    }\r\n\r\n    set_readOnly(value: boolean): void {\r\n\r\n        if (value !== this.get_readOnly()) {\r\n            if (value) {\r\n                this.element.addClass('readonly').attr('readonly', 'readonly');\r\n                this.element.nextAll('.ui-datepicker-trigger').css('opacity', '0.1');\r\n                this.element.nextAll('.inplace-now').css('opacity', '0.1');\r\n            }\r\n            else {\r\n                this.element.removeClass('readonly').removeAttr('readonly');\r\n                this.element.nextAll('.ui-datepicker-trigger').css('opacity', '1');\r\n                this.element.nextAll('.inplace-now').css('opacity', '1');\r\n            }\r\n\r\n            this.time && EditorUtils.setReadonly(this.time, value);\r\n        }\r\n    }\r\n\r\n    static roundToMinutes(date: Date, minutesStep: number) {\r\n        date = new Date(date.getTime());\r\n        var m = trunc(round(date.getMinutes() / minutesStep) * minutesStep);\r\n        date.setMinutes(m);\r\n        date.setSeconds(0);\r\n        date.setMilliseconds(0);\r\n        return date;\r\n    }\r\n\r\n    static getTimeOptions = function (fromHour: number, fromMin: number,\r\n        toHour: number, toMin: number, stepMins: number) {\r\n        var list = [];\r\n        if (toHour >= 23) {\r\n            toHour = 23;\r\n        }\r\n        if (toMin >= 60) {\r\n            toMin = 59;\r\n        }\r\n        var hour = fromHour;\r\n        var min = fromMin;\r\n        while (true) {\r\n            if (hour > toHour || hour === toHour && min > toMin) {\r\n                break;\r\n            }\r\n            var t = ((hour >= 10) ? '' : '0') + hour + ':' + ((min >= 10) ? '' : '0') + min;\r\n            list.push(t);\r\n            min += stepMins;\r\n            if (min >= 60) {\r\n                min -= 60;\r\n                hour++;\r\n            }\r\n        }\r\n        return list;\r\n    };\r\n}\r\n\r\nexport interface DateTimeEditorOptions {\r\n    startHour?: any;\r\n    endHour?: any;\r\n    intervalMinutes?: any;\r\n    yearRange?: string;\r\n    useUtc?: boolean;\r\n    seconds?: boolean;\r\n    inputOnly?: boolean;\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IDoubleValue, IReadOnly } from \"../../interfaces\";\r\nimport { addOption, toId } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { EditorUtils } from \"./editorutils\";\r\n\r\nexport interface TimeEditorOptions {\r\n    noEmptyOption?: boolean;\r\n    startHour?: any;\r\n    endHour?: any;\r\n    intervalMinutes?: any;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.TimeEditor', [IDoubleValue, IReadOnly])\r\n@Decorators.element(\"<select />\")\r\nexport class TimeEditor extends Widget<TimeEditorOptions> {\r\n\r\n    private minutes: JQuery;\r\n\r\n    constructor(input: JQuery, opt?: TimeEditorOptions) {\r\n        super(input, opt);\r\n\r\n        input.addClass('editor s-TimeEditor hour');\r\n\r\n        if (!this.options.noEmptyOption) {\r\n            addOption(input, '', '--');\r\n        }\r\n\r\n        for (var h = (this.options.startHour || 0); h <= (this.options.endHour || 23); h++) {\r\n            addOption(input, h.toString(), ((h < 10) ? ('0' + h) : h.toString()));\r\n        }\r\n\r\n        this.minutes = $('<select/>').addClass('editor s-TimeEditor minute').insertAfter(input);\r\n        this.minutes.change(() => this.element.trigger(\"change\"));\r\n\r\n        for (var m = 0; m <= 59; m += (this.options.intervalMinutes || 5)) {\r\n            addOption(this.minutes, m.toString(), ((m < 10) ? ('0' + m) : m.toString()));\r\n        }\r\n    }\r\n\r\n    public get value(): number {\r\n        var hour = toId(this.element.val());\r\n        var minute = toId(this.minutes.val());\r\n        if (hour == null || minute == null) {\r\n            return null;\r\n        }\r\n        return hour * 60 + minute;\r\n    }\r\n\r\n    protected get_value(): number {\r\n        return this.value;\r\n    }\r\n\r\n    public set value(value: number) {\r\n        if (!value) {\r\n            if (this.options.noEmptyOption) {\r\n                this.element.val(this.options.startHour);\r\n                this.minutes.val('0');\r\n            }\r\n            else {\r\n                this.element.val('');\r\n                this.minutes.val('0');\r\n            }\r\n        }\r\n        else {\r\n            this.element.val(Math.floor(value / 60).toString());\r\n            this.minutes.val(value % 60);\r\n        }\r\n    }\r\n\r\n    protected set_value(value: number): void {\r\n        this.value = value;\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return this.element.hasClass('readonly');\r\n    }\r\n\r\n    set_readOnly(value: boolean): void {\r\n\r\n        if (value !== this.get_readOnly()) {\r\n            if (value) {\r\n                this.element.addClass('readonly').attr('readonly', 'readonly');\r\n            }\r\n            else {\r\n                this.element.removeClass('readonly').removeAttr('readonly');\r\n            }\r\n            EditorUtils.setReadonly(this.minutes, value);\r\n        }\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IReadOnly, IStringValue } from \"../../interfaces\";\r\nimport { isEmptyOrNull, trimToNull, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface EmailEditorOptions {\r\n    domain?: string;\r\n    readOnlyDomain?: boolean;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.EmailEditor', [IStringValue, IReadOnly])\r\n@Decorators.element('<input type=\"text\"/>')\r\nexport class EmailEditor extends Widget<EmailEditorOptions> {\r\n\r\n    constructor(input: JQuery, opt: EmailEditorOptions) {\r\n        super(input, opt);\r\n\r\n        EmailEditor.registerValidationMethods();\r\n\r\n        input.addClass('emailuser');\r\n\r\n        var spanAt = $('<span/>').text('@').addClass('emailat').insertAfter(input);\r\n\r\n        var domain = $('<input type=\"text\"/>').addClass('emaildomain').insertAfter(spanAt);\r\n        domain.bind('blur.' + this.uniqueName, function () {\r\n            var validator = domain.closest('form').data('validator');\r\n            if (validator != null) {\r\n                validator.element(input[0]);\r\n            }\r\n        });\r\n\r\n        if (!isEmptyOrNull(this.options.domain)) {\r\n            domain.val(this.options.domain);\r\n        }\r\n\r\n        if (this.options.readOnlyDomain) {\r\n            domain.attr('readonly', 'readonly').addClass('disabled').attr('tabindex', '-1');\r\n        }\r\n\r\n        input.bind('keypress.' + this.uniqueName, e => {\r\n            if (e.which === 64) {\r\n                e.preventDefault();\r\n                if (!this.options.readOnlyDomain) {\r\n                    domain.focus();\r\n                    domain.select();\r\n                }\r\n            }\r\n        });\r\n\r\n        domain.bind('keypress.' + this.uniqueName, function (e1) {\r\n            if (e1.which === 64) {\r\n                e1.preventDefault();\r\n            }\r\n        });\r\n\r\n        if (!this.options.readOnlyDomain) {\r\n            input.change(e2 => this.set_value(input.val()));\r\n        }\r\n    }\r\n\r\n    static registerValidationMethods(): void {\r\n        if (!$.validator || !$.validator.methods || $.validator.methods['emailuser'] != null)\r\n            return;\r\n\r\n        $.validator.addMethod('emailuser', function (value, element) {\r\n\r\n            var domain = $(element).nextAll('.emaildomain');\r\n            if (domain.length > 0 && domain.attr('readonly') == null) {\r\n\r\n                if (this.optional(element) && this.optional(domain[0])) {\r\n                    return true;\r\n                }\r\n\r\n                return $.validator.methods.email.call(this, value + '@' + domain.val(), element);\r\n            }\r\n            else {\r\n                return $.validator.methods.email.call(this, value + '@dummy.com', element);\r\n            }\r\n        }, tryGetText(\"Validation.Email\") ?? $.validator.messages.email);\r\n    }\r\n\r\n    get_value(): string {\r\n        var domain = this.element.nextAll('.emaildomain');\r\n        var value = this.element.val();\r\n        var domainValue = domain.val();\r\n        if (isEmptyOrNull(value)) {\r\n            if (this.options.readOnlyDomain || isEmptyOrNull(domainValue)) {\r\n                return '';\r\n            }\r\n            return '@' + domainValue;\r\n        }\r\n        return value + '@' + domainValue;\r\n    }\r\n\r\n    get value(): string {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: string): void {\r\n        var domain = this.element.nextAll('.emaildomain');\r\n        value = trimToNull(value);\r\n        if (value == null) {\r\n            if (!this.options.readOnlyDomain)\r\n                domain.val('');\r\n            this.element.val('');\r\n        }\r\n        else {\r\n            var parts = value.split('@');\r\n            if (parts.length > 1) {\r\n                if (!this.options.readOnlyDomain) {\r\n                    domain.val(parts[1]);\r\n                    this.element.val(parts[0]);\r\n                }\r\n                else if (!isEmptyOrNull(this.options.domain)) {\r\n                    if (parts[1] !== this.options.domain)\r\n                        this.element.val(value);\r\n                    else \r\n                        this.element.val(parts[0]);\r\n                }\r\n                else \r\n                    this.element.val(parts[0]);\r\n            }\r\n            else\r\n                this.element.val(parts[0]);\r\n        }\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        var domain = this.element.nextAll('.emaildomain');\r\n        return !(this.element.attr('readonly') == null &&\r\n            (!this.options.readOnlyDomain || domain.attr('readonly') == null));\r\n    }\r\n\r\n    set_readOnly(value: boolean): void {\r\n        var domain = this.element.nextAll('.emaildomain');\r\n        if (value) {\r\n            this.element.attr('readonly', 'readonly').addClass('readonly');\r\n            if (!this.options.readOnlyDomain) {\r\n                domain.attr('readonly', 'readonly').addClass('readonly');\r\n            }\r\n        }\r\n        else {\r\n            this.element.removeAttr('readonly').removeClass('readonly');\r\n            if (!this.options.readOnlyDomain) {\r\n                domain.removeAttr('readonly').removeClass('readonly');\r\n            }\r\n        }\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { StringEditor } from \"./stringeditor\";\r\n\r\n@Decorators.registerEditor('Serenity.EmailAddressEditor')\r\nexport class EmailAddressEditor extends StringEditor {\r\n    constructor(input: JQuery) {\r\n        super(input);\r\n\r\n        input.attr('type', 'email')\r\n            .addClass('email');\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IStringValue } from \"../../interfaces\";\r\nimport { trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { StringEditor } from \"./stringeditor\";\r\n\r\n@Decorators.registerEditor('Serenity.URLEditor', [IStringValue])\r\nexport class URLEditor extends StringEditor {\r\n\r\n    constructor(input: JQuery) {\r\n        super(input);\r\n\r\n        input.addClass(\"url\").attr(\"title\", \"URL should be entered in format: 'http://www.site.com/page'.\");\r\n\r\n        input.on(\"blur.\" + this.uniqueName, e => {\r\n            var validator = input.closest(\"form\").data(\"validator\") as JQueryValidation.Validator;\r\n            if (validator == null)\r\n                return;\r\n\r\n            if (!input.hasClass(\"error\"))\r\n                return;\r\n\r\n            var value = trimToNull(input.val());\r\n            if (!value)\r\n                return;\r\n\r\n            value = \"http://\" + value;\r\n\r\n            if ($.validator.methods['url'].call(validator, value, input[0]) == true) {\r\n                input.val(value);\r\n                validator.element(input);\r\n            }\r\n        });\r\n    }\r\n}", "\uFEFFimport { Decorators, EnumKeyAttribute } from \"../../decorators\";\r\nimport { IReadOnly, IStringValue } from \"../../interfaces\";\r\nimport { Enum, getAttributes, getLookup, isEmptyOrNull, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { EnumTypeRegistry } from \"../../types/enumtyperegistry\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface RadioButtonEditorOptions {\r\n    enumKey?: string;\r\n    enumType?: any;\r\n    lookupKey?: string;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.RadioButtonEditor', [IStringValue, IReadOnly])\r\n@Decorators.element('<div/>')\r\nexport class RadioButtonEditor extends Widget<RadioButtonEditorOptions>\r\n    implements IReadOnly {\r\n\r\n    constructor(input: JQuery, opt: RadioButtonEditorOptions) {\r\n        super(input, opt);\r\n\r\n        if (isEmptyOrNull(this.options.enumKey) &&\r\n            this.options.enumType == null &&\r\n            isEmptyOrNull(this.options.lookupKey)) {\r\n            return;\r\n        }\r\n\r\n        if (!isEmptyOrNull(this.options.lookupKey)) {\r\n            var lookup = getLookup(this.options.lookupKey);\r\n            for (var item of lookup.items) {\r\n                var textValue = item[lookup.textField];\r\n                var text = (textValue == null ? '' : textValue.toString());\r\n                var idValue = item[lookup.idField];\r\n                var id = (idValue == null ? '' : idValue.toString());\r\n                this.addRadio(id, text);\r\n            }\r\n        }\r\n        else {\r\n            var enumType = this.options.enumType || EnumTypeRegistry.get(this.options.enumKey);\r\n            var enumKey = this.options.enumKey;\r\n            if (enumKey == null && enumType != null) {\r\n                var enumKeyAttr = getAttributes(enumType, EnumKeyAttribute, false);\r\n                if (enumKeyAttr.length > 0) {\r\n                    enumKey = enumKeyAttr[0].value;\r\n                }\r\n            }\r\n\r\n            var values = Enum.getValues(enumType);\r\n            for (var x of values) {\r\n                var name = Enum.toString(enumType, x);\r\n                this.addRadio(x.toString(), tryGetText(\r\n                    'Enums.' + enumKey + '.' + name) ?? name);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected addRadio(value: string, text: string) {\r\n        var label = $('<label/>').text(text);\r\n        $('<input type=\"radio\"/>').attr('name', this.uniqueName)\r\n            .attr('id', this.uniqueName + '_' + value)\r\n            .attr('value', value).prependTo(label);\r\n        label.appendTo(this.element);\r\n    }\r\n\r\n    get_value(): string {\r\n        return this.element.find('input:checked').first().val();\r\n    }\r\n\r\n    get value(): string {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: string): void {\r\n        if (value !== this.get_value()) {\r\n            var inputs = this.element.find('input');\r\n            var checks = inputs.filter(':checked');\r\n            if (checks.length > 0) {\r\n                (checks[0] as HTMLInputElement).checked = false;\r\n            }\r\n            if (!isEmptyOrNull(value)) {\r\n                checks = inputs.filter('[value=' + value + ']');\r\n                if (checks.length > 0) {\r\n                    (checks[0] as HTMLInputElement).checked = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return this.element.attr('disabled') != null;\r\n    }\r\n\r\n    set_readOnly(value: boolean): void {\r\n        if (this.get_readOnly() !== value) {\r\n            if (value) {\r\n                this.element.attr('disabled', 'disabled')\r\n                    .find('input').attr('disabled', 'disabled');\r\n            }\r\n            else {\r\n                this.element.removeAttr('disabled')\r\n                    .find('input').removeAttr('disabled');\r\n            }\r\n        }\r\n    }\r\n\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IEditDialog, IGetEditValue, IReadOnly, ISetEditValue, IStringValue } from \"../../interfaces\";\r\nimport { any, Authorization, isArray, isEmptyOrNull, isTrimmedEmpty, PropertyItem, startsWith, text, trimToEmpty, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { DialogTypeRegistry } from \"../../types/dialogtyperegistry\";\r\nimport { ReflectionUtils } from \"../../types/reflectionutils\";\r\nimport { SubDialogHelper } from \"../helpers/subdialoghelper\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { CascadedWidgetLink } from \"./cascadedwidgetlink\";\r\nimport { EditorUtils } from \"./editorutils\";\r\n\r\nexport interface Select2CommonOptions {\r\n    allowClear?: boolean;\r\n    delimited?: boolean;\r\n    minimumResultsForSearch?: any;\r\n    multiple?: boolean;\r\n}\r\n\r\nexport interface Select2FilterOptions {\r\n    cascadeFrom?: string;\r\n    cascadeField?: string;\r\n    cascadeValue?: any;\r\n    filterField?: string;\r\n    filterValue?: any;\r\n}\r\n\r\nexport interface Select2InplaceAddOptions {\r\n    inplaceAdd?: boolean;\r\n    inplaceAddPermission?: string;\r\n    dialogType?: string;\r\n    autoComplete?: boolean;\r\n}\r\n\r\nexport interface Select2EditorOptions extends Select2FilterOptions, Select2InplaceAddOptions, Select2CommonOptions {\r\n}\r\n\r\nexport interface Select2SearchPromise {\r\n    abort?(): void;\r\n    catch?(callback: () => void): void;\r\n    fail?(callback: () => void): void;\r\n}\r\n\r\nexport interface Select2SearchQuery {\r\n    searchTerm?: string;\r\n    idList?: string[];\r\n    skip?: number;\r\n    take?: number;\r\n    checkMore?: boolean;\r\n}\r\n\r\nexport interface Select2SearchResult<TItem> {\r\n    items: TItem[];\r\n    more: boolean;\r\n}\r\n\r\n@Decorators.registerClass('Serenity.Select2Editor',\r\n    [ISetEditValue, IGetEditValue, IStringValue, IReadOnly])\r\n@Decorators.element(\"<input type=\\\"hidden\\\"/>\")\r\nexport class Select2Editor<TOptions, TItem> extends Widget<TOptions> implements\r\n    ISetEditValue, IGetEditValue, IStringValue, IReadOnly {\r\n\r\n    private _items: Select2Item[];\r\n    private _itemById: { [key: string]: Select2Item };\r\n    protected lastCreateTerm: string;\r\n\r\n    constructor(hidden: JQuery, opt?: any) {\r\n        super(hidden, opt);\r\n\r\n        this._items = [];\r\n        this._itemById = {};\r\n        var emptyItemText = this.emptyItemText();\r\n        if (emptyItemText != null) {\r\n            hidden.attr('placeholder', emptyItemText);\r\n        }\r\n        var select2Options = this.getSelect2Options();\r\n        hidden.select2(select2Options);\r\n        hidden.attr('type', 'text');\r\n\r\n        // for jquery validate to work\r\n        hidden.on('change.' + this.uniqueName, (e: any, valueSet) => {\r\n            if (valueSet !== true && hidden.closest('form').data('validator'))\r\n                    hidden.valid();\r\n        });\r\n\r\n        this.setCascadeFrom((this.options as Select2EditorOptions).cascadeFrom);\r\n\r\n        if (this.useInplaceAdd())\r\n            this.addInplaceCreate(text('Controls.SelectEditor.InplaceAdd'), null);\r\n    }\r\n\r\n    destroy() {\r\n        if (this.element != null) {\r\n            this.element.select2('destroy');\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    protected hasAsyncSource(): boolean {\r\n        return false;\r\n    }\r\n\r\n    protected asyncSearch(query: Select2SearchQuery, results: (result: Select2SearchResult<TItem>) => void): Select2SearchPromise {\r\n        results({\r\n            items: [],\r\n            more: false\r\n        });\r\n        return null;\r\n    }\r\n\r\n    protected getTypeDelay() {\r\n        return (this.options['typeDelay'] ?? 200);\r\n    }\r\n\r\n    protected emptyItemText() {\r\n        return this.element.attr('placeholder') ??\r\n            text('Controls.SelectEditor.EmptyItemText');\r\n    }\r\n\r\n    protected getPageSize(): number {\r\n        return this.options['pageSize'] ?? 100;\r\n    }\r\n\r\n    protected getIdField() {\r\n        return this.options['idField'];\r\n    }\r\n\r\n    protected itemId(item: TItem): string {\r\n        var value = item[this.getIdField()];\r\n        if (value == null)\r\n            return '';\r\n        return value.toString();\r\n    }\r\n\r\n    protected getTextField() {\r\n        return this.options['textField'] ?? this.getIdField();\r\n    }\r\n\r\n    protected itemText(item: TItem): string {\r\n        var value = item[this.getTextField()];\r\n        if (value == null)\r\n            return '';\r\n        return value.toString();\r\n    }\r\n\r\n    protected itemDisabled(item: TItem): boolean {\r\n        return false;\r\n    }\r\n\r\n    protected mapItem(item: TItem): Select2Item {\r\n        return {\r\n            id: this.itemId(item),\r\n            text: this.itemText(item),\r\n            disabled: this.itemDisabled(item),\r\n            source: item\r\n        };\r\n    }\r\n\r\n    protected mapItems(items: TItem[]): Select2Item[] {\r\n        return items.map(this.mapItem.bind(this));\r\n    }\r\n\r\n    protected allowClear() {\r\n        return (this.options as Select2EditorOptions).allowClear != null ?\r\n            !!(this.options as Select2EditorOptions).allowClear : this.emptyItemText() != null;\r\n    }\r\n\r\n    protected isMultiple() {\r\n        return !!(this.options as Select2EditorOptions).multiple;\r\n    }\r\n\r\n    protected getSelect2Options(): Select2Options {\r\n        var emptyItemText = this.emptyItemText();\r\n        var opt: Select2Options = {\r\n            multiple: this.isMultiple(),\r\n            placeHolder: (!isEmptyOrNull(emptyItemText) ? emptyItemText : null),\r\n            allowClear: this.allowClear(),\r\n            createSearchChoicePosition: 'bottom'\r\n        }\r\n\r\n        if (this.hasAsyncSource()) {\r\n            var typeTimeout = 0;\r\n            var queryPromise: Select2SearchPromise = null;\r\n            opt.query = query => {\r\n                var pageSize = this.getPageSize();\r\n                var searchQuery: Select2SearchQuery = {\r\n                    searchTerm: trimToNull(query.term),\r\n                    skip: (query.page - 1) * pageSize,\r\n                    take: pageSize,\r\n                    checkMore: true\r\n                }\r\n\r\n                queryPromise && queryPromise.abort && queryPromise.abort();\r\n                queryPromise = null;\r\n\r\n                if (typeTimeout != null)\r\n                    clearTimeout(typeTimeout);\r\n\r\n                var select2 = $(this.element).data('select2');\r\n                select2 && select2.search && select2.search.removeClass('select2-active').parent().removeClass('select2-active');\r\n\r\n                typeTimeout = setTimeout(() => {\r\n                    queryPromise && queryPromise.abort && queryPromise.abort();\r\n                    select2 && select2.search.addClass('select2-active').parent().addClass('select2-active');\r\n                    queryPromise = this.asyncSearch(searchQuery, result => {\r\n                        queryPromise = null;\r\n                        query.callback({\r\n                            results: this.mapItems(result.items),\r\n                            more: result.more\r\n                        });\r\n                    });\r\n                    (queryPromise && (queryPromise.catch || queryPromise.fail)).call(queryPromise, () => {\r\n                        queryPromise = null;\r\n                        select2 && select2.search && select2.search.removeClass('select2-active').parent().removeClass('select2-active');\r\n                    });\r\n                }, !query.term ? 0 : this.getTypeDelay());\r\n            }\r\n\r\n            var initPromise: Select2SearchPromise = null;\r\n            opt.initSelection = (element, callback) => {\r\n                var val = element.val();\r\n                if (val == null || val == '') {\r\n                    callback(null);\r\n                    return;\r\n                }\r\n\r\n                var isMultiple = this.isMultiple();\r\n                var idList = isMultiple ? val.split(',') : [val]; \r\n                var searchQuery = {\r\n                    idList: idList\r\n                }\r\n\r\n                initPromise && initPromise.abort && initPromise.abort();\r\n                initPromise = this.asyncSearch(searchQuery, result => {\r\n                    initPromise = null;\r\n                    if (isMultiple) {\r\n                        var items = (result.items || []).map(x => this.mapItem(x));\r\n                        this._itemById = this._itemById || {};\r\n                        for (var item of items)\r\n                            this._itemById[item.id] = item;\r\n                        if (this.isAutoComplete &&\r\n                            items.length != idList.length) {\r\n                            for (var v of idList) {\r\n                                if (!any(items, z => z.id == v)) {\r\n                                    items.push({\r\n                                        id: v,\r\n                                        text: v\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                        callback(items);\r\n                    }\r\n                    else if (!result.items || !result.items.length) {\r\n                        if (this.isAutoComplete) {\r\n                            callback({\r\n                                id: val,\r\n                                text: val\r\n                            });\r\n                        }\r\n                        else\r\n                            callback(null);\r\n                    }\r\n                    else {\r\n                        var item = this.mapItem(result.items[0]);\r\n                        this._itemById = this._itemById || {};\r\n                        this._itemById[item.id] = item;\r\n                        callback(item);\r\n                    }\r\n                });\r\n                (initPromise && (initPromise.catch || initPromise.fail)).call(initPromise, () => {\r\n                    initPromise = null;\r\n                });\r\n            }\r\n        }\r\n        else {\r\n            opt.data = this._items;\r\n            opt.query = (query) => {\r\n                var items = Select2Editor.filterByText(this._items, x => x.text, query.term);\r\n                var pageSize = this.getPageSize();\r\n                query.callback({\r\n                    results: items.slice((query.page - 1) * pageSize, query.page * pageSize),\r\n                    more: items.length >= query.page * pageSize\r\n                });\r\n            }\r\n            opt.initSelection = (element, callback) => {\r\n                var val = element.val();\r\n                var isAutoComplete = this.isAutoComplete();\r\n                if (this.isMultiple()) {\r\n                    var list = [];\r\n                    for (var z of val.split(',')) {\r\n                        var item2 = this._itemById[z];\r\n                        if (item2 == null && isAutoComplete) {\r\n                            item2 = { id: z, text: z };\r\n                            this.addItem(item2);\r\n                        }\r\n                        if (item2 != null) {\r\n                            list.push(item2);\r\n                        }\r\n                    }\r\n                    callback(list);\r\n                    return;\r\n                }\r\n                var it = this._itemById[val];\r\n                if (it == null && isAutoComplete) {\r\n                    it = { id: val, text: val };\r\n                    this.addItem(it);\r\n                }\r\n                callback(it);\r\n            }\r\n        }\r\n\r\n        if ((this.options as Select2EditorOptions).minimumResultsForSearch != null)\r\n            opt.minimumResultsForSearch = (this.options as Select2EditorOptions).minimumResultsForSearch;\r\n\r\n        if (this.isAutoComplete() || this.useInplaceAdd())\r\n            opt.createSearchChoice = this.getCreateSearchChoice(null);\r\n\r\n        return opt;\r\n    }\r\n\r\n    get_delimited() {\r\n        return !!(this.options as Select2EditorOptions).delimited;\r\n    }\r\n\r\n    public get items(): Select2Item[] {\r\n        if (this.hasAsyncSource())\r\n            throw new Error(\"Can't read items property of an async select editor!\");\r\n\r\n        return this._items || [];\r\n    }\r\n\r\n    public set items(value: Select2Item[]) {\r\n        if (this.hasAsyncSource())\r\n            throw new Error(\"Can't set items of an async select editor!\");\r\n\r\n        this._items = value || [];\r\n        this._itemById = {};\r\n        for (var item of this._items)\r\n            this._itemById[item.id] = item;\r\n    }\r\n\r\n    protected get itemById(): { [key: string]: Select2Item } {\r\n        if (this.hasAsyncSource())\r\n            throw new Error(\"Can't read items property of an async select editor!\");\r\n\r\n        return this._itemById;\r\n    }\r\n\r\n    protected set itemById(value: { [key: string]: Select2Item }) {\r\n        if (this.hasAsyncSource())\r\n            throw new Error(\"Can't set itemById of an async select editor!\");\r\n\r\n        this._itemById = value || {};\r\n    }\r\n\r\n    public clearItems() {\r\n        if (this.hasAsyncSource())\r\n            throw new Error(\"Can't clear items of an async select editor!\");\r\n\r\n        this._items.length = 0;\r\n        this._itemById = {};\r\n    }\r\n\r\n    public addItem(item: Select2Item) {\r\n        if (this.hasAsyncSource())\r\n            throw new Error(\"Can't add item to an async select editor!\");\r\n\r\n        this._items.push(item);\r\n        this._itemById[item.id] = item;\r\n    }\r\n\r\n    public addOption(key: string, text: string, source?: any, disabled?: boolean) {\r\n        this.addItem({\r\n            id: key,\r\n            text: text,\r\n            source: source,\r\n            disabled: disabled\r\n        });\r\n    }\r\n\r\n    protected addInplaceCreate(addTitle: string, editTitle: string) {\r\n        var self = this;\r\n        addTitle = (addTitle ?? text('Controls.SelectEditor.InplaceAdd'));\r\n        editTitle = (editTitle ?? text('Controls.SelectEditor.InplaceEdit'));\r\n        var inplaceButton = $('<a><b/></a>')\r\n            .addClass('inplace-button inplace-create')\r\n            .attr('title', addTitle)\r\n            .insertAfter(this.element).click(function (e) {\r\n                self.inplaceCreateClick(e);\r\n            });\r\n\r\n        this.get_select2Container().add(this.element).addClass('has-inplace-button');\r\n\r\n        this.element.change(() => {\r\n            var isNew = this.isMultiple() || isEmptyOrNull(this.get_value());\r\n            inplaceButton.attr('title', (isNew ? addTitle : editTitle)).toggleClass('edit', !isNew);\r\n        });\r\n\r\n        this.element.change((e: any, valueSet: boolean) => {\r\n            if (valueSet === true)\r\n                return;\r\n            if (this.isMultiple()) {\r\n                var values = this.get_values();\r\n                if (values.length > 0 && values[values.length - 1] == (-2147483648).toString()) {\r\n                    this.set_values(values.slice(0, values.length - 1));\r\n                    this.inplaceCreateClick(e);\r\n                }\r\n            }\r\n            else if (this.get_value() == (-2147483648).toString()) {\r\n                this.set_value(null);\r\n                this.inplaceCreateClick(e);\r\n            }\r\n        });\r\n\r\n        if (this.isMultiple()) {\r\n            this.get_select2Container().on('dblclick.' + this.uniqueName, '.select2-search-choice', (e3: JQueryEventObject) => {\r\n                var q = $(e3.target);\r\n                if (!q.hasClass('select2-search-choice')) {\r\n                    q = q.closest('.select2-search-choice');\r\n                }\r\n                var index = q.index();\r\n                var values1 = this.get_values();\r\n                if (index < 0 || index >= this.get_values().length) {\r\n                    return;\r\n                }\r\n                e3['editItem'] = values1[index];\r\n                this.inplaceCreateClick(e3);\r\n            });\r\n        }\r\n    }\r\n\r\n    protected useInplaceAdd(): boolean {\r\n        return !this.isAutoComplete() &&\r\n            (this.options as Select2EditorOptions).inplaceAdd &&\r\n            ((this.options as Select2EditorOptions).inplaceAddPermission == null ||\r\n                Authorization.hasPermission((this.options as Select2EditorOptions).inplaceAddPermission));\r\n    }\r\n\r\n    protected isAutoComplete(): boolean {\r\n        return !!(this.options as Select2EditorOptions).autoComplete;\r\n    }\r\n\r\n    public getCreateSearchChoice(getName: (z: any) => string) {\r\n        return (s: string) => {\r\n\r\n            this.lastCreateTerm = s;\r\n            s = (Select2.util.stripDiacritics(s) ?? '').toLowerCase();\r\n\r\n            if (isTrimmedEmpty(s)) {\r\n                return null;\r\n            }\r\n\r\n            var isAsyncSource = false;\r\n\r\n            if (any(this._items || [], (x: Select2Item) => {\r\n                    var text = getName ? getName(x.source) : x.text;\r\n                    return Select2.util.stripDiacritics((text ?? '')).toLowerCase() == s;\r\n            }))\r\n                return null;\r\n\r\n            if (!any(this._items || [], x1 => {\r\n                return (Select2.util.stripDiacritics(x1.text) ?? '').toLowerCase().indexOf(s) !== -1;\r\n            })) {\r\n                if (this.isAutoComplete()) {\r\n                    return {\r\n                        id: this.lastCreateTerm,\r\n                        text: this.lastCreateTerm\r\n                    };\r\n                }\r\n\r\n                return {\r\n                    id: (-2147483648).toString(),\r\n                    text: text('Controls.SelectEditor.NoResultsClickToDefine')\r\n                };\r\n            }\r\n\r\n            if (this.isAutoComplete()) {\r\n                return {\r\n                    id: this.lastCreateTerm,\r\n                    text: this.lastCreateTerm\r\n                };\r\n            }\r\n\r\n            return {\r\n                id: (-2147483648).toString(),\r\n                text: text('Controls.SelectEditor.ClickToDefine')\r\n            };\r\n        }\r\n    }\r\n\r\n    setEditValue(source: any, property: PropertyItem) {\r\n        var val = source[property.name];\r\n        if(isArray(val)) {\r\n            this.set_values(val);\r\n        }\r\n        else {\r\n            this.set_value((val == null ? null : val.toString()));\r\n        }\r\n    }\r\n\r\n    getEditValue(property: PropertyItem, target: any) {\r\n        if (!this.isMultiple() || this.get_delimited()) {\r\n            target[property.name] = this.get_value();\r\n        }\r\n        else {\r\n            target[property.name] = this.get_values();\r\n        }\r\n    }\r\n\r\n    protected get_select2Container(): JQuery {\r\n        return this.element.prevAll('.select2-container');\r\n    }\r\n\r\n    protected get_items() {\r\n        return this.items;\r\n    }\r\n\r\n    protected get_itemByKey() {\r\n        return this.itemById;\r\n    }\r\n\r\n    public static filterByText<TItem>(items: TItem[], getText: (item: TItem) => string, term: string): TItem[] {\r\n        if (term == null || term.length == 0)\r\n            return items;\r\n\r\n        term = Select2.util.stripDiacritics(term).toUpperCase();\r\n\r\n        var contains: TItem[] = [];\r\n        function filter(item: TItem): boolean {\r\n            var text = getText(item);\r\n            if (text == null || !text.length)\r\n                return false;\r\n            text = Select2.util.stripDiacritics(text).toUpperCase();\r\n            if (startsWith(text, term))\r\n                return true;\r\n            if (text.indexOf(term) >= 0)\r\n                contains.push(item);\r\n            return false;\r\n        }\r\n\r\n        return items.filter(filter).concat(contains);\r\n    }\r\n\r\n    get_value() {\r\n        var val;\r\n        if (this.element.data('select2')) {\r\n            val = this.element.select2('val');\r\n            if (val != null && isArray(val)) {\r\n                return val.join(',');\r\n            }\r\n        }\r\n        else\r\n            val = this.element.val();\r\n\r\n        return val;\r\n    }\r\n\r\n    get value(): string {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: string) {\r\n\r\n        if (value != this.get_value()) {\r\n            var val: any = value;\r\n            if (!isEmptyOrNull(value) && this.isMultiple()) {\r\n                val = value.split(String.fromCharCode(44)).map(function (x) {\r\n                    return trimToNull(x);\r\n                }).filter(function (x1) {\r\n                    return x1 != null;\r\n                });\r\n            }\r\n\r\n            var el = this.element;\r\n            el.select2('val', val);\r\n            el.data('select2-change-triggered', true);\r\n            try {\r\n                el.triggerHandler('change', [true]); // valueSet: true\r\n            } finally {\r\n                el.data('select2-change-triggered', false);\r\n            }\r\n\r\n            this.updateInplaceReadOnly();\r\n        }\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    get selectedItem(): TItem {\r\n        let selectedValue = this.get_value();\r\n        if (selectedValue && this._itemById) {\r\n            let item = this._itemById[selectedValue];\r\n            if (item)\r\n                return item.source;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    get selectedItems(): TItem[] {\r\n        let selectedValues = this.values;\r\n        var result = [];\r\n        for (var value of selectedValues) {\r\n            if (value && this._itemById) {\r\n                let item = this._itemById[value];\r\n                if (item && item.source)\r\n                    result.push(item.source);\r\n                else\r\n                    result.push(null);\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected get_values(): string[] {\r\n\r\n        var val = this.element.select2('val');\r\n        if (val == null) {\r\n            return [];\r\n        }\r\n\r\n        if (isArray(val)) {\r\n            return val;\r\n        }\r\n\r\n        var str = val;\r\n        if (isEmptyOrNull(str)) {\r\n            return [];\r\n        }\r\n\r\n        return [str];\r\n    }\r\n\r\n    get values(): string[] {\r\n        return this.get_values();\r\n    }\r\n\r\n    protected set_values(value: string[]) {\r\n\r\n        if (value == null || value.length === 0) {\r\n            this.set_value(null);\r\n            return;\r\n        }\r\n\r\n        this.set_value(value.join(','));\r\n    }\r\n\r\n    set values(value: string[]) {\r\n        this.set_values(value);\r\n    }\r\n\r\n    protected get_text(): string {\r\n        return (this.element.select2('data') ?? {}).text;\r\n    }\r\n\r\n    get text(): string {\r\n        return this.get_text();\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return !isEmptyOrNull(this.element.attr('readonly'));\r\n    }\r\n\r\n    get readOnly(): boolean {\r\n        return this.get_readOnly();\r\n    }\r\n\r\n    private updateInplaceReadOnly(): void {\r\n        var readOnly = this.get_readOnly() &&\r\n            (this.isMultiple() || !this.value);\r\n\r\n        this.element.nextAll('.inplace-create')\r\n            .attr('disabled', (readOnly ? 'disabled' : ''))\r\n            .css('opacity', (readOnly ? '0.1' : ''))\r\n            .css('cursor', (readOnly ? 'default' : ''));\r\n    }\r\n\r\n    set_readOnly(value: boolean) {\r\n        if (value !== this.get_readOnly()) {\r\n            this.element.attr(\"readonly\", value ? \"readonly\" : null);\r\n            this.updateInplaceReadOnly();\r\n        }\r\n    }\r\n\r\n    set readOnly(value: boolean) {\r\n        this.set_readOnly(value);\r\n    }\r\n\r\n    protected getCascadeFromValue(parent: Widget<any>) {\r\n        return EditorUtils.getValue(parent);\r\n    }\r\n\r\n    protected cascadeLink: CascadedWidgetLink<Widget<any>>;\r\n\r\n    protected setCascadeFrom(value: string) {\r\n\r\n        if (isEmptyOrNull(value)) {\r\n            if (this.cascadeLink != null) {\r\n                this.cascadeLink.set_parentID(null);\r\n                this.cascadeLink = null;\r\n            }\r\n            (this.options as Select2EditorOptions).cascadeFrom = null;\r\n            return;\r\n        }\r\n\r\n        this.cascadeLink = new CascadedWidgetLink<Widget<any>>(Widget, this, p => {\r\n            this.set_cascadeValue(this.getCascadeFromValue(p));\r\n        });\r\n\r\n        this.cascadeLink.set_parentID(value);\r\n        (this.options as Select2EditorOptions).cascadeFrom = value;\r\n    }\r\n\r\n    protected get_cascadeFrom(): string {\r\n        return (this.options as Select2EditorOptions).cascadeFrom;\r\n    }\r\n\r\n    get cascadeFrom(): string {\r\n        return this.get_cascadeFrom();\r\n    }\r\n\r\n    protected set_cascadeFrom(value: string) {\r\n        if (value !== (this.options as Select2EditorOptions).cascadeFrom) {\r\n            this.setCascadeFrom(value);\r\n            this.updateItems();\r\n        }\r\n    }\r\n\r\n    set cascadeFrom(value: string) {\r\n        this.set_cascadeFrom(value);\r\n    }\r\n\r\n    protected get_cascadeField() {\r\n        return ((this.options as Select2EditorOptions).cascadeField ?? (this.options as Select2EditorOptions).cascadeFrom);\r\n    }\r\n\r\n    get cascadeField(): string {\r\n        return this.get_cascadeField();\r\n    }\r\n\r\n    protected set_cascadeField(value: string) {\r\n        (this.options as Select2EditorOptions).cascadeField = value;\r\n    }\r\n\r\n    set cascadeField(value: string) {\r\n        this.set_cascadeField(value);\r\n    }\r\n\r\n    protected get_cascadeValue(): any {\r\n        return (this.options as Select2EditorOptions).cascadeValue;\r\n    }\r\n\r\n    get cascadeValue(): any {\r\n        return this.get_cascadeValue();\r\n    }\r\n\r\n    protected set_cascadeValue(value: any) {\r\n        if ((this.options as Select2EditorOptions).cascadeValue !== value) {\r\n            (this.options as Select2EditorOptions).cascadeValue = value;\r\n            this.set_value(null);\r\n            this.updateItems();\r\n        }\r\n    }\r\n\r\n    set cascadeValue(value: any) {\r\n        this.set_cascadeValue(value);\r\n    }\r\n\r\n    protected get_filterField() {\r\n        return (this.options as Select2EditorOptions).filterField;\r\n    }\r\n\r\n    get filterField(): string {\r\n        return this.get_filterField();\r\n    }\r\n\r\n    protected set_filterField(value: string) {\r\n        (this.options as Select2EditorOptions).filterField = value;\r\n    }\r\n\r\n    set filterField(value: string) {\r\n        this.set_filterField(value);\r\n    }\r\n\r\n    protected get_filterValue(): any {\r\n        return (this.options as Select2EditorOptions).filterValue;\r\n    }\r\n\r\n    get filterValue(): any {\r\n        return this.get_filterValue();\r\n    }\r\n\r\n    protected set_filterValue(value: any) {\r\n        if ((this.options as Select2EditorOptions).filterValue !== value) {\r\n            (this.options as Select2EditorOptions).filterValue = value;\r\n            this.set_value(null);\r\n            this.updateItems();\r\n        }\r\n    }\r\n\r\n    set filterValue(value: any) {\r\n        this.set_filterValue(value);\r\n    }\r\n\r\n    protected cascadeItems(items: TItem[]) {\r\n\r\n        var val = this.get_cascadeValue();\r\n\r\n        if (val == null || val === '') {\r\n\r\n            if (!isEmptyOrNull(this.get_cascadeField())) {\r\n                return [];\r\n            }\r\n\r\n            return items;\r\n        }\r\n\r\n        var key = val.toString();\r\n        var fld = this.get_cascadeField();\r\n\r\n        return items.filter(x => {\r\n            var itemKey = x[fld] ?? ReflectionUtils.getPropertyValue(x, fld);\r\n            return !!(itemKey != null && itemKey.toString() === key);\r\n        });\r\n    }\r\n\r\n    protected filterItems(items: TItem[]) {\r\n        var val = this.get_filterValue();\r\n\r\n        if (val == null || val === '') {\r\n            return items;\r\n        }\r\n\r\n        var key = val.toString();\r\n        var fld = this.get_filterField();\r\n\r\n        return items.filter(x => {\r\n            var itemKey = x[fld] ?? ReflectionUtils.getPropertyValue(x, fld);\r\n            return !!(itemKey != null && itemKey.toString() === key);\r\n        });\r\n    }\r\n\r\n    protected updateItems() {\r\n    }\r\n\r\n    protected getDialogTypeKey() {\r\n        if ((this.options as Select2EditorOptions).dialogType != null) {\r\n            return (this.options as Select2EditorOptions).dialogType;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    protected createEditDialog(callback: (dlg: IEditDialog) => void) {\r\n        var dialogTypeKey = this.getDialogTypeKey();\r\n        var dialogType = DialogTypeRegistry.get(dialogTypeKey);\r\n        Widget.create({\r\n            type: dialogType,\r\n            init: x => callback(x as any)\r\n        });\r\n    }\r\n\r\n    public onInitNewEntity: (entity: TItem) => void;\r\n\r\n    protected initNewEntity(entity: TItem) {\r\n        if (!isEmptyOrNull(this.get_cascadeField())) {\r\n            entity[this.get_cascadeField()] = this.get_cascadeValue();\r\n        }\r\n\r\n        if (!isEmptyOrNull(this.get_filterField())) {\r\n            entity[this.get_filterField()] = this.get_filterValue();\r\n        }\r\n\r\n        if (this.onInitNewEntity != null) {\r\n            this.onInitNewEntity(entity);\r\n        }\r\n    }\r\n\r\n    protected setEditDialogReadOnly(dialog: any): void {\r\n        // an ugly workaround\r\n        dialog.element && dialog.element\r\n            .find('.tool-button.delete-button')\r\n            .addClass('disabled')\r\n            .unbind('click');\r\n    }\r\n\r\n    protected editDialogDataChange() {\r\n    }\r\n\r\n    protected setTermOnNewEntity(entity: TItem, term: string) {\r\n    }\r\n\r\n    protected inplaceCreateClick(e: JQueryEventObject) {\r\n\r\n        if (this.get_readOnly() &&\r\n            ((this.isMultiple() && !e['editItem']) || !this.value))\r\n            return;\r\n\r\n        this.createEditDialog(dialog => {\r\n\r\n            if (this.get_readOnly())\r\n                this.setEditDialogReadOnly(dialog);\r\n\r\n            SubDialogHelper.bindToDataChange(dialog, this, (x, dci) => {\r\n                this.editDialogDataChange();\r\n                this.updateItems();\r\n                this.lastCreateTerm = null;\r\n\r\n                if ((dci.type === 'create' || dci.type === 'update') &&\r\n                    dci.entityId != null) {\r\n                    var id = dci.entityId.toString();\r\n\r\n                    if (this.isMultiple()) {\r\n                        var values = this.get_values().slice();\r\n                        if (values.indexOf(id) < 0) {\r\n                            values.push(id);\r\n                        }\r\n                        this.set_values(null);\r\n                        this.set_values(values.slice());\r\n                    }\r\n                    else {\r\n                        this.set_value(null);\r\n                        this.set_value(id);\r\n                    }\r\n                }\r\n                else if (this.isMultiple() && dci.type === 'delete' &&\r\n                    dci.entityId != null) {\r\n                    var id1 = dci.entityId.toString();\r\n                    var values1 = this.get_values().slice();\r\n\r\n                    var idx1 = values1.indexOf(id1);\r\n                    if (idx1 >= 0)\r\n                        values1.splice(idx1, 1);\r\n\r\n                    this.set_values(values1.slice());\r\n                }\r\n                else if (!this.isMultiple()) {\r\n                    this.set_value(null);\r\n                }\r\n            }, true);\r\n\r\n            var editItem = e['editItem'];\r\n            if (editItem != null) {\r\n                dialog.load(editItem, () => {\r\n                    (dialog as any).dialogOpen(this.openDialogAsPanel);\r\n                }, null);\r\n            }\r\n            else if (this.isMultiple() || isEmptyOrNull(this.get_value())) {\r\n                var entity: TItem = {} as any;\r\n                this.setTermOnNewEntity(entity, trimToEmpty(this.lastCreateTerm));\r\n                this.initNewEntity(entity);\r\n                dialog.load(entity, () => {\r\n                    (dialog as any).dialogOpen(this.openDialogAsPanel);\r\n                }, null);\r\n            }\r\n            else {\r\n                dialog.load(this.get_value(), () => {\r\n                    (dialog as any).dialogOpen(this.openDialogAsPanel);\r\n                }, null);\r\n            }\r\n        });\r\n    }\r\n\r\n    public openDialogAsPanel: boolean;\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { isEmptyOrNull } from \"@serenity-is/corelib/q\";\r\nimport { Select2CommonOptions, Select2Editor } from \"./select2editor\";\r\n\r\n@Decorators.registerClass('Serenity.SelectEditor')\r\nexport class SelectEditor extends Select2Editor<SelectEditorOptions, Select2Item> {\r\n    constructor(hidden: JQuery, opt?: SelectEditorOptions) {\r\n        super(hidden, opt);\r\n        this.updateItems();\r\n    }\r\n\r\n    getItems() {\r\n        return this.options.items || [];\r\n    }\r\n\r\n    protected emptyItemText() {\r\n        if (!isEmptyOrNull(this.options.emptyOptionText)) {\r\n            return this.options.emptyOptionText;\r\n        }\r\n        return super.emptyItemText();\r\n    }\r\n\r\n    updateItems() {\r\n        var items = this.getItems();\r\n        this.clearItems();\r\n\r\n        if (items.length > 0) {\r\n            var isStrings = typeof (items[0]) === 'string';\r\n            for (var item of items) {\r\n                var key = isStrings ? item : item[0];\r\n                var text = isStrings ? item : (item[1] ?? item[0]);\r\n                this.addOption(key, text, item, false);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport interface SelectEditorOptions extends Select2CommonOptions {\r\n    items?: any[];\r\n    emptyOptionText?: string;\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { startsWith } from \"@serenity-is/corelib/q\";\r\nimport { SelectEditor, SelectEditorOptions } from \"./selecteditor\";\r\n\r\n@Decorators.registerEditor('Serenity.DateYearEditor')\r\nexport class DateYearEditor extends SelectEditor {\r\n\r\n    constructor(hidden: JQuery, opt: DateYearEditorOptions) {\r\n        super(hidden, opt);\r\n\r\n        this.updateItems();\r\n    }\r\n\r\n    getItems() {\r\n        var opt = this.options as DateYearEditorOptions;\r\n\r\n        if (opt.items != null && opt.items.length >= 1) {\r\n            return opt.items;\r\n        }\r\n\r\n        var years = [];\r\n        var minYear = (new Date()).getFullYear();\r\n        var maxYear = (new Date()).getFullYear();\r\n\r\n        opt.minYear = (opt.minYear ?? '-10').toString();\r\n        if (startsWith(opt.minYear, '-')) {\r\n            minYear -= parseInt(opt.minYear.substr(1), 10);\r\n        }\r\n        else if (startsWith(opt.minYear, '+')) {\r\n            minYear += parseInt(opt.minYear.substr(1), 10);\r\n        }\r\n        else {\r\n            minYear = parseInt(opt.minYear, 10);\r\n        }\r\n\r\n        opt.maxYear = (opt.maxYear ?? '+10').toString();\r\n        if (startsWith(opt.maxYear, '-')) {\r\n            maxYear -= parseInt(opt.maxYear.substr(1), 10);\r\n        }\r\n        else if (startsWith(opt.maxYear, '+')) {\r\n            maxYear += parseInt(opt.maxYear.substr(1), 10);\r\n        }\r\n        else {\r\n            maxYear = parseInt(opt.maxYear, 10);\r\n        }\r\n\r\n        if (opt.descending) {\r\n            for (var i = maxYear; i >= minYear; i--) {\r\n                years.push(i.toString());\r\n            }\r\n        }\r\n        else {\r\n            for (var i1 = minYear; i1 <= maxYear; i1++) {\r\n                years.push(i1.toString());\r\n            }\r\n        }\r\n\r\n        return years;\r\n    }\r\n}\r\n\r\nexport interface DateYearEditorOptions extends SelectEditorOptions {\r\n    minYear?: string;\r\n    maxYear?: string;\r\n    descending?: boolean;\r\n}", "\uFEFFimport { Decorators, EnumKeyAttribute } from \"../../decorators\";\r\nimport { Enum, getAttributes, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { EnumTypeRegistry } from \"../../types/enumtyperegistry\";\r\nimport { Select2CommonOptions, Select2Editor } from \"./select2editor\";\r\n\r\nexport interface EnumEditorOptions extends Select2CommonOptions {\r\n    enumKey?: string;\r\n    enumType?: any;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.EnumEditor')\r\nexport class EnumEditor extends Select2Editor<EnumEditorOptions, Select2Item> {\r\n    constructor(hidden: JQuery, opt: EnumEditorOptions) {\r\n        super(hidden, opt);\r\n        this.updateItems();\r\n    }\r\n\r\n    protected updateItems(): void {\r\n        this.clearItems();\r\n\r\n        var enumType = this.options.enumType || EnumTypeRegistry.get(this.options.enumKey);\r\n        var enumKey = this.options.enumKey;\r\n\r\n        if (enumKey == null && enumType != null) {\r\n            var enumKeyAttr = getAttributes(enumType, EnumKeyAttribute, false);\r\n            if (enumKeyAttr.length > 0) {\r\n                enumKey = enumKeyAttr[0].value;\r\n            }\r\n        }\r\n\r\n        var values = Enum.getValues(enumType);\r\n        for (var x of values) {\r\n            var name = Enum.toString(enumType, x);\r\n            this.addOption(parseInt(x, 10).toString(),\r\n                (tryGetText('Enums.' + enumKey + '.' + name) ?? name), null, false);\r\n        }\r\n    }\r\n\r\n    protected allowClear() {\r\n        return (this.options.allowClear ?? true);\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { endsWith, getInstanceType, getLookup, getLookupAsync, getTypeFullName, reloadLookup, ScriptData } from \"@serenity-is/corelib/q\";\r\nimport { Select2Editor, Select2EditorOptions, Select2SearchPromise, Select2SearchQuery, Select2SearchResult } from \"./select2editor\";\r\n\r\nexport interface LookupEditorOptions extends Select2EditorOptions {\r\n    lookupKey?: string;\r\n    async?: boolean;\r\n}\r\n\r\n@Decorators.registerEditor(\"Serenity.LookupEditorBase\")\r\nexport class LookupEditorBase<TOptions extends LookupEditorOptions, TItem> extends Select2Editor<TOptions, TItem> {\r\n\r\n    constructor(input: JQuery, opt?: TOptions) {\r\n        super(input, opt);\r\n\r\n        if (!this.hasAsyncSource()) {\r\n            this.updateItems();\r\n            var self = this;\r\n            ScriptData.bindToChange('Lookup.' + this.getLookupKey(), this.uniqueName, function () {\r\n                self.updateItems();\r\n            });\r\n        }\r\n    }\r\n\r\n    hasAsyncSource(): boolean {\r\n        return !!this.options.async;\r\n    }\r\n\r\n    destroy(): void {\r\n        if (!this.hasAsyncSource())\r\n            ScriptData.unbindFromChange(this.uniqueName);\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    protected getLookupKey(): string {\r\n        if (this.options.lookupKey != null) {\r\n            return this.options.lookupKey;\r\n        }\r\n\r\n        var key = getTypeFullName(getInstanceType(this));\r\n\r\n        var idx = key.indexOf('.');\r\n        if (idx >= 0) {\r\n            key = key.substring(idx + 1);\r\n        }\r\n\r\n        if (endsWith(key, 'Editor')) {\r\n            key = key.substr(0, key.length - 6);\r\n        }\r\n\r\n        return key;\r\n    }\r\n\r\n    protected lookup: Q.Lookup<TItem>;\r\n\r\n    protected getLookupAsync(): PromiseLike<Q.Lookup<TItem>> {\r\n        return getLookupAsync<TItem>(this.getLookupKey());\r\n    }\r\n\r\n    protected getLookup(): Q.Lookup<TItem> {\r\n        return getLookup<TItem>(this.getLookupKey());\r\n    }\r\n\r\n    protected getItems(lookup: Q.Lookup<TItem>) {\r\n        return this.filterItems(this.cascadeItems(lookup.items));\r\n    }\r\n\r\n    protected getIdField() {\r\n        return this.lookup != null ? this.lookup.idField : super.getIdField();\r\n    }\r\n\r\n    protected getItemText(item: TItem, lookup: Q.Lookup<TItem>) {\r\n        if (lookup == null)\r\n            return super.itemText(item);\r\n\r\n        var textValue = lookup.textFormatter ? lookup.textFormatter(item) : item[lookup.textField];\r\n        return textValue == null ? '' : textValue.toString();\r\n    }\r\n\r\n    protected mapItem(item: TItem): Select2Item {\r\n        return {\r\n            id: this.itemId(item),\r\n            text: this.getItemText(item, this.lookup),\r\n            disabled: this.getItemDisabled(item, this.lookup),\r\n            source: item\r\n        };\r\n    }\r\n\r\n    protected getItemDisabled(item: TItem, lookup: Q.Lookup<TItem>) {\r\n        return super.itemDisabled(item);\r\n    }\r\n\r\n    public updateItems() {\r\n        this.clearItems();\r\n        this.lookup = this.getLookup();\r\n        var items = this.getItems(this.lookup);\r\n        for (var item of items)\r\n            this.addItem(this.mapItem(item));\r\n    }\r\n\r\n    protected asyncSearch(query: Select2SearchQuery, results: (result: Select2SearchResult<TItem>) => void): Select2SearchPromise {\r\n        return this.getLookupAsync().then(lookup => {\r\n            this.lookup = lookup;\r\n\r\n            var items = this.getItems(this.lookup);\r\n\r\n            if (query.idList != null) {\r\n                items = items.filter(x => query.idList.indexOf(this.itemId(x)) >= 0);\r\n            }\r\n\r\n            function getText(item: TItem) {\r\n                return this.getItemText(item, this.lookup);\r\n            }\r\n\r\n            items = Select2Editor.filterByText(items, getText.bind(this), query.searchTerm);\r\n\r\n            results({\r\n                items: items.slice(query.skip, query.take),\r\n                more: items.length >= query.take\r\n            });\r\n        }) as any;\r\n    }\r\n\r\n    protected getDialogTypeKey() {\r\n        var dialogTypeKey = super.getDialogTypeKey();\r\n        if (dialogTypeKey)\r\n            return dialogTypeKey;\r\n\r\n        return this.getLookupKey();\r\n    }\r\n\r\n    protected setCreateTermOnNewEntity(entity: TItem, term: string) {\r\n        entity[this.getLookup().textField] = term;\r\n    }\r\n\r\n    protected editDialogDataChange() {\r\n        reloadLookup(this.getLookupKey());\r\n    }\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.LookupEditor')\r\nexport class LookupEditor extends LookupEditorBase<LookupEditorOptions, any> {\r\n    constructor(hidden: JQuery, opt?: LookupEditorOptions) {\r\n        super(hidden, opt);\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { ColumnSelection, Criteria, isEmptyOrNull, ListRequest, ListResponse, resolveUrl, serviceCall, ServiceOptions, startsWith } from \"@serenity-is/corelib/q\";\r\nimport { Select2Editor, Select2EditorOptions, Select2SearchPromise, Select2SearchQuery, Select2SearchResult } from \"./select2editor\";\r\n\r\nexport interface ServiceLookupEditorOptions extends Select2EditorOptions {\r\n    service?: string;\r\n    idField: string;\r\n    textField: string;\r\n    pageSize?: number;\r\n    minimumResultsForSearch?: any;\r\n    sort: string[];\r\n    columnSelection?: ColumnSelection;\r\n    includeColumns?: string[];\r\n    excludeColumns?: string[];\r\n    includeDeleted?: boolean;\r\n    containsField?: string;\r\n    equalityFilter?: any;\r\n    criteria?: any[];\r\n}\r\n\r\n@Decorators.registerEditor(\"ServiceLookupEditorBase\")\r\nexport class ServiceLookupEditorBase<TOptions extends ServiceLookupEditorOptions, TItem> extends Select2Editor<TOptions, TItem> {\r\n\r\n    constructor(input: JQuery, opt?: TOptions) {\r\n        super(input, opt);\r\n    }\r\n\r\n    protected getDialogTypeKey() {\r\n        var dialogTypeKey = super.getDialogTypeKey();\r\n        if (dialogTypeKey)\r\n            return dialogTypeKey;\r\n\r\n        var service = this.getService();\r\n        if (startsWith(service, \"~/Services/\"))\r\n            service = service.substr(\"~/Services/\".length);\r\n\r\n        if (service.split('/').length == 3)\r\n            service = service.substr(0, service.lastIndexOf('/'));\r\n\r\n        return service.replace(\"/\", \".\");\r\n    }\r\n\r\n    protected getService(): string {\r\n        return this.options.service;\r\n    }\r\n\r\n    protected getServiceUrl() {\r\n        var url = this.getService();\r\n        if (url == null)\r\n            throw new Error(\"ServiceLookupEditor requires 'service' option to be configured!\");\r\n\r\n        if (!startsWith(url, \"~\") && !startsWith(url, \"/\") && url.indexOf('://') < 0)\r\n            url = \"~/Services/\" + url;\r\n\r\n        if (startsWith(url, \"~\"))\r\n            url = resolveUrl(url);\r\n\r\n        return url;\r\n    }\r\n\r\n    protected getIncludeColumns() {\r\n        var include = this.options.includeColumns || [];\r\n        var idField = this.getIdField();\r\n\r\n        if (idField && include.indexOf(idField) < 0)\r\n            include.push(idField);\r\n\r\n        var textField = this.getTextField();\r\n        if (textField && include.indexOf(textField) < 0)\r\n            include.push(textField);\r\n\r\n        return include;\r\n    }\r\n\r\n    protected getSort() {\r\n        return this.options.sort || (this.getTextField() ? [this.getTextField()] : null);\r\n    }\r\n\r\n    protected getCascadeCriteria(): any[] {\r\n\r\n        var val = this.get_cascadeValue();\r\n\r\n        if (val == null || val === '') {\r\n\r\n            if (!isEmptyOrNull(this.get_cascadeField())) {\r\n                return ['1', '=', '0'];\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        var fld = this.get_cascadeField();\r\n\r\n        return [[fld], '=', val];\r\n    }\r\n\r\n    protected getFilterCriteria(): any[] {\r\n        var val = this.get_filterValue();\r\n\r\n        if (val == null || val === '') {\r\n            return null;\r\n        }\r\n\r\n        var fld = this.get_filterField();\r\n        return [[fld], '=', val];\r\n    }\r\n\r\n    protected getIdListCriteria(idList: any[]): any[] {\r\n        if (idList == null)\r\n            return null;\r\n\r\n        if (idList.length == 0)\r\n            return ['0', '=', '1'];\r\n\r\n        var idField = this.getIdField();\r\n        if (idField == null)\r\n            throw new Error(\"ServiceLookupEditor requires 'idField' option to be configured!\");\r\n\r\n        return [[idField], 'in', [idList]];\r\n    }\r\n\r\n    protected getCriteria(query: Select2SearchQuery): any[] {\r\n        return Criteria.and(\r\n            Criteria.and(this.getIdListCriteria(query.idList), this.options.criteria),\r\n            Criteria.and(this.getCascadeCriteria(), this.getFilterCriteria()));\r\n    }\r\n\r\n    protected getListRequest(query: Select2SearchQuery): ListRequest {\r\n\r\n        var request: ListRequest = {};\r\n\r\n        if (query.searchTerm)\r\n            request.ContainsText = query.searchTerm;\r\n\r\n        request.Sort = this.getSort();\r\n        request.ColumnSelection = this.options.columnSelection || ColumnSelection.KeyOnly;\r\n        request.IncludeColumns = this.getIncludeColumns();\r\n        request.ExcludeColumns = this.options.excludeColumns;\r\n        request.ContainsField = this.options.containsField;\r\n        request.EqualityFilter = this.options.equalityFilter;\r\n        request.Criteria = this.getCriteria(query);\r\n        request.Skip = query.skip || 0;\r\n        request.Take = query.take ? (query.checkMore ? query.take + 1 : query.take) : 0;\r\n        request.IncludeDeleted = this.options.includeDeleted;\r\n        request.ExcludeTotalCount = true;\r\n\r\n        return request;\r\n    }\r\n\r\n    protected getServiceCallOptions(query: Select2SearchQuery, results: (result: Select2SearchResult<TItem>) => void): ServiceOptions<ListResponse<TItem>> {\r\n        return {\r\n            blockUI: false,\r\n            url: this.getServiceUrl(),\r\n            request: this.getListRequest(query),\r\n            onSuccess: response => {\r\n                var items = response.Entities || [];\r\n\r\n                if (items && query.take && query.checkMore && response.Entities.length > items.length)\r\n                    items = items.slice(0, query.take);\r\n\r\n                results({\r\n                    items: items.slice(0, query.take),\r\n                    more: query.checkMore && query.take && items.length > query.take\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n    protected hasAsyncSource() {\r\n        return true;\r\n    }\r\n\r\n    protected asyncSearch(query: Select2SearchQuery, results: (result: Select2SearchResult<TItem>) => void): Select2SearchPromise {\r\n        var opt = this.getServiceCallOptions(query, results);\r\n        return serviceCall(opt);\r\n    }\r\n}\r\n\r\n@Decorators.registerEditor('ServiceLookupEditor')\r\nexport class ServiceLookupEditor extends ServiceLookupEditorBase<ServiceLookupEditorOptions, any> {\r\n    constructor(hidden: JQuery, opt?: ServiceLookupEditorOptions) {\r\n        super(hidden, opt);\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IReadOnly, IStringValue } from \"../../interfaces\";\r\nimport { endsWith, isEmptyOrNull, isTrimmedEmpty, resolveUrl, text, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { LazyLoadHelper } from \"../helpers/lazyloadhelper\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface HtmlContentEditorOptions {\r\n    cols?: any;\r\n    rows?: any;\r\n}\r\n\r\nexport interface CKEditorConfig {\r\n}    \r\n\r\n@Decorators.registerEditor('Serenity.HtmlContentEditor', [IStringValue, IReadOnly])\r\n@Decorators.element('<textarea/>')\r\nexport class HtmlContentEditor extends Widget<HtmlContentEditorOptions>\r\n    implements IStringValue, IReadOnly {\r\n\r\n    private _instanceReady: boolean;\r\n\r\n    constructor(textArea: JQuery, opt?: HtmlContentEditorOptions) {\r\n        super(textArea, opt)\r\n\r\n        this._instanceReady = false;\r\n        HtmlContentEditor.includeCKEditor();\r\n\r\n        var id = textArea.attr('id');\r\n        if (isTrimmedEmpty(id)) {\r\n            textArea.attr('id', this.uniqueName);\r\n            id = this.uniqueName;\r\n        }\r\n\r\n        if (this.options.cols != null)\r\n            textArea.attr('cols', this.options.cols);\r\n\r\n        if (this.options.rows != null)\r\n            textArea.attr('rows', this.options.rows);\r\n\r\n        this.addValidationRule(this.uniqueName, e => {\r\n            if (e.hasClass('required')) {\r\n                var value = trimToNull(this.get_value());\r\n                if (value == null)\r\n                    return text('Validation.Required');\r\n            }\r\n\r\n            return null;\r\n        });\r\n\r\n        LazyLoadHelper.executeOnceWhenShown(this.element, () => {\r\n            var config = this.getConfig();\r\n            window['CKEDITOR'] && window['CKEDITOR'].replace(id, config);\r\n        });\r\n    }\r\n\r\n    protected instanceReady(x: any): void {\r\n        this._instanceReady = true;\r\n        $(x.editor.container.$).addClass(this.element.attr('class'));\r\n        this.element.addClass('select2-offscreen').css('display', 'block');\r\n\r\n        // for validation to work\r\n        x.editor.setData(this.element.val());\r\n        x.editor.setReadOnly(this.get_readOnly());\r\n    }\r\n\r\n    protected getLanguage(): string {\r\n        if (!window['CKEDITOR'])\r\n            return 'en';\r\n\r\n        var CKEDITOR = window['CKEDITOR'];\r\n\r\n        var lang = (trimToNull($('html').attr('lang')) ?? 'en');\r\n        if (!!CKEDITOR.lang.languages[lang]) {\r\n            return lang;\r\n        }\r\n        if (lang.indexOf(String.fromCharCode(45)) >= 0) {\r\n            lang = lang.split(String.fromCharCode(45))[0];\r\n        }\r\n        if (!!CKEDITOR.lang.languages[lang]) {\r\n            return lang;\r\n        }\r\n        return 'en';\r\n    }\r\n\r\n    protected getConfig(): CKEditorConfig {\r\n        return {\r\n            customConfig: '',\r\n            language: this.getLanguage(),\r\n            bodyClass: 's-HtmlContentBody',\r\n            on: {\r\n                instanceReady: (x: any) => this.instanceReady(x),\r\n                change: (x1: any) => {\r\n                    x1.editor.updateElement();\r\n                    this.element.triggerHandler('change');\r\n                }\r\n            },\r\n            toolbarGroups: [\r\n                {\r\n                    name: 'clipboard',\r\n                    groups: ['clipboard', 'undo']\r\n                }, {\r\n                    name: 'editing',\r\n                    groups: ['find', 'selection', 'spellchecker']\r\n                }, {\r\n                    name: 'insert',\r\n                    groups: ['links', 'insert', 'blocks', 'bidi', 'list', 'indent']\r\n                }, {\r\n                    name: 'forms',\r\n                    groups: ['forms', 'mode', 'document', 'doctools', 'others', 'about', 'tools']\r\n                }, {\r\n                    name: 'colors'\r\n                }, {\r\n                    name: 'basicstyles',\r\n                    groups: ['basicstyles', 'cleanup']\r\n                }, {\r\n                    name: 'align'\r\n                }, {\r\n                    name: 'styles'\r\n                }],\r\n            removeButtons: 'SpecialChar,Anchor,Subscript,Styles',\r\n            format_tags: 'p;h1;h2;h3;pre',\r\n            removeDialogTabs: 'image:advanced;link:advanced',\r\n            removePlugins: 'uploadimage,image2',\r\n            contentsCss: resolveUrl('~/Content/site/site.htmlcontent.css'),\r\n            entities: false,\r\n            entities_latin: false,\r\n            entities_greek: false,\r\n            autoUpdateElement: true,\r\n            height: (this.options.rows == null || this.options.rows === 0) ? null :\r\n                ((this.options.rows * 20) + 'px')\r\n        };\r\n    }\r\n\r\n    protected getEditorInstance() {\r\n        var id = this.element.attr('id');\r\n        return window['CKEDITOR'].instances[id];\r\n    }\r\n\r\n    destroy(): void {\r\n        var instance = this.getEditorInstance();\r\n        instance && instance.destroy(true);\r\n        super.destroy();\r\n    }\r\n\r\n    get_value(): string {\r\n        var instance = this.getEditorInstance();\r\n        if (this._instanceReady && instance) {\r\n            return instance.getData();\r\n        }\r\n        else {\r\n            return this.element.val();\r\n        }\r\n    }\r\n\r\n    get value(): string {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: string): void {\r\n        var instance = this.getEditorInstance();\r\n        this.element.val(value);\r\n        if (this._instanceReady && instance)\r\n            instance.setData(value);\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return !isEmptyOrNull(this.element.attr('disabled'));\r\n    }\r\n\r\n    set_readOnly(value: boolean) {\r\n\r\n        if (this.get_readOnly() !== value) {\r\n            if (value) {\r\n                this.element.attr('disabled', 'disabled');\r\n            }\r\n            else {\r\n                this.element.removeAttr('disabled');\r\n            }\r\n\r\n            var instance = this.getEditorInstance();\r\n            if (this._instanceReady && instance)\r\n                instance.setReadOnly(value);\r\n        }\r\n    }\r\n\r\n    static CKEditorVer = \"4.7.1\";\r\n    static CKEditorBasePath: string;\r\n\r\n    static getCKEditorBasePath(): string {\r\n        var path = HtmlContentEditor.CKEditorBasePath;\r\n        if (path == null) {\r\n            // @ts-ignore\r\n            if (typeof CKEDITOR_BASEPATH !== \"undefined\" && CKEDITOR_BASEPATH)\r\n                // @ts-ignore\r\n                path = CKEDITOR_BASEPATH;\r\n            else\r\n                return \"~/Scripts/ckeditor/\";\r\n        }\r\n        if (endsWith(path, '/'))\r\n            return path;\r\n        return path + '/';\r\n    }\r\n\r\n    static includeCKEditor(): void {\r\n        if (window['CKEDITOR']) {\r\n            return;\r\n        }\r\n\r\n        var script = $('#CKEditorScript');\r\n        if (script.length > 0) {\r\n            return;\r\n        }\r\n\r\n        $('<script/>').attr('type', 'text/javascript')\r\n            .attr('id', 'CKEditorScript')\r\n            .attr('src', resolveUrl(HtmlContentEditor.getCKEditorBasePath() + 'ckeditor.js?v=' +\r\n                HtmlContentEditor.CKEditorVer))\r\n            .appendTo(window.document.head);\r\n    };\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.HtmlNoteContentEditor')\r\nexport class HtmlNoteContentEditor extends HtmlContentEditor {\r\n    constructor(textArea: JQuery, opt?: HtmlContentEditorOptions) {\r\n        super(textArea, opt);\r\n    }\r\n\r\n    protected getConfig(): CKEditorConfig {\r\n        var config = super.getConfig();\r\n        (config as any).removeButtons += ',Cut,Copy,Paste,BulletedList,NumberedList,' +\r\n            'Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,' +\r\n            'PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,' +\r\n            'HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,' +\r\n            'CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,' +\r\n            'JustifyRight,JustifyBlock,Superscript,RemoveFormat';\r\n\r\n        (config as any).removePlugins = 'elementspath,uploadimage,image2';\r\n        return config;\r\n    }\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.HtmlReportContentEditor')\r\nexport class HtmlReportContentEditor extends HtmlContentEditor {\r\n    constructor(textArea: JQuery, opt?: HtmlContentEditorOptions) {\r\n        super(textArea, opt);\r\n    }\r\n\r\n    protected getConfig(): CKEditorConfig {\r\n        var config = super.getConfig();\r\n        (config as any).removeButtons += ',Cut,Copy,Paste,BulletedList,NumberedList,' +\r\n            'Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,' +\r\n            'PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,' +\r\n            'Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,' +\r\n            'Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,' +\r\n            'JustifyRight,JustifyBlock,Superscript,RemoveFormat';\r\n\r\n        (config as any).removePlugins = 'elementspath,uploadimage,image2';\r\n        return config;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IStringValue } from \"../../interfaces\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\n// http://digitalbush.com/projects/masked-input-plugin/\r\n@Decorators.registerEditor('Serenity.MaskedEditor', [IStringValue])\r\n@Decorators.element(\"<input type=\\\"text\\\"/>\")\r\nexport class MaskedEditor extends Widget<MaskedEditorOptions> {\r\n\r\n    constructor(input: JQuery, opt?: MaskedEditorOptions) {\r\n        super(input, opt);\r\n\r\n        (input as any).mask(this.options.mask || '', {\r\n            placeholder: (this.options.placeholder ?? '_')\r\n        });\r\n    }\r\n\r\n    public get value(): string {\r\n        this.element.triggerHandler(\"blur.mask\");\r\n        return this.element.val();\r\n    }\r\n\r\n    protected get_value(): string {\r\n        return this.value;\r\n    }\r\n\r\n    public set value(value: string) {\r\n        this.element.val(value);\r\n    }\r\n\r\n    protected set_value(value: string): void {\r\n        this.value = value;\r\n    }\r\n}\r\n\r\nexport interface MaskedEditorOptions {\r\n    mask?: string;\r\n    placeholder?: string;\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IStringValue } from \"../../interfaces\";\r\nimport { addValidationRule, isEmptyOrNull, text } from \"@serenity-is/corelib/q\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface RecaptchaOptions {\r\n    siteKey?: string;\r\n    language?: string;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.Recaptcha', [IStringValue])\r\n@Decorators.element(\"<div/>\")\r\nexport class Recaptcha extends Widget<RecaptchaOptions> implements IStringValue {\r\n    constructor(div: JQuery, opt: RecaptchaOptions) {\r\n        super(div, opt);\r\n\r\n        this.element.addClass('g-recaptcha').attr('data-sitekey', this.options.siteKey);\r\n        if (!!(window['grecaptcha'] == null && $('script#RecaptchaInclude').length === 0)) {\r\n            var src = 'https://www.google.com/recaptcha/api.js';\r\n            var lng = this.options.language;\r\n            if (lng == null) {\r\n                lng = $('html').attr('lang') ?? '';\r\n            }\r\n            src += '?hl=' + lng;\r\n            $('<script/>').attr('id', 'RecaptchaInclude').attr('src', src).appendTo(document.body);\r\n        }\r\n\r\n        var valInput = $('<input />').insertBefore(this.element)\r\n            .attr('id', this.uniqueName + '_validate').val('x');\r\n\r\n        var gro = {};\r\n        gro['visibility'] = 'hidden';\r\n        gro['width'] = '0px';\r\n        gro['height'] = '0px';\r\n        gro['padding'] = '0px';\r\n\r\n        var input = valInput.css(gro);\r\n        var self = this;\r\n\r\n        addValidationRule(input, this.uniqueName, e => {\r\n            if (isEmptyOrNull(this.get_value())) {\r\n                return text('Validation.Required');\r\n            }\r\n            return null;\r\n        });\r\n    }\r\n\r\n    get_value(): string {\r\n        return this.element.find('.g-recaptcha-response').val();\r\n    }\r\n\r\n    set_value(value: string): void {\r\n        // ignore\r\n    }\r\n}", "import { blockUI, blockUndo, endsWith, format, iframeDialog, isEmptyOrNull, notifyError, replaceAll, resolveUrl, round, startsWith, text } from \"@serenity-is/corelib/q\";\r\n\r\nexport namespace UploadHelper {\r\n\r\n    export function addUploadInput(options: UploadInputOptions): JQuery {\r\n        options.container.addClass('fileinput-button');\r\n        var uploadInput = $('<input/>').attr('type', 'file')\r\n            .attr('name', options.inputName + '[]')\r\n            .attr('data-url', resolveUrl('~/File/TemporaryUpload'))\r\n            .attr('multiple', 'multiple').appendTo(options.container);\r\n\r\n        if (options.allowMultiple) {\r\n            uploadInput.attr('multiple', 'multiple');\r\n        }\r\n\r\n        (uploadInput as any).fileupload({\r\n            dataType: 'json',\r\n            dropZone: options.zone,\r\n            pasteZone: options.zone,\r\n            done: function (e: JQueryEventObject, data: any) {\r\n                var response = data.result;\r\n                if (response.Error) {\r\n                    notifyError(response.Error.Message);\r\n                    return;\r\n                } \r\n\r\n                if (options.fileDone != null) {\r\n                    options.fileDone(response, data.files[0].name, data);\r\n                }\r\n            },\r\n            fail: function(e: JQueryEventObject, opt: any) {\r\n                var xhr = opt?._response?.jqXHR;\r\n                if (!xhr) {\r\n                    notifyError('An error occurred during file upload.');\r\n                    return;\r\n                }\r\n\r\n                if ((xhr.getResponseHeader('content-type') || '')\r\n                    .toLowerCase().indexOf('application/json') >= 0) {\r\n                    var json = $.parseJSON(xhr.responseText);\r\n                    if (json && json.Error && json.Error.Message) {\r\n                        notifyError(json.Error.Message);\r\n                        return;\r\n                    }\r\n                }\r\n\r\n                var html = xhr.responseText;\r\n                if (html) {\r\n                    iframeDialog({ html: html });\r\n                    return;\r\n                }\r\n\r\n                if (!xhr.status) {\r\n                    if (xhr.statusText != \"abort\")\r\n                        notifyError(\"An unknown connection error occurred! Check browser console for details.\");\r\n                    return;\r\n                }\r\n\r\n                if (xhr.status == 500) {\r\n                    notifyError(\"HTTP 500: Connection refused! Check browser console for details.\");\r\n                    return;\r\n                }\r\n\r\n                notifyError(\"HTTP \" + xhr.status + ' error! Check browser console for details.');\r\n            },\r\n            start: function () {\r\n                blockUI(null);\r\n                if (options.progress != null) {\r\n                    options.progress.show();\r\n                }\r\n            },\r\n            stop: function () {\r\n                blockUndo();\r\n                if (options.progress != null) {\r\n                    options.progress.hide();\r\n                }\r\n            },\r\n            progress: function (e1: JQueryEventObject, data1: any) {\r\n                if (options.progress != null) {\r\n                    var percent = data1.loaded / data1.total * 100;\r\n                    options.progress.children().css('width', percent.toString() + '%');\r\n                }\r\n            }\r\n        });\r\n        return uploadInput;\r\n    }\r\n\r\n    export function checkImageConstraints(file: UploadResponse,\r\n        opt: FileUploadConstraints): boolean {\r\n\r\n        if (!file.IsImage && !opt.allowNonImage) {\r\n            alert(text('Controls.ImageUpload.NotAnImageFile'));\r\n            return false;\r\n        }\r\n        if (opt.minSize > 0 && file.Size < opt.minSize) {\r\n            alert(format(text('Controls.ImageUpload.UploadFileTooSmall'),\r\n                fileSizeDisplay(opt.minSize)));\r\n            return false;\r\n        }\r\n        if (opt.maxSize > 0 && file.Size > opt.maxSize) {\r\n            alert(format(text('Controls.ImageUpload.UploadFileTooBig'),\r\n                fileSizeDisplay(opt.maxSize)));\r\n            return false;\r\n        }\r\n        if (!file.IsImage) {\r\n            return true;\r\n        }\r\n        if (opt.minWidth > 0 && file.Width < opt.minWidth) {\r\n            alert(format(text('Controls.ImageUpload.MinWidth'), opt.minWidth));\r\n            return false;\r\n        }\r\n        if (opt.maxWidth > 0 && file.Width > opt.maxWidth) {\r\n            alert(format(text('Controls.ImageUpload.MaxWidth'), opt.maxWidth));\r\n            return false;\r\n        }\r\n        if (opt.minHeight > 0 && file.Height < opt.minHeight) {\r\n            alert(format(text('Controls.ImageUpload.MinHeight'), opt.minHeight));\r\n            return false;\r\n        }\r\n        if (opt.maxHeight > 0 && file.Height > opt.maxHeight) {\r\n            alert(format(text('Controls.ImageUpload.MaxHeight'), opt.maxHeight));\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    export function fileNameSizeDisplay(name: string, bytes: number): string {\r\n        return name + ' (' + fileSizeDisplay(bytes) + ')';\r\n    }\r\n\r\n    export function fileSizeDisplay(bytes: number): string {\r\n        var byteSize = round(bytes * 100 / 1024) * 0.01;\r\n        var suffix = 'KB';\r\n        if (byteSize >= 1024) {\r\n            byteSize = round(byteSize * 100 / 1024) * 0.01;\r\n            suffix = 'MB';\r\n        }\r\n        var sizeParts = byteSize.toString().split(String.fromCharCode(46));\r\n        var value;\r\n        if (sizeParts.length > 1) {\r\n            value = sizeParts[0] + '.' + sizeParts[1].substr(0, 2);\r\n        }\r\n        else {\r\n            value = sizeParts[0];\r\n        }\r\n        return value + ' ' + suffix;\r\n    }\r\n\r\n    export function hasImageExtension(filename: string): boolean {\r\n        if (isEmptyOrNull(filename)) {\r\n            return false;\r\n        }\r\n        filename = filename.toLowerCase();\r\n        return endsWith(filename, '.jpg') || endsWith(filename, '.jpeg') ||\r\n            endsWith(filename, '.gif') || endsWith(filename, '.png');\r\n    }\r\n\r\n    export function thumbFileName(filename: string): string {\r\n        filename = filename ?? '';\r\n        var idx = filename.lastIndexOf('.');\r\n        if (idx >= 0) {\r\n            filename = filename.substr(0, idx);\r\n        }\r\n        return filename + '_t.jpg';\r\n    }\r\n\r\n    export function dbFileUrl(filename: string): string {\r\n        filename = replaceAll(filename ?? '', '\\\\', '/');\r\n        return resolveUrl('~/upload/') + filename;\r\n    }\r\n\r\n    export function colorBox(link: JQuery, options: any): void {\r\n        (link as any).colorbox({\r\n            current: text('Controls.ImageUpload.ColorboxCurrent'),\r\n            previous: text('Controls.ImageUpload.ColorboxPrior'),\r\n            next: text('Controls.ImageUpload.ColorboxNext'),\r\n            close: text('Controls.ImageUpload.ColorboxClose')\r\n        });\r\n    }\r\n\r\n    export function populateFileSymbols(container: JQuery, items: UploadedFile[],\r\n        displayOriginalName?: boolean, urlPrefix?: string): void {\r\n\r\n        items = items || [];\r\n        container.html('');\r\n        for (var index = 0; index < items.length; index++) {\r\n            var item = items[index];\r\n            var li = $('<li/>').addClass('file-item').data('index', index);\r\n            var isImage = hasImageExtension(item.Filename);\r\n            if (isImage) {\r\n                li.addClass('file-image');\r\n            }\r\n            else {\r\n                li.addClass('file-binary');\r\n            }\r\n            var editLink = '#' + index;\r\n            var thumb = $('<a/>').addClass('thumb').appendTo(li);\r\n            var originalName = item.OriginalName ?? '';\r\n            var fileName = item.Filename;\r\n            if (urlPrefix != null && fileName != null &&\r\n                !startsWith(fileName, 'temporary/')) {\r\n                fileName = urlPrefix + fileName;\r\n            }\r\n\r\n            thumb.attr('href', dbFileUrl(fileName));\r\n            thumb.attr('target', '_blank');\r\n            if (!isEmptyOrNull(originalName)) {\r\n                thumb.attr('title', originalName);\r\n            }\r\n\r\n            if (isImage) {\r\n                thumb.css('backgroundImage', \"url('\" + dbFileUrl(\r\n                    thumbFileName(item.Filename)) + \"')\");\r\n                colorBox(thumb, new Object());\r\n            }\r\n\r\n            if (displayOriginalName) {\r\n                $('<div/>').addClass('filename').text(originalName)\r\n                    .attr('title', originalName).appendTo(li);\r\n            }\r\n\r\n            li.appendTo(container);\r\n        }\r\n    }\r\n}\r\n\r\nexport interface UploadedFile {\r\n    Filename?: string;\r\n    OriginalName?: string;\r\n}\r\n\r\nexport interface UploadInputOptions {\r\n    container?: JQuery;\r\n    zone?: JQuery;\r\n    progress?: JQuery;\r\n    inputName?: string;\r\n    allowMultiple?: boolean;\r\n    fileDone?: (p1: UploadResponse, p2: string, p3: any) => void;\r\n}\r\n\r\nexport interface UploadResponse {\r\n    TemporaryFile: string;\r\n    Size: number;\r\n    IsImage: boolean;\r\n    Width: number;\r\n    Height: number;\r\n}\r\n\r\nexport interface FileUploadConstraints {\r\n    minWidth?: number;\r\n    maxWidth?: number;\r\n    minHeight?: number;\r\n    maxHeight?: number;\r\n    minSize?: number;\r\n    maxSize?: number;\r\n    allowNonImage?: boolean;\r\n    originalNameProperty?: string;\r\n}\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IGetEditValue, IReadOnly, ISetEditValue, IValidateRequired } from \"../../interfaces\";\r\nimport { endsWith, extend, isEmptyOrNull, isInstanceOfType, isTrimmedEmpty, PropertyItem, replaceAll, startsWith, text, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { FileUploadConstraints, UploadedFile, UploadHelper, UploadInputOptions } from \"../helpers/uploadhelper\";\r\nimport { Toolbar, ToolButton } from \"../widgets/toolbar\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface FileUploadEditorOptions extends FileUploadConstraints {\r\n    displayFileName?: boolean; \r\n    urlPrefix?: string;\r\n}\r\n\r\nexport interface ImageUploadEditorOptions extends FileUploadEditorOptions {\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.FileUploadEditor', [IReadOnly, IGetEditValue, ISetEditValue, IValidateRequired])\r\n@Decorators.element('<div/>')\r\nexport class FileUploadEditor extends Widget<FileUploadEditorOptions>\r\n    implements IReadOnly, IGetEditValue, ISetEditValue, IValidateRequired {\r\n\r\n    constructor(div: JQuery, opt: FileUploadEditorOptions) {\r\n        super(div, opt);\r\n\r\n        if (!opt || opt.allowNonImage == null)\r\n            this.options.allowNonImage = true;\r\n\r\n        div.addClass('s-FileUploadEditor');\r\n        \r\n        if (isEmptyOrNull(this.options.originalNameProperty))\r\n            div.addClass('hide-original-name');\r\n\r\n        this.toolbar = new Toolbar($('<div/>').appendTo(this.element), {\r\n            buttons: this.getToolButtons()\r\n        });\r\n\r\n        this.progress = $('<div><div></div></div>')\r\n            .addClass('upload-progress')\r\n            .prependTo(this.toolbar.element);\r\n\r\n        var uio = this.getUploadInputOptions();\r\n        this.uploadInput = UploadHelper.addUploadInput(uio);\r\n\r\n        this.fileSymbols = $('<ul/>').appendTo(this.element);\r\n\r\n        if (!this.element.attr('id'))\r\n            this.element.attr('id', this.uniqueName);\r\n\r\n        this.hiddenInput = $('<input type=\"text\" class=\"s-offscreen\" name=\"' + this.uniqueName +\r\n            '_Validator\" data-vx-highlight=\"' + this.element.attr('id') + '\"/>')\r\n            .appendTo(this.element);\r\n\r\n        this.updateInterface();\r\n    }\r\n\r\n    protected getUploadInputOptions(): UploadInputOptions {\r\n        return {\r\n            container: this.toolbar.findButton('add-file-button'),\r\n            zone: this.element,\r\n            inputName: this.uniqueName,\r\n            progress: this.progress,\r\n            fileDone: (response, name, data) => {\r\n                if (!UploadHelper.checkImageConstraints(response, this.options)) {\r\n                    return;\r\n                }\r\n\r\n                var newEntity: UploadedFile = {\r\n                    OriginalName: name,\r\n                    Filename: response.TemporaryFile\r\n                };\r\n\r\n                this.entity = newEntity;\r\n                this.populate();\r\n                this.updateInterface();\r\n\r\n                var validator = this.hiddenInput.closest('form').data('validator');\r\n                if (validator != null) {\r\n                    validator.element(this.hiddenInput);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected addFileButtonText(): string {\r\n        return text('Controls.ImageUpload.AddFileButton');\r\n    }\r\n\r\n    protected getToolButtons(): ToolButton[] {\r\n        return [\r\n            {\r\n                title: this.addFileButtonText(),\r\n                cssClass: 'add-file-button',\r\n                onClick: function () {\r\n                }\r\n            },\r\n            {\r\n                title: '',\r\n                hint: text('Controls.ImageUpload.DeleteButtonHint'),\r\n                cssClass: 'delete-button',\r\n                onClick: () => {\r\n                    this.entity = null;\r\n                    this.populate();\r\n                    this.updateInterface();\r\n\r\n                    var validator = this.hiddenInput.closest('form').data('validator');\r\n                    if (validator != null) {\r\n                        validator.element(this.hiddenInput);\r\n                    }\r\n                }\r\n            }\r\n        ];\r\n    }\r\n\r\n    protected populate(): void {\r\n        var displayOriginalName = this.options.displayFileName ||\r\n            !isTrimmedEmpty(this.options.originalNameProperty);\r\n\r\n        if (this.entity == null) {\r\n            UploadHelper.populateFileSymbols(this.fileSymbols,\r\n                null, displayOriginalName, this.options.urlPrefix);\r\n        }\r\n        else {\r\n            UploadHelper.populateFileSymbols(\r\n                this.fileSymbols, [this.entity], displayOriginalName,\r\n                this.options.urlPrefix);\r\n        }\r\n\r\n        this.hiddenInput.val(trimToNull((this.get_value() || {}).Filename));\r\n    }\r\n\r\n    protected updateInterface(): void {\r\n        var addButton = this.toolbar.findButton('add-file-button');\r\n        var delButton = this.toolbar.findButton('delete-button');\r\n        addButton.toggleClass('disabled', this.get_readOnly());\r\n        delButton.toggleClass('disabled', this.get_readOnly() ||\r\n            this.entity == null);\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return this.uploadInput.attr('disabled') != null;\r\n    }\r\n\r\n    set_readOnly(value: boolean): void {\r\n        if (this.get_readOnly() !== value) {\r\n            if (value) {\r\n                this.uploadInput.attr('disabled', 'disabled');\r\n                try {\r\n                    (this.uploadInput as any).fileupload('disable');\r\n                }\r\n                catch {\r\n                }\r\n            }\r\n            else {\r\n                this.uploadInput.removeAttr('disabled');\r\n                try {\r\n                    (this.uploadInput as any).fileupload('enable');\r\n                } catch {\r\n                }\r\n            }\r\n            this.updateInterface();\r\n        }\r\n    }\r\n\r\n    get_required(): boolean {\r\n        return this.hiddenInput.hasClass('required');\r\n    }\r\n\r\n    set_required(value: boolean): void {\r\n        this.hiddenInput.toggleClass('required', !!value);\r\n    }\r\n\r\n    get_value(): UploadedFile {\r\n        if (this.entity == null) {\r\n            return null;\r\n        }\r\n        var copy = extend({}, this.entity);\r\n        return copy;\r\n    }\r\n\r\n    get value(): UploadedFile {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: UploadedFile): void {\r\n        var stringValue = value as string;\r\n        if (typeof stringValue === \"string\") {\r\n            var stringValue = trimToNull(stringValue);\r\n            if (value != null) {\r\n                var idx = stringValue.indexOf('/');\r\n                if (idx < 0)\r\n                    idx = stringValue.indexOf('\\\\');\r\n                value = <UploadedFile>{\r\n                    Filename: value,\r\n                    OriginalName: stringValue.substring(idx + 1)\r\n                }\r\n            }\r\n        }\r\n        else if (value != null && isTrimmedEmpty(value.Filename))\r\n            value = null;\r\n\r\n        if (value != null) {\r\n            if (value.Filename == null) {\r\n                this.entity = null;\r\n            }\r\n            else {\r\n                this.entity = extend({}, value);\r\n            }\r\n        }\r\n        else {\r\n            this.entity = null;\r\n        }\r\n        this.populate();\r\n\r\n        var validator = this.hiddenInput.closest('form').data('validator');\r\n        if (validator != null) {\r\n            validator.element(this.hiddenInput);\r\n        }\r\n\r\n        this.updateInterface();\r\n    }\r\n\r\n    set value(v: UploadedFile) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    getEditValue(property: PropertyItem, target: any) {\r\n        target[property.name] = this.entity == null ? null :\r\n            trimToNull(this.entity.Filename);\r\n    }\r\n\r\n    setEditValue(source: any, property: PropertyItem) {\r\n        var value: UploadedFile = {};\r\n        value.Filename = source[property.name];\r\n        if (isEmptyOrNull(this.options.originalNameProperty)) {\r\n\r\n            if (this.options.displayFileName) {\r\n                var s = (value.Filename ?? '');\r\n                var idx = replaceAll(s, '\\\\', '/').lastIndexOf('/');\r\n                if (idx >= 0) {\r\n                    value.OriginalName = s.substr(idx + 1);\r\n                }\r\n                else {\r\n                    value.OriginalName = s;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            value.OriginalName = source[this.options.originalNameProperty];\r\n        }\r\n\r\n        this.set_value(value);\r\n    }\r\n\r\n    protected entity: UploadedFile;\r\n    protected toolbar: Toolbar;\r\n    protected progress: JQuery;\r\n    protected fileSymbols: JQuery;\r\n    protected uploadInput: JQuery;\r\n    protected hiddenInput: JQuery;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.ImageUploadEditor')\r\nexport class ImageUploadEditor extends FileUploadEditor {\r\n    constructor(div: JQuery, opt: ImageUploadEditorOptions) {\r\n        super(div, opt);\r\n\r\n        if (opt && opt.allowNonImage == null)\r\n            this.options.allowNonImage = false;\r\n\r\n        div.addClass('s-ImageUploadEditor');\r\n    }\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.MultipleFileUploadEditor', [IReadOnly, IGetEditValue, ISetEditValue, IValidateRequired])\r\n@Decorators.element('<div/>')\r\nexport class MultipleFileUploadEditor extends Widget<FileUploadEditorOptions>\r\n    implements IReadOnly, IGetEditValue, ISetEditValue, IValidateRequired {\r\n\r\n    private entities: UploadedFile[];\r\n    private toolbar: Toolbar;\r\n    private fileSymbols: JQuery;\r\n    private uploadInput: JQuery;\r\n    protected progress: JQuery;\r\n    protected hiddenInput: JQuery;\r\n\r\n    constructor(div: JQuery, opt: ImageUploadEditorOptions) {\r\n        super(div, opt);\r\n\r\n        this.entities = [];\r\n        div.addClass('s-MultipleFileUploadEditor');\r\n        var self = this;\r\n        this.toolbar = new Toolbar($('<div/>').appendTo(this.element), {\r\n            buttons: this.getToolButtons()\r\n        });\r\n\r\n        this.progress = $('<div><div></div></div>')\r\n            .addClass('upload-progress')\r\n            .prependTo(this.toolbar.element);\r\n\r\n        var addFileButton = this.toolbar.findButton('add-file-button');\r\n\r\n        this.uploadInput = UploadHelper.addUploadInput({\r\n            container: addFileButton,\r\n            zone: this.element,\r\n            inputName: this.uniqueName,\r\n            progress: this.progress,\r\n            fileDone: (response, name, data) => {\r\n                if (!UploadHelper.checkImageConstraints(response, this.options)) {\r\n                    return;\r\n                }\r\n                var newEntity = { OriginalName: name, Filename: response.TemporaryFile };\r\n                self.entities.push(newEntity);\r\n                self.populate();\r\n\r\n                var validator = this.hiddenInput.closest('form').data('validator');\r\n                if (validator != null) {\r\n                    validator.element(this.hiddenInput);\r\n                }\r\n\r\n                self.updateInterface();\r\n            }\r\n        });\r\n\r\n        this.fileSymbols = $('<ul/>').appendTo(this.element);\r\n        if (!this.element.attr('id')) {\r\n            this.element.attr('id', this.uniqueName);\r\n        }\r\n\r\n        this.hiddenInput = $('<input type=\"text\" class=\"s-offscreen\" name=\"' + this.uniqueName +\r\n            '_Validator\" data-vx-highlight=\"' + this.element.attr('id') + '\"/>').appendTo(this.element);\r\n\r\n        this.updateInterface();\r\n\r\n    }\r\n\r\n    protected addFileButtonText(): string {\r\n        return text('Controls.ImageUpload.AddFileButton');\r\n    }\r\n\r\n    protected getToolButtons(): ToolButton[] {\r\n        return [{\r\n            title: this.addFileButtonText(),\r\n            cssClass: 'add-file-button',\r\n            onClick: function () {\r\n            }\r\n        }];\r\n    }\r\n\r\n    protected populate(): void {\r\n        UploadHelper.populateFileSymbols(this.fileSymbols, this.entities,\r\n            true, this.options.urlPrefix);\r\n\r\n        this.fileSymbols.children().each((i, e) => {\r\n            var x = i;\r\n            $(\"<a class='delete'></a>\").appendTo($(e).children('.filename'))\r\n                .click(ev => {\r\n                    ev.preventDefault();\r\n                    this.entities.splice(x, 1);\r\n                    this.populate();\r\n\r\n                    var validator = this.hiddenInput.closest('form').data('validator');\r\n                    if (validator != null) {\r\n                        validator.element(this.hiddenInput);\r\n                    }\r\n                });\r\n        });\r\n\r\n        this.hiddenInput.val(trimToNull((this.get_value()[0] || {}).Filename));\r\n    }\r\n\r\n    protected updateInterface(): void {\r\n        var addButton = this.toolbar.findButton('add-file-button');\r\n        addButton.toggleClass('disabled', this.get_readOnly());\r\n        this.fileSymbols.find('a.delete').toggle(!this.get_readOnly());\r\n    }\r\n\r\n    get_readOnly(): boolean {\r\n        return this.uploadInput.attr('disabled') != null;\r\n    }\r\n\r\n    set_readOnly(value: boolean): void {\r\n        if (this.get_readOnly() !== value) {\r\n            if (value) {\r\n                this.uploadInput.attr('disabled', 'disabled');\r\n                try {\r\n                    (this.uploadInput as any).fileupload('disable');\r\n                }\r\n                catch {\r\n                }\r\n            }\r\n            else {\r\n                this.uploadInput.removeAttr('disabled');\r\n                try {\r\n                    (this.uploadInput as any).fileupload('enable');\r\n                } catch {\r\n                }\r\n            }\r\n            this.updateInterface();\r\n        }\r\n    }\r\n\r\n    get_required(): boolean {\r\n        return this.hiddenInput.hasClass('required');\r\n    }\r\n\r\n    set_required(value: boolean): void {\r\n        this.hiddenInput && this.hiddenInput.toggleClass('required', !!value);\r\n    }\r\n\r\n    get_value(): UploadedFile[] {\r\n        return this.entities.map(function (x) {\r\n            return extend({}, x);\r\n        });\r\n    }\r\n\r\n    get value(): UploadedFile[] {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: UploadedFile[]) {\r\n        this.entities = (value || []).map(function (x) {\r\n            return extend({}, x);\r\n        });\r\n        this.populate();\r\n        this.updateInterface();\r\n    }\r\n\r\n    set value(v: UploadedFile[]) {\r\n        this.set_value(v);\r\n    }\r\n\r\n    getEditValue(property: PropertyItem, target: any) {\r\n        if (this.jsonEncodeValue) {\r\n            target[property.name] = JSON.stringify(this.get_value());\r\n        }\r\n        else {\r\n            target[property.name] = this.get_value();\r\n        }\r\n    }\r\n\r\n    setEditValue(source: any, property: PropertyItem) {\r\n        var val = source[property.name];\r\n        if (isInstanceOfType(val, String)) {\r\n            var json = trimToNull(val) ?? '[]';\r\n            if (startsWith(json, '[') && endsWith(json, ']')) {\r\n                this.set_value($.parseJSON(json));\r\n            }\r\n            else {\r\n                this.set_value([{\r\n                    Filename: json,\r\n                    OriginalName: 'UnknownFile'\r\n                }]);\r\n            }\r\n        }\r\n        else {\r\n            this.set_value(val as any);\r\n        }\r\n    }\r\n\r\n    @Decorators.option()\r\n    public jsonEncodeValue: boolean;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.MultipleImageUploadEditor')\r\nexport class MultipleImageUploadEditor extends MultipleFileUploadEditor {\r\n    constructor(div: JQuery, opt: ImageUploadEditorOptions) {\r\n        super(div, opt);\r\n\r\n        div.addClass('s-MultipleImageUploadEditor');\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { ArgumentNullException, Criteria, delegateCombine, delegateRemove, formatDate, isArray, isEmptyOrNull, isTrimmedEmpty, ListRequest, notifyWarning, parseDate, text, toId, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { DateEditor } from \"../editors/dateeditor\";\r\nimport { DateTimeEditor, DateTimeEditorOptions } from \"../editors/datetimeeditor\";\r\nimport { EditorUtils } from \"../editors/editorutils\";\r\nimport { SelectEditor, SelectEditorOptions } from \"../editors/selecteditor\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { QuickFilter } from \"./quickfilter\";\r\n\r\nexport interface QuickFilterBarOptions {\r\n    filters: QuickFilter<Widget<any>, any>[];\r\n    getTitle?: (filter: QuickFilter<Widget<any>, any>) => string;\r\n    idPrefix?: string;\r\n}\r\n\r\n@Decorators.registerClass('Serenity.QuickFilterBar')\r\n@Decorators.element(\"<div/>\")\r\nexport class QuickFilterBar extends Widget<QuickFilterBarOptions> {\r\n\r\n    constructor(container: JQuery, options?: QuickFilterBarOptions) {\r\n        super(container, options);\r\n\r\n        container.addClass('quick-filters-bar').addClass('clear');\r\n\r\n        var filters = this.options.filters;\r\n        for (var f = 0; f < filters.length; f++) {\r\n            var filter = filters[f];\r\n            this.add(filter);\r\n        }\r\n\r\n        this.options.idPrefix = (this.options.idPrefix ?? this.uniqueName + '_');\r\n    }\r\n\r\n    public addSeparator(): void {\r\n        this.element.append($('<hr/>'));\r\n    }\r\n\r\n    public add<TWidget extends Widget<any>, TOptions>(opt: QuickFilter<TWidget, TOptions>): TWidget {\r\n\r\n        if (opt == null) {\r\n            throw new ArgumentNullException('opt');\r\n        }\r\n\r\n        if (opt.separator) {\r\n            this.addSeparator();\r\n        }\r\n\r\n        var item = $(\"<div class='quick-filter-item'><span class='quick-filter-label'></span></div>\")\r\n            .appendTo(this.element)\r\n            .data('qffield', opt.field).children();\r\n\r\n        var title = opt.title;\r\n        if (title == null) {\r\n            title = this.options.getTitle ? this.options.getTitle(opt) : null;\r\n            if (title == null) {\r\n                title = opt.field;\r\n            }\r\n        }\r\n\r\n        var quickFilter = item.text(title).parent();\r\n\r\n        if (opt.displayText != null) {\r\n            quickFilter.data('qfdisplaytext', opt.displayText);\r\n        }\r\n\r\n        if (opt.saveState != null) {\r\n            quickFilter.data('qfsavestate', opt.saveState);\r\n        }\r\n\r\n        if (opt.loadState != null) {\r\n            quickFilter.data('qfloadstate', opt.loadState);\r\n        }\r\n\r\n        if (!isEmptyOrNull(opt.cssClass)) {\r\n            quickFilter.addClass(opt.cssClass);\r\n        }\r\n\r\n        var widget = Widget.create({\r\n            type: opt.type,\r\n            element: e => {\r\n                if (!isEmptyOrNull(opt.field)) {\r\n                    e.attr('id', this.options.idPrefix + opt.field);\r\n                }\r\n                e.attr('placeholder', ' ');\r\n                e.appendTo(quickFilter);\r\n                if (opt.element != null) {\r\n                    opt.element(e);\r\n                }\r\n            },\r\n            options: opt.options,\r\n            init: opt.init\r\n        });\r\n\r\n        var submitHandler = (request: ListRequest) => {\r\n\r\n            if (quickFilter.hasClass('ignore')) {\r\n                return;\r\n            }\r\n\r\n            request.EqualityFilter = request.EqualityFilter || {};\r\n            var value = EditorUtils.getValue(widget);\r\n            var active = value != null && !isEmptyOrNull(value.toString());\r\n            if (opt.handler != null) {\r\n                var args = {\r\n                    field: opt.field,\r\n                    request: request,\r\n                    equalityFilter: request.EqualityFilter,\r\n                    value: value,\r\n                    active: active,\r\n                    widget: widget,\r\n                    handled: true\r\n                };\r\n                opt.handler(args);\r\n                quickFilter.toggleClass('quick-filter-active', args.active);\r\n                if (!args.handled) {\r\n                    request.EqualityFilter[opt.field] = value;\r\n                }\r\n            }\r\n            else {\r\n                request.EqualityFilter[opt.field] = value;\r\n                quickFilter.toggleClass('quick-filter-active', active);\r\n            }\r\n        };\r\n\r\n        widget.changeSelect2(e1 => {\r\n            // use timeout give cascaded dropdowns a chance to update / clear themselves\r\n            window.setTimeout(() => this.onChange && this.onChange(e1), 0);\r\n        });\r\n\r\n        this.add_submitHandlers(submitHandler);\r\n        widget.element.bind('remove.' + this.uniqueName, x => {\r\n            this.remove_submitHandlers(submitHandler);\r\n        });\r\n\r\n        return widget;\r\n    }\r\n\r\n    public addDateRange(field: string, title?: string): DateEditor {\r\n        return this.add(QuickFilterBar.dateRange(field, title)) as DateEditor;\r\n    }\r\n\r\n    public static dateRange(field: string, title?: string): QuickFilter<DateEditor, DateTimeEditorOptions> {\r\n        var end: DateEditor = null;\r\n        return <QuickFilter<DateEditor, DateTimeEditorOptions>>{\r\n            field: field,\r\n            type: DateEditor,\r\n            title: title,\r\n            element: function (e1) {\r\n                end = Widget.create({\r\n                    type: DateEditor,\r\n                    element: function (e2) {\r\n                        e2.insertAfter(e1);\r\n                    },\r\n                    options: null,\r\n                    init: null\r\n                });\r\n\r\n                end.element.change(function (x) {\r\n                    e1.triggerHandler('change');\r\n                });\r\n\r\n                $('<span/>').addClass('range-separator').text('-').insertAfter(e1);\r\n            },\r\n            handler: function (args) {\r\n                var active1 = !isTrimmedEmpty(args.widget.value);\r\n                var active2 = !isTrimmedEmpty(end.value);\r\n                if (active1 && !parseDate(args.widget.element.val())) {\r\n                    active1 = false;\r\n                    notifyWarning(text('Validation.DateInvalid'), '', null);\r\n                    args.widget.element.val('');\r\n                }\r\n                if (active2 && !parseDate(end.element.val())) {\r\n                    active2 = false;\r\n                    notifyWarning(text('Validation.DateInvalid'), '', null);\r\n                    end.element.val('');\r\n                }\r\n                args.active = active1 || active2;\r\n                if (active1) {\r\n                    args.request.Criteria = Criteria.join(args.request.Criteria, 'and',\r\n                        [[args.field], '>=', args.widget.value]);\r\n                }\r\n                if (active2) {\r\n                    var next = new Date(end.valueAsDate.valueOf());\r\n                    next.setDate(next.getDate() + 1);\r\n                    args.request.Criteria = Criteria.join(args.request.Criteria, 'and',\r\n                        [[args.field], '<', formatDate(next, 'yyyy-MM-dd')]);\r\n                }\r\n            },\r\n            displayText: function (w, l) {\r\n                var v1 = EditorUtils.getDisplayText(w);\r\n                var v2 = EditorUtils.getDisplayText(end);\r\n                if (isEmptyOrNull(v1) && isEmptyOrNull(v2)) {\r\n                    return null;\r\n                }\r\n                var text1 = l + ' >= ' + v1;\r\n                var text2 = l + ' <= ' + v2;\r\n                if (!isEmptyOrNull(v1) && !isEmptyOrNull(v2)) {\r\n                    return text1 + ' ' + (tryGetText('Controls.FilterPanel.And') ?? 'and') + ' ' + text2;\r\n                }\r\n                else if (!isEmptyOrNull(v1)) {\r\n                    return text1;\r\n                }\r\n                else {\r\n                    return text2;\r\n                }\r\n            },\r\n            saveState: function (w1) {\r\n                return [EditorUtils.getValue(w1), EditorUtils.getValue(end)];\r\n            },\r\n            loadState: function (w2, state) {\r\n                if (state == null || !isArray(state) || state.length !== 2) {\r\n                    state = [null, null];\r\n                }\r\n\r\n                EditorUtils.setValue(w2, state[0]);\r\n                EditorUtils.setValue(end, state[1]);\r\n            }\r\n        };\r\n    }\r\n\r\n    public addDateTimeRange(field: string, title?: string) {\r\n        return this.add(QuickFilterBar.dateTimeRange(field, title)) as DateTimeEditor;\r\n    }\r\n\r\n    public static dateTimeRange(field: string, title?: string, useUtc?: boolean): QuickFilter<DateTimeEditor, DateTimeEditorOptions> {\r\n        var end: DateTimeEditor = null;\r\n\r\n        return <QuickFilter<DateTimeEditor, DateTimeEditorOptions>>{\r\n            field: field,\r\n            type: DateTimeEditor,\r\n            title: title,\r\n            element: function (e1) {\r\n                end = Widget.create({\r\n                    type: DateTimeEditor,\r\n                    element: function (e2) {\r\n                        e2.insertAfter(e1);\r\n                    },\r\n                    options: useUtc == null ? null : { useUtc },\r\n                    init: null\r\n                });\r\n\r\n                end.element.change(function (x) {\r\n                    e1.triggerHandler('change');\r\n                });\r\n\r\n                $('<span/>').addClass('range-separator').text('-').insertAfter(e1);\r\n            },\r\n            init: function (i) {\r\n                i.element.parent().find('.time').change(function (x1) {\r\n                    i.element.triggerHandler('change');\r\n                });\r\n            },\r\n            handler: function (args) {\r\n                var active1 = !isTrimmedEmpty(args.widget.value);\r\n                var active2 = !isTrimmedEmpty(end.value);\r\n                if (active1 && !parseDate(args.widget.element.val())) {\r\n                    active1 = false;\r\n                    notifyWarning(text('Validation.DateInvalid'), '', null);\r\n                    args.widget.element.val('');\r\n                }\r\n                if (active2 && !parseDate(end.element.val())) {\r\n                    active2 = false;\r\n                    notifyWarning(text('Validation.DateInvalid'), '', null);\r\n                    end.element.val('');\r\n                }\r\n                args.active = active1 || active2;\r\n                if (active1) {\r\n                    args.request.Criteria = Criteria.join(args.request.Criteria, 'and',\r\n                        [[args.field], '>=', args.widget.value]);\r\n                }\r\n                if (active2) {\r\n                    args.request.Criteria = Criteria.join(args.request.Criteria, 'and',\r\n                        [[args.field], '<=', end.value]);\r\n                }\r\n            },\r\n            displayText: function (w, l) {\r\n                var v1 = EditorUtils.getDisplayText(w);\r\n                var v2 = EditorUtils.getDisplayText(end);\r\n                if (isEmptyOrNull(v1) && isEmptyOrNull(v2)) {\r\n                    return null;\r\n                }\r\n                var text1 = l + ' >= ' + v1;\r\n                var text2 = l + ' <= ' + v2;\r\n                if (!isEmptyOrNull(v1) && !isEmptyOrNull(v2)) {\r\n                    return text1 + ' ' + (tryGetText('Controls.FilterPanel.And') ?? 'and') + ' ' + text2;\r\n                }\r\n                else if (!isEmptyOrNull(v1)) {\r\n                    return text1;\r\n                }\r\n                else {\r\n                    return text2;\r\n                }\r\n            },\r\n            saveState: function (w1) {\r\n                return [EditorUtils.getValue(w1), EditorUtils.getValue(end)];\r\n            },\r\n            loadState: function (w2, state) {\r\n                if (state == null || !isArray(state) || state.length !== 2) {\r\n                    state = [null, null];\r\n                }\r\n                EditorUtils.setValue(w2, state[0]);\r\n                EditorUtils.setValue(end, state[1]);\r\n            },\r\n            options: useUtc == null ? null : { useUtc }\r\n        };\r\n    }\r\n\r\n    public addBoolean(field: string, title?: string, yes?: string, no?: string): SelectEditor {\r\n        return this.add(QuickFilterBar.boolean(field, title, yes, no));\r\n    }\r\n\r\n    public static boolean(field: string, title?: string, yes?: string, no?: string): QuickFilter<SelectEditor, SelectEditorOptions> {\r\n        var opt: SelectEditorOptions = {};\r\n        var items = [];\r\n\r\n        var trueText = yes;\r\n        if (trueText == null) {\r\n            trueText = text('Controls.FilterPanel.OperatorNames.true');\r\n        }\r\n        items.push(['1', trueText]);\r\n\r\n        var falseText = no;\r\n        if (falseText == null) {\r\n            falseText = text('Controls.FilterPanel.OperatorNames.false');\r\n        }\r\n\r\n        items.push(['0', falseText]);\r\n\r\n        opt.items = items;\r\n\r\n        return {\r\n            field: field,\r\n            type: SelectEditor,\r\n            title: title,\r\n            options: opt,\r\n            handler: function (args) {\r\n                args.equalityFilter[args.field] = args.value == null || isEmptyOrNull(args.value.toString()) ?\r\n                    null : !!toId(args.value);\r\n            }\r\n        };\r\n    }\r\n\r\n    public onChange: (e: JQueryEventObject) => void;\r\n\r\n    private submitHandlers: any;\r\n\r\n    destroy() {\r\n        this.submitHandlers = null;\r\n        super.destroy();\r\n    }\r\n\r\n    public onSubmit(request: ListRequest) {\r\n        this.submitHandlers && this.submitHandlers(request);\r\n    }\r\n\r\n    protected add_submitHandlers(action: (request: ListRequest) => void): void {\r\n        this.submitHandlers = delegateCombine(this.submitHandlers, action);\r\n    }\r\n\r\n    protected remove_submitHandlers(action: (request: ListRequest) => void): void {\r\n        this.submitHandlers = delegateRemove(this.submitHandlers, action);\r\n    }\r\n\r\n    protected clear_submitHandlers() {\r\n    }\r\n\r\n    public find<TWidget>(type: { new(...args: any[]): TWidget }, field: string): TWidget {\r\n        return $('#' + this.options.idPrefix + field).getWidget(type);\r\n    }\r\n\r\n    public tryFind<TWidget>(type: { new(...args: any[]): TWidget }, field: string): TWidget {\r\n        var el = $('#' + this.options.idPrefix + field);\r\n        if (!el.length)\r\n            return null;\r\n\r\n        return el.tryGetWidget(type);\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { isEmptyOrNull, isValue, text, trim } from \"@serenity-is/corelib/q\";\r\nimport { PopupMenuButton } from \"../widgets/toolbar\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport interface QuickSearchField {\r\n    name: string;\r\n    title: string;\r\n}\r\n\r\nexport interface QuickSearchInputOptions {\r\n    typeDelay?: number;\r\n    loadingParentClass?: string;\r\n    filteredParentClass?: string;\r\n    onSearch?: (p1: string, p2: string, p3: (p1: boolean) => void) => void;\r\n    fields?: QuickSearchField[];\r\n}\r\n\r\n@Decorators.registerClass('Serenity.QuickSearchInput')\r\nexport class QuickSearchInput extends Widget<QuickSearchInputOptions> {\r\n    private lastValue: string;\r\n    private field: QuickSearchField;\r\n    private fieldChanged: boolean;\r\n    private timer: number;\r\n\r\n    constructor(input: JQuery, opt: QuickSearchInputOptions) {\r\n        super(input, opt);\r\n\r\n        input.attr('title', text('Controls.QuickSearch.Hint'))\r\n            .attr('placeholder', text('Controls.QuickSearch.Placeholder'));\r\n        this.lastValue = trim(input.val() ?? '');\r\n\r\n        var self = this;\r\n        this.element.bind('keyup.' + this.uniqueName, function () {\r\n            self.checkIfValueChanged();\r\n        });\r\n\r\n        this.element.bind('change.' + this.uniqueName, function () {\r\n            self.checkIfValueChanged();\r\n        });\r\n\r\n        $('<span><i></i></span>').addClass('quick-search-icon')\r\n            .insertBefore(input);\r\n\r\n        if (isValue(this.options.fields) && this.options.fields.length > 0) {\r\n            var a = $('<a/>').addClass('quick-search-field').attr('title',\r\n                text('Controls.QuickSearch.FieldSelection')).insertBefore(input);\r\n\r\n            var menu = $('<ul></ul>').css('width', '120px');\r\n\r\n            for (var item of this.options.fields) {\r\n                var field = { $: item };\r\n                $('<li><a/></li>').appendTo(menu).children().attr('href', '#')\r\n                    .text(item.title ?? '').click(function (e: any) {\r\n                        e.preventDefault();\r\n                        this.$this.fieldChanged = self.field !== this.field.$;\r\n                        self.field = this.field.$;\r\n                        this.$this.updateInputPlaceHolder();\r\n                        this.$this.checkIfValueChanged();\r\n                    }.bind({\r\n                        field: field,\r\n                        $this: this\r\n                    }));\r\n            }\r\n\r\n            new PopupMenuButton(a, {\r\n                positionMy: 'right top',\r\n                positionAt: 'right bottom',\r\n                menu: menu\r\n            });\r\n\r\n            this.field = this.options.fields[0];\r\n            this.updateInputPlaceHolder();\r\n        }\r\n\r\n        this.element.bind('execute-search.' + this.uniqueName, e1 => {\r\n            if (!!this.timer) {\r\n                window.clearTimeout(this.timer);\r\n            }\r\n            this.searchNow(trim(this.element.val() ?? ''));\r\n        });\r\n    }\r\n\r\n    protected checkIfValueChanged(): void {\r\n        if (this.element.hasClass('ignore-change')) {\r\n            return;\r\n        }\r\n\r\n        var value = this.get_value();\r\n        if (value == this.lastValue && (!this.fieldChanged || isEmptyOrNull(value))) {\r\n            this.fieldChanged = false;\r\n            return;\r\n        }\r\n\r\n        this.fieldChanged = false;\r\n\r\n        if (!!this.timer) {\r\n            window.clearTimeout(this.timer);\r\n        }\r\n\r\n        var self = this;\r\n        this.timer = window.setTimeout(function () {\r\n            self.searchNow(value);\r\n        }, this.options.typeDelay ?? 500);\r\n\r\n        this.lastValue = value;\r\n    }\r\n\r\n    get_value() {\r\n        return trim(this.element.val() ?? '');\r\n    }\r\n\r\n    get_field(): QuickSearchField {\r\n        return this.field;\r\n    }\r\n\r\n    set_field(value: QuickSearchField): void {\r\n        if (this.field !== value) {\r\n            this.fieldChanged = true;\r\n            this.field = value;\r\n            this.updateInputPlaceHolder();\r\n            this.checkIfValueChanged();\r\n        }\r\n    }\r\n\r\n    protected updateInputPlaceHolder() {\r\n        var qsf = this.element.prevAll('.quick-search-field');\r\n        if (this.field) {\r\n            qsf.text(this.field.title);\r\n        }\r\n        else {\r\n            qsf.text('');\r\n        }\r\n    }\r\n\r\n    public restoreState(value: string, field: QuickSearchField) {\r\n        this.fieldChanged = false;\r\n        this.field = field;\r\n        var value = trim(value ?? '');\r\n        this.element.val(value);\r\n        this.lastValue = value;\r\n        if (!!this.timer) {\r\n            window.clearTimeout(this.timer);\r\n            this.timer = null;\r\n        }\r\n        this.updateInputPlaceHolder();\r\n    }\r\n\r\n    protected searchNow(value: string) {\r\n        this.element.parent().toggleClass(\r\n            (this.options.filteredParentClass ?? 's-QuickSearchFiltered'), !!(value.length > 0));\r\n\r\n        this.element.parent().addClass(this.options.loadingParentClass ?? 's-QuickSearchLoading')\r\n                .addClass(this.options.loadingParentClass ?? 's-QuickSearchLoading');\r\n\r\n        var done = (results: any) => {\r\n            this.element.removeClass(this.options.loadingParentClass ?? 's-QuickSearchLoading')\r\n            .parent().removeClass(this.options.loadingParentClass ?? 's-QuickSearchLoading');\r\n\r\n            if (!results) {\r\n                this.element.closest('.s-QuickSearchBar')\r\n                    .find('.quick-search-icon i')\r\n                    .effect('shake', { distance: 2 });\r\n            }\r\n        };\r\n\r\n        if (this.options.onSearch != null) {\r\n            this.options.onSearch(((this.field != null &&\r\n                !isEmptyOrNull(this.field.name)) ? this.field.name : null), value, done);\r\n        }\r\n        else {\r\n            done(true);\r\n        }\r\n    }\r\n}", "\uFEFFexport {}\r\n\r\nexport interface FilterOperator {\r\n    key?: string;\r\n    title?: string;\r\n    format?: string;\r\n}\r\n\r\nexport namespace FilterOperators {\r\n\r\n    export const isTrue = 'true';\r\n    export const isFalse = 'false';\r\n    export const contains = 'contains';\r\n    export const startsWith = 'startswith';\r\n    export const EQ = 'eq';\r\n    export const NE = 'ne';\r\n    export const GT = 'gt';\r\n    export const GE = 'ge';\r\n    export const LT = 'lt';\r\n    export const LE = 'le';\r\n    export const BW = 'bw';\r\n    export const IN = 'in';\r\n    export const isNull = 'isnull';\r\n    export const isNotNull = 'isnotnull';\r\n\r\n    export const toCriteriaOperator: { [key: string]: string } = {\r\n        eq: '=',\r\n        ne: '!=',\r\n        gt: '>',\r\n        ge: '>=',\r\n        lt: '<',\r\n        le: '<='\r\n    };\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { ArgumentNullException, Criteria, Culture, delegateCombine, delegateRemove, PropertyItem, text, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { FilterLine } from \"./filterline\";\r\n\r\n@Decorators.registerClass('Serenity.FilterStore')\r\nexport class FilterStore {\r\n\r\n    constructor(fields: PropertyItem[]) {\r\n\r\n        this.items = [];\r\n\r\n        if (fields == null) {\r\n            throw new ArgumentNullException('source');\r\n        }\r\n\r\n        this.fields = fields.slice();\r\n\r\n        this.get_fields().sort(function (x, y) {\r\n            var titleX = tryGetText(x.title);\r\n            if (titleX == null) {\r\n                titleX = x.title;\r\n                if (titleX == null)\r\n                    titleX = x.name;\r\n            }\r\n\r\n            var titleY = tryGetText(y.title);\r\n            if (titleY == null) {\r\n                titleY = y.title;\r\n                if (titleY == null)\r\n                    titleY = y.name;\r\n            }\r\n\r\n            return Culture.stringCompare(titleX, titleY);\r\n        });\r\n\r\n        this.fieldByName = {};\r\n\r\n        for (var field of fields) {\r\n            this.get_fieldByName()[field.name] = field;\r\n        }\r\n    }\r\n\r\n    static getCriteriaFor(items: FilterLine[]): any[] {\r\n\r\n        if (items == null)\r\n            return [''];\r\n\r\n        var inParens = false;\r\n        var currentBlock = [''];\r\n        var isBlockOr = false;\r\n        var criteria = [''];\r\n\r\n        for (var i = 0; i < items.length; i++) {\r\n            var line = items[i];\r\n\r\n            if (line.leftParen || inParens && line.rightParen) {\r\n\r\n                if (!Criteria.isEmpty(currentBlock)) {\r\n\r\n                    if (inParens)\r\n                        currentBlock = Criteria.paren(currentBlock);\r\n\r\n                    if (isBlockOr)\r\n                        criteria = Criteria.join(criteria,\r\n                            'or', currentBlock);\r\n                    else\r\n                        criteria = Criteria.join(criteria,\r\n                            'and', currentBlock);\r\n\r\n                    currentBlock = [''];\r\n                }\r\n\r\n                inParens = false;\r\n            }\r\n\r\n            if (line.leftParen) {\r\n                isBlockOr = line.isOr;\r\n                inParens = true;\r\n            }\r\n\r\n            if (line.isOr)\r\n                currentBlock = Criteria.join(currentBlock,\r\n                    'or', line.criteria);\r\n            else\r\n                currentBlock = Criteria.join(currentBlock,\r\n                    'and', line.criteria);\r\n        }\r\n\r\n        if (!Criteria.isEmpty(currentBlock)) {\r\n            if (isBlockOr)\r\n                criteria = Criteria.join(criteria,\r\n                    'or', Criteria.paren(currentBlock));\r\n            else\r\n                criteria = Criteria.join(criteria,\r\n                    'and', Criteria.paren(currentBlock));\r\n        }\r\n\r\n        return criteria;\r\n    }\r\n\r\n    static getDisplayTextFor(items: FilterLine[]): string {\r\n\r\n        if (items == null)\r\n            return '';\r\n\r\n        var inParens = false;\r\n        var displayText = '';\r\n\r\n        for (var i = 0; i < items.length; i++) {\r\n            var line = items[i];\r\n\r\n            if (inParens && (line.rightParen || line.leftParen)) {\r\n                displayText += ')';\r\n                inParens = false;\r\n            }\r\n\r\n            if (displayText.length > 0) {\r\n                displayText += ' ' + text('Controls.FilterPanel.' +\r\n                    (line.isOr ? 'Or' : 'And')) + ' ';\r\n            }\r\n\r\n            if (line.leftParen) {\r\n                displayText += '(';\r\n                inParens = true;\r\n            }\r\n\r\n            displayText += line.displayText;\r\n        }\r\n\r\n        if (inParens) {\r\n            displayText += ')';\r\n        }\r\n\r\n        return displayText;\r\n    }\r\n\r\n    private changed: any;\r\n    private displayText: string;\r\n    private fields: PropertyItem[];\r\n    private fieldByName: { [key: string]: PropertyItem }\r\n    private items: FilterLine[];\r\n\r\n    get_fields(): PropertyItem[] {\r\n        return this.fields;\r\n    }\r\n\r\n    get_fieldByName(): { [key: string]: PropertyItem } {\r\n        return this.fieldByName;\r\n    }\r\n\r\n    get_items(): FilterLine[] {\r\n        return this.items;\r\n    }\r\n\r\n    raiseChanged(): void {\r\n        this.displayText = null;\r\n        this.changed && this.changed(this, {});\r\n    }\r\n\r\n    add_changed(value: (e: JQueryEventObject, a: any) => void): void {\r\n        this.changed = delegateCombine(this.changed, value);\r\n    }\r\n\r\n    remove_changed(value: (e: JQueryEventObject, a: any) => void): void {\r\n        this.changed = delegateRemove(this.changed, value);\r\n    }\r\n\r\n    get_activeCriteria(): any[] {\r\n        return FilterStore.getCriteriaFor(this.items);\r\n    }\r\n\r\n    get_displayText(): string {\r\n        if (this.displayText == null)\r\n            this.displayText = FilterStore.getDisplayTextFor(this.items);\r\n        \r\n        return this.displayText;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { ArgumentNullException, Config, Criteria, deepClone, endsWith, Exception, extend, format, formatDate, getInstanceType, getTypeFullName, getTypeName, getTypes, isAssignableFrom, isEmptyOrNull, parseISODateTime, PropertyItem, startsWith, text, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { EditorTypeRegistry } from \"../../types/editortyperegistry\";\r\nimport { QuickFilter } from \"../datagrid/quickfilter\";\r\nimport { DateEditor } from \"../editors/dateeditor\";\r\nimport { DateTimeEditor } from \"../editors/datetimeeditor\";\r\nimport { DecimalEditor } from \"../editors/decimaleditor\";\r\nimport { EditorUtils } from \"../editors/editorutils\";\r\nimport { EnumEditor } from \"../editors/enumeditor\";\r\nimport { IntegerEditor } from \"../editors/integereditor\";\r\nimport { LookupEditor } from \"../editors/lookupeditor\";\r\nimport { ServiceLookupEditor } from \"../editors/servicelookupeditor\";\r\nimport { StringEditor } from \"../editors/stringeditor\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { FilterOperator, FilterOperators } from \"./filteroperator\";\r\n\r\nexport interface IFiltering {\r\n    createEditor(): void;\r\n    getCriteria(): CriteriaWithText;\r\n    getOperators(): FilterOperator[];\r\n    loadState(state: any): void;\r\n    saveState(): any;\r\n    get_field(): PropertyItem;\r\n    set_field(value: PropertyItem): void;\r\n    get_container(): JQuery;\r\n    set_container(value: JQuery): void;\r\n    get_operator(): FilterOperator;\r\n    set_operator(value: FilterOperator): void;\r\n}\r\n\r\n@Decorators.registerInterface('Serenity.IFiltering')\r\nexport class IFiltering {\r\n}\r\n\r\nexport interface CriteriaWithText {\r\n    criteria?: any[];\r\n    displayText?: string;\r\n}\r\n\r\nexport interface IQuickFiltering {\r\n    initQuickFilter(filter: QuickFilter<Widget<any>, any>): void;\r\n}\r\n\r\n@Decorators.registerInterface('Serenity.IQuickFiltering')\r\nexport class IQuickFiltering {\r\n}\r\n\r\n@Decorators.registerClass('Serenity.BaseFiltering', [IFiltering, IQuickFiltering])\r\nexport abstract class BaseFiltering implements IFiltering, IQuickFiltering {\r\n\r\n    private field: PropertyItem;\r\n\r\n    public get_field() {\r\n        return this.field;\r\n    }\r\n\r\n    set_field(value: PropertyItem) {\r\n        this.field = value;\r\n    }\r\n\r\n    private container: JQuery;\r\n\r\n    get_container(): JQuery {\r\n        return this.container;\r\n    }\r\n\r\n    set_container(value: JQuery) {\r\n        this.container = value;\r\n    }\r\n\r\n    private operator: FilterOperator;\r\n\r\n    get_operator() {\r\n        return this.operator;\r\n    }\r\n\r\n    set_operator(value: FilterOperator) {\r\n        this.operator = value;\r\n    }\r\n\r\n    abstract getOperators(): FilterOperator[];\r\n\r\n    protected appendNullableOperators(list: FilterOperator[]) {\r\n        if (!this.isNullable()) {\r\n            return list;\r\n        }\r\n        list.push({ key: FilterOperators.isNotNull });\r\n        list.push({ key: FilterOperators.isNull });\r\n        return list;\r\n    }\r\n\r\n    protected appendComparisonOperators(list: FilterOperator[]) {\r\n        list.push({ key: FilterOperators.EQ });\r\n        list.push({ key: FilterOperators.NE });\r\n        list.push({ key: FilterOperators.LT });\r\n        list.push({ key: FilterOperators.LE });\r\n        list.push({ key: FilterOperators.GT });\r\n        list.push({ key: FilterOperators.GE });\r\n        return list;\r\n    }\r\n\r\n    protected isNullable() {\r\n        return this.get_field().required !== true;\r\n    }\r\n\r\n    public createEditor() {\r\n        switch (this.get_operator().key) {\r\n            case 'true':\r\n            case 'false':\r\n            case 'isnull':\r\n            case 'isnotnull': {\r\n                return;\r\n            }\r\n            case 'contains':\r\n            case 'startswith':\r\n            case 'eq':\r\n            case 'ne':\r\n            case 'lt':\r\n            case 'le':\r\n            case 'gt':\r\n            case 'ge': {\r\n                this.get_container().html('<input type=\"text\"/>');\r\n                return;\r\n            }\r\n        }\r\n\r\n        throw new Exception(format(\"Filtering '{0}' has no editor for '{1}' operator\",\r\n            getTypeName(getInstanceType(this)), this.get_operator().key));\r\n    }\r\n\r\n    protected operatorFormat(op: FilterOperator) {\r\n        return op.format ?? tryGetText('Controls.FilterPanel.OperatorFormats.' + op.key) ?? op.key;\r\n    }\r\n\r\n    protected getTitle(field: PropertyItem) {\r\n        return tryGetText(field.title) ??(field.title ?? field.name);\r\n    }\r\n\r\n    protected displayText(op: FilterOperator, values?: any[]) {\r\n        if (!values || values.length === 0) {\r\n            return format(this.operatorFormat(op), this.getTitle(this.field));\r\n        }\r\n        else if (values.length === 1) {\r\n            return format(this.operatorFormat(op), this.getTitle(this.field), values[0]);\r\n        }\r\n        else {\r\n            return format(this.operatorFormat(op), this.getTitle(this.field), values[0], values[1]);\r\n        }\r\n    }\r\n\r\n    protected getCriteriaField() {\r\n        return this.field.name;\r\n    }\r\n\r\n    public getCriteria(): CriteriaWithText {\r\n        var result: CriteriaWithText = {};\r\n        var text: string;\r\n        switch (this.get_operator().key) {\r\n            case 'true': {\r\n                result.displayText = this.displayText(this.get_operator(), []);\r\n                result.criteria = [[this.getCriteriaField()], '=', true];\r\n                return result;\r\n            }\r\n\r\n            case 'false': {\r\n                result.displayText = this.displayText(this.get_operator(), []);\r\n                result.criteria = [[this.getCriteriaField()], '=', false];\r\n                return result;\r\n            }\r\n\r\n            case 'isnull': {\r\n                result.displayText = this.displayText(this.get_operator(), []);\r\n                result.criteria = ['is null', [this.getCriteriaField()]];\r\n                return result;\r\n            }\r\n\r\n            case 'isnotnull': {\r\n                result.displayText = this.displayText(this.get_operator(), []);\r\n                result.criteria = ['is not null', [this.getCriteriaField()]];\r\n                return result;\r\n            }\r\n\r\n            case 'contains': {\r\n                text = this.getEditorText();\r\n                result.displayText = this.displayText(this.get_operator(), [text]);\r\n                result.criteria = [[this.getCriteriaField()], 'like', '%' + text + '%'];\r\n                return result;\r\n            }\r\n\r\n            case 'startswith': {\r\n                text = this.getEditorText();\r\n                result.displayText = this.displayText(this.get_operator(), [text]);\r\n                result.criteria = [[this.getCriteriaField()], 'like', text + '%'];\r\n                return result;\r\n            }\r\n\r\n            case 'eq':\r\n            case 'ne':\r\n            case 'lt':\r\n            case 'le':\r\n            case 'gt':\r\n            case 'ge': {\r\n                text = this.getEditorText();\r\n                result.displayText = this.displayText(this.get_operator(), [text]);\r\n                result.criteria = [[this.getCriteriaField()], FilterOperators.toCriteriaOperator[\r\n                    this.get_operator().key], this.getEditorValue()];\r\n                return result;\r\n            }\r\n        }\r\n\r\n        throw new Exception(format(\"Filtering '{0}' has no handler for '{1}' operator\",\r\n            getTypeName(getInstanceType(this)), this.get_operator().key));\r\n    }\r\n\r\n    loadState(state: any) {\r\n        var input = this.get_container().find(':input').first();\r\n        input.val(state);\r\n    }\r\n\r\n    saveState() {\r\n        switch (this.get_operator().key) {\r\n            case 'contains':\r\n            case 'startswith':\r\n            case 'eq':\r\n            case 'ne':\r\n            case 'lt':\r\n            case 'le':\r\n            case 'gt':\r\n            case 'ge': {\r\n                var input = this.get_container().find(':input').first();\r\n                return input.val();\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    protected argumentNull() {\r\n        return new ArgumentNullException('value', text('Controls.FilterPanel.ValueRequired'));\r\n    }\r\n\r\n    validateEditorValue(value: string) {\r\n        if (value.length === 0) {\r\n            throw this.argumentNull();\r\n        }\r\n        return value;\r\n    }\r\n\r\n    getEditorValue() {\r\n        var input = this.get_container().find(':input').not('.select2-focusser').first();\r\n        if (input.length !== 1) {\r\n            throw new Exception(format(\"Couldn't find input in filter container for {0}\",\r\n                (this.field.title ?? this.field.name)));\r\n        }\r\n\r\n        var value;\r\n        if (input.data('select2') != null) {\r\n            value = input.select2('val');\r\n        }\r\n        else {\r\n            value = input.val();\r\n        }\r\n\r\n        value = (value ?? '').trim();\r\n\r\n        return this.validateEditorValue(value);\r\n    }\r\n\r\n    getEditorText() {\r\n        var input = this.get_container().find(':input').not('.select2-focusser').not('.select2-input').first();\r\n        if (input.length === 0) {\r\n            return this.get_container().text().trim();\r\n        }\r\n        var value;\r\n        if (input.data('select2') != null) {\r\n            value = (input.select2('data') ?? {}).text;\r\n        }\r\n        else {\r\n            value = input.val();\r\n        }\r\n        return value;\r\n    }\r\n\r\n    initQuickFilter(filter: QuickFilter<Widget<any>, any>) {\r\n        filter.field = this.getCriteriaField();\r\n        filter.type = StringEditor;\r\n        filter.title = this.getTitle(this.field);\r\n        filter.options = deepClone(this.get_field().quickFilterParams);\r\n    }\r\n}\r\n\r\nfunction Filtering(name: string) {\r\n    return Decorators.registerClass('Serenity.' + name + 'Filtering')\r\n}\r\n\r\n@Filtering('BaseEditor')\r\nexport abstract class BaseEditorFiltering<TEditor extends Widget<any>> extends BaseFiltering {\r\n    constructor(public editorType: any) {\r\n        super();\r\n    }\r\n\r\n    protected useEditor() {\r\n        switch (this.get_operator().key) {\r\n            case 'eq':\r\n            case 'ne':\r\n            case 'lt':\r\n            case 'le':\r\n            case 'gt':\r\n            case 'ge':\r\n                return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected editor: TEditor;\r\n\r\n    createEditor() {\r\n        if (this.useEditor()) {\r\n            this.editor = Widget.create({\r\n                type: this.editorType,\r\n                container: this.get_container(),\r\n                options: this.getEditorOptions(),\r\n                init: null\r\n            }) as any;\r\n            return;\r\n        }\r\n        this.editor = null;\r\n        super.createEditor();\r\n    }\r\n\r\n    protected useIdField() {\r\n        return false;\r\n    }\r\n\r\n    getCriteriaField() {\r\n        if (this.useEditor() &&\r\n            this.useIdField() &&\r\n            !isEmptyOrNull(this.get_field().filteringIdField)) {\r\n            return this.get_field().filteringIdField;\r\n        }\r\n\r\n        return super.getCriteriaField();\r\n    }\r\n\r\n    getEditorOptions() {\r\n        var opt = deepClone(this.get_field().editorParams || {});\r\n        delete opt['cascadeFrom'];\r\n        // currently can't support cascadeFrom in filtering\r\n        return extend(opt, this.get_field().filteringParams);\r\n    }\r\n\r\n    loadState(state: any) {\r\n        if (this.useEditor()) {\r\n            if (state == null) {\r\n                return;\r\n            }\r\n\r\n            EditorUtils.setValue(this.editor, state);\r\n            return;\r\n        }\r\n\r\n        super.loadState(state);\r\n    }\r\n\r\n    saveState() {\r\n        if (this.useEditor()) {\r\n            return EditorUtils.getValue(this.editor);\r\n        }\r\n\r\n        return super.saveState();\r\n    }\r\n\r\n    getEditorValue() {\r\n        if (this.useEditor()) {\r\n            var value = EditorUtils.getValue(this.editor);\r\n\r\n            if (value == null || (typeof value == \"string\" && value.trim().length === 0))\r\n                throw this.argumentNull();\r\n\r\n            return value;\r\n        }\r\n\r\n        return super.getEditorValue();\r\n    }\r\n\r\n    initQuickFilter(filter: QuickFilter<Widget<any>, any>) {\r\n        super.initQuickFilter(filter);\r\n\r\n        filter.type = this.editorType;\r\n        filter.options = extend(extend({}, deepClone(this.getEditorOptions())), deepClone(this.get_field().quickFilterParams));\r\n    }\r\n}\r\n\r\n@Filtering('Date')\r\nexport class DateFiltering extends BaseEditorFiltering<DateEditor> {\r\n\r\n    constructor() {\r\n        super(DateEditor)\r\n    }\r\n\r\n    getOperators(): FilterOperator[] {\r\n        return this.appendNullableOperators(this.appendComparisonOperators([]));\r\n    }\r\n}\r\n\r\n@Filtering('Boolean')\r\nexport class BooleanFiltering extends BaseFiltering {\r\n    getOperators() {\r\n        return this.appendNullableOperators([\r\n            { key: FilterOperators.isTrue },\r\n            { key: FilterOperators.isFalse }\r\n        ]);\r\n    }\r\n}\r\n\r\n@Filtering('DateTime')\r\nexport class DateTimeFiltering extends BaseEditorFiltering<DateEditor> {\r\n\r\n    constructor() {\r\n        super(DateTimeEditor)\r\n    }\r\n\r\n    getOperators(): FilterOperator[] {\r\n        return this.appendNullableOperators(\r\n            this.appendComparisonOperators([]));\r\n    }\r\n\r\n    getCriteria() {\r\n        var result: CriteriaWithText = {};\r\n\r\n        switch (this.get_operator().key) {\r\n            case 'eq':\r\n            case 'ne':\r\n            case 'lt':\r\n            case 'le':\r\n            case 'gt':\r\n            case 'ge': {\r\n                {\r\n                    var text = this.getEditorText();\r\n                    result.displayText = this.displayText(this.get_operator(), [text]);\r\n                    var date = parseISODateTime(this.getEditorValue());\r\n                    date = new Date(date.getFullYear(), date.getMonth(), date.getDate());\r\n                    var next = new Date(date.getFullYear(), date.getMonth(), date.getDate() + 1);\r\n                    var criteria = [this.getCriteriaField()];\r\n                    var dateValue = formatDate(date, 'yyyy-MM-dd');\r\n                    var nextValue = formatDate(next, 'yyyy-MM-dd');\r\n                    switch (this.get_operator().key) {\r\n                        case 'eq': {\r\n                            result.criteria = Criteria.join([criteria, '>=', dateValue], 'and', [criteria, '<', nextValue]);\r\n                            return result;\r\n                        }\r\n                        case 'ne': {\r\n                            result.criteria = Criteria.paren(Criteria.join([criteria, '<', dateValue], 'or', [criteria, '>', nextValue]));\r\n                            return result;\r\n                        }\r\n                        case 'lt': {\r\n                            result.criteria = [criteria, '<', dateValue];\r\n                            return result;\r\n                        }\r\n                        case 'le': {\r\n                            result.criteria = [criteria, '<', nextValue];\r\n                            return result;\r\n                        }\r\n                        case 'gt': {\r\n                            result.criteria = [criteria, '>=', nextValue];\r\n                            return result;\r\n                        }\r\n                        case 'ge': {\r\n                            result.criteria = [criteria, '>=', dateValue];\r\n                            return result;\r\n                        }\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return super.getCriteria();\r\n    }\r\n}\r\n\r\n@Filtering('Decimal')\r\nexport class DecimalFiltering extends BaseEditorFiltering<DecimalEditor> {\r\n    constructor() {\r\n        super(DecimalEditor);\r\n    }\r\n\r\n    getOperators(): FilterOperator[] {\r\n        return this.appendNullableOperators(\r\n            this.appendComparisonOperators([]));\r\n    }\r\n}\r\n\r\n@Filtering('Editor')\r\nexport class EditorFiltering extends BaseEditorFiltering<Widget<any>> {\r\n\r\n    constructor() {\r\n        super(Widget)\r\n    }\r\n\r\n    @Decorators.option()\r\n    editorType: string;\r\n\r\n    @Decorators.option()\r\n    useRelative: boolean;\r\n\r\n    @Decorators.option()\r\n    useLike: boolean;\r\n\r\n    getOperators(): FilterOperator[] {\r\n        var list = [];\r\n\r\n        list.push({ key: FilterOperators.EQ });\r\n        list.push({ key: FilterOperators.NE });\r\n\r\n        if (this.useRelative) {\r\n            list.push({ key: FilterOperators.LT });\r\n            list.push({ key: FilterOperators.LE });\r\n            list.push({ key: FilterOperators.GT });\r\n            list.push({ key: FilterOperators.GE });\r\n        }\r\n\r\n        if (this.useLike) {\r\n            list.push({ key: FilterOperators.contains });\r\n            list.push({ key: FilterOperators.startsWith });\r\n        }\r\n\r\n        this.appendNullableOperators(list);\r\n\r\n        return list;\r\n    }\r\n\r\n    protected useEditor() {\r\n        var op = this.get_operator().key;\r\n\r\n        return op === FilterOperators.EQ ||\r\n            op === FilterOperators.NE ||\r\n            (this.useRelative && (\r\n                op === FilterOperators.LT ||\r\n                op === FilterOperators.LE ||\r\n                op === FilterOperators.GT ||\r\n                op === FilterOperators.GE));\r\n    }\r\n\r\n    getEditorOptions() {\r\n        var opt = super.getEditorOptions();\r\n        if (this.useEditor() && this.editorType === (this.get_field().editorType ?? 'String')) {\r\n            opt = extend(opt, this.get_field().editorParams);\r\n        }\r\n\r\n        return opt;\r\n    }\r\n\r\n    createEditor() {\r\n        if (this.useEditor()) {\r\n            var editorType = EditorTypeRegistry.get(this.editorType);\r\n\r\n            this.editor = Widget.create({\r\n                type: editorType ,\r\n                element: e => e.appendTo(this.get_container()),\r\n                options: this.getEditorOptions()\r\n            });\r\n\r\n            return;\r\n        }\r\n\r\n        super.createEditor();\r\n    }\r\n\r\n    protected useIdField(): boolean {\r\n        return this.useEditor();\r\n    }\r\n\r\n    initQuickFilter(filter: QuickFilter<Widget<any>, any>) {\r\n        super.initQuickFilter(filter);\r\n\r\n        filter.type = EditorTypeRegistry.get(this.editorType);\r\n    }\r\n}\r\n\r\n@Filtering('Enum')\r\nexport class EnumFiltering extends BaseEditorFiltering<EnumEditor> {\r\n    constructor() {\r\n        super(EnumEditor);\r\n    }\r\n\r\n    getOperators() {\r\n        var op = [{ key: FilterOperators.EQ }, { key: FilterOperators.NE }];\r\n        return this.appendNullableOperators(op);\r\n    }\r\n}\r\n\r\n@Filtering('Integer')\r\nexport class IntegerFiltering extends BaseEditorFiltering<IntegerEditor> {\r\n    constructor() {\r\n        super(IntegerEditor);\r\n    }\r\n\r\n    getOperators(): FilterOperator[] {\r\n        return this.appendNullableOperators(this.appendComparisonOperators([]));\r\n    }\r\n}\r\n\r\n@Filtering('Lookup')\r\nexport class LookupFiltering extends BaseEditorFiltering<LookupEditor> {\r\n\r\n    constructor() {\r\n        super(LookupEditor);\r\n    }\r\n\r\n    getOperators(): FilterOperator[] {\r\n        var ops = [{ key: FilterOperators.EQ }, { key: FilterOperators.NE }, { key: FilterOperators.contains }, { key: FilterOperators.startsWith }]\r\n        return this.appendNullableOperators(ops);\r\n    }\r\n\r\n    protected useEditor(): boolean {\r\n        var op = this.get_operator().key;\r\n        return op == FilterOperators.EQ || op == FilterOperators.NE;\r\n    }\r\n\r\n    protected useIdField(): boolean {\r\n        return this.useEditor();\r\n    }\r\n\r\n    getEditorText(): string {\r\n        if (this.useEditor()) {\r\n            return this.editor.text;\r\n        }\r\n\r\n        return super.getEditorText();\r\n    }\r\n}\r\n\r\n@Filtering('ServiceLookup')\r\nexport class ServiceLookupFiltering extends BaseEditorFiltering<ServiceLookupEditor> {\r\n\r\n    constructor() {\r\n        super(ServiceLookupEditor);\r\n    }\r\n\r\n    getOperators(): FilterOperator[] {\r\n        var ops = [{ key: FilterOperators.EQ }, { key: FilterOperators.NE }, { key: FilterOperators.contains }, { key: FilterOperators.startsWith }]\r\n        return this.appendNullableOperators(ops);\r\n    }\r\n\r\n    protected useEditor(): boolean {\r\n        var op = this.get_operator().key;\r\n        return op == FilterOperators.EQ || op == FilterOperators.NE;\r\n    }\r\n\r\n    protected useIdField(): boolean {\r\n        return this.useEditor();\r\n    }\r\n\r\n    getEditorText(): string {\r\n        if (this.useEditor()) {\r\n            return this.editor.text;\r\n        }\r\n\r\n        return super.getEditorText();\r\n    }\r\n}\r\n\r\n@Filtering('String')\r\nexport class StringFiltering extends BaseFiltering {\r\n\r\n    getOperators(): FilterOperator[] {\r\n        var ops = [\r\n            { key: FilterOperators.contains }, \r\n            { key: FilterOperators.startsWith }, \r\n            { key: FilterOperators.EQ },\r\n            { key: FilterOperators.NE }\r\n        ];\r\n        return this.appendNullableOperators(ops);\r\n    }\r\n\r\n    validateEditorValue(value: string) {\r\n        if (value.length === 0) {\r\n            return value;\r\n        }\r\n\r\n        return super.validateEditorValue(value);\r\n    }\r\n}\r\n\r\nexport namespace FilteringTypeRegistry {\r\n\r\n    let knownTypes: { [key: string]: Function };\r\n\r\n    function initialize(): void {\r\n\r\n        if (knownTypes != null)\r\n            return;\r\n        \r\n        knownTypes = {};\r\n\r\n        for (var type of getTypes()) {\r\n            if (!isAssignableFrom(IFiltering, type))\r\n                continue;\r\n                \r\n            var fullName = getTypeFullName(type).toLowerCase();\r\n\r\n            knownTypes[fullName] = type;\r\n\r\n            for (var k of Config.rootNamespaces) {\r\n                if (startsWith(fullName, k.toLowerCase() + '.')) {\r\n                    var kx = fullName.substr(k.length + 1).toLowerCase();\r\n\r\n                    if (knownTypes[kx] == null) {\r\n                        knownTypes[kx] = type;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        setTypeKeysWithoutFilterHandlerSuffix();\r\n    }\r\n\r\n    function setTypeKeysWithoutFilterHandlerSuffix() {\r\n        var suffix = 'filtering';\r\n        \r\n        for (var k of Object.keys(knownTypes)) {\r\n            if (!endsWith(k, suffix))\r\n                continue;\r\n            \r\n            var p = k.substr(0, k.length - suffix.length);\r\n            if (isEmptyOrNull(p))\r\n                continue;\r\n\r\n            if (knownTypes[p] != null)\r\n                continue;\r\n            \r\n            knownTypes[p] = knownTypes[k];\r\n        }\r\n    }\r\n\r\n    function reset(): void {\r\n        knownTypes = null;\r\n    }\r\n\r\n    export function get(key: string): Function {\r\n\r\n        if (isEmptyOrNull(key))\r\n            throw new ArgumentNullException('key');\r\n\r\n        initialize();\r\n        var formatterType = knownTypes[key.toLowerCase()];\r\n        if (formatterType == null)\r\n            throw new Exception(format(\r\n                \"Can't find {0} filter handler type!\", key));\r\n\r\n        return formatterType;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { TemplatedWidget } from \"../widgets/templatedwidget\";\r\nimport { FilterStore } from \"./filterstore\";\r\n\r\n@Decorators.registerClass('Serenity.FilterWidgetBase')\r\nexport class FilterWidgetBase<TOptions> extends TemplatedWidget<TOptions> {\r\n    private store: FilterStore;\r\n\r\n    private onFilterStoreChanged: () => void;\r\n\r\n    constructor(div: JQuery, opt?: TOptions) {\r\n        super(div, opt);\r\n\r\n        this.store = new FilterStore([]);\r\n        this.onFilterStoreChanged = () => this.filterStoreChanged();\r\n        this.store.add_changed(this.onFilterStoreChanged);\r\n    }\r\n\r\n    destroy() {\r\n\r\n        if (this.store) {\r\n            this.store.remove_changed(this.onFilterStoreChanged);\r\n            this.onFilterStoreChanged = null;\r\n            this.store = null;\r\n        }\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    protected filterStoreChanged() {\r\n    }\r\n\r\n    get_store(): FilterStore {\r\n        return this.store;\r\n    }\r\n\r\n    set_store(value: FilterStore): void {\r\n        if (this.store !== value) {\r\n            if (this.store != null) \r\n                this.store.remove_changed(this.onFilterStoreChanged);\r\n\r\n            this.store = value || new FilterStore([]);\r\n            this.store.add_changed(this.onFilterStoreChanged);\r\n            this.filterStoreChanged();\r\n        }\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { cast, isEmptyOrNull, PropertyItem, text, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { Select2Editor } from \"../editors/select2editor\";\r\nimport { ReflectionOptionsSetter } from \"../widgets/reflectionoptionssetter\";\r\nimport { FilteringTypeRegistry, IFiltering } from \"./filtering\";\r\nimport { FilterLine } from \"./filterline\";\r\nimport { FilterOperator } from \"./filteroperator\";\r\nimport { FilterWidgetBase } from \"./filterwidgetbase\";\r\n\r\n@Decorators.registerClass('Serenity.FilterFieldSelect')\r\nclass FilterFieldSelect extends Select2Editor<any, PropertyItem> {\r\n    constructor(hidden: JQuery, fields: PropertyItem[]) {\r\n        super(hidden);\r\n\r\n        for (var field of fields) {\r\n            this.addOption(field.name, (tryGetText(field.title) ??\r\n                field.title ?? field.name), field);\r\n        }\r\n    }\r\n\r\n    emptyItemText() {\r\n        if (isEmptyOrNull(this.value)) {\r\n            return text('Controls.FilterPanel.SelectField');\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getSelect2Options() {\r\n        var opt = super.getSelect2Options();\r\n        opt.allowClear = false;\r\n        return opt;\r\n    }\r\n}\r\n\r\n@Decorators.registerClass('Serenity.FilterOperatorSelect')\r\nclass FilterOperatorSelect extends Select2Editor<any, FilterOperator> {\r\n    constructor(hidden: JQuery, source: FilterOperator[]) {\r\n        super(hidden);\r\n\r\n        for (var op of source) {\r\n            var title = (op.title ?? (\r\n                tryGetText(\"Controls.FilterPanel.OperatorNames.\" + op.key) ?? op.key));\r\n            this.addOption(op.key, title, op);\r\n        }\r\n\r\n        if (source.length && source[0])\r\n            this.value = source[0].key;\r\n    }\r\n\r\n    emptyItemText(): string {\r\n        return null;\r\n    }\r\n\r\n    getSelect2Options() {\r\n        var opt = super.getSelect2Options();\r\n        opt.allowClear = false;\r\n        return opt;\r\n    }\r\n}\r\n\r\nexport class FilterPanel extends FilterWidgetBase<any> {\r\n\r\n    private rowsDiv: JQuery;\r\n\r\n    constructor(div: JQuery) {\r\n        super(div);\r\n\r\n        this.element.addClass('s-FilterPanel');\r\n        this.rowsDiv = this.byId('Rows');\r\n        this.initButtons();\r\n        this.updateButtons();\r\n    }\r\n\r\n    private showInitialLine: boolean;\r\n\r\n    get_showInitialLine() {\r\n        return this.showInitialLine;\r\n    }\r\n\r\n    set_showInitialLine(value: boolean) {\r\n        if (this.showInitialLine !== value) {\r\n            this.showInitialLine = value;\r\n            if (this.showInitialLine && this.rowsDiv.children().length === 0) {\r\n                this.addEmptyRow(false);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected filterStoreChanged() {\r\n        super.filterStoreChanged();\r\n        this.updateRowsFromStore();\r\n    }\r\n\r\n    updateRowsFromStore() {\r\n        this.rowsDiv.empty();\r\n\r\n        var items = this.get_store().get_items();\r\n        for (var item of items) {\r\n            this.addEmptyRow(false);\r\n\r\n            var row = this.rowsDiv.children().last();\r\n\r\n            var divl = row.children('div.l');\r\n            divl.children('.leftparen').toggleClass('active', !!item.leftParen);\r\n            divl.children('.rightparen').toggleClass('active', !!item.rightParen);\r\n            divl.children('.andor').toggleClass('or', !!item.isOr)\r\n                .text(text((!!item.isOr ? 'Controls.FilterPanel.Or' :\r\n                    'Controls.FilterPanel.And')));\r\n\r\n            var fieldSelect = row.children('div.f')\r\n                .find('input.field-select').getWidget(FilterFieldSelect);\r\n\r\n            fieldSelect.value = item.field;\r\n            this.rowFieldChange(row);\r\n            var operatorSelect = row.children('div.o')\r\n                .find('input.op-select').getWidget(FilterOperatorSelect);\r\n\r\n            operatorSelect.set_value(item.operator);\r\n            this.rowOperatorChange(row);\r\n\r\n            var filtering = this.getFilteringFor(row);\r\n            if (filtering != null) {\r\n                filtering.set_operator({ key: item.operator });\r\n                filtering.loadState(item.state);\r\n            }\r\n        }\r\n\r\n        if (this.get_showInitialLine() && this.rowsDiv.children().length === 0) {\r\n            this.addEmptyRow(false);\r\n        }\r\n\r\n        this.updateParens();\r\n    }\r\n\r\n    private showSearchButton: boolean;\r\n\r\n    get_showSearchButton(): boolean {\r\n        return this.showSearchButton;\r\n    }\r\n\r\n    set_showSearchButton(value: boolean): void {\r\n        if (this.showSearchButton !== value) {\r\n            this.showSearchButton = value;\r\n            this.updateButtons();\r\n        }\r\n    }\r\n\r\n    private updateStoreOnReset: boolean;\r\n\r\n    get_updateStoreOnReset() {\r\n        return this.updateStoreOnReset;\r\n    }\r\n\r\n    set_updateStoreOnReset(value: boolean): void {\r\n        if (this.updateStoreOnReset !== value) {\r\n            this.updateStoreOnReset = value;\r\n        }\r\n    }\r\n\r\n    protected getTemplate(): string {\r\n        return \"<div id='~_Rows' class='filter-lines'>\" +\r\n            \"</div>\" +\r\n            \"<div id='~_Buttons' class='buttons'>\" +\r\n            \"<button id='~_AddButton' class='btn btn-primary add'></button>\" +\r\n            \"<button id='~_SearchButton' class='btn btn-success search'></button>\" +\r\n            \"<button id='~_ResetButton' class='btn btn-danger reset'></button>\" +\r\n            \"</div>\" +\r\n            \"<div style='clear: both'>\" +\r\n            \"</div>\"\r\n    }\r\n\r\n    protected initButtons(): void {\r\n        this.byId('AddButton').text(text('Controls.FilterPanel.AddFilter'))\r\n            .click((e) => this.addButtonClick(e));\r\n\r\n        this.byId('SearchButton').text(text('Controls.FilterPanel.SearchButton'))\r\n            .click((e) => this.searchButtonClick(e));\r\n\r\n        this.byId('ResetButton').text(text('Controls.FilterPanel.ResetButton'))\r\n            .click((e) => this.resetButtonClick(e));\r\n    }\r\n\r\n    protected searchButtonClick(e: JQueryEventObject) {\r\n        e.preventDefault();\r\n        this.search();\r\n    }\r\n\r\n    get_hasErrors(): boolean {\r\n        return this.rowsDiv.children().children('div.v')\r\n            .children('span.error').length > 0;\r\n    }\r\n\r\n    search() {\r\n        this.rowsDiv.children().children('div.v')\r\n            .children('span.error').remove();\r\n\r\n        var filterLines = [];\r\n        var errorText = null;\r\n        var row = null;\r\n        for (var i = 0; i < this.rowsDiv.children().length; i++) {\r\n            row = this.rowsDiv.children().eq(i);\r\n            var filtering = this.getFilteringFor(row);\r\n            if (filtering == null) {\r\n                continue;\r\n            }\r\n\r\n            var field = this.getFieldFor(row);\r\n            var op = row.children('div.o').find('input.op-select')\r\n                .getWidget(FilterOperatorSelect).value;\r\n\r\n            if (op == null || op.length === 0) {\r\n                errorText = text('Controls.FilterPanel.InvalidOperator');\r\n                break;\r\n            }\r\n\r\n            var line: FilterLine = {};\r\n            line.field = field.name;\r\n            line.operator = op;\r\n            line.isOr = row.children('div.l')\r\n                .children('a.andor').hasClass('or');\r\n            line.leftParen = row.children('div.l')\r\n                .children('a.leftparen').hasClass('active');\r\n            line.rightParen = row.children('div.l')\r\n                .children('a.rightparen').hasClass('active');\r\n            filtering.set_operator({ key: op });\r\n            var criteria = filtering.getCriteria();\r\n            line.criteria = criteria.criteria;\r\n            line.state = filtering.saveState();\r\n            line.displayText = criteria.displayText;\r\n            filterLines.push(line);\r\n        }\r\n\r\n        // if an error occurred, display it, otherwise set current filters\r\n        if (errorText != null) {\r\n            $('<span/>').addClass('error')\r\n                .attr('title', errorText).appendTo(row.children('div.v'));\r\n            row.children('div.v').find('input:first').focus();\r\n            return;\r\n        }\r\n\r\n        var items = this.get_store().get_items();\r\n        items.length = 0;\r\n        items.push.apply(items, filterLines);\r\n        this.get_store().raiseChanged();\r\n    }\r\n\r\n    protected addButtonClick(e: JQueryEventObject) {\r\n        this.addEmptyRow(true);\r\n        e.preventDefault();\r\n    }\r\n\r\n    protected resetButtonClick(e: JQueryEventObject) {\r\n        e.preventDefault();\r\n\r\n        if (this.get_updateStoreOnReset()) {\r\n            if (this.get_store().get_items().length > 0) {\r\n                this.get_store().get_items().length = 0;\r\n                this.get_store().raiseChanged();\r\n            }\r\n        }\r\n\r\n        this.rowsDiv.empty();\r\n        this.updateButtons();\r\n        if (this.get_showInitialLine()) {\r\n            this.addEmptyRow(false);\r\n        }\r\n    }\r\n\r\n    protected findEmptyRow(): JQuery {\r\n        var result: JQuery = null;\r\n\r\n        this.rowsDiv.children().each(function (index, row) {\r\n            var fieldInput = $(row).children('div.f')\r\n                .children('input.field-select').first();\r\n            if (fieldInput.length === 0) {\r\n                return true;\r\n            }\r\n            var val = fieldInput.val();\r\n            if (val == null || val.length === 0) {\r\n                result = $(row);\r\n                return false;\r\n            }\r\n            return true;\r\n        });\r\n\r\n        return result;\r\n    }\r\n\r\n    protected addEmptyRow(popupField: boolean): JQuery {\r\n        var emptyRow = this.findEmptyRow();\r\n\r\n        if (emptyRow != null) {\r\n            emptyRow.find('input.field-select').select2('focus');\r\n            if (popupField) {\r\n                emptyRow.find('input.field-select').select2('open');\r\n            }\r\n            return emptyRow;\r\n        }\r\n\r\n        var isLastRowOr = this.rowsDiv.children().last()\r\n            .children('a.andor').hasClass('or');\r\n\r\n        var row = $(\r\n            \"<div class='filter-line'>\" +\r\n            \"<a class='delete'><span></span></a>\" +\r\n            \"<div class='l'>\" +\r\n            \"<a class='rightparen' href='#'>)</a>\" +\r\n            \"<a class='andor' href='#'></a>\" +\r\n            \"<a class='leftparen' href='#'>(</a>\" +\r\n            \"</div>\" +\r\n            \"<div class='f'>\" +\r\n            \"<input type='hidden' class='field-select'>\" +\r\n            \"</div>\" +\r\n            \"<div class='o'></div>\" +\r\n            \"<div class='v'></div>\" +\r\n            \"<div style='clear: both'></div>\" +\r\n            \"</div>\").appendTo(this.rowsDiv);\r\n\r\n        var parenDiv = row.children('div.l').hide();\r\n\r\n        parenDiv.children('a.leftparen, a.rightparen')\r\n            .click((e) => this.leftRightParenClick(e));\r\n\r\n        var andor = parenDiv.children('a.andor').attr('title', text('Controls.FilterPanel.ChangeAndOr'));\r\n        if (isLastRowOr) {\r\n            andor.addClass('or').text(text('Controls.FilterPanel.Or'));\r\n        }\r\n        else {\r\n            andor.text(text('Controls.FilterPanel.And'));\r\n        }\r\n\r\n        andor.click((e) => this.andOrClick(e));\r\n\r\n        row.children('a.delete')\r\n            .attr('title', text('Controls.FilterPanel.RemoveField'))\r\n            .click((e) => this.deleteRowClick(e));\r\n\r\n        var fieldSel = new FilterFieldSelect(row.children('div.f')\r\n            .children('input'), this.get_store().get_fields())\r\n            .changeSelect2(e => this.onRowFieldChange(e));\r\n\r\n        this.updateParens();\r\n        this.updateButtons();\r\n\r\n        row.find('input.field-select').select2('focus');\r\n\r\n        if (popupField) {\r\n            row.find('input.field-select').select2('open');\r\n        }\r\n\r\n        return row;\r\n    }\r\n\r\n    protected onRowFieldChange(e: JQueryEventObject) {\r\n        var row = $(e.target).closest('div.filter-line');\r\n        this.rowFieldChange(row);\r\n        var opSelect = row.children('div.o').find('input.op-select');\r\n        opSelect.select2('focus');\r\n    }\r\n\r\n    protected rowFieldChange(row: JQuery) {\r\n        row.removeData('Filtering');\r\n        var select = row.children('div.f').find('input.field-select')\r\n            .getWidget(FilterFieldSelect);\r\n        var fieldName = select.get_value();\r\n        var isEmpty = fieldName == null || fieldName === '';\r\n        this.removeFiltering(row);\r\n        this.populateOperatorList(row);\r\n        this.rowOperatorChange(row);\r\n        this.updateParens();\r\n        this.updateButtons();\r\n    }\r\n\r\n    protected removeFiltering(row: JQuery): void {\r\n        row.data('Filtering', null);\r\n        row.data('FilteringField', null);\r\n    }\r\n\r\n    protected populateOperatorList(row: JQuery): void {\r\n        row.children('div.o').html('');\r\n\r\n        var filtering = this.getFilteringFor(row);\r\n        if (filtering == null)\r\n            return;\r\n\r\n        var hidden = row.children('div.o').html('<input/>')\r\n            .children().attr('type', 'hidden').addClass('op-select');\r\n\r\n        var operators = filtering.getOperators();\r\n        var opSelect = new FilterOperatorSelect(hidden, operators);\r\n        opSelect.changeSelect2(e => this.onRowOperatorChange(e));\r\n    }\r\n\r\n    protected getFieldFor(row: JQuery) {\r\n        if (row.length === 0) {\r\n            return null;\r\n        }\r\n        var select = row.children('div.f').find('input.field-select')\r\n            .getWidget(FilterFieldSelect);\r\n\r\n        if (isEmptyOrNull(select.value)) {\r\n            return null;\r\n        }\r\n\r\n        return this.get_store().get_fieldByName()[select.get_value()];\r\n    }\r\n\r\n    protected getFilteringFor(row: JQuery): IFiltering {\r\n        var field = this.getFieldFor(row);\r\n\r\n        if (field == null)\r\n            return null;\r\n\r\n        var filtering = cast(row.data('Filtering'), IFiltering);\r\n\r\n        if (filtering != null)\r\n            return filtering;\r\n\r\n        var filteringType = FilteringTypeRegistry.get(\r\n            (field.filteringType ?? 'String'));\r\n\r\n        var editorDiv = row.children('div.v');\r\n        filtering = new (filteringType as any)() as IFiltering;\r\n        ReflectionOptionsSetter.set(filtering, field.filteringParams);\r\n        filtering.set_container(editorDiv);\r\n        filtering.set_field(field);\r\n        row.data('Filtering', filtering);\r\n        return filtering;\r\n    }\r\n\r\n    protected onRowOperatorChange(e: JQueryEventObject) {\r\n        var row = $(e.target).closest('div.filter-line');\r\n        this.rowOperatorChange(row);\r\n        var firstInput = row.children('div.v').find(':input:visible').first();\r\n        try {\r\n            firstInput.focus();\r\n        }\r\n        catch ($t1) {\r\n        }\r\n    }\r\n\r\n    protected rowOperatorChange(row: JQuery): void {\r\n\r\n        if (row.length === 0) {\r\n            return;\r\n        }\r\n\r\n        var editorDiv = row.children('div.v');\r\n        editorDiv.html('');\r\n        var filtering = this.getFilteringFor(row);\r\n        if (filtering == null)\r\n            return;\r\n        \r\n        var operatorSelect = row.children('div.o').find('input.op-select')\r\n            .getWidget(FilterOperatorSelect);\r\n\r\n        if (isEmptyOrNull(operatorSelect.get_value()))\r\n            return;\r\n        \r\n        var ops = filtering.getOperators().filter(function (x) {\r\n            return x.key === operatorSelect.value;\r\n        });\r\n\r\n        var op = ((ops.length > 0) ? ops[0] : null);\r\n        if (op == null)\r\n            return;\r\n\r\n        filtering.set_operator(op);\r\n        filtering.createEditor();\r\n    }\r\n\r\n    protected deleteRowClick(e: JQueryEventObject): void {\r\n        e.preventDefault();\r\n        var row = $(e.target).closest('div.filter-line');\r\n        row.remove();\r\n\r\n        if (this.rowsDiv.children().length === 0) {\r\n            this.search();\r\n        }\r\n\r\n        this.updateParens();\r\n        this.updateButtons();\r\n    }\r\n\r\n    protected updateButtons(): void {\r\n        this.byId('SearchButton').toggle(\r\n            this.rowsDiv.children().length >= 1 && this.showSearchButton);\r\n        this.byId('ResetButton').toggle(\r\n            this.rowsDiv.children().length >= 1);\r\n    }\r\n\r\n    protected andOrClick(e: JQueryEventObject): void {\r\n        e.preventDefault();\r\n        var andor = $(e.target).toggleClass('or');\r\n        andor.text(text('Controls.FilterPanel.' +\r\n            (andor.hasClass('or') ? 'Or' : 'And')));\r\n    }\r\n\r\n    protected leftRightParenClick(e: JQueryEventObject): void {\r\n        e.preventDefault();\r\n        $(e.target).toggleClass('active');\r\n        this.updateParens();\r\n    }\r\n\r\n    protected updateParens() {\r\n        var rows = this.rowsDiv.children();\r\n        if (rows.length === 0) {\r\n            return;\r\n        }\r\n        rows.removeClass('paren-start');\r\n        rows.removeClass('paren-end');\r\n        rows.children('div.l').css('display', ((rows.length === 1) ? 'none' : 'block'));\r\n        rows.first().children('div.l').children('a.rightparen, a.andor')\r\n            .css('visibility', 'hidden');\r\n\r\n        for (var i = 1; i < rows.length; i++) {\r\n            var row = rows.eq(i);\r\n            row.children('div.l').css('display', 'block')\r\n                .children('a.lefparen, a.andor').css('visibility', 'visible');\r\n        }\r\n\r\n        var inParen = false;\r\n        for (var i1 = 0; i1 < rows.length; i1++) {\r\n            var row1 = rows.eq(i1);\r\n            var divParen = row1.children('div.l');\r\n            var lp = divParen.children('a.leftparen');\r\n            var rp = divParen.children('a.rightparen');\r\n            if (rp.hasClass('active') && inParen) {\r\n                inParen = false;\r\n                if (i1 > 0) {\r\n                    rows.eq(i1 - 1).addClass('paren-end');\r\n                }\r\n            }\r\n            if (lp.hasClass('active')) {\r\n                inParen = true;\r\n                if (i1 > 0) {\r\n                    row1.addClass('paren-start');\r\n                }\r\n            }\r\n        }\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { notifyError, text } from \"@serenity-is/corelib/q\";\r\nimport { TemplatedDialog } from \"../dialogs/templateddialog\";\r\nimport { FilterPanel } from \"./filterpanel\";\r\n\r\n@Decorators.registerClass('Serenity.FilterDialog')\r\nexport class FilterDialog extends TemplatedDialog<any> {\r\n\r\n    private filterPanel: FilterPanel;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.filterPanel = new FilterPanel(this.byId('FilterPanel'));\r\n        this.filterPanel.set_showInitialLine(true);\r\n        this.filterPanel.set_showSearchButton(false);\r\n        this.filterPanel.set_updateStoreOnReset(false);\r\n\r\n        this.dialogTitle = text('Controls.FilterPanel.DialogTitle');\r\n    }\r\n\r\n    get_filterPanel(): FilterPanel {\r\n        return this.filterPanel;\r\n    }\r\n\r\n    protected getTemplate(): string {\r\n        return '<div id=\"~_FilterPanel\"/>';\r\n    }\r\n\r\n    protected getDialogButtons() {\r\n        return [\r\n            {\r\n                text: text('Dialogs.OkButton'),\r\n                click: () => {\r\n                    this.filterPanel.search();\r\n                    if (this.filterPanel.get_hasErrors()) {\r\n                        notifyError(text('Controls.FilterPanel.FixErrorsMessage'), '', null);\r\n                        return;\r\n                    }\r\n\r\n                    this.dialogClose();\r\n                }\r\n            },\r\n            {\r\n                text: text('Dialogs.CancelButton'),\r\n                click: () => this.dialogClose()\r\n            }\r\n        ];\r\n    }\r\n}\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { text, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { FilterDialog } from \"./filterdialog\";\r\nimport { FilterWidgetBase } from \"./filterwidgetbase\";\r\n\r\n@Decorators.registerClass('Serenity.FilterDisplayBar')\r\nexport class FilterDisplayBar extends FilterWidgetBase<any> {\r\n\r\n    constructor(div: JQuery) {\r\n        super(div);\r\n\r\n        this.element.find('.cap').text(\r\n            text('Controls.FilterPanel.EffectiveFilter'));\r\n\r\n        this.element.find('.edit').text(\r\n            text('Controls.FilterPanel.EditFilter'));\r\n\r\n        this.element.find('.reset').attr('title',\r\n            text('Controls.FilterPanel.ResetFilterHint'));\r\n\r\n        var openFilterDialog = (e: JQueryEventObject) => {\r\n            e.preventDefault();\r\n            var dialog = new FilterDialog();\r\n            dialog.get_filterPanel().set_store(this.get_store());\r\n            dialog.dialogOpen(null);\r\n        };\r\n\r\n        this.element.find('.edit').click(openFilterDialog);\r\n        this.element.find('.txt').click(openFilterDialog);\r\n\r\n        this.element.find('.reset').click(e1 => {\r\n            e1.preventDefault();\r\n            this.get_store().get_items().length = 0;\r\n            this.get_store().raiseChanged();\r\n        });\r\n    }\r\n\r\n    protected filterStoreChanged() {\r\n        super.filterStoreChanged();\r\n\r\n        var displayText = trimToNull(this.get_store().get_displayText());\r\n\r\n        this.element.find('.current').toggle(displayText != null);\r\n        this.element.find('.reset').toggle(displayText != null);\r\n\r\n        if (displayText == null)\r\n            displayText = text('Controls.FilterPanel.EffectiveEmpty');\r\n\r\n        this.element.find('.txt').text('[' + displayText + ']');\r\n    }\r\n\r\n    protected getTemplate() {\r\n        return \"<div><a class='reset'></a><a class='edit'></a>\" + \r\n            \"<div class='current'><span class='cap'></span>\" +\r\n            \"<a class='txt'></a></div></div>\";\r\n    }\r\n}\r\n", "\uFEFFimport { extend, text } from \"@serenity-is/corelib/q\";\r\nimport { PagerOptions } from \"@serenity-is/corelib/slick\";\r\nimport { Widget } from \"../widgets/widget\";\r\n\r\nexport class SlickPager extends Widget<PagerOptions> {\r\n\r\n    constructor(div: JQuery, o: PagerOptions) {\r\n        super(div, extend({\r\n            showRowsPerPage: true,\r\n            rowsPerPageOptions: [20, 100, 500, 2000]\r\n        } as any, o));\r\n\r\n        o = this.options;\r\n        var v = o.view;\r\n\r\n        if (!v)\r\n            throw \"SlickPager requires view option to be set!\";\r\n\r\n        this.element.addClass('s-SlickPager slick-pg')\r\n            .html(\r\n                '<div class=\"slick-pg-in\">' + \r\n                    '<div class=\"slick-pg-grp\">' +\r\n                        '<div class=\"slick-pg-first slick-pg-btn\"><span class=\"slick-pg-btn-span\"></span></div>' + \r\n                        '<div class=\"slick-pg-prev slick-pg-btn\"><span class=\"slick-pg-btn-span\"></span></div>' + \r\n                    '</div><div class=\"slick-pg-sep\"></div><div class=\"slick-pg-grp\">' + \r\n                        '<span class=\"slick-pg-control\">&nbsp;' + text(\"Controls.Pager.Page\") +\r\n                        '&nbsp;<input class=\"slick-pg-current\" type=\"text\" size=\"4\" value=\"1\" /> / ' +\r\n                        '<span class=\"slick-pg-total\"> 1 </span></span>' + \r\n                    '</div><div class=\"slick-pg-sep\"></div><div class=\"slick-pg-grp\">' + \r\n                        '<div class=\"slick-pg-next slick-pg-btn\"><span class=\"slick-pg-btn-span\"></span></div>' + \r\n                        '<div class=\"slick-pg-last slick-pg-btn\"><span class=\"slick-pg-btn-span\"></span></div>' + \r\n                    '</div><div class=\"slick-pg-sep\"></div><div class=\"slick-pg-grp\">' + \r\n                        '<div class=\"slick-pg-reload slick-pg-btn\"><span class=\"slick-pg-btn-span\"></span></div>' + \r\n                    '</div><div class=\"slick-pg-sep\"></div>' + \r\n                    '<div class=\"slick-pg-grp\"><span class=\"slick-pg-stat\"></span></div></div>');\r\n\r\n        var self = this;\r\n        $('.slick-pg-reload', this.element).click(function () { v.populate() });\r\n        $('.slick-pg-first', this.element).click(function () { self._changePage('first') });\r\n        $('.slick-pg-prev', this.element).click(function () { self._changePage('prev') });\r\n        $('.slick-pg-next', this.element).click(function () { self._changePage('next') });\r\n        $('.slick-pg-last', this.element).click(function () { self._changePage('last') });\r\n        $('.slick-pg-current', this.element).keydown(function (e) { if (e.keyCode == 13) self._changePage('input') });\r\n\r\n        if (self.options.showRowsPerPage) {\r\n            var opt: string = \"\", sel = \"\";\r\n            for (var nx = 0; nx < o.rowsPerPageOptions.length; nx++) {\r\n                if (v.rowsPerPage == o.rowsPerPageOptions[nx]) \r\n                    sel = 'selected=\"selected\"'; else sel = '';\r\n                opt += \"<option value='\" + o.rowsPerPageOptions[nx] + \"' \" + sel + \" >\" + o.rowsPerPageOptions[nx] + \"&nbsp;&nbsp;</option>\";\r\n            };\r\n            $('.slick-pg-in', this.element).prepend('<div class=\"slick-pg-grp\"><select class=\"slick-pg-size\" name=\"rp\">' + opt + '</select></div><div class=\"slick-pg-sep\"></div>');\r\n            $('select.slick-pg-size', this.element).change(\r\n                function (this: HTMLSelectElement) {\r\n                    if (o.onRowsPerPageChange)\r\n                        o.onRowsPerPageChange(+this.value);\r\n                    else {\r\n                        v[\"newp\"] = 1;\r\n                        v.setPagingOptions({\r\n                            page: 1,\r\n                            rowsPerPage: +this.value \r\n                        });\r\n                    }\r\n                }\r\n            );\r\n        }\r\n\r\n        v.onPagingInfoChanged.subscribe(function() {\r\n            self._updatePager();\r\n        });\r\n    }\r\n\r\n    _changePage(ctype: string) { //change page\r\n\r\n        var view = this.options.view;\r\n\r\n        if (!view || view.loading)\r\n            return true;\r\n\r\n        var info = view.getPagingInfo();\r\n        var pages = (!info.rowsPerPage || !info.totalCount) ? 1 : Math.ceil(info.totalCount / info.rowsPerPage);\r\n\r\n        var newp: number;\r\n\r\n        switch (ctype) {\r\n            case 'first': newp = 1; break;\r\n            case 'prev': if (info.page > 1) newp = parseInt(info.page as any) - 1; break;\r\n            case 'next': if (info.page < pages) newp = parseInt(info.page as any) + 1; break;\r\n            case 'last': newp = pages; break;\r\n            case 'input':\r\n                var nv = parseInt($('input.slick-pg-current', this.element).val());\r\n                if (isNaN(nv)) \r\n                    nv = 1;\r\n                else if (nv < 1) \r\n                    nv = 1;\r\n                else if (nv > pages) \r\n                    nv = pages;\r\n\r\n                $('.slick-pg-current', this.element).val(nv);\r\n\r\n                newp = nv;\r\n                break;\r\n        }\r\n\r\n        if (newp == info.page)\r\n            return false;\r\n\r\n        if (this.options.onChangePage)\r\n            this.options.onChangePage(newp);\r\n        else {\r\n            view.setPagingOptions({ page: newp });\r\n        }\r\n    }\r\n\r\n    _updatePager() { \r\n\r\n        var view = this.options.view;\r\n        var info = view.getPagingInfo();\r\n        var pages = (!info.rowsPerPage || !info.totalCount) ? 1 : Math.ceil(info.totalCount / info.rowsPerPage);\r\n\r\n        $('.slick-pg-current', this.element).val(info.page);\r\n        $('.slick-pg-total', this.element).html(pages as any);\r\n\r\n        var r1 = (info.page - 1) * info.rowsPerPage + 1;\r\n        var r2 = r1 + info.rowsPerPage - 1;\r\n\r\n        if (info.totalCount < r2) \r\n            r2 = info.totalCount;\r\n\r\n        var stat: string;\r\n\r\n        if (info.loading) {\r\n            stat = text(\"Controls.Pager.LoadingStatus\");\r\n        }\r\n        else if (info.error) {\r\n            stat = info.error;\r\n        }\r\n        else if (info.totalCount > 0) {\r\n            stat = text(\"Controls.Pager.PageStatus\");\r\n            stat = stat.replace(/{from}/, <any>r1);\r\n            stat = stat.replace(/{to}/, <any>r2);\r\n            stat = stat.replace(/{total}/, <any>info.totalCount);\r\n        }\r\n        else\r\n            stat = text(\"Controls.Pager.NoRowStatus\");\r\n\r\n        $('.slick-pg-stat', this.element).html(stat);\r\n        $('.slick-pg-size', this.element).val((info.rowsPerPage || 0).toString());\r\n    }\r\n}", "\uFEFFimport { Column, FormatterContext, Grid, IPlugin } from \"@serenity-is/sleekgrid\";\r\nimport { Decorators } from \"../../decorators\";\r\nimport { attrEncode, Authorization, clearKeys, Culture, htmlEncode, isEmptyOrNull, PropertyItem, replaceAll, safeCast, SaveRequest, serviceCall, startsWith, text, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { Format, Formatter, RemoteView } from \"@serenity-is/corelib/slick\";\r\nimport { IDataGrid } from \"../datagrid/idatagrid\";\r\nimport { QuickSearchField, QuickSearchInput } from \"../datagrid/quicksearchinput\";\r\nimport { DateFormatter, EnumFormatter, FormatterTypeRegistry, IInitializeColumn, NumberFormatter } from \"../formatters/formatters\";\r\nimport { ReflectionOptionsSetter } from \"../widgets/reflectionoptionssetter\";\r\nimport { Toolbar, ToolButton } from \"../widgets/toolbar\";\r\n\r\nexport interface GridRowSelectionMixinOptions {\r\n    selectable?: (item: any) => boolean;\r\n}\r\n\r\n@Decorators.registerClass('Serenity.GridRowSelectionMixin')\r\nexport class GridRowSelectionMixin {\r\n\r\n    private idField: string;\r\n    private include: { [key: string]: boolean}\r\n    private grid: IDataGrid;\r\n    private options: GridRowSelectionMixinOptions;\r\n\r\n    constructor(grid: IDataGrid, options?: GridRowSelectionMixinOptions) {\r\n\r\n        this.include = {};\r\n        this.grid = grid;\r\n        this.idField = (grid.getView() as any).idField;\r\n        this.options = options || {};\r\n\r\n        grid.getGrid().onClick.subscribe((e, p) => {\r\n            if ($(e.target).hasClass('select-item')) {\r\n                e.preventDefault();\r\n                var item = grid.getView().getItem(p.row);\r\n                var id = item[this.idField].toString();\r\n\r\n                if (this.include[id]) {\r\n                    delete this.include[id];\r\n                }\r\n                else {\r\n                    this.include[id] = true;\r\n                }\r\n\r\n                for (var i = 0; i < (grid.getView() as any).getLength(); i++) {\r\n                    grid.getGrid().updateRow(i);\r\n                }\r\n\r\n                this.updateSelectAll();\r\n            }\r\n        });\r\n\r\n        grid.getGrid().onHeaderClick.subscribe((e1, u) => {\r\n            if (e1.isDefaultPrevented())\r\n                return;\r\n            if ($(e1.target).hasClass('select-all-items')) {\r\n                e1.preventDefault();\r\n                if (Object.keys(this.include).length > 0) {\r\n                    clearKeys(this.include);\r\n                }\r\n                else {\r\n                    var items = grid.getView().getItems();\r\n                    for (var x of items.filter(this.isSelectable.bind(this))) {\r\n                        var id1 = x[this.idField];\r\n                        this.include[id1] = true;\r\n                    }\r\n                }\r\n                this.updateSelectAll();\r\n                grid.getView().setItems(grid.getView().getItems(), true);\r\n                setTimeout(this.updateSelectAll.bind(this), 0);\r\n            }\r\n        });\r\n\r\n        (grid.getView() as any).onRowsChanged.subscribe(() => {\r\n            return this.updateSelectAll();\r\n        });\r\n    }\r\n\r\n    updateSelectAll(): void {\r\n        var selectAllButton = this.grid.getElement()\r\n            .find('.select-all-header .slick-column-name .select-all-items');\r\n\r\n        if (selectAllButton) {\r\n            var keys = Object.keys(this.include);\r\n            selectAllButton.toggleClass('checked',\r\n                keys.length > 0 &&\r\n                this.grid.getView().getItems().filter(\r\n                    this.isSelectable.bind(this)).length <= keys.length);\r\n        }\r\n    }\r\n\r\n    clear(): void {\r\n        clearKeys(this.include);\r\n        this.updateSelectAll();\r\n    }\r\n\r\n    resetCheckedAndRefresh(): void {\r\n        this.include = {};\r\n        this.updateSelectAll();\r\n        this.grid.getView().populate();\r\n    }\r\n\r\n    selectKeys(keys: string[]): void {\r\n        for (var k of keys) {\r\n            this.include[k] = true;\r\n        }\r\n\r\n        this.updateSelectAll();\r\n    }\r\n\r\n    getSelectedKeys(): string[] {\r\n        return Object.keys(this.include);\r\n    }\r\n\r\n    getSelectedAsInt32(): number[] {\r\n        return Object.keys(this.include).map(function (x) {\r\n            return parseInt(x, 10);\r\n        });\r\n    }\r\n\r\n    getSelectedAsInt64(): number[] {\r\n        return Object.keys(this.include).map(function (x) {\r\n            return parseInt(x, 10);\r\n        });\r\n    }\r\n\r\n    setSelectedKeys(keys: string[]): void {\r\n        this.clear();\r\n        for (var k of keys) {\r\n            this.include[k] = true;\r\n        }\r\n\r\n        this.updateSelectAll();\r\n    }\r\n\r\n    private isSelectable(item: any) {\r\n        return item && (\r\n            this.options.selectable == null ||\r\n            this.options.selectable(item));\r\n    }\r\n\r\n    static createSelectColumn(getMixin: () => GridRowSelectionMixin): Column {\r\n        return {\r\n            name: '<span class=\"select-all-items check-box no-float \"></span>',\r\n            nameIsHtml: true,\r\n            toolTip: ' ',\r\n            field: '__select__',\r\n            width: 27,\r\n            minWidth: 27,\r\n            headerCssClass: 'select-all-header',\r\n            sortable: false,\r\n            format: function (ctx) {\r\n                var item = ctx.item;\r\n                var mixin = getMixin();\r\n                if (!mixin || !mixin.isSelectable(item)) {\r\n                    return '';\r\n                }\r\n                var isChecked = mixin.include[ctx.item[mixin.idField]];\r\n                return '<span class=\"select-item check-box no-float ' + (isChecked ? ' checked' : '') + '\"></span>';\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nexport interface GridRadioSelectionMixinOptions {\r\n    selectable?: (item: any) => boolean;\r\n}\r\n\r\n@Decorators.registerClass('GridRadioSelectionMixin')\r\nexport class GridRadioSelectionMixin {\r\n\r\n    private idField: string;\r\n    private include: { [key: string]: boolean };\r\n    private grid: IDataGrid;\r\n    private options: GridRadioSelectionMixinOptions;\r\n\r\n    constructor(grid: IDataGrid, options?: GridRadioSelectionMixinOptions) {\r\n\r\n        this.include = {};\r\n        this.grid = grid;\r\n        this.idField = (grid.getView() as any).idField;\r\n        this.options = options || {};\r\n\r\n        grid.getGrid().onClick.subscribe((e, p) => {\r\n            if ($(e.target).hasClass('rad-select-item')) {\r\n                e.preventDefault();\r\n                var item = grid.getView().getItem(p.row);\r\n\r\n                if (!this.isSelectable(item)) {\r\n                    return;\r\n                }\r\n\r\n                var id = item[this.idField].toString();\r\n\r\n                if (this.include[id] == true) {\r\n                    clearKeys(this.include);\r\n                }\r\n                else {\r\n                    clearKeys(this.include);\r\n                    this.include[id] = true;\r\n                }\r\n\r\n                for (var i = 0; i < (grid.getView() as any).getLength(); i++) {\r\n                    grid.getGrid().updateRow(i);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private isSelectable(item: any) {\r\n        return item && (\r\n            this.options.selectable == null ||\r\n            this.options.selectable(item));\r\n    }\r\n\r\n    clear(): void {\r\n        clearKeys(this.include);\r\n    }\r\n\r\n    resetCheckedAndRefresh(): void {\r\n        this.include = {};\r\n        this.grid.getView().populate();\r\n    }\r\n\r\n    getSelectedKey(): string {\r\n        var items = Object.keys(this.include);\r\n        if (items != null && items.length > 0) {\r\n            return items[0];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getSelectedAsInt32(): number {\r\n        var items = Object.keys(this.include).map(function (x) {\r\n            return parseInt(x, 10);\r\n        });\r\n\r\n        if (items != null && items.length > 0) {\r\n            return items[0];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getSelectedAsInt64(): number {\r\n        var items = Object.keys(this.include).map(function (x) {\r\n            return parseInt(x, 10);\r\n        });\r\n\r\n        if (items != null && items.length > 0) {\r\n            return items[0];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    setSelectedKey(key: string): void {\r\n        this.clear();\r\n        this.include[key] = true;\r\n    }\r\n\r\n    static createSelectColumn(getMixin: () => GridRadioSelectionMixin): Column {\r\n        return {\r\n            name: '',\r\n            toolTip: ' ',\r\n            field: '__select__',\r\n            width: 27,\r\n            minWidth: 27,\r\n            headerCssClass: '',\r\n            sortable: false,\r\n            formatter: function (row, cell, value, column, item) {\r\n                var mixin = getMixin();\r\n                if (!mixin || !mixin.isSelectable(item)) {\r\n                    return '';\r\n                }\r\n\r\n                var isChecked = mixin.include[item[mixin.idField]];\r\n                return '<input type=\"radio\" name=\"radio-selection-group\" class=\"rad-select-item no-float\" style=\"cursor: pointer;width: 13px; height:13px;\" ' + (isChecked ? ' checked' : '') + ' /> ';\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nexport namespace GridSelectAllButtonHelper {\r\n    export function update(grid: IDataGrid, getSelected: (p1: any) => boolean): void {\r\n        var toolbar = (grid as any).element.children('.s-Toolbar') as JQuery;\r\n        if (toolbar.length === 0) {\r\n            return;\r\n        }\r\n        var btn = toolbar.getWidget(Toolbar).findButton('select-all-button');\r\n        var items = grid.getView().getItems();\r\n        btn.toggleClass('checked', items.length > 0 && !items.some(function (x) {\r\n            return !getSelected(x);\r\n        }));\r\n    }\r\n\r\n    export function define(getGrid: () => IDataGrid, getId: (p1: any) => any,\r\n        getSelected: (p1: any) => boolean,\r\n        setSelected: (p1: any, p2: boolean) => void,\r\n        text?: string, onClick?: () => void): ToolButton {\r\n\r\n        if (text == null) {\r\n            text = tryGetText('Controls.CheckTreeEditor.SelectAll') ??\r\n                'Select All';\r\n        }\r\n        return {\r\n            title: text,\r\n            cssClass: 'select-all-button',\r\n            onClick: function () {\r\n                var grid = getGrid();\r\n                var view = grid.getView();\r\n                var btn = (grid as any).element.children('.s-Toolbar')\r\n                    .getWidget(Toolbar).findButton('select-all-button');\r\n                var makeSelected = !btn.hasClass('checked');\r\n                view.beginUpdate();\r\n                try {\r\n                    for (var item of view.getItems()) {\r\n                        setSelected(item, makeSelected);\r\n                        view.updateItem(getId(item), item);\r\n                    }\r\n                    onClick && onClick();\r\n                }\r\n                finally {\r\n                    view.endUpdate();\r\n                }\r\n\r\n                btn.toggleClass('checked', makeSelected);\r\n            }\r\n        };\r\n    }\r\n}\r\n\r\nexport namespace GridUtils {\r\n    export function addToggleButton(toolDiv: JQuery, cssClass: string,\r\n        callback: (p1: boolean) => void, hint: string, initial?: boolean): void {\r\n\r\n        var div = $('<div><a href=\"#\"></a></div>')\r\n            .addClass('s-ToggleButton').addClass(cssClass)\r\n            .prependTo(toolDiv);\r\n        div.children('a').click(function (e) {\r\n            e.preventDefault();\r\n            div.toggleClass('pressed');\r\n            var pressed = div.hasClass('pressed');\r\n            callback && callback(pressed);\r\n        }).attr('title', hint ?? '');\r\n        if (initial) {\r\n            div.addClass('pressed');\r\n        }\r\n    }\r\n\r\n    export function addIncludeDeletedToggle(toolDiv: JQuery,\r\n        view: RemoteView<any>, hint?: string, initial?: boolean): void {\r\n\r\n        var includeDeleted = false;\r\n        var oldSubmit = view.onSubmit;\r\n        view.onSubmit = function (v) {\r\n            v.params.IncludeDeleted = includeDeleted;\r\n            if (oldSubmit != null) {\r\n                return oldSubmit(v);\r\n            }\r\n            return true;\r\n        };\r\n\r\n        if (hint == null) \r\n            hint = text('Controls.EntityGrid.IncludeDeletedToggle');\r\n        \r\n        addToggleButton(toolDiv, 's-IncludeDeletedToggle',\r\n            function (pressed) {\r\n                includeDeleted = pressed;\r\n                view.seekToPage = 1;\r\n                view.populate();\r\n            }, hint, initial);\r\n        toolDiv.bind('remove', function () {\r\n            view.onSubmit = null;\r\n            oldSubmit = null;\r\n        });\r\n    }\r\n\r\n    export function addQuickSearchInput(toolDiv: JQuery,\r\n        view: RemoteView<any>, fields?: QuickSearchField[], onChange?: () => void): void {\r\n\r\n        var oldSubmit = view.onSubmit;\r\n        var input: QuickSearchInput;\r\n        view.onSubmit = function (v) {\r\n            if (input) {\r\n                var searchText = input.get_value();\r\n                if (searchText && searchText.length > 0) {\r\n                    v.params.ContainsText = searchText;\r\n                }\r\n                else {\r\n                    delete v.params['ContainsText'];\r\n                }\r\n                var searchField = input.get_field()?.name;\r\n                if (searchField != null && searchField.length > 0) {\r\n                    v.params.ContainsField = searchField;\r\n                }\r\n                else {\r\n                    delete v.params['ContainsField'];\r\n                }\r\n            }\r\n\r\n            if (oldSubmit != null) \r\n                return oldSubmit(v);\r\n            \r\n            return true;\r\n        };\r\n\r\n        var lastDoneEvent: any = null;\r\n        input = addQuickSearchInputCustom(toolDiv, (field, query, done) => {\r\n            onChange && onChange();\r\n            view.seekToPage = 1;\r\n            lastDoneEvent = done;\r\n            view.populate();\r\n        }, fields);\r\n\r\n        view.onDataLoaded.subscribe(function (e, ui) {\r\n            if (lastDoneEvent != null) {\r\n                lastDoneEvent(view.getLength() > 0);\r\n                lastDoneEvent = null;\r\n            }\r\n        });\r\n    }\r\n\r\n    export function addQuickSearchInputCustom(container: JQuery,\r\n        onSearch: (p1: string, p2: string, done: (p3: boolean) => void) => void,\r\n        fields?: QuickSearchField[]): QuickSearchInput {\r\n\r\n        var div = $('<div><input type=\"text\"/></div>')\r\n            .addClass('s-QuickSearchBar').prependTo(container);\r\n\r\n        if (fields != null && fields.length > 0) {\r\n            div.addClass('has-quick-search-fields');\r\n        }\r\n\r\n        return new QuickSearchInput(div.children(), {\r\n            fields: fields,\r\n            onSearch: onSearch as any\r\n        });\r\n    }\r\n\r\n    export function makeOrderable(grid: Grid,\r\n        handleMove: (p1: any, p2: number) => void): void {\r\n\r\n        var moveRowsPlugin = new Slick.RowMoveManager({ cancelEditOnDrag: true });\r\n        moveRowsPlugin.onBeforeMoveRows.subscribe(function (e, data) {\r\n            for (var i = 0; !!(i < data.rows.length); i++) {\r\n                if (!!(data.rows[i] === data.insertBefore ||\r\n                    data.rows[i] === data.insertBefore - 1)) {\r\n                    e.stopPropagation();\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        });\r\n\r\n        moveRowsPlugin.onMoveRows.subscribe(function (e1, data1) {\r\n            handleMove(data1.rows, data1.insertBefore);\r\n            try {\r\n                grid.setSelectedRows([]);\r\n            }\r\n            catch ($t1) {\r\n            }\r\n        });\r\n        grid.registerPlugin(moveRowsPlugin);\r\n    }\r\n\r\n    export function makeOrderableWithUpdateRequest(grid: IDataGrid,\r\n        getId: (p1: any) => number, getDisplayOrder: (p1: any) => any, service: string,\r\n        getUpdateRequest: (p1: number, p2: number) => SaveRequest<any>): void {\r\n\r\n        makeOrderable(grid.getGrid(), function (rows, insertBefore) {\r\n            if (rows.length === 0) {\r\n                return;\r\n            }\r\n\r\n            var order: number;\r\n            var index = insertBefore;\r\n            if (index < 0) {\r\n                order = 1;\r\n            }\r\n            else if (insertBefore >= grid.getGrid().getDataLength()) {\r\n                order = (getDisplayOrder(grid.getGrid().getDataItem(grid.getGrid().getDataLength() - 1)) ?? 0);\r\n                if (order === 0) {\r\n                    order = insertBefore + 1;\r\n                }\r\n                else {\r\n                    order = order + 1;\r\n                }\r\n            }\r\n            else {\r\n                order = (getDisplayOrder(grid.getGrid().getDataItem(insertBefore)) ?? 0);\r\n                if (order === 0) {\r\n                    order = insertBefore + 1;\r\n                }\r\n            }\r\n\r\n            var i = 0;\r\n            var next: any = null;\r\n            next = function () {\r\n                serviceCall({\r\n                    service: service,\r\n                    request: getUpdateRequest(getId(\r\n                        grid.getGrid().getDataItem(rows[i])), order++),\r\n                    onSuccess: function (response) {\r\n                        i++;\r\n                        if (i < rows.length) {\r\n                            next();\r\n                        }\r\n                        else {\r\n                            grid.getView().populate();\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n            next();\r\n        });\r\n    }\r\n}\r\n\r\nexport namespace PropertyItemSlickConverter {\r\n\r\n    export function toSlickColumns(items: PropertyItem[]): Column[] {\r\n        var result: Column[] = [];\r\n        if (items == null) {\r\n            return result;\r\n        }\r\n        for (var i = 0; i < items.length; i++) {\r\n            result.push(PropertyItemSlickConverter.toSlickColumn(items[i]));\r\n        }\r\n        return result;\r\n    }\r\n\r\n    export function toSlickColumn(item: PropertyItem): Column {\r\n        var result: Column = {\r\n            field: item.name,\r\n            sourceItem: item,\r\n            cssClass: item.cssClass,\r\n            headerCssClass: item.headerCssClass,\r\n            sortable: item.sortable !== false,\r\n            sortOrder: item.sortOrder ?? 0,\r\n            width: item.width != null ? item.width : 80,\r\n            minWidth: item.minWidth ?? 30,\r\n            maxWidth: (item.maxWidth == null || item.maxWidth === 0) ? null : item.maxWidth,\r\n            resizable: item.resizable == null || !!item.resizable\r\n        };\r\n\r\n        result.visible = item.visible !== false && item.filterOnly !== true &&\r\n            (item.readPermission == null || Authorization.hasPermission(item.readPermission));\r\n\r\n        var name = tryGetText(item.title);\r\n        if (name == null)\r\n            name = item.title;\r\n        result.name = name;\r\n\r\n        if (item.alignment != null && item.alignment.length > 0) {\r\n            if (!isEmptyOrNull(result.cssClass)) {\r\n                result.cssClass += ' align-' + item.alignment;\r\n            }\r\n            else {\r\n                result.cssClass = 'align-' + item.alignment;\r\n            }\r\n        }\r\n\r\n        if (item.formatterType != null && item.formatterType.length > 0) {\r\n\r\n            var formatterType = FormatterTypeRegistry.get(item.formatterType) as any;\r\n            var formatter = new formatterType() as Formatter;\r\n\r\n            if (item.formatterParams != null) {\r\n                ReflectionOptionsSetter.set(formatter, item.formatterParams);\r\n            }\r\n\r\n            var initializer = safeCast(formatter, IInitializeColumn);\r\n            if (initializer != null) {\r\n                initializer.initializeColumn(result);\r\n            }\r\n\r\n            result.format = (ctx) => formatter.format(ctx);\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\nexport namespace SlickFormatting {\r\n    export function getEnumText(enumKey: string, name: string): string {\r\n        return EnumFormatter.getText(enumKey, name);\r\n    }\r\n\r\n    export function treeToggle(getView: () => RemoteView<any>, getId: (x: any) => any,\r\n        formatter: Format): Format {\r\n        return function (ctx: FormatterContext) {\r\n            var text = formatter(ctx);\r\n            var view = getView();\r\n            var indent = (ctx.item as any)._indent ?? 0;\r\n            var spacer = '<span class=\"s-TreeIndent\" style=\"width:' + 15 * indent + 'px\"></span>';\r\n            var id = getId(ctx.item);\r\n            var idx = view.getIdxById(id);\r\n            var next = view.getItemByIdx(idx + 1);\r\n            if (next != null) {\r\n                var nextIndent = next._indent ?? 0;\r\n                if (nextIndent > indent) {\r\n                    if (!!!!(ctx.item as any)._collapsed) {\r\n                        return spacer + '<span class=\"s-TreeToggle s-TreeExpand\"></span>' + text;\r\n                    }\r\n                    else {\r\n                        return spacer + '<span class=\"s-TreeToggle s-TreeCollapse\"></span>' + text;\r\n                    }\r\n                }\r\n            }\r\n            return spacer + '<span class=\"s-TreeToggle\"></span>' + text;\r\n        };\r\n    }\r\n\r\n    export function date(format?: string): Format {\r\n        if (format == null) {\r\n            format = Culture.dateFormat;\r\n        }\r\n\r\n        return function (ctx: FormatterContext) {\r\n            return htmlEncode(DateFormatter.format(ctx.value, format));\r\n        };\r\n    }\r\n\r\n    export function dateTime(format?: string): Format {\r\n        if (format == null) {\r\n            format = Culture.dateTimeFormat;\r\n        }\r\n        return function (ctx: FormatterContext) {\r\n            return htmlEncode(DateFormatter.format(ctx.value, format));\r\n        };\r\n    }\r\n\r\n    export function checkBox(): Format {\r\n        return function (ctx: FormatterContext) {\r\n            return '<span class=\"check-box no-float ' + (!!ctx.value ? ' checked' : '') + '\"></span>';\r\n        };\r\n    }\r\n\r\n    export function number(format: string): Format {\r\n        return function (ctx: FormatterContext) {\r\n            return NumberFormatter.format(ctx.value, format);\r\n        };\r\n    }\r\n\r\n    export function getItemType(link: JQuery): string {\r\n        return link.data('item-type');\r\n    }\r\n\r\n    export function getItemId(link: JQuery): string {\r\n        var value = link.data('item-id');\r\n        return value == null ? null : value.toString();\r\n    }\r\n\r\n    export function itemLinkText(itemType: string, id: any, text: any,\r\n        extraClass: string, encode: boolean): string {\r\n        return '<a' + (id != null ? (' href=\"#' + replaceAll(itemType, '.', '-') +\r\n            '/' + id + '\"') : '') + ' data-item-type=\"' +\r\n            attrEncode(itemType) + '\"' + ' data-item-id=\"' +\r\n            attrEncode(id) + '\"' + ' class=\"s-EditLink s-' +\r\n            replaceAll(itemType, '.', '-') + 'Link' +\r\n            (isEmptyOrNull(extraClass) ? '' : (' ' + extraClass)) + '\">' +\r\n            (encode ? htmlEncode(text ?? '') : text ?? '') + '</a>';\r\n    }\r\n\r\n    export function itemLink<TItem = any>(itemType: string, idField: string, getText: Format<TItem>,\r\n        cssClass?: Format<TItem>, encode?: boolean): Format<TItem> {\r\n        return function (ctx: FormatterContext<TItem>) {\r\n            var text = (getText == null ? ctx.value : getText(ctx)) ?? '';\r\n            if ((ctx.item as any)?.__nonDataRow) {\r\n                return encode ? htmlEncode(text) : text;\r\n            }\r\n\r\n            return itemLinkText(itemType, ctx.item[idField],\r\n                (getText == null ? ctx.value : getText(ctx)),\r\n                (cssClass == null ? '' : cssClass(ctx)), encode);\r\n        };\r\n    }\r\n}\r\n\r\nexport namespace SlickHelper {\r\n    export function setDefaults(columns: Column[], localTextPrefix?: string): any {\r\n        for (var col of columns) {\r\n            col.sortable = (col.sortable != null ? col.sortable : true);\r\n            var id = col.id;\r\n            if (id == null) {\r\n                id = col.field;\r\n            }\r\n            col.id = id;\r\n\r\n            if (localTextPrefix != null && col.id != null &&\r\n                (col.name == null || startsWith(col.name, '~'))) {\r\n                var key = (col.name != null ? col.name.substr(1) : col.id);\r\n                col.name = text(localTextPrefix + key);\r\n            }\r\n        }\r\n\r\n        return columns;\r\n    }\r\n}\r\n\r\nexport namespace SlickTreeHelper {\r\n    export function filterCustom<TItem>(item: TItem, getParent: (x: TItem) => any): boolean {\r\n        var parent = getParent(item);\r\n        var loop = 0;\r\n        while (parent != null) {\r\n            if (!!parent._collapsed) {\r\n                return false;\r\n            }\r\n            parent = getParent(parent);\r\n            if (loop++ > 1000) {\r\n                throw new Error(\r\n                    'Possible infinite loop, check parents has no circular reference!');\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    export function filterById<TItem>(item: TItem, view: RemoteView<TItem>,\r\n        getParentId: (x: TItem) => any): boolean {\r\n        return filterCustom(item, function (x) {\r\n            var parentId = getParentId(x);\r\n            if (parentId == null) {\r\n                return null;\r\n            }\r\n            return view.getItemById(parentId);\r\n        });\r\n    }\r\n\r\n    export function setCollapsed<TItem>(items: TItem[], collapsed: boolean): void {\r\n        if (items != null) {\r\n            for (var item of items) {\r\n                (item as any)._collapsed = collapsed;\r\n            }\r\n        }\r\n    }\r\n\r\n    export function setCollapsedFlag<TItem>(item: TItem, collapsed: boolean): void {\r\n        (item as any)._collapsed = collapsed;\r\n    }\r\n\r\n    export function setIndents<TItem>(items: TItem[], getId: (x: TItem) => any,\r\n        getParentId: (x: TItem) => any, setCollapsed?: boolean): void {\r\n        var depth = 0;\r\n        var depths = {};\r\n        for (var line = 0; line < items.length; line++) {\r\n            var item = items[line];\r\n            if (line > 0) {\r\n                var parentId = getParentId(item);\r\n                if (parentId != null && parentId === getId(items[line - 1])) {\r\n                    depth += 1;\r\n                }\r\n                else if (parentId == null) {\r\n                    depth = 0;\r\n                }\r\n                else if (parentId !== getParentId(items[line - 1])) {\r\n                    if (depths[parentId] != null) {\r\n                        depth = depths[parentId] + 1;\r\n                    }\r\n                    else {\r\n                        depth = 0;\r\n                    }\r\n                }\r\n            }\r\n            depths[getId(item)] = depth;\r\n            (item as any)._indent = depth;\r\n            if (setCollapsed != null) {\r\n                (item as any)._collapsed = setCollapsed;\r\n            }\r\n        }\r\n    }\r\n\r\n    export function toggleClick<TItem>(e: JQueryEventObject, row: number, cell: number,\r\n        view: RemoteView<TItem>, getId: (x: TItem) => any): void {\r\n        var target = $(e.target);\r\n        if (!target.hasClass('s-TreeToggle')) {\r\n            return;\r\n        }\r\n        if (target.hasClass('s-TreeCollapse') || target.hasClass('s-TreeExpand')) {\r\n            var item = view.getItem(row);\r\n            if (item != null) {\r\n                if (!!!item._collapsed) {\r\n                    item._collapsed = true;\r\n                }\r\n                else {\r\n                    item._collapsed = false;\r\n                }\r\n                view.updateItem(getId(item), item);\r\n            }\r\n            if (e.shiftKey) {\r\n                view.beginUpdate();\r\n                try {\r\n                    setCollapsed(view.getItems(), !!item._collapsed);\r\n                    view.setItems(view.getItems(), true);\r\n                }\r\n                finally {\r\n                    view.endUpdate();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}", "\uFEFFimport { Column, FormatterContext } from \"@serenity-is/sleekgrid\";\r\nimport { Decorators, EnumKeyAttribute } from \"../../decorators\";\r\nimport { ArgumentNullException, attrEncode, Config, Culture, endsWith, Enum, Exception, format, formatDate, formatNumber, getAttributes, getTypeFullName, getTypes, htmlEncode, \r\n    isAssignableFrom, isEmptyOrNull, ISlickFormatter, parseDecimal, parseISODateTime, replaceAll, resolveUrl, safeCast, startsWith, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { Formatter } from \"@serenity-is/corelib/slick\";\r\nimport { EnumTypeRegistry } from \"../../types/enumtyperegistry\";\r\n\r\nexport interface IInitializeColumn {\r\n    initializeColumn(column: Column): void;\r\n}\r\n\r\n@Decorators.registerInterface('Serenity.IInitializeColumn')\r\nexport class IInitializeColumn {\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.BooleanFormatter')\r\nexport class BooleanFormatter implements Formatter {\r\n    format(ctx: FormatterContext) {\r\n\r\n        if (ctx.value == null) {\r\n            return '';\r\n        }\r\n\r\n        var text;\r\n        if (!!ctx.value) {\r\n            text = tryGetText(this.trueText);\r\n            if (text == null) {\r\n                text = this.trueText;\r\n                if (text == null) {\r\n                    text = tryGetText('Dialogs.YesButton') ?? 'Yes';\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            text = tryGetText(this.falseText);\r\n            if (text == null) {\r\n                text = this.falseText;\r\n                if (text == null) {\r\n                    text = tryGetText('Dialogs.NoButton') ?? 'No';\r\n                }\r\n            }\r\n        }\r\n\r\n        return htmlEncode(text);\r\n    }\r\n\r\n    @Decorators.option()\r\n    public falseText: string;\r\n\r\n    @Decorators.option()\r\n    public trueText: string;\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.CheckboxFormatter')\r\nexport class CheckboxFormatter implements Formatter {\r\n    format(ctx: FormatterContext) {\r\n        return '<span class=\"check-box no-float readonly slick-edit-preclick ' + (!!ctx.value ? ' checked' : '') + '\"></span>';\r\n    }\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.DateFormatter')\r\nexport class DateFormatter implements Formatter {\r\n    constructor() {\r\n        this.displayFormat = Culture.dateFormat;\r\n    }\r\n\r\n    static format(value: any, format?: string) {\r\n        if (value == null) {\r\n            return '';\r\n        }\r\n\r\n        var date: Date;\r\n\r\n        if (value instanceof Date) {\r\n            date = value;\r\n        }\r\n        else if (typeof value === 'string') {\r\n            date = parseISODateTime(value);\r\n\r\n            if (date == null) {\r\n                return htmlEncode(value);\r\n            }\r\n        }\r\n        else {\r\n            return value.toString();\r\n        }\r\n\r\n        return htmlEncode(formatDate(date, format));\r\n    }\r\n\r\n    @Decorators.option()\r\n    public displayFormat: string;\r\n\r\n    format(ctx: FormatterContext): string {\r\n        return DateFormatter.format(ctx.value, this.displayFormat);\r\n    }\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.DateTimeFormatter')\r\nexport class DateTimeFormatter extends DateFormatter {\r\n    constructor() {\r\n        super();\r\n        this.displayFormat = Culture.dateTimeFormat;\r\n    }\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.EnumFormatter')\r\nexport class EnumFormatter implements Formatter {\r\n\r\n    format(ctx: FormatterContext): string {\r\n        return EnumFormatter.format(EnumTypeRegistry.get(this.enumKey), ctx.value);\r\n    }\r\n\r\n    @Decorators.option()\r\n    enumKey: string;\r\n\r\n    static format(enumType: any, value: any) {\r\n\r\n        if (value == null) {\r\n            return '';\r\n        }\r\n\r\n        var name = Enum.toString(enumType, value);\r\n        var enumKeyAttr = getAttributes(enumType, EnumKeyAttribute, false);\r\n        var enumKey = ((enumKeyAttr.length > 0) ? enumKeyAttr[0].value : getTypeFullName(enumType));\r\n        return EnumFormatter.getText(enumKey, name);\r\n    }\r\n\r\n    static getText(enumKey: string, name: string) {\r\n        if (isEmptyOrNull(name)) {\r\n            return '';\r\n        }\r\n\r\n        return htmlEncode(tryGetText('Enums.' + enumKey + '.' + name) ?? name);\r\n    }\r\n\r\n    static getName(enumType: any, value: any) {\r\n        if (value == null) {\r\n            return '';\r\n        }\r\n        return Enum.toString(enumType, value);\r\n    }\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.FileDownloadFormatter', [ISlickFormatter, IInitializeColumn])\r\nexport class FileDownloadFormatter implements Formatter, IInitializeColumn {\r\n\r\n    format(ctx: FormatterContext): string {\r\n        var dbFile = safeCast(ctx.value, String);\r\n        if (isEmptyOrNull(dbFile)) {\r\n            return '';\r\n        }\r\n\r\n        var downloadUrl = FileDownloadFormatter.dbFileUrl(dbFile);\r\n        var originalName = (!isEmptyOrNull(this.originalNameProperty) ?\r\n            safeCast(ctx.item[this.originalNameProperty], String) : null);\r\n\r\n        originalName = (originalName ?? '');\r\n        var text = format((this.displayFormat ?? '{0}'),\r\n            originalName, dbFile, downloadUrl);\r\n\r\n        return \"<a class='file-download-link' target='_blank' href='\" +\r\n            attrEncode(downloadUrl) + \"'>\" + htmlEncode(text) + '</a>';\r\n    }\r\n\r\n    static dbFileUrl(filename: string): string {\r\n        filename = replaceAll((filename ?? ''), '\\\\', '/');\r\n        return resolveUrl('~/upload/') + filename;\r\n    }\r\n\r\n    initializeColumn(column: Column): void {\r\n        column.referencedFields = column.referencedFields || [];\r\n        if (!isEmptyOrNull(this.originalNameProperty)) {\r\n            column.referencedFields.push(this.originalNameProperty);\r\n            return;\r\n        }\r\n    }\r\n\r\n    @Decorators.option()\r\n    displayFormat: string;\r\n\r\n    @Decorators.option()\r\n    originalNameProperty: string;\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.MinuteFormatter')\r\nexport class MinuteFormatter implements Formatter {\r\n\r\n    format(ctx: FormatterContext) {\r\n        return MinuteFormatter.format(ctx.value);\r\n    }\r\n\r\n    static format(value: number): string {\r\n        var hour = Math.floor(value / 60);\r\n        var minute = value - hour * 60;\r\n        var hourStr, minuteStr;\r\n\r\n        if (value == null || isNaN(value))\r\n            return '';\r\n\r\n        if (hour < 10)\r\n            hourStr = '0' + hour;\r\n        else\r\n            hourStr = hour.toString();\r\n\r\n        if (minute < 10)\r\n            minuteStr = '0' + minute;\r\n        else\r\n            minuteStr = minute.toString();\r\n\r\n        return format('{0}:{1}', hourStr, minuteStr);\r\n    }\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.NumberFormatter')\r\nexport class NumberFormatter {\r\n    format(ctx: FormatterContext): string {\r\n        return NumberFormatter.format(ctx.value, this.displayFormat);\r\n    }\r\n\r\n    static format(value: any, format?: string): string {\r\n        format = (format ?? '0.##');\r\n        if (value == null)\r\n            return '';\r\n\r\n        if (typeof (value) === 'number') {\r\n            if (isNaN(value))\r\n                return '';\r\n\r\n            return htmlEncode(formatNumber(value, format));\r\n        }\r\n\r\n        var dbl = parseDecimal(value.toString());\r\n        if (dbl == null)\r\n            return '';\r\n\r\n        return htmlEncode(value.toString());\r\n    }\r\n\r\n    @Decorators.option()\r\n    displayFormat: string;\r\n}\r\n\r\n@Decorators.registerFormatter('Serenity.UrlFormatter', [ISlickFormatter, IInitializeColumn])\r\nexport class UrlFormatter implements Formatter, IInitializeColumn {\r\n\r\n    format(ctx: FormatterContext): string {\r\n        var url = (!isEmptyOrNull(this.urlProperty) ?\r\n            (ctx.item[this.urlProperty] ?? '').toString() :\r\n            (ctx.value ?? '').toString());\r\n\r\n        if (isEmptyOrNull(url))\r\n            return '';\r\n\r\n        if (!isEmptyOrNull(this.urlFormat))\r\n            url = format(this.urlFormat, url);\r\n\r\n        if (url != null && startsWith(url, '~/'))\r\n            url = resolveUrl(url);\r\n\r\n        var display = (!isEmptyOrNull(this.displayProperty) ?\r\n            (ctx.item[this.displayProperty] ?? '').toString() :\r\n            (ctx.value ?? '').toString());\r\n\r\n        if (!isEmptyOrNull(this.displayFormat))\r\n            display = format(this.displayFormat, display);\r\n\r\n        var s = \"<a href='\" + attrEncode(url) + \"'\";\r\n        if (!isEmptyOrNull(this.target))\r\n            s += \" target='\" + this.target + \"'\";\r\n\r\n        s += '>' + htmlEncode(display) + '</a>';\r\n\r\n        return s;\r\n    }\r\n\r\n    initializeColumn(column: Column): void {\r\n        column.referencedFields = column.referencedFields || [];\r\n\r\n        if (!isEmptyOrNull(this.displayProperty)) {\r\n            column.referencedFields.push(this.displayProperty);\r\n            return;\r\n        }\r\n\r\n        if (!isEmptyOrNull(this.urlProperty)) {\r\n            column.referencedFields.push(this.urlProperty);\r\n            return;\r\n        }\r\n    }\r\n\r\n    @Decorators.option()\r\n    displayProperty: string;\r\n\r\n    @Decorators.option()\r\n    displayFormat: string;\r\n\r\n    @Decorators.option()\r\n    urlProperty: string;\r\n\r\n    @Decorators.option()\r\n    urlFormat: string;\r\n\r\n    @Decorators.option()\r\n    target: string;\r\n}\r\n\r\nexport namespace FormatterTypeRegistry {\r\n\r\n    let knownTypes: { [key: string]: Function };\r\n\r\n    function setTypeKeysWithoutFormatterSuffix() {\r\n        var suffix = 'formatter';\r\n        for (var k of Object.keys(knownTypes)) {\r\n            if (!endsWith(k, suffix)) \r\n                continue;\r\n            \r\n            var p = k.substr(0, k.length - suffix.length);\r\n            if (isEmptyOrNull(p))\r\n                continue;\r\n            \r\n            if (knownTypes[p] != null)\r\n                continue;\r\n            \r\n            knownTypes[p] = knownTypes[k];\r\n        }\r\n    }\r\n\r\n    function initialize() {\r\n\r\n        if (knownTypes) {\r\n            return;\r\n        }\r\n\r\n        knownTypes = {};\r\n        var types = getTypes();\r\n        for (var type of types) {\r\n            if (!isAssignableFrom(ISlickFormatter, type))\r\n                continue;\r\n                \r\n            var fullName = getTypeFullName(type).toLowerCase();\r\n            knownTypes[fullName] = type;\r\n\r\n            for (var k of Config.rootNamespaces) {\r\n                if (startsWith(fullName, k.toLowerCase() + '.')) {\r\n                    var kx = fullName.substr(k.length + 1).toLowerCase();\r\n                    if (knownTypes[kx] == null) {\r\n                        knownTypes[kx] = type;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        setTypeKeysWithoutFormatterSuffix();\r\n    }\r\n\r\n    export function get(key: string): Function {\r\n        if (isEmptyOrNull(key)) \r\n            throw new ArgumentNullException('key');\r\n        \r\n        initialize();\r\n\r\n        var formatterType = knownTypes[key.toLowerCase()];\r\n        if (formatterType == null) {\r\n            throw new Exception(format(\r\n                \"Can't find {0} formatter type!\", key));\r\n        }\r\n\r\n        return formatterType;\r\n    }\r\n\r\n    export function reset() {\r\n        knownTypes = null;\r\n    }\r\n}", "\uFEFFimport { ColumnsKeyAttribute, Decorators, FilterableAttribute, IdPropertyAttribute, IsActivePropertyAttribute, LocalTextPrefixAttribute } from \"../../decorators\";\r\nimport { IReadOnly } from \"../../interfaces\";\r\nimport { Authorization, Criteria, debounce, deepClone, endsWith, extend, getAttributes, getColumns, getColumnsAsync, getColumnsData, getColumnsDataAsync, getInstanceType, getTypeFullName, getTypeName, htmlEncode, indexOf, isEmptyOrNull, isInstanceOfType, layoutFillHeight, LayoutTimer, ListResponse, PropertyItem, PropertyItemsData, ScriptData, setEquality, startsWith, trimEnd, trimToNull, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { Format, PagerOptions, RemoteView, RemoteViewOptions } from \"@serenity-is/corelib/slick\";\r\nimport { DateEditor } from \"../editors/dateeditor\";\r\nimport { EditorUtils } from \"../editors/editorutils\";\r\nimport { SelectEditor } from \"../editors/selecteditor\";\r\nimport { FilterDisplayBar } from \"../filtering/filterdisplaybar\";\r\nimport { BooleanFiltering, DateFiltering, DateTimeFiltering, FilteringTypeRegistry, IFiltering, IQuickFiltering } from \"../filtering/filtering\";\r\nimport { FilterLine } from \"../filtering/filterline\";\r\nimport { FilterOperators } from \"../filtering/filteroperator\";\r\nimport { FilterStore } from \"../filtering/filterstore\";\r\nimport { LazyLoadHelper } from \"../helpers/lazyloadhelper\";\r\nimport { GridUtils, PropertyItemSlickConverter, SlickFormatting, SlickHelper } from \"../helpers/slickhelpers\";\r\nimport { ReflectionOptionsSetter } from \"../widgets/reflectionoptionssetter\";\r\nimport { Toolbar, ToolButton } from \"../widgets/toolbar\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { QuickFilterBar } from \"./quickfilterbar\";\r\nimport { IDataGrid } from \"./idatagrid\";\r\nimport { QuickFilter } from \"./quickfilter\";\r\nimport { QuickSearchField, QuickSearchInput } from \"./quicksearchinput\";\r\nimport { SlickPager } from \"./slickpager\";\r\nimport { Column, ColumnSort, Event, FormatterContext, Grid, GridOptions, IPlugin, ItemMetadata, Range, SelectionModel } from \"@serenity-is/sleekgrid\";\r\n\r\ndeclare global {\r\n    namespace Slick {\r\n        interface AutoTooltipsOptions {\r\n            enableForHeaderCells?: boolean;\r\n            enableForCells?: boolean;\r\n            maxToolTipLength?: number;\r\n        }\r\n        \r\n        class AutoTooltips {\r\n            constructor(options: AutoTooltipsOptions);\r\n            init(): void;\r\n        }\r\n   \r\n        namespace Data {\r\n    \r\n            interface GroupItemMetadataProvider {\r\n                getGroupRowMetadata(item: any): ItemMetadata;\r\n                getTotalsRowMetadata(item: any): ItemMetadata;\r\n            }\r\n\r\n            class GroupItemMetadataProvider implements GroupItemMetadataProvider, IPlugin {\r\n                constructor();\r\n                init(grid: Grid): void;\r\n                getGroupRowMetadata(item: any): ItemMetadata;\r\n                getTotalsRowMetadata(item: any): ItemMetadata;\r\n            }\r\n        }\r\n\r\n        interface RowMoveManagerOptions {\r\n            cancelEditOnDrag: boolean;\r\n        }\r\n    \r\n        class RowMoveManager implements IPlugin {\r\n            constructor(options: RowMoveManagerOptions);\r\n            init(): void;\r\n            onBeforeMoveRows: Event;\r\n            onMoveRows: Event;\r\n        }\r\n\r\n        class RowSelectionModel implements SelectionModel {\r\n            init(grid: Grid): void;\r\n            destroy?: () => void;\r\n            setSelectedRanges(ranges: Range[]): void;\r\n            onSelectedRangesChanged: Event<Range[]>;\r\n            refreshSelections?(): void;\r\n        }        \r\n    }\r\n}\r\n\r\nexport interface SettingStorage {\r\n    getItem(key: string): string;\r\n    setItem(key: string, value: string): void;\r\n}\r\n\r\nexport interface PersistedGridColumn {\r\n    id: string;\r\n    width?: number;\r\n    sort?: number;\r\n    visible?: boolean;\r\n}\r\n\r\nexport interface PersistedGridSettings {\r\n    columns?: PersistedGridColumn[];\r\n    filterItems?: FilterLine[];\r\n    quickFilters?: { [key: string]: any };\r\n    quickFilterText?: string;\r\n    quickSearchField?: QuickSearchField;\r\n    quickSearchText?: string;\r\n    includeDeleted?: boolean;\r\n}\r\n\r\nexport interface GridPersistanceFlags {\r\n    columnWidths?: boolean;\r\n    columnVisibility?: boolean;\r\n    sortColumns?: boolean;\r\n    filterItems?: boolean;\r\n    quickFilters?: boolean;\r\n    quickFilterText?: boolean;\r\n    quickSearch?: boolean;\r\n    includeDeleted?: boolean;\r\n}\r\n\r\n@Decorators.registerClass('Serenity.DataGrid', [IReadOnly])\r\n@Decorators.element(\"<div/>\")\r\nexport class DataGrid<TItem, TOptions> extends Widget<TOptions> implements IDataGrid, IReadOnly {\r\n\r\n    protected titleDiv: JQuery;\r\n    protected toolbar: Toolbar;\r\n    protected filterBar: FilterDisplayBar;\r\n    protected quickFiltersDiv: JQuery;\r\n    protected quickFiltersBar: QuickFilterBar;\r\n    protected slickContainer: JQuery;\r\n    protected allColumns: Column[];\r\n    protected propertyItemsData: PropertyItemsData;\r\n    protected initialSettings: PersistedGridSettings;\r\n    protected restoringSettings: number = 0;\r\n    private idProperty: string;\r\n    private isActiveProperty: string;\r\n    private localTextDbPrefix: string;\r\n    private isDisabled: boolean;\r\n    private slickGridOnSort: any;\r\n    private slickGridOnClick: any;\r\n    public view: RemoteView<TItem>;\r\n    public slickGrid: Grid;\r\n    public openDialogsAsPanel: boolean;\r\n\r\n    public static defaultRowHeight: number;\r\n    public static defaultHeaderHeight: number;\r\n    public static defaultPersistanceStorage: SettingStorage;\r\n    public static defaultColumnWidthScale: number;\r\n    public static defaultColumnWidthDelta: number;\r\n\r\n    private layoutTimer: number; \r\n\r\n    constructor(container: JQuery, options?: TOptions) {\r\n        super(container, options);\r\n\r\n        var self = this;\r\n\r\n        this.element.addClass('s-DataGrid').html('');\r\n        this.element.addClass('s-' + getTypeName(getInstanceType(this)));\r\n\r\n        var layout = function() {\r\n            self.layout();\r\n            if (self.layoutTimer != null)\r\n                LayoutTimer.store(self.layoutTimer);\r\n        }\r\n        this.element.addClass('require-layout').on('layout.' + this.uniqueName, layout);\r\n\r\n        if (this.useLayoutTimer())\r\n            this.layoutTimer = LayoutTimer.onSizeChange(() => this.element && this.element[0], debounce(layout, 50));\r\n\r\n        this.setTitle(this.getInitialTitle());\r\n\r\n        var buttons = this.getButtons();\r\n        if (buttons != null) {\r\n            this.createToolbar(buttons);\r\n        }\r\n\r\n        this.slickContainer = this.createSlickContainer();\r\n        this.view = this.createView();\r\n\r\n        if (this.useAsync())\r\n            this.initAsync();\r\n        else \r\n            this.initSync();\r\n    }\r\n\r\n    protected internalInit() {\r\n        this.allColumns = this.allColumns ?? this.getColumns();\r\n        this.slickGrid = this.createSlickGrid();\r\n\r\n        if (this.enableFiltering()) {\r\n            this.createFilterBar();\r\n        }\r\n\r\n        if (this.usePager()) {\r\n            this.createPager();\r\n        }\r\n        this.bindToSlickEvents();\r\n        this.bindToViewEvents();\r\n\r\n        if (this.toolbar) {\r\n            this.createToolbarExtensions();\r\n        }\r\n\r\n        this.createQuickFilters();\r\n\r\n        this.updateDisabledState();\r\n        this.updateInterface();\r\n\r\n        this.initialSettings = this.getCurrentSettings(null);\r\n        this.restoreSettings(null, null);\r\n\r\n        window.setTimeout(() => this.initialPopulate(), 0);   \r\n    }\r\n\r\n    protected initSync() {\r\n        this.propertyItemsData = this.getPropertyItemsData();\r\n        this.internalInit();\r\n        this.afterInit();\r\n    }\r\n\r\n    protected async initAsync() {\r\n        this.propertyItemsData = await this.getPropertyItemsDataAsync();\r\n        this.internalInit();\r\n        this.afterInit();\r\n    }\r\n\r\n    protected afterInit() {\r\n    }\r\n\r\n    protected useAsync() {\r\n        return false;\r\n    }\r\n\r\n    protected useLayoutTimer() {\r\n        return true;\r\n    }\r\n\r\n    protected attrs<TAttr>(attrType: { new(...args: any[]): TAttr }): TAttr[] {\r\n        return getAttributes(getInstanceType(this), attrType, true);\r\n    }\r\n\r\n    protected layout(): void {\r\n        if (!this.element || !this.element.is(':visible') || !this.slickContainer || !this.slickGrid)\r\n            return;\r\n\r\n        var responsiveHeight = this.element.hasClass('responsive-height');\r\n        var madeAutoHeight = this.slickGrid != null && this.slickGrid.getOptions().autoHeight;\r\n        var shouldAutoHeight = responsiveHeight && window.innerWidth < 768;\r\n\r\n        if (shouldAutoHeight) {\r\n            if (this.element[0] && this.element[0].style.height != \"auto\")\r\n                this.element[0].style.height = \"auto\";\r\n\r\n            if (!madeAutoHeight) {\r\n\r\n                this.slickContainer.css('height', 'auto')\r\n                    .children('.slick-pane').each((i, e: HTMLElement) => {\r\n                        if (e.style.height != null && e.style.height != \"auto\")\r\n                            e.style.height = \"auto\";\r\n                    });\r\n\r\n                this.slickGrid.setOptions({ autoHeight: true });\r\n            }\r\n        }\r\n        else {\r\n            if (madeAutoHeight) {\r\n                this.slickContainer.children('.slick-viewport').css('height', 'auto');\r\n                this.slickGrid.setOptions({ autoHeight: false });\r\n            }\r\n\r\n            layoutFillHeight(this.slickContainer);\r\n        }\r\n\r\n        this.slickGrid.resizeCanvas();\r\n    }\r\n\r\n    protected getInitialTitle(): string {\r\n        return null;\r\n    }\r\n\r\n    protected createToolbarExtensions(): void {\r\n    }\r\n\r\n    protected ensureQuickFilterBar(): QuickFilterBar {\r\n\r\n        if (this.quickFiltersDiv == null)\r\n            this.createQuickFilters([]);\r\n\r\n        return this.quickFiltersBar;\r\n    }\r\n\r\n    protected createQuickFilters(filters?: QuickFilter<Widget<any>, any>[]): void {\r\n\r\n        if (this.quickFiltersDiv == null && (filters != null ||\r\n            ((filters = this.getQuickFilters()) && filters != null && filters.length))) {\r\n            this.quickFiltersDiv = $('<div/>').addClass('quick-filters-bar');\r\n            if (this.toolbar) {\r\n                $('<div/>').addClass('clear').appendTo(this.toolbar.element);\r\n                this.quickFiltersDiv.appendTo(this.toolbar.element);\r\n            }\r\n            else {\r\n                this.quickFiltersDiv.appendTo($('<div/>').addClass('s-Toolbar').insertBefore(this.slickContainer));\r\n            }\r\n\r\n            this.quickFiltersBar = new QuickFilterBar(this.quickFiltersDiv, {\r\n                filters: filters,\r\n                getTitle: (filter: QuickFilter<Widget<any>, any>) => this.determineText(pre => pre + filter.field),\r\n                idPrefix: this.uniqueName + '_QuickFilter_'\r\n            });\r\n            this.quickFiltersBar.onChange = (e) => this.quickFilterChange(e);\r\n        }\r\n    }\r\n\r\n    protected getQuickFilters(): QuickFilter<Widget<any>, any>[] {\r\n        return this.allColumns.filter(function (x) {\r\n            return x.sourceItem &&\r\n                x.sourceItem.quickFilter === true &&\r\n                (x.sourceItem.readPermission == null ||\r\n                    Authorization.hasPermission(x.sourceItem.readPermission));\r\n        }).map(x => DataGrid.propertyItemToQuickFilter(x.sourceItem))\r\n            .filter(x => x != null);\r\n    }\r\n\r\n    public static propertyItemToQuickFilter(item: PropertyItem) {\r\n        var quick: any = {};\r\n\r\n        var name = item.name;\r\n        var title = tryGetText(item.title);\r\n        if (title == null) {\r\n            title = item.title;\r\n            if (title == null) {\r\n                title = name;\r\n            }\r\n        }\r\n\r\n        var filteringType = FilteringTypeRegistry.get((item.filteringType ?? 'String'));\r\n        if (filteringType === DateFiltering) {\r\n            quick = QuickFilterBar.dateRange(name, title);\r\n        }\r\n        else if (filteringType === DateTimeFiltering) {\r\n            quick = QuickFilterBar.dateTimeRange(name, title, item.editorParams?.useUtc);\r\n        }\r\n        else if (filteringType === BooleanFiltering) {\r\n            var q = item.quickFilterParams || {};\r\n            var f = item.filteringParams || {};\r\n            var trueText = q['trueText'];\r\n            if (trueText == null) {\r\n                trueText = f['trueText'];\r\n            }\r\n            var falseText = q['falseText'];\r\n            if (falseText == null) {\r\n                falseText = f['falseText'];\r\n            }\r\n            quick = QuickFilterBar.boolean(name, title, trueText, falseText);\r\n        }\r\n        else {\r\n            var filtering = new (filteringType as any)() as IFiltering;\r\n            if (filtering && isInstanceOfType(filtering, IQuickFiltering)) {\r\n                ReflectionOptionsSetter.set(filtering, item.filteringParams);\r\n                filtering.set_field(item);\r\n                filtering.set_operator({ key: FilterOperators.EQ });\r\n                (filtering as any).initQuickFilter(quick);\r\n                quick.options = extend(deepClone(quick.options), item.quickFilterParams);\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        }\r\n\r\n        if (!!item.quickFilterSeparator) {\r\n            quick.separator = true;\r\n        }\r\n\r\n        quick.cssClass = item.quickFilterCssClass;\r\n        return quick;\r\n    }\r\n\r\n    protected findQuickFilter<TWidget>(type: { new(...args: any[]): TWidget }, field: string): TWidget {\r\n        if (this.quickFiltersBar != null)\r\n            return this.quickFiltersBar.find(type, field);\r\n\r\n        return $('#' + this.uniqueName + '_QuickFilter_' + field).getWidget(type);\r\n    }\r\n\r\n    protected tryFindQuickFilter<TWidget>(type: { new(...args: any[]): TWidget }, field: string): TWidget {\r\n        if (this.quickFiltersBar != null)\r\n            return this.quickFiltersBar.tryFind(type, field);\r\n\r\n        var el = $('#' + this.uniqueName + '_QuickFilter_' + field);\r\n        if (!el.length)\r\n            return null;\r\n\r\n        return el.tryGetWidget(type);\r\n    }\r\n\r\n    protected createIncludeDeletedButton(): void {\r\n        if (!isEmptyOrNull(this.getIsActiveProperty()) ||\r\n            !isEmptyOrNull(this.getIsDeletedProperty())) {\r\n            GridUtils.addIncludeDeletedToggle(this.toolbar.element, this.view, null, false);\r\n        }\r\n    }\r\n\r\n    protected getQuickSearchFields(): QuickSearchField[] {\r\n        return null;\r\n    }\r\n\r\n    protected createQuickSearchInput(): void {\r\n        GridUtils.addQuickSearchInput(this.toolbar.element, this.view, this.getQuickSearchFields(), () => this.persistSettings(null));\r\n    }\r\n\r\n    public destroy() {\r\n        if (this.layoutTimer) {\r\n            this.layoutTimer = LayoutTimer.off(this.layoutTimer);\r\n        }\r\n        if (this.quickFiltersBar) {\r\n            this.quickFiltersBar.destroy();\r\n            this.quickFiltersBar = null;\r\n        }\r\n\r\n        if (this.toolbar) {\r\n            this.toolbar.destroy();\r\n            this.toolbar = null;\r\n        }\r\n\r\n        if (this.slickGrid) {\r\n            this.slickGrid.onClick.clear();\r\n            this.slickGrid.onSort.clear();\r\n            this.slickGrid.onColumnsResized.clear();\r\n            this.slickGrid.onColumnsReordered.clear();\r\n            this.slickGrid.destroy();\r\n            this.slickGrid = null;\r\n        }\r\n\r\n        if (this.view) {\r\n            this.view.onDataChanged.clear();\r\n            this.view.onSubmit = null;\r\n            this.view.setFilter(null);\r\n            this.view = null;\r\n        }\r\n\r\n        this.titleDiv = null;\r\n        super.destroy();\r\n    }\r\n\r\n    protected getItemCssClass(item: TItem, index: number): string {\r\n        var activeFieldName = this.getIsActiveProperty();\r\n        var deletedFieldName = this.getIsDeletedProperty();\r\n        if (isEmptyOrNull(activeFieldName) && isEmptyOrNull(deletedFieldName)) {\r\n            return null;\r\n        }\r\n\r\n        if (activeFieldName) {\r\n            var value = item[activeFieldName];\r\n            if (value == null) {\r\n                return null;\r\n            }\r\n\r\n            if (typeof (value) === 'number') {\r\n                if (value < 0) {\r\n                    return 'deleted';\r\n                }\r\n                else if (value === 0) {\r\n                    return 'inactive';\r\n                }\r\n            }\r\n            else if (typeof (value) === 'boolean') {\r\n                if (value === false) {\r\n                    return 'deleted';\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            return item[deletedFieldName] ? 'deleted' : null;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    protected getItemMetadata(item: TItem, index: number): any {\r\n        var itemClass = this.getItemCssClass(item, index);\r\n        if (isEmptyOrNull(itemClass)) {\r\n            return new Object();\r\n        }\r\n        return { cssClasses: itemClass };\r\n    }\r\n\r\n    protected postProcessColumns(columns: Column[]): Column[] {\r\n        SlickHelper.setDefaults(columns, this.getLocalTextDbPrefix());\r\n\r\n        var delta = this.getColumnWidthDelta();\r\n        var scale = this.getColumnWidthScale();\r\n        if (scale < 0)\r\n            scale = 1;\r\n        if (delta !== 0 || scale !== 1) {\r\n            for (var col of columns) {\r\n                if (typeof col.width === \"number\")\r\n                    col.width = col.width * scale + delta;\r\n                if (typeof col.minWidth === \"number\")\r\n                    col.minWidth = col.minWidth * scale + delta;\r\n                if (typeof col.maxWidth === \"number\")\r\n                    col.maxWidth = col.maxWidth * scale + delta;\r\n            }\r\n        }\r\n\r\n        return columns;\r\n    }\r\n\r\n    protected getColumnWidthDelta() {\r\n        return DataGrid.defaultColumnWidthDelta ?? 0;\r\n    }\r\n\r\n    protected getColumnWidthScale() {\r\n        return DataGrid.defaultColumnWidthScale ?? 1;\r\n    }\r\n\r\n    protected initialPopulate(): void {\r\n        var self = this;\r\n        if (this.populateWhenVisible()) {\r\n            LazyLoadHelper.executeEverytimeWhenShown(this.element, function () {\r\n                self.refreshIfNeeded();\r\n            }, false);\r\n            if (this.element.is(':visible') && this.view) {\r\n                this.view.populate();\r\n            }\r\n        }\r\n        else if (this.view) {\r\n            this.view.populate();\r\n        }\r\n    }\r\n\r\n    protected canFilterColumn(column: Column): boolean {\r\n        return (column.sourceItem != null && \r\n            column.sourceItem.notFilterable !== true &&\r\n            (column.sourceItem.readPermission == null ||\r\n                Authorization.hasPermission(column.sourceItem.readPermission)));\r\n    }\r\n\r\n    protected initializeFilterBar() {\r\n\r\n        this.filterBar.set_store(new FilterStore(\r\n            this.allColumns\r\n                .filter(c => this.canFilterColumn(c))\r\n                .map(x => x.sourceItem)));\r\n\r\n        this.filterBar.get_store().add_changed((s: JQueryEventObject, e: any) => {\r\n            if (this.restoringSettings <= 0) {\r\n                this.persistSettings(null);\r\n                this.view && (this.view.seekToPage = 1);\r\n                this.refresh();\r\n            }\r\n        });\r\n    }\r\n\r\n    protected createSlickGrid(): Grid {\r\n\r\n        var visibleColumns = this.postProcessColumns(this.allColumns).filter(function (x) {\r\n            return x.visible !== false;\r\n        });\r\n\r\n        var slickOptions = this.getSlickOptions();\r\n        var grid = new Grid(this.slickContainer, this.view as any, visibleColumns, slickOptions) as Grid;\r\n        grid.registerPlugin(new Slick.AutoTooltips({\r\n            enableForHeaderCells: true\r\n        }));\r\n\r\n        this.slickGrid = grid;\r\n        \r\n        this.setInitialSortOrder();\r\n\r\n        return grid;\r\n    }\r\n\r\n    protected setInitialSortOrder(): void {\r\n        var sortBy = this.getDefaultSortBy();\r\n\r\n        if (this.view) {\r\n            this.view.sortBy = Array.prototype.slice.call(sortBy);\r\n        }\r\n\r\n        var mapped = sortBy.map(function (s): ColumnSort {\r\n            var x: ColumnSort;\r\n            if (s && endsWith(s.toLowerCase(), ' desc')) {\r\n                return {\r\n                    columnId: trimEnd(s.substr(0, s.length - 5)),\r\n                    sortAsc: false\r\n                }\r\n            }\r\n            else return {\r\n                columnId: s,\r\n                sortAsc: true\r\n            }\r\n            return x;\r\n        });\r\n\r\n        this.slickGrid.setSortColumns(mapped);\r\n    }\r\n\r\n    itemAt(row: number): TItem {\r\n        return this.slickGrid.getDataItem(row);\r\n    }\r\n\r\n    rowCount() {\r\n        return this.slickGrid.getDataLength();\r\n    }\r\n\r\n    getItems(): TItem[] {\r\n        return this.view.getItems();\r\n    }\r\n\r\n    setItems(value: TItem[]) {\r\n        this.view.setItems(value, true);\r\n    }\r\n\r\n    protected bindToSlickEvents() {\r\n        var self = this;\r\n        this.slickGridOnSort = (e: JQuery, p: any) => {\r\n            self.view.populateLock();\r\n            try {\r\n                var sortBy = [];\r\n                var col: any;\r\n                if (!!p.multiColumnSort) {\r\n                    for (var i = 0; !!(i < p.sortCols.length); i++) {\r\n                        var x = p.sortCols[i];\r\n                        col = x.sortCol;\r\n                        if (col == null) {\r\n                            col = {};\r\n                        }\r\n                        sortBy.push(col.field + (!!x.sortAsc ? '' : ' DESC'));\r\n                    }\r\n                }\r\n                else {\r\n                    var col = p.sortCol;\r\n                    if (col == null) {\r\n                        col = {};\r\n                    }\r\n                    sortBy.push(col.field + (!!p.sortAsc ? '' : ' DESC'));\r\n                }\r\n\r\n                self.view.seekToPage = 1;\r\n                self.view.sortBy = sortBy;\r\n            }\r\n            finally {\r\n                self.view.populateUnlock();\r\n            }\r\n\r\n            if (self.view.getLocalSort && self.view.getLocalSort()) {\r\n                self.view.sort();\r\n            }\r\n            else {\r\n                self.view.populate();\r\n            }\r\n            this.persistSettings(null);\r\n        };\r\n\r\n        this.slickGrid.onSort.subscribe(this.slickGridOnSort);\r\n\r\n        this.slickGridOnClick = (e1: JQueryEventObject, p1: any) => {\r\n            self.onClick(e1, p1.row, p1.cell);\r\n        }\r\n\r\n        this.slickGrid.onClick.subscribe(this.slickGridOnClick);\r\n\r\n        this.slickGrid.onColumnsReordered.subscribe((e2: JQueryEventObject, p2: any) => {\r\n            return this.persistSettings(null);\r\n        });\r\n\r\n        this.slickGrid.onColumnsResized.subscribe((e3: JQueryEventObject, p3: any) => {\r\n            return this.persistSettings(null);\r\n        });\r\n    }\r\n\r\n    protected getAddButtonCaption(): string {\r\n        return tryGetText('Controls.DataGrid.NewButton') ?? 'New';\r\n    }\r\n\r\n    protected getButtons(): ToolButton[] {\r\n        return [];\r\n    }\r\n\r\n    protected editItem(entityOrId: any): void {\r\n        throw new Error(\"Not Implemented!\");\r\n    }\r\n\r\n    protected editItemOfType(itemType: string, entityOrId: any): void {\r\n        if (itemType === this.getItemType()) {\r\n            this.editItem(entityOrId);\r\n            return;\r\n        }\r\n\r\n        throw new Error(\"Not Implemented!\");\r\n    }\r\n\r\n    protected onClick(e: JQueryEventObject, row: number, cell: number): void {\r\n        if (e.isDefaultPrevented()) {\r\n            return;\r\n        }\r\n\r\n        var target = $(e.target);\r\n        if (!target.hasClass('s-EditLink')) {\r\n            target = target.closest('a');\r\n        }\r\n\r\n        if (target.hasClass('s-EditLink')) {\r\n            e.preventDefault();\r\n            this.editItemOfType(SlickFormatting.getItemType(target), SlickFormatting.getItemId(target));\r\n        }\r\n    }\r\n\r\n    protected viewDataChanged(e: any, rows: TItem[]): void {\r\n        this.markupReady();\r\n        this.layout();\r\n    }\r\n\r\n    protected bindToViewEvents(): void {\r\n        var self = this;\r\n\r\n        this.view.onDataChanged.subscribe(function (e, d) {\r\n            return self.viewDataChanged(e, d);\r\n        });\r\n\r\n        this.view.onSubmit = function (view) {\r\n            return self.onViewSubmit();\r\n        };\r\n\r\n        this.view.setFilter(function (item, view1) {\r\n            return self.onViewFilter(item);\r\n        });\r\n\r\n        this.view.onProcessData = function (response, view2) {\r\n            return self.onViewProcessData(response);\r\n        }\r\n    }\r\n\r\n    protected onViewProcessData(response: ListResponse<TItem>): ListResponse<TItem> {\r\n        return response;\r\n    }\r\n\r\n    protected onViewFilter(item: TItem): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected getIncludeColumns(include: { [key: string]: boolean }): void {\r\n        var columns = this.slickGrid.getColumns();\r\n        for (var column of columns) {\r\n            if (column.field) {\r\n                include[column.field] = true;\r\n            }\r\n\r\n            if (column.referencedFields) {\r\n                for (var x of column.referencedFields) {\r\n                    include[x] = true;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    protected setCriteriaParameter(): void {\r\n        delete this.view.params['Criteria'];\r\n        if (this.filterBar) {\r\n            var criteria = this.filterBar.get_store().get_activeCriteria();\r\n            if (!Criteria.isEmpty(criteria)) {\r\n                this.view.params.Criteria = criteria;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected setEquality(field: string, value: any): void {\r\n        setEquality(this.view.params, field, value);\r\n    }\r\n\r\n    protected setIncludeColumnsParameter(): void {\r\n        var include = {};\r\n        this.getIncludeColumns(include);\r\n        var array = [];\r\n        for (var key of Object.keys(include)) {\r\n            array.push(key);\r\n        }\r\n        this.view.params.IncludeColumns = array;\r\n    }\r\n\r\n    protected onViewSubmit(): boolean {\r\n        if (this.isDisabled || !this.getGridCanLoad()) {\r\n            return false;\r\n        }\r\n\r\n        this.setCriteriaParameter();\r\n        this.setIncludeColumnsParameter();\r\n        this.invokeSubmitHandlers();\r\n\r\n        return true;\r\n    }\r\n\r\n    protected markupReady(): void {\r\n    }\r\n\r\n    protected createSlickContainer(): JQuery {\r\n        return $('<div class=\"grid-container\"></div>').appendTo(this.element);\r\n    }\r\n\r\n    protected createView(): RemoteView<TItem> {\r\n        var opt = this.getViewOptions();\r\n        return new RemoteView<TItem>(opt) as any;\r\n    }\r\n\r\n    protected getDefaultSortBy(): any[] {\r\n        if (this.slickGrid) {\r\n\r\n            var columns = this.slickGrid.getColumns().filter(function (x) {\r\n                return x.sortOrder && x.sortOrder !== 0;\r\n            });\r\n\r\n            if (columns.length > 0) {\r\n                columns.sort(function (x1, y) {\r\n                    return Math.abs(x1.sortOrder) < Math.abs(y.sortOrder) ? -1 : (Math.abs(x1.sortOrder) > Math.abs(y.sortOrder) ? 1 : 0);\r\n                });\r\n\r\n                var list = [];\r\n                for (var i = 0; i < columns.length; i++) {\r\n                    var col = columns[i];\r\n                    list.push(col.field + ((col.sortOrder < 0) ? ' DESC' : ''));\r\n                }\r\n\r\n                return list;\r\n            }\r\n        }\r\n\r\n        return [];\r\n    }\r\n\r\n    protected usePager(): boolean {\r\n        return false;\r\n    }\r\n\r\n    protected enableFiltering(): boolean {\r\n        var attr = this.attrs(FilterableAttribute);\r\n        return attr.length > 0 && attr[0].value;\r\n    }\r\n\r\n    protected populateWhenVisible(): boolean {\r\n        return false;\r\n    }\r\n\r\n    protected createFilterBar(): void {\r\n        var filterBarDiv = $('<div/>').appendTo(this.element);\r\n        this.filterBar = new FilterDisplayBar(filterBarDiv);\r\n        this.initializeFilterBar();\r\n    }\r\n\r\n    protected getPagerOptions(): PagerOptions {\r\n        return {\r\n            view: this.view,\r\n            rowsPerPage: 20,\r\n            rowsPerPageOptions: [20, 100, 500, 2500]\r\n        };\r\n    }\r\n\r\n    protected createPager(): void {\r\n        var pagerDiv = $('<div></div>').appendTo(this.element);\r\n        new SlickPager(pagerDiv, this.getPagerOptions());\r\n    }\r\n\r\n    protected getViewOptions() {\r\n        var opt: RemoteViewOptions = {};\r\n        opt.idField = this.getIdProperty();\r\n        opt.sortBy = this.getDefaultSortBy();\r\n\r\n        if (!this.usePager()) {\r\n            opt.rowsPerPage = 0;\r\n        }\r\n        else if (this.element.hasClass('responsive-height')) {\r\n            opt.rowsPerPage = (($(window.window).width() < 768) ? 20 : 100);\r\n        }\r\n        else {\r\n            opt.rowsPerPage = 100;\r\n        }\r\n\r\n        opt.getItemMetadata = (item, index) => {\r\n            return this.getItemMetadata(item, index);\r\n        };\r\n\r\n        return opt;\r\n    }\r\n\r\n    protected createToolbar(buttons: ToolButton[]): void {\r\n        var toolbarDiv = $('<div class=\"grid-toolbar\"></div>').appendTo(this.element);\r\n        this.toolbar = new Toolbar(toolbarDiv, { buttons: buttons, hotkeyContext: this.element[0] });\r\n    }\r\n\r\n    getTitle(): string {\r\n        if (!this.titleDiv) {\r\n            return null;\r\n        }\r\n\r\n        return this.titleDiv.children('.title-text').text();\r\n    }\r\n\r\n    setTitle(value: string) {\r\n        if (value !== this.getTitle()) {\r\n            if (value == null) {\r\n                if (this.titleDiv) {\r\n                    this.titleDiv.remove();\r\n                    this.titleDiv = null;\r\n                }\r\n            }\r\n            else {\r\n                if (!this.titleDiv) {\r\n                    this.titleDiv = $('<div class=\"grid-title\"><div class=\"title-text\"></div></div>')\r\n                        .prependTo(this.element);\r\n                }\r\n                this.titleDiv.children('.title-text').text(value);\r\n            }\r\n\r\n            this.layout();\r\n        }\r\n    }\r\n\r\n    protected getItemType(): string {\r\n        return 'Item';\r\n    }\r\n\r\n    protected itemLink(itemType?: string, idField?: string, text?: (ctx: FormatterContext) => string,\r\n        cssClass?: (ctx: FormatterContext) => string, encode: boolean = true): Format<TItem> {\r\n\r\n        if (itemType == null) {\r\n            itemType = this.getItemType();\r\n        }\r\n\r\n        if (idField == null) {\r\n            idField = this.getIdProperty();\r\n        }\r\n\r\n        return SlickFormatting.itemLink(itemType, idField, text, cssClass, encode);\r\n    }\r\n\r\n    protected getColumnsKey(): string {\r\n        var attr = this.attrs(ColumnsKeyAttribute);\r\n        if (attr && attr.length > 0) {\r\n            return attr[0].value;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    protected getPropertyItems() {\r\n        return this.propertyItemsData?.items || [];\r\n    }\r\n\r\n    protected getPropertyItemsData(): PropertyItemsData {\r\n        var columnsKey = this.getColumnsKey();\r\n\r\n        if (this.getColumnsKey === DataGrid.prototype.getColumnsKey &&\r\n            this.getPropertyItems !== DataGrid.prototype.getPropertyItems &&\r\n            !ScriptData.canLoad('Columns.' + columnsKey)) {\r\n            return {\r\n                items: this.getPropertyItems(),\r\n                additionalItems: []\r\n            }\r\n        }\r\n\r\n\r\n        if (!isEmptyOrNull(columnsKey)) {\r\n            return getColumnsData(columnsKey);\r\n        }\r\n\r\n        return { items: [], additionalItems: [] };\r\n    }\r\n\r\n    protected async getPropertyItemsDataAsync(): Promise<PropertyItemsData> {\r\n        var columnsKey = this.getColumnsKey();\r\n        if (!isEmptyOrNull(columnsKey)) {\r\n            return await getColumnsDataAsync(columnsKey);\r\n        }\r\n\r\n        return { items: [], additionalItems: [] };\r\n    }\r\n\r\n    protected getColumns(): Column[] {\r\n        return this.propertyItemsToSlickColumns(this.getPropertyItems());\r\n    }\r\n\r\n    protected propertyItemsToSlickColumns(propertyItems: PropertyItem[]): Column[] {\r\n        var columns = PropertyItemSlickConverter.toSlickColumns(propertyItems);\r\n        for (var i = 0; i < propertyItems.length; i++) {\r\n            var item = propertyItems[i];\r\n            var column = columns[i];\r\n            if (item.editLink === true) {\r\n                var oldFormat = { $: column.format };\r\n                var css = { $: (item.editLinkCssClass) != null ? item.editLinkCssClass : null };\r\n                column.format = this.itemLink(\r\n                    item.editLinkItemType != null ? item.editLinkItemType : null,\r\n                    item.editLinkIdField != null ? item.editLinkIdField : null,\r\n                    function(ctx: FormatterContext) {\r\n                        if (this.oldFormat.$ != null) {\r\n                            return this.oldFormat.$(ctx);\r\n                        }\r\n                        return htmlEncode(ctx.value);\r\n                    }.bind({ oldFormat: oldFormat }),\r\n                    function(ctx1: FormatterContext) {\r\n                        return (this.css.$ ?? '');\r\n                    }.bind({ css: css }), false);\r\n\r\n                if (!isEmptyOrNull(item.editLinkIdField)) {\r\n                    column.referencedFields = column.referencedFields || [];\r\n                    column.referencedFields.push(item.editLinkIdField);\r\n                }\r\n            }\r\n        }\r\n        return columns;\r\n    }\r\n\r\n    protected getSlickOptions(): GridOptions {\r\n        var opt: GridOptions = {};\r\n        opt.multiSelect = false;\r\n        opt.multiColumnSort = true;\r\n        opt.enableCellNavigation = false;\r\n        if (DataGrid.defaultHeaderHeight)\r\n            opt.headerRowHeight = DataGrid.defaultHeaderHeight;\r\n        if (DataGrid.defaultRowHeight)\r\n            opt.rowHeight = DataGrid.defaultRowHeight;\r\n        return opt;\r\n    }\r\n\r\n    protected populateLock(): void {\r\n        this.view.populateLock();\r\n    }\r\n\r\n    protected populateUnlock(): void {\r\n        this.view.populateUnlock();\r\n    }\r\n\r\n    protected getGridCanLoad(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public refresh() {\r\n        if (!this.populateWhenVisible()) {\r\n            this.internalRefresh();\r\n            return;\r\n        }\r\n        if (this.slickContainer.is(':visible')) {\r\n            this.slickContainer.data('needsRefresh', false);\r\n            this.internalRefresh();\r\n            return;\r\n        }\r\n        this.slickContainer.data('needsRefresh', true);\r\n    }\r\n\r\n    protected refreshIfNeeded(): void {\r\n        if (!!this.slickContainer.data('needsRefresh')) {\r\n            this.slickContainer.data('needsRefresh', false);\r\n            this.internalRefresh();\r\n        }\r\n    }\r\n\r\n    protected internalRefresh(): void {\r\n        this.view.populate();\r\n    }\r\n\r\n    public setIsDisabled(value: boolean): void {\r\n        if (this.isDisabled !== value) {\r\n            this.isDisabled = value;\r\n            if (this.isDisabled) {\r\n                this.view.setItems([], true);\r\n            }\r\n\r\n            this.updateDisabledState();\r\n        }\r\n    }\r\n\r\n    private _readonly: boolean;\r\n\r\n    public get readOnly(): boolean {\r\n        return this.get_readOnly();\r\n    }\r\n\r\n    public set readOnly(value: boolean) {\r\n        this.set_readOnly(value);\r\n    }\r\n\r\n    public get_readOnly() {\r\n        return !!this._readonly;\r\n    }\r\n\r\n    public set_readOnly(value: boolean) {\r\n        if (!!this._readonly != !!value) {\r\n            this._readonly = !!value;\r\n            this.updateInterface();\r\n        }\r\n    }\r\n\r\n    protected updateInterface() {\r\n        this.toolbar && this.toolbar.updateInterface();\r\n    }\r\n\r\n    protected getLocalTextDbPrefix(): string {\r\n        if (this.localTextDbPrefix == null) {\r\n            this.localTextDbPrefix = this.getLocalTextPrefix() ?? '';\r\n            if (this.localTextDbPrefix.length > 0 && !endsWith(this.localTextDbPrefix, '.')) {\r\n                this.localTextDbPrefix = 'Db.' + this.localTextDbPrefix + '.';\r\n            }\r\n        }\r\n\r\n        return this.localTextDbPrefix;\r\n    }\r\n\r\n    protected getLocalTextPrefix(): string {\r\n        var attr = this.attrs(LocalTextPrefixAttribute);\r\n\r\n        if (attr.length >= 1)\r\n            return attr[0].value;\r\n\r\n        return '';\r\n    }\r\n\r\n    protected getIdProperty(): string {\r\n        if (this.idProperty == null) {\r\n            var attr = this.attrs(IdPropertyAttribute);\r\n\r\n            if (attr.length === 1) {\r\n                this.idProperty = attr[0].value;\r\n            }\r\n            else {\r\n                this.idProperty = 'ID';\r\n            }\r\n        }\r\n\r\n        return this.idProperty;\r\n    }\r\n\r\n    protected getIsDeletedProperty(): string {\r\n        return null;\r\n    }\r\n\r\n    protected getIsActiveProperty(): string {\r\n        if (this.isActiveProperty == null) {\r\n            var attr = this.attrs(IsActivePropertyAttribute);\r\n\r\n            if (attr.length === 1) {\r\n                this.isActiveProperty = attr[0].value;\r\n            }\r\n            else {\r\n                this.isActiveProperty = '';\r\n            }\r\n        }\r\n        return this.isActiveProperty;\r\n    }\r\n\r\n    protected updateDisabledState(): void {\r\n        this.slickContainer.toggleClass('ui-state-disabled', !!this.isDisabled);\r\n    }\r\n\r\n    protected resizeCanvas(): void {\r\n        this.slickGrid?.resizeCanvas();\r\n    }\r\n\r\n    protected subDialogDataChange(): void {\r\n        this.refresh();\r\n    }\r\n\r\n    protected addFilterSeparator(): void {\r\n        this.ensureQuickFilterBar().addSeparator();\r\n    }\r\n\r\n    protected determineText(getKey: (prefix: string) => string) {\r\n        var localTextPrefix = this.getLocalTextDbPrefix();\r\n        if (!isEmptyOrNull(localTextPrefix)) {\r\n            var local = tryGetText(getKey(localTextPrefix));\r\n            if (local != null) {\r\n                return local;\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    protected addQuickFilter<TWidget extends Widget<any>, TOptions>(opt: QuickFilter<TWidget, TOptions>): TWidget {\r\n        return this.ensureQuickFilterBar().add(opt);\r\n    }\r\n\r\n    protected addDateRangeFilter(field: string, title?: string): DateEditor {\r\n        return this.ensureQuickFilterBar().addDateRange(field, title);\r\n    }\r\n\r\n    protected dateRangeQuickFilter(field: string, title?: string) {\r\n        return QuickFilterBar.dateRange(field, title);\r\n    }\r\n\r\n    protected addDateTimeRangeFilter(field: string, title?: string) {\r\n        return this.ensureQuickFilterBar().addDateTimeRange(field, title);\r\n    }\r\n\r\n    protected dateTimeRangeQuickFilter(field: string, title?: string) {\r\n        return QuickFilterBar.dateTimeRange(field, title);\r\n    }\r\n\r\n    protected addBooleanFilter(field: string, title?: string, yes?: string, no?: string): SelectEditor {\r\n        return this.ensureQuickFilterBar().addBoolean(field, title, yes, no);\r\n    }\r\n\r\n    protected booleanQuickFilter(field: string, title?: string, yes?: string, no?: string) {\r\n        return QuickFilterBar.boolean(field, title, yes, no);\r\n    }\r\n\r\n    protected invokeSubmitHandlers() {\r\n        if (this.quickFiltersBar != null) {\r\n            this.quickFiltersBar.onSubmit(this.view.params);\r\n        }\r\n    }\r\n\r\n    protected quickFilterChange(e: JQueryEventObject) {\r\n        this.persistSettings(null);\r\n        this.view && (this.view.seekToPage = 1);\r\n        this.refresh();\r\n    }\r\n\r\n    protected getPersistanceStorage(): SettingStorage {\r\n        return DataGrid.defaultPersistanceStorage;\r\n    }\r\n\r\n    protected getPersistanceKey(): string {\r\n        var key = 'GridSettings:';\r\n        var path = window.location.pathname;\r\n        if (!isEmptyOrNull(path)) {\r\n            key += path.substr(1).split(String.fromCharCode(47)).slice(0, 2).join('/') + ':';\r\n        }\r\n\r\n        key += getTypeFullName(getInstanceType(this));\r\n        return key;\r\n    }\r\n\r\n    protected gridPersistanceFlags(): GridPersistanceFlags {\r\n        return {};\r\n    }\r\n\r\n    protected canShowColumn(column: Column) {\r\n        if (column == null) {\r\n            return false;\r\n        }\r\n\r\n        var item = column.sourceItem;\r\n        if (item == null) {\r\n            return true;\r\n        }\r\n\r\n        if (item.filterOnly === true) {\r\n            return false;\r\n        }\r\n\r\n        if (item.readPermission == null) {\r\n            return true;\r\n        }\r\n\r\n        return Authorization.hasPermission(item.readPermission);\r\n    }\r\n\r\n    protected getPersistedSettings(): PersistedGridSettings {\r\n        var storage = this.getPersistanceStorage();\r\n        if (storage == null)\r\n            return null;\r\n\r\n        var json = trimToNull(storage.getItem(this.getPersistanceKey()));\r\n        if (json != null && startsWith(json, '{') && endsWith(json, '}'))\r\n            return JSON.parse(json);\r\n\r\n        return null;\r\n    }\r\n\r\n    protected restoreSettings(settings?: PersistedGridSettings, flags?: GridPersistanceFlags): void {\r\n        if (!this.slickGrid)\r\n            return;\r\n\r\n        if (settings == null) {\r\n            settings = this.getPersistedSettings();\r\n            if (settings == null)\r\n                return;\r\n        }\r\n\r\n        var columns = this.slickGrid.getColumns();\r\n        var colById: { [key: string]: Column } = null;\r\n        var updateColById = function(cl: Column[]) {\r\n            colById = {};\r\n            for (var $t1 = 0; $t1 < cl.length; $t1++) {\r\n                var c = cl[$t1];\r\n                colById[c.id] = c;\r\n            }\r\n        };\r\n\r\n        this.view.beginUpdate();\r\n        this.restoringSettings++;\r\n        try {\r\n            flags = flags || this.gridPersistanceFlags();\r\n            if (settings.columns != null) {\r\n                if (flags.columnVisibility !== false) {\r\n                    var visible = {};\r\n                    updateColById(this.allColumns);\r\n                    var newColumns = [];\r\n                    for (var $t2 = 0; $t2 < settings.columns.length; $t2++) {\r\n                        var x = settings.columns[$t2];\r\n                        if (x.id != null && x.visible === true) {\r\n                            var column = colById[x.id];\r\n                            if (this.canShowColumn(column)) {\r\n                                column.visible = true;\r\n                                newColumns.push(column);\r\n                                delete colById[x.id];\r\n                            }\r\n                        }\r\n                    }\r\n                    for (var $t3 = 0; $t3 < this.allColumns.length; $t3++) {\r\n                        var c1 = this.allColumns[$t3];\r\n                        if (colById[c1.id] != null) {\r\n                            c1.visible = false;\r\n                            newColumns.push(c1);\r\n                        }\r\n                    }\r\n                    this.allColumns = newColumns;\r\n                    columns = this.allColumns.filter(function (x1) {\r\n                        return x1.visible === true;\r\n                    });\r\n                }\r\n                if (flags.columnWidths !== false) {\r\n                    updateColById(columns);\r\n                    for (var $t4 = 0; $t4 < settings.columns.length; $t4++) {\r\n                        var x2 = settings.columns[$t4];\r\n                        if (x2.id != null && x2.width != null && x2.width !== 0) {\r\n                            var column1 = colById[x2.id];\r\n                            if (column1 != null) {\r\n                                column1.width = x2.width;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (flags.sortColumns !== false) {\r\n                    updateColById(columns);\r\n                    var list = [];\r\n                    var sortColumns = settings.columns.filter(function (x3) {\r\n                        return x3.id != null && (x3.sort ?? 0) !== 0;\r\n                    });\r\n\r\n                    sortColumns.sort(function (a, b) {\r\n                        // sort holds two informations:\r\n                        // absoulte value: order of sorting\r\n                        // sign: positive = ascending, negativ = descending\r\n                        // so we have to compare absolute values here\r\n                        return Math.abs(a.sort) - Math.abs(b.sort);\r\n                    });\r\n\r\n                    for (var $t5 = 0; $t5 < sortColumns.length; $t5++) {\r\n                        var x4 = sortColumns[$t5];\r\n                        var column2 = colById[x4.id];\r\n                        if (column2 != null) {\r\n                            list.push({\r\n                                columnId: x4.id,\r\n                                sortAsc: x4.sort > 0\r\n                            });\r\n                        }\r\n                    }\r\n                    this.view.sortBy = list.map(function (x5) {\r\n                        return x5.columnId + ((x5.sortAsc === false) ? ' DESC' : '');\r\n                    });\r\n                    this.slickGrid.setSortColumns(list);\r\n                }\r\n                this.slickGrid.setColumns(columns);\r\n                this.slickGrid.invalidate();\r\n            }\r\n\r\n            if (settings.filterItems != null &&\r\n                flags.filterItems !== false &&\r\n                this.filterBar != null &&\r\n                this.filterBar.get_store() != null) {\r\n                var items = this.filterBar.get_store().get_items();\r\n                items.length = 0;\r\n                items.push.apply(items, settings.filterItems);\r\n                this.filterBar.get_store().raiseChanged();\r\n            }\r\n\r\n            if (settings.includeDeleted != null &&\r\n                flags.includeDeleted !== false) {\r\n                var includeDeletedToggle = this.element.find('.s-IncludeDeletedToggle');\r\n                if (!!settings.includeDeleted !== includeDeletedToggle.hasClass('pressed')) {\r\n                    includeDeletedToggle.children('a').click();\r\n                }\r\n            }\r\n\r\n            if (settings.quickFilters != null &&\r\n                flags.quickFilters !== false &&\r\n                this.quickFiltersDiv != null &&\r\n                this.quickFiltersDiv.length > 0) {\r\n                this.quickFiltersDiv.find('.quick-filter-item').each((i, e) => {\r\n                    var field = $(e).data('qffield');\r\n\r\n                    if (isEmptyOrNull(field)) {\r\n                        return;\r\n                    }\r\n\r\n                    var widget = $('#' + this.uniqueName + '_QuickFilter_' + field).tryGetWidget(Widget);\r\n                    if (widget == null) {\r\n                        return;\r\n                    }\r\n\r\n                    var state = settings.quickFilters[field];\r\n                    var loadState = $(e).data('qfloadstate');\r\n                    if (loadState != null) {\r\n                        loadState(widget, state);\r\n                    }\r\n                    else {\r\n                        EditorUtils.setValue(widget, state);\r\n                    }\r\n                });\r\n            }\r\n\r\n            if (flags.quickSearch === true && (settings.quickSearchField !== undefined || settings.quickSearchText !== undefined)) {\r\n                var qsInput = this.toolbar.element.find('.s-QuickSearchInput').first();\r\n                if (qsInput.length > 0) {\r\n                    var qsWidget = qsInput.tryGetWidget(QuickSearchInput);\r\n                    qsWidget && qsWidget.restoreState(settings.quickSearchText, settings.quickSearchField);\r\n                }\r\n            }\r\n        }\r\n        finally {\r\n            this.restoringSettings--;\r\n            this.view.endUpdate();\r\n        }\r\n    }\r\n\r\n    protected persistSettings(flags?: GridPersistanceFlags): void {\r\n        var storage = this.getPersistanceStorage();\r\n        if (!storage) {\r\n            return;\r\n        }\r\n\r\n        var settings = this.getCurrentSettings(flags);\r\n        storage.setItem(this.getPersistanceKey(), JSON.stringify(settings));\r\n    }\r\n\r\n    protected getCurrentSettings(flags?: GridPersistanceFlags) {\r\n        flags = flags || this.gridPersistanceFlags();\r\n        var settings: PersistedGridSettings = {};\r\n        if (flags.columnVisibility !== false || flags.columnWidths !== false || flags.sortColumns !== false) {\r\n            settings.columns = [];\r\n            var sortColumns = this.slickGrid.getSortColumns() as any[];\r\n            var columns = this.slickGrid.getColumns();\r\n            for (var column of columns) {\r\n                var p: PersistedGridColumn = {\r\n                    id: column.id\r\n                };\r\n\r\n                if (flags.columnVisibility !== false) {\r\n                    p.visible = true;\r\n                }\r\n                if (flags.columnWidths !== false) {\r\n                    p.width = column.width;\r\n                }\r\n\r\n                if (flags.sortColumns !== false) {\r\n                    var sort = indexOf(sortColumns, x => x.columnId == column.id);\r\n                    p.sort = ((sort >= 0) ? ((sortColumns[sort].sortAsc !== false) ? (sort + 1) : (-sort - 1)) : 0);\r\n                }\r\n                settings.columns.push(p);\r\n            }\r\n        }\r\n\r\n        if (flags.includeDeleted !== false) {\r\n            settings.includeDeleted = this.element.find('.s-IncludeDeletedToggle').hasClass('pressed');\r\n        }\r\n\r\n        if (flags.filterItems !== false && (this.filterBar != null) && (this.filterBar.get_store() != null)) {\r\n            settings.filterItems = this.filterBar.get_store().get_items().slice();\r\n        }\r\n\r\n        if (flags.quickSearch === true) {\r\n            var qsInput = this.toolbar.element.find('.s-QuickSearchInput').first();\r\n            if (qsInput.length > 0) {\r\n                var qsWidget = qsInput.tryGetWidget(QuickSearchInput);\r\n                if (qsWidget != null) {\r\n                    settings.quickSearchField = qsWidget.get_field();\r\n                    settings.quickSearchText = qsWidget.element.val();\r\n                }\r\n            }\r\n        }\r\n\r\n        if (flags.quickFilters !== false && (this.quickFiltersDiv != null) && this.quickFiltersDiv.length > 0) {\r\n            settings.quickFilters = {};\r\n            this.quickFiltersDiv.find('.quick-filter-item').each((i, e) => {\r\n                var field = $(e).data('qffield');\r\n                if (isEmptyOrNull(field)) {\r\n                    return;\r\n                }\r\n\r\n                var widget = $('#' + this.uniqueName + '_QuickFilter_' + field).tryGetWidget(Widget);\r\n                if (widget == null) {\r\n                    return;\r\n                }\r\n\r\n                var saveState = $(e).data('qfsavestate');\r\n                var state = (saveState != null) ? saveState(widget) : EditorUtils.getValue(widget);\r\n                settings.quickFilters[field] = state;\r\n                if (flags.quickFilterText === true && $(e).hasClass('quick-filter-active')) {\r\n\r\n                    var getDisplayText = $(e).data('qfdisplaytext');\r\n                    var filterLabel = $(e).find('.quick-filter-label').text();\r\n\r\n                    var displayText;\r\n                    if (getDisplayText != null) {\r\n                        displayText = getDisplayText(widget, filterLabel);\r\n                    }\r\n                    else {\r\n                        displayText = filterLabel + ' = ' + EditorUtils.getDisplayText(widget);\r\n                    }\r\n\r\n                    if (!isEmptyOrNull(displayText)) {\r\n                        if (!isEmptyOrNull(settings.quickFilterText)) {\r\n                            settings.quickFilterText += ' ' + (tryGetText('Controls.FilterPanel.And') ?? 'and') + ' ';\r\n                            settings.quickFilterText += displayText;\r\n                        }\r\n                        else {\r\n                            settings.quickFilterText = displayText;\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        return settings;\r\n    }\r\n\r\n    getElement(): JQuery {\r\n        return this.element;\r\n    }\r\n\r\n    getGrid(): Grid {\r\n        return this.slickGrid;\r\n    }\r\n\r\n    getView(): RemoteView<TItem> {\r\n        return this.view;\r\n    }\r\n\r\n    getFilterStore(): FilterStore {\r\n        return (this.filterBar == null) ? null : this.filterBar.get_store();\r\n    }\r\n}\r\n", "\uFEFFimport { Column } from \"@serenity-is/sleekgrid\";\r\nimport { Decorators } from \"../../decorators\";\r\nimport { Authorization, centerDialog, Culture, htmlEncode, Router, text, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { QuickSearchInput } from \"../datagrid/quicksearchinput\";\r\nimport { TemplatedDialog } from \"../dialogs/templateddialog\";\r\nimport { ToolButton } from \"../widgets/toolbar\";\r\nimport { IDataGrid } from \"./idatagrid\";\r\n\r\n@Decorators.registerClass('Serenity.ColumnPickerDialog')\r\n@Decorators.resizable()\r\n@Decorators.responsive()\r\nexport class ColumnPickerDialog extends TemplatedDialog<any> {\r\n\r\n    private ulVisible: JQuery;\r\n    private ulHidden: JQuery;\r\n    private colById: { [key: string]: Column };\r\n\r\n    public allColumns: Column[];\r\n    public visibleColumns: string[];\r\n    public defaultColumns: string[];\r\n    public done: () => void;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        new QuickSearchInput(this.byId(\"Search\"), {\r\n            onSearch: (fld, txt, done) => {\r\n                txt = trimToNull(txt);\r\n                if (txt != null)\r\n                    txt = Select2.util.stripDiacritics(txt.toLowerCase());\r\n\r\n                this.element.find('li').each((x, e) => {\r\n                    $(e).toggle(!txt || Select2.util.stripDiacritics(\r\n                        $(e).text().toLowerCase()).indexOf(txt) >= 0);\r\n                });\r\n                done && done(true);\r\n            }\r\n        });\r\n\r\n        this.ulVisible = this.byId(\"VisibleCols\");\r\n        this.ulHidden = this.byId(\"HiddenCols\");\r\n        this.dialogTitle = text(\"Controls.ColumnPickerDialog.Title\");\r\n    }\r\n\r\n    public static createToolButton(grid: IDataGrid): ToolButton {\r\n        function onClick() {\r\n            var picker = new ColumnPickerDialog();\r\n            picker.allColumns = (grid as any).allColumns;\r\n            if ((grid as any).initialSettings) {\r\n                var initialSettings = (grid as any).initialSettings;\r\n                if (initialSettings.columns && initialSettings.columns.length)\r\n                    picker.defaultColumns = initialSettings.columns.map((x: any) => x.id);\r\n            }\r\n            picker.visibleColumns = grid.getGrid().getColumns().map(x => x.id);\r\n            picker.done = () => {\r\n                (grid as any).allColumns = picker.allColumns;\r\n                var visible = picker.allColumns.filter(x => x.visible === true);\r\n                grid.getGrid().setColumns(visible);\r\n                (grid as any).persistSettings();\r\n                grid.getView().populate();\r\n            };\r\n\r\n            Router && Router.dialog && Router.dialog((grid as any).element, picker.element, () => \"columns\");\r\n            picker.dialogOpen();\r\n        }\r\n\r\n        (grid as any).element.on('handleroute.' + (grid as any).uniqueName, (e: any, arg: any) => {\r\n            if (arg && !arg.handled && arg.route == \"columns\") {\r\n                onClick();\r\n            }\r\n        });\r\n\r\n        return {\r\n            hint: text(\"Controls.ColumnPickerDialog.Title\"),\r\n            cssClass: \"column-picker-button\",\r\n            icon: 'fa-th-list text-blue',\r\n            onClick: onClick\r\n        }\r\n    }\r\n\r\n    protected getDialogButtons() {\r\n        return [\r\n            {\r\n                text: text(\"Controls.ColumnPickerDialog.RestoreDefaults\"),\r\n                click: () => {\r\n                    let liByKey: { [key: string]: JQuery } = {};\r\n                    this.ulVisible.children().add(this.ulHidden.children()).each((x, e) => {\r\n                        let el = $(e);\r\n                        liByKey[el.data('key')] = el;\r\n                    });\r\n\r\n                    let last: JQuery = null;\r\n                    for (let id of this.defaultColumns) {\r\n                        let li = liByKey[id];\r\n                        if (!li)\r\n                            continue;\r\n\r\n                        if (last == null)\r\n                            li.prependTo(this.ulVisible);\r\n                        else\r\n                            li.insertAfter(last);\r\n\r\n                        last = li;\r\n                        let key: string = li.data('key');\r\n                        delete liByKey[key];\r\n                    }\r\n\r\n                    for (let key in liByKey)\r\n                        liByKey[key].appendTo(this.ulHidden);\r\n\r\n                    this.updateListStates();\r\n                }\r\n            },\r\n            {\r\n                text: text(\"Dialogs.OkButton\"),\r\n                click: () => {\r\n                    let newColumns: Column[] = [];\r\n\r\n                    for (var col of this.allColumns)\r\n                        col.visible = false;\r\n\r\n                    this.visibleColumns = this.ulVisible.children().toArray().map(x => {\r\n                        let id = $(x).data(\"key\");\r\n                        var col = this.colById[id];\r\n                        col.visible = true;\r\n                        newColumns.push(col);\r\n                        return id;\r\n                    });\r\n\r\n                    for (var col of this.allColumns) {\r\n                        if (!col.visible)\r\n                            newColumns.push(col);\r\n                    }\r\n\r\n                    this.allColumns = newColumns;\r\n                    this.done && this.done();\r\n                    this.dialogClose()\r\n                }\r\n            },\r\n            {\r\n                text: text(\"Dialogs.CancelButton\"),\r\n                click: () => {\r\n                    this.dialogClose()\r\n                }\r\n            }\r\n        ];\r\n    }\r\n\r\n    protected getDialogOptions() {\r\n        var opt = super.getDialogOptions();\r\n        opt.width = 600;\r\n        return opt;\r\n    }\r\n\r\n    private getTitle(col: Column) {\r\n        if (col.id == \"__select__\")\r\n            return \"[x]\";\r\n\r\n        return col.name || col.toolTip || col.id;\r\n    }\r\n\r\n    private allowHide(col: Column): boolean {\r\n        return col.sourceItem == null || col.sourceItem.allowHide == null || col.sourceItem.allowHide;\r\n    }\r\n\r\n    private createLI(col: Column): JQuery {\r\n        var allowHide = this.allowHide(col);\r\n        return $(`\r\n<li data-key=\"${col.id}\" class=\"${allowHide ? \"\" : \"cant-hide\"}\">\r\n<span class=\"drag-handle\">\u2630</span>\r\n${ htmlEncode(this.getTitle(col)) }\r\n${ allowHide ? `<i class=\"js-hide fa fa-eye-slash\" title=\"${ text(\"Controls.ColumnPickerDialog.HideHint\") }\"></i>` : '' }\r\n<i class=\"js-show fa fa-eye\" title=\"${ text(\"Controls.ColumnPickerDialog.ShowHint\") }\"></i>\r\n</li>`);\r\n    }\r\n\r\n    private updateListStates() {\r\n        this.ulVisible.children().removeClass(\"bg-info\").addClass(\"bg-success\");\r\n        this.ulHidden.children().removeClass(\"bg-success\").addClass(\"bg-info\");\r\n    }\r\n\r\n    protected setupColumns(): void {\r\n        this.allColumns = this.allColumns || [];\r\n        this.visibleColumns = this.visibleColumns || [];\r\n\r\n        let visible: { [key: string]: boolean } = {};\r\n        for (let id of this.visibleColumns) {\r\n            visible[id] = true;\r\n        }\r\n\r\n        this.colById = {};\r\n        for (let c of this.allColumns) {\r\n            this.colById[c.id] = c;\r\n        }\r\n\r\n        if (this.defaultColumns == null)\r\n            this.defaultColumns = this.visibleColumns.slice(0);\r\n\r\n        let hidden: Column[] = [];\r\n\r\n        for (let c of this.allColumns) {\r\n            if (!visible[c.id] && (!c.sourceItem ||\r\n                (c.sourceItem.filterOnly !== true &&\r\n                    (c.sourceItem.readPermission == null || Authorization.hasPermission(c.sourceItem.readPermission))))) {\r\n                hidden.push(c);\r\n            }\r\n        }\r\n\r\n        let hiddenColumns = hidden.sort((a, b) => Culture.stringCompare(this.getTitle(a), this.getTitle(b)));\r\n\r\n        for (let id of this.visibleColumns) {\r\n            var c = this.colById[id];\r\n            if (!c)\r\n                continue;\r\n\r\n            this.createLI(c).appendTo(this.ulVisible);\r\n        }\r\n\r\n        for (let c of hiddenColumns) {\r\n            this.createLI(c).appendTo(this.ulHidden);\r\n        }\r\n\r\n        this.updateListStates();\r\n\r\n        // @ts-ignore\r\n        if (typeof Sortable !== \"undefined\" && Sortable.create) {\r\n\r\n            // @ts-ignore\r\n            Sortable.create(this.ulVisible[0], {\r\n                group: this.uniqueName + \"_group\",\r\n                filter: '.js-hide',\r\n                onFilter: (evt: any) => {\r\n                    $(evt.item).appendTo(this.ulHidden);\r\n                    this.updateListStates();\r\n                },\r\n                onMove: (x: any) => {\r\n                    if ($(x.dragged).hasClass('cant-hide') &&\r\n                        x.from == this.ulVisible[0] &&\r\n                        x.to !== x.from)\r\n                        return false;\r\n                    return true;\r\n                },\r\n                onEnd: (evt: any) => this.updateListStates()\r\n            });\r\n\r\n            // @ts-ignore\r\n            Sortable.create(this.ulHidden[0], {\r\n                group: this.uniqueName + \"_group\",\r\n                sort: false,\r\n                filter: '.js-show',\r\n                onFilter: (evt: any) => {\r\n                    $(evt.item).appendTo(this.ulVisible);\r\n                    this.updateListStates();\r\n                },\r\n                onEnd: () => this.updateListStates()\r\n            });\r\n        }\r\n    }\r\n\r\n    protected onDialogOpen(): void {\r\n        super.onDialogOpen();\r\n        this.element.find(\"input\").removeAttr(\"disabled\")\r\n        this.element.closest('.ui-dialog').children(\".ui-dialog-buttonpane\")\r\n            .find('button').eq(0).addClass(\"restore-defaults\")\r\n            .next().focus();\r\n\r\n        this.setupColumns();\r\n        centerDialog(this.element);\r\n    }\r\n\r\n    protected getTemplate() {\r\n        return `\r\n<div class=\"search\"><input id=\"~_Search\" type=\"text\" disabled /></div>\r\n<div class=\"columns-container\">\r\n<div class=\"column-list visible-list bg-success\">\r\n<h5><i class=\"fa fa-eye\"></i> ${ text(\"Controls.ColumnPickerDialog.VisibleColumns\") }</h5>\r\n<ul id=\"~_VisibleCols\"></ul>\r\n</div>\r\n<div class=\"column-list hidden-list bg-info\">\r\n<h5><i class=\"fa fa-eye-slash\"></i> ${ text(\"Controls.ColumnPickerDialog.HiddenColumns\") }</h5>\r\n<ul id=\"~_HiddenCols\"></ul>\r\n</div>\r\n</div>`;\r\n    }\r\n}\r\n", "\uFEFFimport { Column, FormatterContext } from \"@serenity-is/sleekgrid\";\r\nimport { htmlEncode, ListResponse, toGrouping, tryFirst } from \"@serenity-is/corelib/q\";\r\nimport { SlickFormatting, SlickHelper, SlickTreeHelper } from \"../helpers/slickhelpers\";\r\nimport { DataGrid } from \"./datagrid\";\r\n\r\n/**\r\n * A mixin that can be applied to a DataGrid for tree functionality\r\n */\r\nexport class TreeGridMixin<TItem> {\r\n\r\n    private dataGrid: DataGrid<TItem, any>;\r\n    private getId: (item: TItem) => any;\r\n\r\n    constructor(private options: TreeGridMixinOptions<TItem>) {\r\n        var dg = this.dataGrid = options.grid;\r\n        var idProperty = (dg as any).getIdProperty();\r\n        var getId = this.getId = (item: TItem) => (item as any)[idProperty];\r\n\r\n        dg.element.find('.grid-container').on('click', e => {\r\n            if ($(e.target).hasClass('s-TreeToggle')) {\r\n                var src = dg.slickGrid.getCellFromEvent(e);\r\n                if (src.cell >= 0 &&\r\n                    src.row >= 0) {\r\n                    SlickTreeHelper.toggleClick<TItem>(e, src.row, src.row, dg.view, getId);\r\n                }\r\n            }\r\n        });\r\n\r\n        var oldViewFilter = (dg as any).onViewFilter;\r\n        (dg as any).onViewFilter = function (item: TItem) {\r\n            if (!oldViewFilter.apply(this, [item]))\r\n                return false;\r\n\r\n            return SlickTreeHelper.filterById(item, dg.view, options.getParentId);\r\n        };\r\n\r\n        var oldProcessData = (dg as any).onViewProcessData;\r\n        (dg as any).onViewProcessData = function (response: ListResponse<TItem>) {\r\n\r\n            response = oldProcessData.apply(this, [response]);\r\n            response.Entities = TreeGridMixin.applyTreeOrdering(response.Entities, getId, options.getParentId);\r\n            SlickTreeHelper.setIndents(response.Entities, getId, options.getParentId,\r\n                (options.initialCollapse && options.initialCollapse()) || false);\r\n            return response;\r\n        };\r\n\r\n        if (options.toggleField) {\r\n            var col = tryFirst(dg['allColumns'] || dg.slickGrid.getColumns() || [], x => x.field == options.toggleField) as Column<TItem>;\r\n            if (col) {\r\n                col.format = SlickFormatting.treeToggle(() => dg.view, getId,\r\n                    col.format || ((ctx: FormatterContext<TItem>) => htmlEncode(ctx.value)));\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Expands / collapses all rows in a grid automatically\r\n     */\r\n    toggleAll(): void {\r\n        SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(),\r\n            !this.dataGrid.view.getItems().every(x => (x as any)._collapsed == true));\r\n\r\n        this.dataGrid.view.setItems(this.dataGrid.view.getItems(), true);\r\n    }\r\n\r\n    collapseAll(): void {\r\n        SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(), true);\r\n        this.dataGrid.view.setItems(this.dataGrid.view.getItems(), true);\r\n    }\r\n    \r\n    expandAll(): void {\r\n        SlickTreeHelper.setCollapsed(this.dataGrid.view.getItems(), false);\r\n        this.dataGrid.view.setItems(this.dataGrid.view.getItems(), true);\r\n    }\r\n    \r\n    /**\r\n     * Reorders a set of items so that parents comes before their children.\r\n     * This method is required for proper tree ordering, as it is not so easy to perform with SQL.\r\n     * @param items list of items to be ordered\r\n     * @param getId a delegate to get ID of a record (must return same ID with grid identity field)\r\n     * @param getParentId a delegate to get parent ID of a record\r\n     */\r\n    static applyTreeOrdering<TItem>(items: TItem[], getId: (item: TItem) => any, getParentId: (item: TItem) => any): TItem[] {\r\n        var result: TItem[] = [];\r\n\r\n        var byId = toGrouping(items, getId);\r\n        var byParentId = toGrouping(items, getParentId);\r\n        var visited = {};\r\n\r\n        function takeChildren(theParentId: any) {\r\n            if (visited[theParentId])\r\n                return;\r\n\r\n            visited[theParentId] = true;\r\n            for (var child of (byParentId[theParentId] || [])) {\r\n                result.push(child);\r\n                takeChildren(getId(child));\r\n            }\r\n        }\r\n\r\n        for (var item of items)\r\n        {\r\n            var parentId = getParentId(item);\r\n            if (parentId == null ||\r\n                !((byId[parentId] || []).length)) {\r\n                result.push(item);\r\n                takeChildren(getId(item));\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n}\r\n\r\nexport interface TreeGridMixinOptions<TItem> {\r\n    // data grid object\r\n    grid: DataGrid<TItem, any>;\r\n    // a function to get parent id\r\n    getParentId: (item: TItem) => any;\r\n    // where should the toggle button be placed\r\n    toggleField: string;\r\n    // a delegate that should return initial collapsing state\r\n    initialCollapse?: () => boolean;\r\n}\r\n", "\uFEFFimport { Column, FormatterContext, Grid, GridOptions } from \"@serenity-is/sleekgrid\"\r\nimport { Decorators } from \"../../decorators\";\r\nimport { IGetEditValue, IReadOnly, ISetEditValue } from \"../../interfaces\";\r\nimport { Culture, getLookup, htmlEncode, isEmptyOrNull, ListResponse, PropertyItem, ScriptData, trimToNull, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { ReflectionUtils } from \"../../types/reflectionutils\";\r\nimport { DataGrid } from \"../datagrid/datagrid\";\r\nimport { GridSelectAllButtonHelper, GridUtils, SlickFormatting, SlickTreeHelper } from \"../helpers/slickhelpers\";\r\nimport { ToolButton } from \"../widgets/toolbar\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { CascadedWidgetLink } from \"./cascadedwidgetlink\";\r\nimport { EditorUtils } from \"./editorutils\";\r\n\r\nexport interface CheckTreeItem<TSource> {\r\n    isSelected?: boolean;\r\n    hideCheckBox?: boolean;\r\n    isAllDescendantsSelected?: boolean;\r\n    id?: string;\r\n    text?: string;\r\n    parentId?: string;\r\n    children?: CheckTreeItem<TSource>[];\r\n    source?: TSource;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.CheckTreeEditor', [IGetEditValue, ISetEditValue, IReadOnly])\r\n@Decorators.element(\"<div/>\")\r\nexport class CheckTreeEditor<TItem extends CheckTreeItem<any>, TOptions> extends DataGrid<TItem, TOptions>\r\n    implements IGetEditValue, ISetEditValue, IReadOnly {\r\n\r\n    private byId: { [key: string]: TItem };\r\n\r\n    constructor(div: JQuery, opt?: TOptions) {\r\n        super(div, opt);\r\n\r\n        div.addClass('s-CheckTreeEditor');\r\n        this.updateItems();\r\n    }\r\n\r\n    protected getIdProperty() {\r\n        return \"id\";\r\n    }\r\n\r\n    protected getTreeItems(): TItem[] {\r\n        return [];\r\n    }\r\n\r\n    protected updateItems(): void {\r\n        var items = this.getTreeItems();\r\n        var itemById = {};\r\n        for (var i = 0; i < items.length; i++) {\r\n            var item = items[i];\r\n            item.children = [];\r\n            if (!isEmptyOrNull(item.id)) {\r\n                itemById[item.id] = item;\r\n            }\r\n            if (!isEmptyOrNull(item.parentId)) {\r\n                var parent = itemById[item.parentId];\r\n                if (parent != null) {\r\n                    parent.children.push(item);\r\n                }\r\n            }\r\n        }\r\n        this.view.addData({ Entities: items, Skip: 0, Take: 0, TotalCount: items.length });\r\n        this.updateSelectAll();\r\n        this.updateFlags();\r\n    }\r\n\r\n    getEditValue(property: PropertyItem, target: any): void {\r\n        if (this.getDelimited())\r\n            target[property.name] = this.get_value().join(\",\");\r\n        else\r\n            target[property.name] = this.get_value();\r\n    }\r\n\r\n    setEditValue(source: any, property: PropertyItem): void {\r\n        var value = source[property.name];\r\n        this.set_value(value);\r\n    }\r\n\r\n    protected getButtons(): ToolButton[] {\r\n        var selectAllText = this.getSelectAllText();\r\n        if (isEmptyOrNull(selectAllText)) {\r\n            return null;\r\n        }\r\n\r\n        var self = this;\r\n        var buttons: ToolButton[] = [];\r\n        buttons.push(GridSelectAllButtonHelper.define(function () {\r\n            return self;\r\n        }, function (x) {\r\n            return x.id;\r\n        }, function (x1) {\r\n            return x1.isSelected;\r\n        }, (x2, v) => {\r\n            if (x2.isSelected !== v) {\r\n                x2.isSelected = v;\r\n                this.itemSelectedChanged(x2);\r\n            }\r\n        }, null, () => {\r\n            this.updateFlags();\r\n        }));\r\n\r\n        return buttons;\r\n    }\r\n\r\n    protected itemSelectedChanged(item: TItem): void {\r\n    }\r\n\r\n    protected getSelectAllText(): string {\r\n        return tryGetText('Controls.CheckTreeEditor.SelectAll') ?? 'Select All';\r\n    }\r\n\r\n    protected isThreeStateHierarchy(): boolean {\r\n        return false;\r\n    }\r\n\r\n    protected createSlickGrid(): Grid {\r\n        this.element.addClass('slick-no-cell-border').addClass('slick-no-odd-even');\r\n        var result = super.createSlickGrid();\r\n        this.element.addClass('slick-hide-header');\r\n        result.resizeCanvas();\r\n        return result;\r\n    }\r\n\r\n    protected onViewFilter(item: TItem): boolean {\r\n        if (!super.onViewFilter(item)) {\r\n            return false;\r\n        }\r\n\r\n        var items = this.view.getItems();\r\n        var self = this;\r\n        return SlickTreeHelper.filterCustom(item, function (x) {\r\n            if (x.parentId == null) {\r\n                return null;\r\n            }\r\n\r\n            if (self.byId == null) {\r\n                self.byId = {};\r\n                for (var i = 0; i < items.length; i++) {\r\n                    var o = items[i];\r\n                    if (o.id != null) {\r\n                        self.byId[o.id] = o;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return self.byId[x.parentId];\r\n        });\r\n    }\r\n\r\n    protected getInitialCollapse(): boolean {\r\n        return false;\r\n    }\r\n\r\n    protected onViewProcessData(response: ListResponse<TItem>): ListResponse<TItem> {\r\n        response = super.onViewProcessData(response);\r\n        this.byId = null;\r\n        SlickTreeHelper.setIndents(response.Entities, function (x) {\r\n            return x.id;\r\n        }, function (x1) {\r\n            return x1.parentId;\r\n        }, this.getInitialCollapse());\r\n        return response;\r\n    }\r\n\r\n    protected onClick(e: JQueryEventObject, row: number, cell: number): void {\r\n        super.onClick(e, row, cell);\r\n\r\n        if (!e.isDefaultPrevented()) {\r\n            SlickTreeHelper.toggleClick(e, row, cell, this.view, function (x) {\r\n                return x.id;\r\n            });\r\n        }\r\n\r\n        if (e.isDefaultPrevented()) {\r\n            return;\r\n        }\r\n\r\n        var target = $(e.target);\r\n        if (target.hasClass('check-box')) {\r\n            e.preventDefault();\r\n\r\n            if (this._readOnly)\r\n                return;\r\n\r\n            var checkedOrPartial = target.hasClass('checked') || target.hasClass('partial');\r\n            var item = this.itemAt(row);\r\n            var anyChanged = item.isSelected !== !checkedOrPartial;\r\n            this.view.beginUpdate();\r\n            try {\r\n                if (item.isSelected !== !checkedOrPartial) {\r\n                    item.isSelected = !checkedOrPartial;\r\n                    this.view.updateItem(item.id, item);\r\n                    this.itemSelectedChanged(item);\r\n                }\r\n                anyChanged = this.setAllSubTreeSelected(item, item.isSelected) || anyChanged;\r\n                this.updateSelectAll();\r\n                this.updateFlags();\r\n            }\r\n            finally {\r\n                this.view.endUpdate();\r\n            }\r\n            if (anyChanged) {\r\n                this.element.triggerHandler('change');\r\n            }\r\n        }\r\n    }\r\n\r\n    protected updateSelectAll(): void {\r\n        GridSelectAllButtonHelper.update(this, function (x) {\r\n            return x.isSelected;\r\n        });\r\n    }\r\n\r\n    protected updateFlags(): void {\r\n        var view = this.view;\r\n        var items = view.getItems();\r\n        var threeState = this.isThreeStateHierarchy();\r\n        if (!threeState) {\r\n            return;\r\n        }\r\n        view.beginUpdate();\r\n        try {\r\n            for (var i = 0; i < items.length; i++) {\r\n                var item = items[i];\r\n                if (item.children == null || item.children.length === 0) {\r\n                    var allsel = this.getDescendantsSelected(item);\r\n                    if (allsel !== item.isAllDescendantsSelected) {\r\n                        item.isAllDescendantsSelected = allsel;\r\n                        view.updateItem(item.id, item);\r\n                    }\r\n                    continue;\r\n                }\r\n                var allSelected = this.allDescendantsSelected(item);\r\n                var selected = allSelected || this.anyDescendantsSelected(item);\r\n                if (allSelected !== item.isAllDescendantsSelected || selected !== item.isSelected) {\r\n                    var selectedChange = item.isSelected !== selected;\r\n                    item.isAllDescendantsSelected = allSelected;\r\n                    item.isSelected = selected;\r\n                    view.updateItem(item.id, item);\r\n                    if (selectedChange) {\r\n                        this.itemSelectedChanged(item);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        finally {\r\n            view.endUpdate();\r\n        }\r\n    }\r\n\r\n    protected getDescendantsSelected(item: TItem): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected setAllSubTreeSelected(item: TItem, selected: boolean): boolean {\r\n        var result = false;\r\n        for (var i = 0; i < item.children.length; i++) {\r\n            var sub = item.children[i];\r\n            if (sub.isSelected !== selected) {\r\n                result = true;\r\n                sub.isSelected = selected;\r\n                this.view.updateItem(sub.id, sub as TItem);\r\n                this.itemSelectedChanged(sub as TItem);\r\n            }\r\n            if (sub.children.length > 0) {\r\n                result = this.setAllSubTreeSelected(sub as TItem, selected) || result;\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected allItemsSelected() {\r\n        for (var i = 0; i < this.rowCount(); i++) {\r\n            var row = this.itemAt(i);\r\n            if (!row.isSelected) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return this.rowCount() > 0;\r\n    }\r\n\r\n    protected allDescendantsSelected(item: TItem): boolean {\r\n        if (item.children.length > 0) {\r\n            for (var i = 0; i < item.children.length; i++) {\r\n                var sub = item.children[i];\r\n                if (!sub.isSelected) {\r\n                    return false;\r\n                }\r\n\r\n                if (!this.allDescendantsSelected(sub as TItem)) {\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n        return true;\r\n    }\r\n\r\n    protected getDelimited() {\r\n        return !!!!this.options['delimited'];\r\n    }\r\n\r\n    protected anyDescendantsSelected(item: TItem): boolean {\r\n        if (item.children.length > 0) {\r\n            for (var i = 0; i < item.children.length; i++) {\r\n                var sub = item.children[i];\r\n                if (sub.isSelected) {\r\n                    return true;\r\n                }\r\n                if (this.anyDescendantsSelected(sub as TItem)) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    protected getColumns(): Column[] {\r\n        var self = this;\r\n        var columns: Column[] = [];\r\n        columns.push({\r\n            field: 'text', name: 'Kay\u0131t', width: 80, format: SlickFormatting.treeToggle(function () {\r\n                return self.view;\r\n            }, function (x) {\r\n                return x.id;\r\n            }, ctx => {\r\n                var cls = 'check-box';\r\n                var item = ctx.item;\r\n                if (item.hideCheckBox) {\r\n                    return this.getItemText(ctx);\r\n                }\r\n                var threeState = this.isThreeStateHierarchy();\r\n                if (item.isSelected) {\r\n                    if (threeState && !item.isAllDescendantsSelected) {\r\n                        cls += ' partial';\r\n                    }\r\n                    else {\r\n                        cls += ' checked';\r\n                    }\r\n                }\r\n                if (this._readOnly)\r\n                    cls += ' readonly';\r\n                return '<span class=\"' + cls + '\"></span>' + this.getItemText(ctx);\r\n            })\r\n        });\r\n        return columns;\r\n    }\r\n\r\n    protected getItemText(ctx: FormatterContext): string {\r\n        return htmlEncode(ctx.value);\r\n    }\r\n\r\n    protected getSlickOptions(): GridOptions {\r\n        var opt = super.getSlickOptions();\r\n        opt.forceFitColumns = true;\r\n        return opt;\r\n    }\r\n\r\n    protected sortItems(): void {\r\n        if (!this.moveSelectedUp()) {\r\n            return;\r\n        }\r\n        var oldIndexes = {};\r\n        var list = this.view.getItems();\r\n        var i = 0;\r\n        for (var $t1 = 0; $t1 < list.length; $t1++) {\r\n            var x = list[$t1];\r\n            oldIndexes[x.id] = i++;\r\n        }\r\n        list.sort(function (x1, y) {\r\n            if (x1.isSelected && !y.isSelected) {\r\n                return -1;\r\n            }\r\n            if (y.isSelected && !x1.isSelected) {\r\n                return 1;\r\n            }\r\n            var c = Culture.stringCompare(x1.text, y.text);\r\n            if (c !== 0) {\r\n                return c;\r\n            }\r\n            return oldIndexes[x1.id] < oldIndexes[y.id] ? -1 : (oldIndexes[x1.id] > oldIndexes[y.id] ? 1 : 0);\r\n        });\r\n\r\n        this.view.setItems(list, true);\r\n    }\r\n\r\n    protected moveSelectedUp(): boolean {\r\n        return false;\r\n    }\r\n\r\n    private _readOnly: boolean;\r\n\r\n    public get_readOnly() {\r\n        return this._readOnly;\r\n    }\r\n\r\n    public set_readOnly(value: boolean) {\r\n        if (!!this._readOnly != !!value) {\r\n            this._readOnly = !!value;\r\n            this.view.refresh();\r\n        }\r\n    }\r\n\r\n    private get_value(): string[] {\r\n        var list = [];\r\n        var items = this.view.getItems();\r\n        for (var i = 0; i < items.length; i++) {\r\n            if (items[i].isSelected) {\r\n                list.push(items[i].id);\r\n            }\r\n        }\r\n        return list;\r\n    }\r\n\r\n    public get value() {\r\n        return this.get_value();\r\n    }\r\n\r\n    private set_value(value: string | string[]) {\r\n\r\n        var selected = {};\r\n        if (value != null) {\r\n            if (typeof value == \"string\") {\r\n                value = value.split(',')\r\n                    .map(x => trimToNull(x))\r\n                    .filter(x => x != null);\r\n            }\r\n\r\n            for (var i = 0; i < value.length; i++) {\r\n                selected[value[i]] = true;\r\n            }\r\n        }\r\n\r\n        this.view.beginUpdate();\r\n        try {\r\n            var items = this.view.getItems();\r\n            for (var i1 = 0; i1 < items.length; i1++) {\r\n                var item = items[i1];\r\n                var select = selected[item.id];\r\n                if (select !== item.isSelected) {\r\n                    item.isSelected = select;\r\n                    this.view.updateItem(item.id, item);\r\n                }\r\n            }\r\n            this.updateSelectAll();\r\n            this.updateFlags();\r\n            this.sortItems();\r\n        }\r\n        finally {\r\n            this.view.endUpdate();\r\n        }\r\n    }\r\n\r\n    public set value(v: string[]) {\r\n        this.set_value(v);\r\n    }\r\n}\r\n\r\nexport interface CheckLookupEditorOptions {\r\n    lookupKey?: string;\r\n    checkedOnTop?: boolean;\r\n    showSelectAll?: boolean;\r\n    hideSearch?: boolean;\r\n    delimited?: boolean;\r\n    cascadeFrom?: string;\r\n    cascadeField?: string;\r\n    cascadeValue?: any;\r\n    filterField?: string;\r\n    filterValue?: any;\r\n}\r\n\r\n@Decorators.registerEditor(\"Serenity.CheckLookupEditor\")\r\nexport class CheckLookupEditor<TItem = any> extends CheckTreeEditor<CheckTreeItem<TItem>, CheckLookupEditorOptions> {\r\n\r\n    private searchText: string;\r\n    private enableUpdateItems: boolean;\r\n\r\n    constructor(div: JQuery, options: CheckLookupEditorOptions) {\r\n        super(div, options);\r\n\r\n        this.enableUpdateItems = true;\r\n        this.setCascadeFrom(this.options.cascadeFrom);\r\n        this.updateItems();\r\n        ScriptData.bindToChange('Lookup.' + this.getLookupKey(), this.uniqueName,\r\n            () => this.updateItems());\r\n    }\r\n\r\n    protected updateItems() {\r\n        if (this.enableUpdateItems)\r\n            super.updateItems();\r\n    }\r\n\r\n    protected getLookupKey() {\r\n        return this.options.lookupKey;\r\n    }\r\n\r\n    protected getButtons(): ToolButton[] {\r\n        return super.getButtons() ?? (this.options.hideSearch ? null : []);\r\n    }\r\n\r\n    protected createToolbarExtensions() {\r\n        super.createToolbarExtensions();\r\n\r\n        GridUtils.addQuickSearchInputCustom(this.toolbar.element, (field, text) => {\r\n            this.searchText = Select2.util.stripDiacritics(text || '').toUpperCase();\r\n            this.view.setItems(this.view.getItems(), true);\r\n        });\r\n    }\r\n\r\n    protected getSelectAllText(): string {\r\n        if (!this.options.showSelectAll)\r\n            return null;\r\n\r\n        return super.getSelectAllText();\r\n    }\r\n\r\n    protected cascadeItems(items: TItem[]) {\r\n\r\n        var val = this.get_cascadeValue();\r\n\r\n        if (val == null || val === '') {\r\n\r\n            if (!isEmptyOrNull(this.get_cascadeField())) {\r\n                return [];\r\n            }\r\n\r\n            return items;\r\n        }\r\n\r\n        var key = val.toString();\r\n        var fld = this.get_cascadeField();\r\n\r\n        return items.filter(x => {\r\n            var itemKey = x[fld] ?? ReflectionUtils.getPropertyValue(x, fld);\r\n            return !!(itemKey != null && itemKey.toString() === key);\r\n        });\r\n    }\r\n\r\n    protected filterItems(items: TItem[]) {\r\n        var val = this.get_filterValue();\r\n\r\n        if (val == null || val === '') {\r\n            return items;\r\n        }\r\n\r\n        var key = val.toString();\r\n        var fld = this.get_filterField();\r\n\r\n        return items.filter(x => {\r\n            var itemKey = x[fld] ?? ReflectionUtils.getPropertyValue(x, fld);\r\n            return !!(itemKey != null && itemKey.toString() === key);\r\n        });\r\n    }\r\n\r\n    protected getLookupItems(lookup: Q.Lookup<TItem>): TItem[] {\r\n        return this.filterItems(this.cascadeItems(lookup.items));\r\n    }\r\n\r\n    protected getTreeItems() {\r\n        var lookup = getLookup<TItem>(this.options.lookupKey);\r\n        var items = this.getLookupItems(lookup);\r\n        return items.map(item => <CheckTreeItem<TItem>>{\r\n            id: (item[lookup.idField] ?? \"\").toString(),\r\n            text: (item[lookup.textField] ?? \"\").toString(),\r\n            source: item\r\n        });\r\n    }\r\n\r\n    protected onViewFilter(item: CheckTreeItem<TItem>) {\r\n        return super.onViewFilter(item) &&\r\n            (isEmptyOrNull(this.searchText) ||\r\n                Select2.util.stripDiacritics(item.text || '')\r\n                    .toUpperCase().indexOf(this.searchText) >= 0);\r\n    }\r\n\r\n    protected moveSelectedUp(): boolean {\r\n        return this.options.checkedOnTop;\r\n    }\r\n\r\n    protected get_cascadeFrom(): string {\r\n        return this.options.cascadeFrom;\r\n    }\r\n\r\n    get cascadeFrom(): string {\r\n        return this.get_cascadeFrom();\r\n    }\r\n\r\n    protected getCascadeFromValue(parent: Widget<any>) {\r\n        return EditorUtils.getValue(parent);\r\n    }\r\n\r\n    protected cascadeLink: CascadedWidgetLink<Widget<any>>;\r\n\r\n    protected setCascadeFrom(value: string) {\r\n\r\n        if (isEmptyOrNull(value)) {\r\n            if (this.cascadeLink != null) {\r\n                this.cascadeLink.set_parentID(null);\r\n                this.cascadeLink = null;\r\n            }\r\n            this.options.cascadeFrom = null;\r\n            return;\r\n        }\r\n\r\n        this.cascadeLink = new CascadedWidgetLink<Widget<any>>(Widget, this, p => {\r\n            this.set_cascadeValue(this.getCascadeFromValue(p));\r\n        });\r\n\r\n        this.cascadeLink.set_parentID(value);\r\n        this.options.cascadeFrom = value;\r\n    }\r\n\r\n    protected set_cascadeFrom(value: string) {\r\n        if (value !== this.options.cascadeFrom) {\r\n            this.setCascadeFrom(value);\r\n            this.updateItems();\r\n        }\r\n    }\r\n\r\n    set cascadeFrom(value: string) {\r\n        this.set_cascadeFrom(value);\r\n    }\r\n\r\n    protected get_cascadeField() {\r\n        return (this.options.cascadeField ?? this.options.cascadeFrom);\r\n    }\r\n\r\n    get cascadeField(): string {\r\n        return this.get_cascadeField();\r\n    }\r\n\r\n    protected set_cascadeField(value: string) {\r\n        this.options.cascadeField = value;\r\n    }\r\n\r\n    set cascadeField(value: string) {\r\n        this.set_cascadeField(value);\r\n    }\r\n\r\n    protected get_cascadeValue(): any {\r\n        return this.options.cascadeValue;\r\n    }\r\n\r\n    get cascadeValue(): any {\r\n        return this.get_cascadeValue();\r\n    }\r\n\r\n    protected set_cascadeValue(value: any) {\r\n        if (this.options.cascadeValue !== value) {\r\n            this.options.cascadeValue = value;\r\n            this.value = [];\r\n            this.updateItems();\r\n        }\r\n    }\r\n\r\n    set cascadeValue(value: any) {\r\n        this.set_cascadeValue(value);\r\n    }\r\n\r\n    protected get_filterField() {\r\n        return this.options.filterField;\r\n    }\r\n\r\n    get filterField(): string {\r\n        return this.get_filterField();\r\n    }\r\n\r\n    protected set_filterField(value: string) {\r\n        this.options.filterField = value;\r\n    }\r\n\r\n    set filterField(value: string) {\r\n        this.set_filterField(value);\r\n    }\r\n\r\n    protected get_filterValue(): any {\r\n        return this.options.filterValue;\r\n    }\r\n\r\n    get filterValue(): any {\r\n        return this.get_filterValue();\r\n    }\r\n\r\n    protected set_filterValue(value: any) {\r\n        if (this.options.filterValue !== value) {\r\n            this.options.filterValue = value;\r\n            this.value = null;\r\n            this.updateItems();\r\n        }\r\n    }\r\n\r\n    set filterValue(value: any) {\r\n        this.set_filterValue(value);\r\n    }\r\n}", "\uFEFFimport { Decorators, DialogTypeAttribute, DisplayNameAttribute, EntityTypeAttribute, ItemNameAttribute, ServiceAttribute } from \"../../decorators\";\r\nimport { IEditDialog } from \"../../interfaces\";\r\nimport { Authorization, endsWith, format, getInstanceType, getTypeFullName, HandleRouteEventArgs, isEmptyOrNull, LT, replaceAll, resolveUrl, Router, safeCast, text, tryGetText } from \"@serenity-is/corelib/q\";\r\nimport { RemoteViewOptions } from \"@serenity-is/corelib/slick\";\r\nimport { DialogTypeRegistry } from \"../../types/dialogtyperegistry\";\r\nimport { EditorUtils } from \"../editors/editorutils\";\r\nimport { SubDialogHelper } from \"../helpers/subdialoghelper\";\r\nimport { ToolButton } from \"../widgets/toolbar\";\r\nimport { Widget, WidgetDialogClass } from \"../widgets/widget\";\r\nimport { ColumnPickerDialog } from \"./columnpickerdialog\";\r\nimport { DataGrid } from \"./datagrid\";\r\n\r\n@Decorators.registerClass('Serenity.EntityGrid')\r\nexport class EntityGrid<TItem, TOptions> extends DataGrid<TItem, TOptions> {\r\n\r\n    constructor(container: JQuery, options?: TOptions) {\r\n        super(container, options);\r\n\r\n        this.element.addClass('route-handler')\r\n            .on('handleroute.' + this.uniqueName, (_, args: any) => this.handleRoute(args));\r\n    }\r\n\r\n    protected handleRoute(args: HandleRouteEventArgs): void {\r\n        if (!!args.handled)\r\n            return;\r\n\r\n        if (!!(args.route === 'new')) {\r\n            args.handled = true;\r\n            this.addButtonClick();\r\n            return;\r\n        }\r\n\r\n        var oldRequests = jQuery[\"active\"];\r\n\r\n        var parts = args.route.split('/');\r\n        if (!!(parts.length === 2 && parts[0] === 'edit')) {\r\n            args.handled = true;\r\n            this.editItem(decodeURIComponent(parts[1]));\r\n        }\r\n        else if (!!(parts.length === 2 && parts[1] === 'new')) {\r\n            args.handled = true;\r\n            this.editItemOfType(parts[0], null);\r\n        }\r\n        else if (!!(parts.length === 3 && parts[1] === 'edit')) {\r\n            args.handled = true;\r\n            this.editItemOfType(parts[0], decodeURIComponent(parts[2]));\r\n        }\r\n        else\r\n            return;\r\n\r\n        if (jQuery[\"active\"] > oldRequests && args.handled && args.index >= 0 && args.index < args.parts.length - 1) {\r\n            $(document).one('ajaxStop', () => {\r\n                setTimeout(() => Router.resolve('#' + args.parts.join('/+/')), 1);\r\n            });\r\n        }\r\n    }\r\n\r\n    protected usePager(): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected createToolbarExtensions(): void {\r\n        this.createIncludeDeletedButton();\r\n        this.createQuickSearchInput();\r\n    }\r\n\r\n    protected getInitialTitle(): string {\r\n        return this.getDisplayName();\r\n    }\r\n\r\n    protected getLocalTextPrefix(): string {\r\n        var result = super.getLocalTextPrefix();\r\n\r\n        if (isEmptyOrNull(result)) {\r\n            return this.getEntityType();\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    private entityType: string;\r\n\r\n    protected getEntityType(): string {\r\n        if (this.entityType != null)\r\n            return this.entityType;\r\n\r\n        var attr = this.attrs(EntityTypeAttribute);\r\n\r\n        if (attr.length === 1) {\r\n            return (this.entityType = attr[0].value);\r\n        }\r\n\r\n        var name = getTypeFullName(getInstanceType(this));\r\n\r\n        var px = name.indexOf('.');\r\n        if (px >= 0) {\r\n            name = name.substring(px + 1);\r\n        }\r\n\r\n        if (endsWith(name, 'Grid')) {\r\n            name = name.substr(0, name.length - 4);\r\n        }\r\n        else if (endsWith(name, 'SubGrid')) {\r\n            name = name.substr(0, name.length - 7);\r\n        }\r\n\r\n        this.entityType = name;\r\n\r\n        return this.entityType;\r\n    }\r\n\r\n    private displayName: string;\r\n\r\n    protected getDisplayName(): string {\r\n        if (this.displayName != null)\r\n            return this.displayName;\r\n\r\n        var attr = this.attrs(DisplayNameAttribute);\r\n        if (attr.length >= 1) {\r\n            this.displayName = attr[0].displayName;\r\n            this.displayName = LT.getDefault(this.displayName, this.displayName);\r\n        }\r\n        else {\r\n            this.displayName = tryGetText(this.getLocalTextDbPrefix() + 'EntityPlural');\r\n            if (this.displayName == null)\r\n                this.displayName = this.getEntityType();\r\n        }\r\n\r\n        return this.displayName;\r\n    }\r\n\r\n    private itemName: string;\r\n\r\n    protected getItemName(): string {\r\n        if (this.itemName != null)\r\n            return this.itemName;\r\n\r\n        var attr = this.attrs(ItemNameAttribute);\r\n        if (attr.length >= 1) {\r\n            this.itemName = attr[0].value;\r\n            this.itemName = LT.getDefault(this.itemName, this.itemName);\r\n        }\r\n        else {\r\n            this.itemName = tryGetText(this.getLocalTextDbPrefix() + 'EntitySingular');\r\n            if (this.itemName == null)\r\n                this.itemName = this.getEntityType();\r\n        }\r\n\r\n        return this.itemName;\r\n    }\r\n\r\n    protected getAddButtonCaption(): string {\r\n        return format(text('Controls.EntityGrid.NewButton'), this.getItemName());\r\n    }\r\n\r\n    protected getButtons(): ToolButton[] {\r\n\r\n        var buttons: ToolButton[] = [];\r\n        buttons.push({\r\n            title: this.getAddButtonCaption(),\r\n            cssClass: 'add-button',\r\n            icon: 'fa-plus-circle text-green',\r\n            hotkey: 'alt+n',\r\n            onClick: () => {\r\n                this.addButtonClick();\r\n            },\r\n            disabled: () => !this.hasInsertPermission() || this.readOnly\r\n            });\r\n\r\n        buttons.push(this.newRefreshButton(true));\r\n        buttons.push(ColumnPickerDialog.createToolButton(this as any));\r\n\r\n        return buttons;\r\n    }\r\n\r\n    protected newRefreshButton(noText?: boolean): ToolButton {\r\n        return {\r\n            title: (noText ? null : text('Controls.EntityGrid.RefreshButton')),\r\n            hint: (noText ? text('Controls.EntityGrid.RefreshButton') : null),\r\n            icon: 'fa-refresh text-blue',\r\n            cssClass: 'refresh-button',\r\n            onClick: () => {\r\n                this.refresh();\r\n            }\r\n        };\r\n    }\r\n\r\n    protected addButtonClick(): void {\r\n        this.editItem(new Object());\r\n    }\r\n\r\n    protected editItem(entityOrId: any): void {\r\n        this.createEntityDialog(this.getItemType(), dlg => {\r\n            var dialog = safeCast(dlg, IEditDialog);\r\n            if (dialog != null) {\r\n                dialog.load(entityOrId, () => {\r\n                    dialog.dialogOpen(this.openDialogsAsPanel);\r\n                });\r\n\r\n                return;\r\n            }\r\n\r\n            throw new Error(\r\n                format(\"{0} doesn't implement IEditDialog!\",\r\n                    getTypeFullName(getInstanceType(dlg))));\r\n        });\r\n    }\r\n\r\n    protected editItemOfType(itemType: string, entityOrId: any): void {\r\n\r\n        if (itemType === this.getItemType()) {\r\n            this.editItem(entityOrId);\r\n            return;\r\n        }\r\n\r\n        this.createEntityDialog(itemType, dlg => {\r\n            var dialog = safeCast(dlg, IEditDialog);\r\n            if (dialog != null) {\r\n                dialog.load(entityOrId, () =>\r\n                    dialog.dialogOpen(this.openDialogsAsPanel));\r\n                return;\r\n            }\r\n\r\n            throw new Error(\r\n                format(\"{0} doesn't implement IEditDialog!\",\r\n                    getTypeFullName(getInstanceType(dlg))));\r\n        });\r\n    }\r\n\r\n    private service: string;\r\n\r\n    protected getService(): string {\r\n        if (this.service != null)\r\n            return this.service;\r\n\r\n        var attr = this.attrs(ServiceAttribute);\r\n        if (attr.length >= 1)\r\n            this.service = attr[0].value;\r\n        else\r\n            this.service = replaceAll(this.getEntityType(), '.', '/');\r\n\r\n        return this.service;\r\n    }\r\n\r\n    protected getViewOptions(): RemoteViewOptions {\r\n        var opt = super.getViewOptions();\r\n        opt.url = resolveUrl('~/Services/' + this.getService() + '/List');\r\n        return opt;\r\n    }\r\n\r\n    protected getItemType() {\r\n        return this.getEntityType();\r\n    }\r\n\r\n    protected routeDialog(itemType: string, dialog: Widget<any>) {\r\n        Router && Router.dialog && Router.dialog(this.element, dialog.element, () => {\r\n            var hash = '';\r\n\r\n            if (itemType !== this.getItemType())\r\n                hash = itemType + '/';\r\n\r\n            if (!!(dialog != null && (dialog as any).entityId != null))\r\n                hash += 'edit/' + (dialog as any).entityId.toString();\r\n            else\r\n                hash += 'new';\r\n\r\n            return hash;\r\n        });\r\n    }\r\n\r\n    protected getInsertPermission(): string {\r\n        return null;\r\n    }\r\n\r\n    protected hasInsertPermission(): boolean {\r\n        var insertPermission = this.getInsertPermission();\r\n        return insertPermission == null || Authorization.hasPermission(this.getInsertPermission());\r\n    }\r\n\r\n    protected transferDialogReadOnly(dialog: Widget<any>) {\r\n        if (this.readOnly)\r\n            EditorUtils.setReadOnly(dialog, true);\r\n    }\r\n\r\n    protected initDialog(dialog: Widget<any>): void {\r\n        SubDialogHelper.bindToDataChange(dialog, this, (e, dci) => {\r\n            this.subDialogDataChange();\r\n        }, true);\r\n\r\n        this.transferDialogReadOnly(dialog);\r\n        this.routeDialog(this.getItemType(), dialog);\r\n    }\r\n\r\n    protected initEntityDialog(itemType: string, dialog: Widget<any>): void {\r\n        if (itemType === this.getItemType()) {\r\n            this.initDialog(dialog);\r\n            return;\r\n        }\r\n\r\n        SubDialogHelper.bindToDataChange(dialog, this, (e, dci) => {\r\n            this.subDialogDataChange();\r\n        }, true);\r\n\r\n        this.transferDialogReadOnly(dialog);\r\n        this.routeDialog(itemType, dialog);\r\n    }\r\n\r\n    protected createEntityDialog(itemType: string, callback?: (dlg: Widget<any>) => void): Widget<any> {\r\n        var dialogClass = this.getDialogTypeFor(itemType);\r\n        var dialog = Widget.create({\r\n            type: dialogClass,\r\n            options: this.getDialogOptionsFor(itemType),\r\n            init: d => {\r\n                this.initEntityDialog(itemType, d);\r\n                callback && callback(d);\r\n            }\r\n        });\r\n\r\n        return dialog;\r\n    }\r\n\r\n    protected getDialogOptions(): JQueryUI.DialogOptions {\r\n        return {};\r\n    }\r\n\r\n    protected getDialogOptionsFor(itemType: string): JQueryUI.DialogOptions {\r\n        if (itemType === this.getItemType())\r\n            return this.getDialogOptions();\r\n\r\n        return {};\r\n    }\r\n\r\n    protected getDialogTypeFor(itemType: string): { new(...args: any[]): Widget<any> } {\r\n\r\n        if (itemType === this.getItemType()) {\r\n            return this.getDialogType();\r\n        }\r\n\r\n        return DialogTypeRegistry.get(itemType) as any;\r\n    }\r\n\r\n    private dialogType: WidgetDialogClass;\r\n\r\n    protected getDialogType(): { new(...args: any[]): Widget<any> } {\r\n\r\n        if (this.dialogType != null)\r\n            return this.dialogType;\r\n\r\n        var attr = this.attrs(DialogTypeAttribute);\r\n        if (attr.length >= 1)\r\n            this.dialogType = attr[0].value;\r\n        else\r\n            this.dialogType = DialogTypeRegistry.get(this.getEntityType());\r\n\r\n        return this.dialogType;\r\n    }\r\n}\r\n", "\uFEFFimport { Decorators, EntityTypeAttribute, FormKeyAttribute, IdPropertyAttribute, IsActivePropertyAttribute, ItemNameAttribute, LocalTextPrefixAttribute, NamePropertyAttribute, ServiceAttribute } from \"../../decorators\";\r\nimport { IEditDialog, IReadOnly } from \"../../interfaces\";\r\nimport { any, Authorization, confirm, DeleteRequest, DeleteResponse, endsWith, Exception, extend, format, getAttributes, getForm, getFormData, getFormDataAsync, getInstanceType, getTypeFullName, isArray, isEmptyOrNull, LT, notifySuccess, PropertyItem, PropertyItemsData, replaceAll, RetrieveRequest, RetrieveResponse, safeCast, SaveRequest, SaveResponse, ScriptData, serviceCall, ServiceOptions, startsWith, text, tryGetText, UndeleteRequest, UndeleteResponse, validatorAbortHandler } from \"@serenity-is/corelib/q\";\r\nimport { EditorUtils } from \"../editors/editorutils\";\r\nimport { SubDialogHelper } from \"../helpers/subdialoghelper\";\r\nimport { TabsExtensions } from \"../helpers/tabsextensions\";\r\nimport { ValidationHelper } from \"../helpers/validationhelper\";\r\nimport { PropertyGrid, PropertyGridMode, PropertyGridOptions } from \"../widgets/propertygrid\";\r\nimport { Toolbar, ToolButton } from \"../widgets/toolbar\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { TemplatedDialog } from \"./templateddialog\";\r\n\r\n@Decorators.registerClass('Serenity.EntityDialog', [IEditDialog, IReadOnly])\r\nexport class EntityDialog<TItem, TOptions> extends TemplatedDialog<TOptions> implements IEditDialog, IReadOnly {\r\n\r\n    protected entity: TItem;\r\n    protected entityId: any;\r\n    protected propertyItemsData: PropertyItemsData;\r\n    protected propertyGrid: PropertyGrid;\r\n\r\n    protected toolbar: Toolbar;\r\n    protected saveAndCloseButton: JQuery;\r\n    protected applyChangesButton: JQuery;\r\n    protected deleteButton: JQuery;\r\n    protected undeleteButton: JQuery;\r\n    protected cloneButton: JQuery;\r\n    protected editButton: JQuery;\r\n\r\n    protected localizationGrid: PropertyGrid;\r\n    protected localizationButton: JQuery;\r\n    protected localizationPendingValue: any;\r\n    protected localizationLastValue: any;\r\n\r\n    static defaultLanguageList: () => string[][];\r\n\r\n    constructor(opt?: TOptions) {\r\n        super(opt);\r\n\r\n        if (this.useAsync())\r\n            this.initAsync();\r\n        else \r\n            this.initSync();        \r\n    }\r\n\r\n    internalInit() {\r\n        this.initPropertyGrid();\r\n        this.initLocalizationGrid();\r\n    }\r\n\r\n    protected initSync() {\r\n        this.propertyItemsData = this.getPropertyItemsData();\r\n        this.internalInit();\r\n        this.afterInit();\r\n    }\r\n\r\n    protected async initAsync() {\r\n        this.propertyItemsData = await this.getPropertyItemsDataAsync();\r\n        this.internalInit();\r\n        this.afterInit();\r\n    }\r\n\r\n    protected afterInit() {\r\n    }    \r\n\r\n    protected useAsync() {\r\n        return false;\r\n    }    \r\n\r\n    destroy(): void {\r\n\r\n        if (this.propertyGrid) {\r\n            this.propertyGrid.destroy();\r\n            this.propertyGrid = null;\r\n        }\r\n\r\n        if (this.localizationGrid) {\r\n            this.localizationGrid.destroy();\r\n            this.localizationGrid = null;\r\n        }\r\n\r\n        this.undeleteButton = null;\r\n        this.applyChangesButton = null;\r\n        this.deleteButton = null;\r\n        this.saveAndCloseButton = null;\r\n        this.editButton = null;\r\n        this.cloneButton = null;\r\n        this.toolbar = null;\r\n\r\n        super.destroy();\r\n    }\r\n\r\n    protected get_entity(): TItem {\r\n        return this.entity;\r\n    }\r\n\r\n    protected set_entity(entity: any): void {\r\n        this.entity = entity || new Object();\r\n    }\r\n\r\n    protected get_entityId(): any {\r\n        return this.entityId;\r\n    }\r\n\r\n    protected set_entityId(value: any) {\r\n        this.entityId = value;\r\n    }\r\n\r\n    protected getEntityNameFieldValue(): any {\r\n        return (this.get_entity()[this.getNameProperty()] ?? '').toString();\r\n    }\r\n\r\n    protected getEntityTitle(): string {\r\n        if (!this.isEditMode()) {\r\n            return format(text('Controls.EntityDialog.NewRecordTitle'), this.getEntitySingular());\r\n        }\r\n        else {\r\n            var titleFormat = (this.isViewMode() || this.readOnly || !this.hasSavePermission()) ?\r\n                text('Controls.EntityDialog.ViewRecordTitle') : text('Controls.EntityDialog.EditRecordTitle');\r\n            var title = this.getEntityNameFieldValue() ?? '';\r\n            return format(titleFormat,\r\n                this.getEntitySingular(), (isEmptyOrNull(title) ? '' : (' (' + title + ')')));\r\n        }\r\n    }\r\n\r\n    protected updateTitle(): void {\r\n        this.dialogTitle = this.getEntityTitle();\r\n    }\r\n\r\n    protected isCloneMode(): boolean {\r\n        return false;\r\n    }\r\n\r\n    protected isEditMode(): boolean {\r\n        return this.get_entityId() != null && !this.isCloneMode();\r\n    }\r\n\r\n    protected isDeleted(): boolean {\r\n        if (this.get_entityId() == null) {\r\n            return false;\r\n        }\r\n\r\n        var isDeletedProperty = this.getIsDeletedProperty();\r\n        if (isDeletedProperty) {\r\n            return !!this.get_entity()[isDeletedProperty];\r\n        }\r\n\r\n        var value = this.get_entity()[this.getIsActiveProperty()];\r\n        if (value == null) {\r\n            return false;\r\n        }\r\n\r\n        return value < 0;\r\n    }\r\n\r\n    protected isNew(): boolean {\r\n        return this.get_entityId() == null;\r\n    }\r\n\r\n    protected isNewOrDeleted(): boolean {\r\n        return this.isNew() || this.isDeleted();\r\n    }\r\n\r\n    protected getDeleteOptions(callback: (response: DeleteResponse) => void): ServiceOptions<DeleteResponse> {\r\n        return {};\r\n    }\r\n\r\n    protected deleteHandler(options: ServiceOptions<DeleteResponse>, callback: (response: DeleteResponse) => void): void {\r\n        serviceCall(options);\r\n    }\r\n\r\n    protected doDelete(callback: (response: DeleteResponse) => void): void {\r\n        var self = this;\r\n\r\n        var request: DeleteRequest = {\r\n            EntityId: this.get_entityId()\r\n        };\r\n\r\n        var baseOptions: ServiceOptions<DeleteResponse> = {\r\n            service: this.getService() + '/Delete',\r\n            request: request,\r\n            onSuccess: response => {\r\n                self.onDeleteSuccess(response);\r\n                if (callback != null) {\r\n                    callback(response);\r\n                }\r\n                self.element.triggerHandler('ondatachange', [{\r\n                    entityId: request.EntityId,\r\n                    entity: this.entity,\r\n                    type: 'delete'\r\n                }]);\r\n            }\r\n        };\r\n\r\n        var thisOptions = this.getDeleteOptions(callback);\r\n        var finalOptions = extend(baseOptions, thisOptions);\r\n\r\n        this.deleteHandler(finalOptions, callback);\r\n    }\r\n\r\n    protected onDeleteSuccess(response: DeleteResponse): void {\r\n    }\r\n\r\n    protected attrs<TAttr>(attrType: { new(...args: any[]): TAttr }): TAttr[] {\r\n        return getAttributes(getInstanceType(this), attrType, true);\r\n    }\r\n\r\n    private entityType: string;\r\n\r\n    protected getEntityType(): string {\r\n\r\n        if (this.entityType != null)\r\n            return this.entityType;\r\n\r\n        var typeAttributes = this.attrs(EntityTypeAttribute);\r\n\r\n        if (typeAttributes.length === 1)\r\n            return (this.entityType = typeAttributes[0].value);\r\n\r\n        // remove global namespace\r\n        var name = getTypeFullName(getInstanceType(this));\r\n        var px = name.indexOf('.');\r\n        if (px >= 0)\r\n            name = name.substring(px + 1);\r\n\r\n        // don't like this kind of convention, make it obsolete soon...\r\n        if (endsWith(name, 'Dialog') || endsWith(name, 'Control'))\r\n            name = name.substr(0, name.length - 6);\r\n        else if (endsWith(name, 'Panel'))\r\n            name = name.substr(0, name.length - 5);\r\n\r\n        return (this.entityType = name);\r\n    }\r\n\r\n    private formKey: string;\r\n\r\n    protected getFormKey(): string {\r\n        if (this.formKey != null)\r\n            return this.formKey;\r\n\r\n        var attributes = this.attrs(FormKeyAttribute);\r\n\r\n        if (attributes.length >= 1)\r\n            return (this.formKey = attributes[0].value);\r\n\r\n        return (this.formKey = this.getEntityType());\r\n    }\r\n\r\n    private localTextDbPrefix: string;\r\n\r\n    protected getLocalTextDbPrefix(): string {\r\n        if (this.localTextDbPrefix != null)\r\n            return this.localTextDbPrefix;\r\n\r\n        this.localTextDbPrefix = this.getLocalTextPrefix() ?? '';\r\n\r\n        if (this.localTextDbPrefix.length > 0 && !endsWith(this.localTextDbPrefix, '.'))\r\n            this.localTextDbPrefix = 'Db.' + this.localTextDbPrefix + '.';\r\n\r\n        return this.localTextDbPrefix;\r\n    }\r\n\r\n    protected getLocalTextPrefix(): string {\r\n        var attributes = this.attrs(LocalTextPrefixAttribute);\r\n\r\n        if (attributes.length >= 1)\r\n            return attributes[0].value;\r\n\r\n        return this.getEntityType();\r\n    }\r\n\r\n    private entitySingular: string;\r\n\r\n    protected getEntitySingular(): string {\r\n        if (this.entitySingular != null)\r\n            return this.entitySingular;\r\n\r\n        var attributes = this.attrs(ItemNameAttribute);\r\n\r\n        if (attributes.length >= 1) {\r\n            this.entitySingular = attributes[0].value;\r\n            this.entitySingular = LT.getDefault(this.entitySingular, this.entitySingular);\r\n        }\r\n        else {\r\n            var es = tryGetText(this.getLocalTextDbPrefix() + 'EntitySingular');\r\n            if (es == null) \r\n                es = this.getEntityType();\r\n            this.entitySingular = es;\r\n        }\r\n\r\n        return this.entitySingular;\r\n    }\r\n\r\n    private nameProperty: string;\r\n\r\n    protected getNameProperty(): string {\r\n        if (this.nameProperty != null)\r\n            return this.nameProperty;\r\n\r\n        var attributes = this.attrs(NamePropertyAttribute);\r\n\r\n        if (attributes.length >= 1)\r\n            this.nameProperty = attributes[0].value;\r\n        else\r\n            this.nameProperty = 'Name';\r\n\r\n        return this.nameProperty;\r\n    }\r\n\r\n    private idProperty: string;\r\n\r\n    protected getIdProperty(): string {\r\n        if (this.idProperty != null)\r\n            return this.idProperty;\r\n\r\n        var attributes = this.attrs(IdPropertyAttribute);\r\n        if (attributes.length >= 1)\r\n            this.idProperty = attributes[0].value;\r\n        else\r\n            this.idProperty = 'ID';\r\n\r\n        return this.idProperty;\r\n    }\r\n\r\n    protected isActiveProperty: string;\r\n\r\n    protected getIsActiveProperty(): string {\r\n        if (this.isActiveProperty != null)\r\n            return this.isActiveProperty;\r\n\r\n        var attributes = this.attrs(IsActivePropertyAttribute)\r\n        if (attributes.length >= 1)\r\n            this.isActiveProperty = attributes[0].value;\r\n        else\r\n            this.isActiveProperty = 'IsActive';\r\n\r\n        return this.isActiveProperty;\r\n    }\r\n\r\n    protected getIsDeletedProperty(): string {\r\n        return null;\r\n    }\r\n\r\n    protected service: string;\r\n\r\n    protected getService() {\r\n        if (this.service != null)\r\n            return this.service;\r\n\r\n        var attributes = this.attrs(ServiceAttribute);\r\n        if (attributes.length >= 1)\r\n            this.service = attributes[0].value;\r\n        else\r\n            this.service = replaceAll(this.getEntityType(), '.', '/');\r\n\r\n        return this.service;\r\n    }\r\n\r\n    load(entityOrId: any, done: () => void, fail: (ex: Exception) => void): void {\r\n\r\n        var action = () => {\r\n\r\n            if (entityOrId == null) {\r\n                this.loadResponse({});\r\n                done && done();\r\n                return;\r\n            }\r\n\r\n            var scriptType = typeof (entityOrId);\r\n            if (scriptType === 'string' || scriptType === 'number') {\r\n                var entityId = entityOrId;\r\n\r\n                this.loadById(entityId, function (response) {\r\n                    if (done)\r\n                        window.setTimeout(done, 0);\r\n                }, null);\r\n\r\n                return;\r\n            }\r\n\r\n            var entity = entityOrId || new Object();\r\n            this.loadResponse({ Entity: entity });\r\n            done && done();\r\n        };\r\n\r\n        if (fail == null) {\r\n            action();\r\n            return;\r\n        }\r\n\r\n        try {\r\n            action();\r\n        }\r\n        catch (ex1) {\r\n            var ex = (Exception as any).wrap(ex1);\r\n            fail(ex);\r\n        }\r\n    }\r\n\r\n    loadNewAndOpenDialog(asPanel?: boolean): void {\r\n        this.loadResponse({});\r\n        this.dialogOpen(asPanel);\r\n    }\r\n\r\n    loadEntityAndOpenDialog(entity: TItem, asPanel?: boolean): void {\r\n        this.loadResponse({ Entity: entity });\r\n        this.dialogOpen(asPanel);\r\n    }\r\n\r\n    protected loadResponse(data: any): void {\r\n        data = data || {};\r\n        this.onLoadingData(data);\r\n        var entity = data.Entity || new Object();\r\n        this.beforeLoadEntity(entity);\r\n        this.loadEntity(entity);\r\n        this.set_entity(entity);\r\n        this.afterLoadEntity();\r\n    }\r\n\r\n    protected loadEntity(entity: TItem): void {\r\n        var idField = this.getIdProperty();\r\n\r\n        if (idField != null)\r\n            this.set_entityId(entity[idField]);\r\n        \r\n        this.set_entity(entity);\r\n\r\n        if (this.propertyGrid != null) {\r\n            this.propertyGrid.set_mode((this.isEditMode() ?\r\n                PropertyGridMode.update : PropertyGridMode.insert));\r\n            this.propertyGrid.load(entity);\r\n        }\r\n    }\r\n\r\n    protected beforeLoadEntity(entity: TItem): void {\r\n        this.localizationPendingValue = null;\r\n        this.localizationLastValue = null;\r\n    }\r\n\r\n    protected afterLoadEntity(): void {\r\n        this.updateInterface();\r\n        this.updateTitle();\r\n    }\r\n\r\n    public loadByIdAndOpenDialog(entityId: any, asPanel?: boolean) {\r\n        this.loadById(entityId,\r\n            response => window.setTimeout(() => this.dialogOpen(asPanel), 0),\r\n            () => {\r\n                if (!this.element.is(':visible')) {\r\n                    this.element.remove();\r\n                }\r\n            });\r\n    }\r\n\r\n    protected onLoadingData(data: RetrieveResponse<TItem>): void {\r\n    }\r\n\r\n    protected getLoadByIdOptions(id: any, callback: (response: RetrieveResponse<TItem>) => void): ServiceOptions<RetrieveResponse<TItem>> {\r\n        return {};\r\n    }\r\n\r\n    protected getLoadByIdRequest(id: any): RetrieveRequest {\r\n        var request: RetrieveRequest = {};\r\n        request.EntityId = id;\r\n        return request;\r\n    }\r\n\r\n    protected reloadById(): void {\r\n        this.loadById(this.get_entityId());\r\n    }\r\n\r\n    loadById(id: any, callback?: (response: RetrieveResponse<TItem>) => void, fail?: () => void) {\r\n        var baseOptions: ServiceOptions<RetrieveResponse<TItem>> = {\r\n            service: this.getService() + '/Retrieve',\r\n            blockUI: true,\r\n            request: this.getLoadByIdRequest(id),\r\n            onSuccess: response => {\r\n                this.loadResponse(response);\r\n                callback && callback(response);\r\n            },\r\n            onCleanup: () => {\r\n                if (this.validator != null) {\r\n                    validatorAbortHandler(this.validator);\r\n                }\r\n            }\r\n        };\r\n\r\n        var thisOptions = this.getLoadByIdOptions(id, callback);\r\n        var finalOptions = extend(baseOptions, thisOptions);\r\n        this.loadByIdHandler(finalOptions, callback, fail);\r\n    }\r\n\r\n    protected loadByIdHandler(options: ServiceOptions<RetrieveResponse<TItem>>, callback: (response: RetrieveResponse<TItem>) => void, fail: () => void): void {\r\n        var request = serviceCall(options);\r\n        fail && request.fail(fail);\r\n    }\r\n\r\n    protected initLocalizationGrid(): void {\r\n        var pgDiv = this.byId('PropertyGrid');\r\n        if (pgDiv.length <= 0) {\r\n            return;\r\n        }\r\n        var pgOptions = this.getPropertyGridOptions();\r\n        this.initLocalizationGridCommon(pgOptions);\r\n    }\r\n\r\n    protected initLocalizationGridCommon(pgOptions: PropertyGridOptions) {\r\n        var pgDiv = this.byId('PropertyGrid');\r\n\r\n        if (!any(pgOptions.items, x => x.localizable === true))\r\n            return;\r\n\r\n        var localGridDiv = $('<div/>')\r\n            .attr('id', this.idPrefix + 'LocalizationGrid')\r\n            .hide().insertAfter(pgDiv);\r\n\r\n        pgOptions.idPrefix = this.idPrefix + 'Localization_';\r\n\r\n        var items: PropertyItem[] = [];\r\n        for (var item1 of pgOptions.items) {\r\n            var langs = null;\r\n\r\n            if (item1.localizable === true) {\r\n                var copy = extend({}, item1);\r\n                copy.oneWay = true;\r\n                copy.readOnly = true;\r\n                copy.required = false;\r\n                copy.defaultValue = null;\r\n                items.push(copy);\r\n\r\n                if (langs == null)\r\n                    langs = this.getLangs();\r\n\r\n                for (var lang of langs) {\r\n                    copy = extend({}, item1);\r\n                    copy.name = lang[0] + '$' + copy.name;\r\n                    copy.title = lang[1];\r\n                    copy.cssClass = [copy.cssClass, 'translation'].join(' ');\r\n                    copy.insertable = true;\r\n                    copy.updatable = true;\r\n                    copy.oneWay = false;\r\n                    copy.required = false;\r\n                    copy.localizable = false;\r\n                    copy.defaultValue = null;\r\n                    items.push(copy);\r\n                }\r\n            }\r\n        }\r\n\r\n        pgOptions.items = items;\r\n\r\n        this.localizationGrid = (new PropertyGrid(localGridDiv, pgOptions)).init(null);\r\n        localGridDiv.addClass('s-LocalizationGrid');\r\n    }\r\n\r\n    protected isLocalizationMode(): boolean {\r\n        return this.localizationButton != null && this.localizationButton.hasClass('pressed');\r\n    }\r\n\r\n    protected isLocalizationModeAndChanged(): boolean {\r\n        if (!this.isLocalizationMode()) {\r\n            return false;\r\n        }\r\n\r\n        var newValue = this.getLocalizationGridValue();\r\n        return JSON.stringify(this.localizationLastValue) !=  JSON.stringify(newValue);\r\n    }\r\n\r\n    protected localizationButtonClick(): void {\r\n        if (this.isLocalizationMode() && !this.validateForm()) {\r\n            return;\r\n        }\r\n\r\n        if (this.isLocalizationModeAndChanged()) {\r\n            var newValue = this.getLocalizationGridValue();\r\n            this.localizationLastValue = newValue;\r\n            this.localizationPendingValue = newValue;\r\n        }\r\n\r\n        this.localizationButton.toggleClass('pressed');\r\n        this.updateInterface();\r\n        if (this.isLocalizationMode()) {\r\n            this.loadLocalization();\r\n        }\r\n    }\r\n\r\n    protected getLanguages(): any[] {\r\n        if (EntityDialog.defaultLanguageList != null)\r\n            return EntityDialog.defaultLanguageList() || [];\r\n\r\n        return [];\r\n    }\r\n\r\n    // for compatibility with older getLanguages methods written in Saltaralle\r\n    private getLangs(): any {\r\n\r\n        var langsTuple = this.getLanguages();\r\n        var langs = safeCast(langsTuple, Array);\r\n        if (langs == null || langs.length === 0 ||\r\n            langs[0] == null || !isArray(langs[0])) {\r\n            langs = Array.prototype.slice.call(langsTuple.map(function (x: any) {\r\n                return [x.item1, x.item2];\r\n            }));\r\n        }\r\n\r\n        return langs;\r\n    }\r\n\r\n    protected loadLocalization(): void {\r\n        if (this.localizationLastValue == null && this.isNew()) {\r\n            this.localizationGrid.load({});\r\n            this.setLocalizationGridCurrentValues();\r\n            this.localizationLastValue = this.getLocalizationGridValue();\r\n            return;\r\n        }\r\n\r\n        if (this.localizationLastValue != null) {\r\n            this.localizationGrid.load(this.localizationLastValue);\r\n            this.setLocalizationGridCurrentValues();\r\n            return;\r\n        }\r\n\r\n        var opt = <ServiceOptions<any>>{\r\n            service: this.getService() + '/Retrieve',\r\n            blockUI: true,\r\n            request: {\r\n                EntityId: this.get_entityId(),\r\n                ColumnSelection: 'keyOnly',\r\n                IncludeColumns: ['Localizations']\r\n            },\r\n            onSuccess: response => {\r\n                var copy = extend(new Object(), this.get_entity());\r\n                if (response.Localizations) {\r\n                    for (var language of Object.keys(response.Localizations)) {\r\n                        var entity = response.Localizations[language];\r\n                        for (var key of Object.keys(entity)) {\r\n                            copy[language + '$' + key] = entity[key];\r\n                        }\r\n                    }\r\n                }\r\n                \r\n                this.localizationGrid.load(copy);\r\n                this.setLocalizationGridCurrentValues();\r\n                this.localizationPendingValue = null;\r\n                this.localizationLastValue = this.getLocalizationGridValue();\r\n            }\r\n        };\r\n\r\n        serviceCall(opt);\r\n    }\r\n\r\n    protected setLocalizationGridCurrentValues(): void {\r\n        var valueByName = {};\r\n\r\n        this.localizationGrid.enumerateItems((item, widget) => {\r\n            if (item.name.indexOf('$') < 0 && widget.element.is(':input')) {\r\n                valueByName[item.name] = this.byId(item.name).val();\r\n                widget.element.val(valueByName[item.name]);\r\n            }\r\n        });\r\n\r\n        this.localizationGrid.enumerateItems((item1, widget1) => {\r\n            var idx = item1.name.indexOf('$');\r\n            if (idx >= 0 && widget1.element.is(':input')) {\r\n                var hint = valueByName[item1.name.substr(idx + 1)];\r\n                if (hint != null && hint.length > 0) {\r\n                    widget1.element.attr('title', hint).attr('placeholder', hint);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    protected getLocalizationGridValue(): any {\r\n        var value = {};\r\n        this.localizationGrid.save(value);\r\n\r\n        for (var k of Object.keys(value)) {\r\n            if (k.indexOf('$') < 0) {\r\n                delete value[k];\r\n            }\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    protected getPendingLocalizations(): any {\r\n        if (this.localizationPendingValue == null) {\r\n            return null;\r\n        }\r\n\r\n        var result: { [key: string]: any } = {};\r\n        var idField = this.getIdProperty();\r\n        var langs = this.getLangs();\r\n\r\n        for (var pair of langs) {\r\n            var language = pair[0];\r\n            var entity: any = {};\r\n\r\n            if (idField != null) {\r\n                entity[idField] = this.get_entityId();\r\n            }\r\n\r\n            var prefix = language + '$';\r\n\r\n            for (var k of Object.keys(this.localizationPendingValue)) {\r\n                if (startsWith(k, prefix)) \r\n                    entity[k.substr(prefix.length)] = this.localizationPendingValue[k];\r\n            }\r\n\r\n            result[language] = entity;\r\n        }\r\n\r\n        return result;\r\n    }\r\n\r\n    protected initPropertyGrid(): void {\r\n        var pgDiv = this.byId('PropertyGrid');\r\n        if (pgDiv.length <= 0) {\r\n            return;\r\n        }\r\n        var pgOptions = this.getPropertyGridOptions();\r\n        this.propertyGrid = (new PropertyGrid(pgDiv, pgOptions)).init(null);\r\n        if (this.element.closest('.ui-dialog').hasClass('s-Flexify')) {\r\n            this.propertyGrid.element.children('.categories').flexHeightOnly(1);\r\n        }\r\n    }\r\n\r\n    protected getPropertyItems() {\r\n        return this.propertyItemsData?.items || [];\r\n    }\r\n\r\n    protected getPropertyItemsData(): PropertyItemsData {\r\n        var formKey = this.getFormKey();\r\n\r\n        if (this.getFormKey === EntityDialog.prototype.getFormKey &&\r\n            this.getPropertyItems !== EntityDialog.prototype.getPropertyItems &&\r\n            !ScriptData.canLoad('Form.' + formKey)) {\r\n            return {\r\n                items: this.getPropertyItems(),\r\n                additionalItems: []\r\n            }\r\n        }\r\n\r\n        if (!isEmptyOrNull(formKey)) {\r\n            return getFormData(formKey);\r\n        }\r\n\r\n        return { items: [], additionalItems: [] };\r\n    }\r\n\r\n    protected async getPropertyItemsDataAsync(): Promise<PropertyItemsData> {\r\n        var formKey = this.getFormKey();\r\n        if (!isEmptyOrNull(formKey)) {\r\n            return await getFormDataAsync(formKey);\r\n        }\r\n\r\n        return { items: [], additionalItems: [] };\r\n    }    \r\n\r\n    protected getPropertyGridOptions(): PropertyGridOptions {\r\n        return {\r\n            idPrefix: this.idPrefix,\r\n            items: this.getPropertyItems(),\r\n            mode: PropertyGridMode.insert,\r\n            localTextPrefix: 'Forms.' + this.getFormKey() + '.',\r\n            useCategories: true\r\n        };\r\n    }\r\n\r\n    protected validateBeforeSave(): boolean {\r\n        return true;\r\n    }\r\n\r\n    protected getSaveOptions(callback: (response: SaveResponse) => void): ServiceOptions<SaveResponse> {\r\n\r\n        var opt: ServiceOptions<SaveResponse> = {};\r\n\r\n        opt.service = this.getService() + '/' + (this.isEditMode() ? 'Update' : 'Create'),\r\n\r\n        opt.onSuccess = response => {\r\n            this.onSaveSuccess(response);\r\n\r\n            callback && callback(response);\r\n\r\n            var typ = (this.isEditMode() ? 'update' : 'create');\r\n\r\n            var ent = opt.request == null ? null : opt.request.Entity;\r\n            var eid: any = this.isEditMode() ? this.get_entityId() :\r\n                (response == null ? null : response.EntityId);\r\n\r\n            var dci = {\r\n                type: typ,\r\n                entity: ent,\r\n                entityId: eid\r\n            };\r\n\r\n            this.element.triggerHandler('ondatachange', [dci]);\r\n        };\r\n\r\n        opt.onCleanup = () => {\r\n            this.validator && validatorAbortHandler(this.validator);\r\n        };\r\n\r\n        opt.request = this.getSaveRequest();\r\n\r\n        return opt;\r\n    }\r\n\r\n    protected getSaveEntity(): TItem {\r\n\r\n        var entity: TItem = new Object() as any;\r\n\r\n        if (this.propertyGrid != null) {\r\n            this.propertyGrid.save(entity);\r\n        }\r\n\r\n        if (this.isEditMode()) {\r\n            var idField = this.getIdProperty();\r\n            if (idField != null && entity[idField] == null) {\r\n                entity[idField] = this.get_entityId();\r\n            }\r\n        }\r\n\r\n        return entity;\r\n    }\r\n\r\n    protected getSaveRequest(): SaveRequest<TItem> {\r\n\r\n        var entity = this.getSaveEntity();\r\n        var req: SaveRequest<TItem> = {};\r\n        req.Entity = entity;\r\n\r\n        if (this.isEditMode()) {\r\n            var idField = this.getIdProperty();\r\n            if (idField != null) {\r\n                req.EntityId = this.get_entityId();\r\n            }\r\n        }\r\n\r\n        if (this.localizationPendingValue != null) {\r\n            req.Localizations = this.getPendingLocalizations();\r\n        }\r\n\r\n        return req;\r\n    }\r\n\r\n    protected onSaveSuccess(response: SaveResponse): void {\r\n    }\r\n\r\n    protected save_submitHandler(callback: (response: SaveResponse) => void): void {\r\n        var options = this.getSaveOptions(callback);\r\n        this.saveHandler(options, callback);\r\n    }\r\n\r\n    protected save(callback?: (response: SaveResponse) => void): void | boolean {\r\n        return ValidationHelper.submit(this.byId('Form'),\r\n            () => this.validateBeforeSave(),\r\n            () => this.save_submitHandler(callback));\r\n    }\r\n\r\n    protected saveHandler(options: ServiceOptions<SaveResponse>,\r\n        callback: (response: SaveResponse) => void): void {\r\n        serviceCall(options);\r\n    }\r\n\r\n    protected initToolbar(): void {\r\n\r\n        super.initToolbar();\r\n\r\n        if (!this.toolbar)\r\n            return;\r\n\r\n        this.saveAndCloseButton = this.toolbar.findButton('save-and-close-button');\r\n        this.applyChangesButton = this.toolbar.findButton('apply-changes-button');\r\n        this.deleteButton = this.toolbar.findButton('delete-button');\r\n        this.undeleteButton = this.toolbar.findButton('undo-delete-button');\r\n        this.editButton = this.toolbar.findButton('edit-button');\r\n        this.cloneButton = this.toolbar.findButton('clone-button');\r\n        this.localizationButton = this.toolbar.findButton('localization-button');\r\n    }\r\n\r\n    protected showSaveSuccessMessage(response: SaveResponse): void {\r\n        notifySuccess(text('Controls.EntityDialog.SaveSuccessMessage'), '', null);\r\n    }\r\n\r\n    protected getToolbarButtons(): ToolButton[] {\r\n        var list: ToolButton[] = [];\r\n\r\n        list.push({\r\n            title: text('Controls.EntityDialog.SaveButton'),\r\n            cssClass: 'save-and-close-button',\r\n            icon: 'fa-check-circle text-purple',\r\n            hotkey: 'alt+s',\r\n            onClick: () => {\r\n                this.save(response => {\r\n                    this.dialogClose();\r\n                });\r\n            },\r\n            visible: () => !this.isDeleted() && !this.isViewMode(),\r\n            disabled: () => !this.hasSavePermission() || this.readOnly\r\n        });\r\n\r\n        list.push({\r\n            title: '',\r\n            hint: text('Controls.EntityDialog.ApplyChangesButton'),\r\n            cssClass: 'apply-changes-button',\r\n            icon: 'fa-clipboard-check text-purple',\r\n            hotkey: 'alt+a',\r\n            onClick: () => {\r\n                this.save(response1 => {\r\n\r\n                    if (this.isEditMode()) {\r\n                        var id1 = response1.EntityId;\r\n                        if (id1 == null) {\r\n                            id1 = this.get_entityId();\r\n                        }\r\n                        this.loadById(id1);\r\n                    }\r\n                    else {\r\n                        this.loadById(response1.EntityId);\r\n                    }\r\n\r\n                    this.showSaveSuccessMessage(response1);\r\n                });\r\n            },\r\n            visible: () => !this.isDeleted() && !this.isViewMode(),\r\n            disabled: () => !this.hasSavePermission() || this.readOnly\r\n        });\r\n\r\n        list.push({\r\n            title: text('Controls.EntityDialog.DeleteButton'),\r\n            cssClass: 'delete-button',\r\n            icon: 'fa-trash-o text-red',\r\n            hotkey: 'alt+x',\r\n            onClick: () => {\r\n                confirm(text('Controls.EntityDialog.DeleteConfirmation'), () => {\r\n                    this.doDelete(() => this.dialogClose());\r\n                });\r\n            },\r\n            visible: () => this.isEditMode() && !this.isDeleted() && !this.isViewMode(),\r\n            disabled: () => !this.hasDeletePermission() || this.readOnly\r\n        });\r\n\r\n        list.push({\r\n            title: text('Controls.EntityDialog.UndeleteButton'),\r\n            cssClass: 'undo-delete-button',\r\n            onClick: () => {\r\n                if (this.isDeleted()) {\r\n                    confirm(text('Controls.EntityDialog.UndeleteConfirmation'), () => {\r\n                        this.undelete(() => this.loadById(this.get_entityId()));\r\n                    });\r\n                }\r\n            },\r\n            visible: () => this.isEditMode() && this.isDeleted() && !this.isViewMode(),\r\n            disabled: () => !this.hasDeletePermission() || this.readOnly\r\n        });\r\n\r\n        if (this.useViewMode()) {\r\n            list.push({\r\n                title: text('Controls.EntityDialog.EditButton'),\r\n                cssClass: 'edit-button',\r\n                icon: 'fa-edit',\r\n                onClick: () => {\r\n                    if (!this.isEditMode())\r\n                        return;\r\n\r\n                    this.editClicked = true;\r\n                    this.updateInterface();\r\n                    this.updateTitle();\r\n                },\r\n                visible: () => this.isViewMode(),\r\n                disabled: () => !this.hasSavePermission() || this.readOnly\r\n            });\r\n        }\r\n\r\n        list.push({\r\n            title: text('Controls.EntityDialog.LocalizationButton'),\r\n            cssClass: 'localization-button',\r\n            onClick: () => this.localizationButtonClick()\r\n        });\r\n\r\n        list.push({\r\n            title: text('Controls.EntityDialog.CloneButton'),\r\n            cssClass: 'clone-button',\r\n            icon: 'fa-clone',\r\n            onClick: () => {\r\n\r\n                if (!this.isEditMode()) {\r\n                    return;\r\n                }\r\n\r\n                var cloneEntity = this.getCloningEntity();\r\n\r\n                Widget.create({\r\n                    type: getInstanceType(this),\r\n                    init: w => SubDialogHelper.bubbleDataChange(\r\n                        SubDialogHelper.cascade(w, this.element), this, true)\r\n                        .loadEntityAndOpenDialog(cloneEntity, null)\r\n                });\r\n            },\r\n            visible: () => false,\r\n            disabled: () => !this.hasInsertPermission() || this.readOnly\r\n        });\r\n\r\n        return list;\r\n    }\r\n\r\n    protected getCloningEntity(): TItem {\r\n\r\n        var clone: TItem = new Object() as any;\r\n        clone = extend(clone, this.get_entity());\r\n\r\n        var idField = this.getIdProperty();\r\n        if (!isEmptyOrNull(idField)) {\r\n            delete clone[idField];\r\n        }\r\n\r\n        var isActiveField = this.getIsActiveProperty();\r\n        if (!isEmptyOrNull(isActiveField)) {\r\n            delete clone[isActiveField];\r\n        }\r\n\r\n        var isDeletedField = this.getIsDeletedProperty();\r\n        if (!isEmptyOrNull(isDeletedField)) {\r\n            delete clone[isDeletedField];\r\n        }\r\n\r\n        return clone;\r\n    }\r\n\r\n    protected updateInterface(): void {\r\n\r\n        EditorUtils.setContainerReadOnly(this.byId('Form'), false);\r\n\r\n        var isLocalizationMode = this.isLocalizationMode();\r\n        var hasSavePermission = this.hasSavePermission();\r\n        var viewMode = this.isViewMode();\r\n        var readOnly = this.readOnly;\r\n\r\n        this.toolbar.updateInterface();\r\n\r\n        if (this.tabs != null) {\r\n            TabsExtensions.setDisabled(this.tabs, 'Log', this.isNewOrDeleted());\r\n        }\r\n\r\n        if (this.propertyGrid != null) {\r\n            this.propertyGrid.element.toggle(!isLocalizationMode);\r\n        }\r\n\r\n        if (this.localizationGrid != null) {\r\n            this.localizationGrid.element.toggle(isLocalizationMode);\r\n        }\r\n\r\n        if (this.localizationButton != null) {\r\n            this.localizationButton.toggle(this.localizationGrid != null);\r\n            this.localizationButton.find('.button-inner')\r\n                .text((this.isLocalizationMode() ?\r\n                    text('Controls.EntityDialog.LocalizationBack') :\r\n                    text('Controls.EntityDialog.LocalizationButton')));\r\n        }\r\n\r\n        if (isLocalizationMode) {\r\n\r\n            if (this.toolbar != null)\r\n                this.toolbar.findButton('tool-button')\r\n                    .not('.localization-hidden')\r\n                    .addClass('.localization-hidden').hide();\r\n\r\n            this.localizationButton && this.localizationButton.show();\r\n\r\n            return;\r\n        }\r\n\r\n        this.toolbar.findButton('localization-hidden')\r\n            .removeClass('localization-hidden').show();\r\n\r\n        if (!hasSavePermission || viewMode || readOnly)\r\n            EditorUtils.setContainerReadOnly(this.byId(\"Form\"), true);\r\n    }\r\n\r\n    protected getUndeleteOptions(callback?: (response: UndeleteResponse) => void): ServiceOptions<UndeleteResponse> {\r\n        return {}\r\n    }\r\n\r\n    protected undeleteHandler(options: ServiceOptions<UndeleteResponse>, callback: (response: UndeleteResponse) => void): void {\r\n        serviceCall(options);\r\n    }\r\n\r\n    protected undelete(callback?: (response: UndeleteResponse) => void): void {\r\n        var baseOptions: ServiceOptions<UndeleteResponse> = {};\r\n        baseOptions.service = this.getService() + '/Undelete';\r\n\r\n        var request: UndeleteRequest = {};\r\n        request.EntityId = this.get_entityId();\r\n\r\n        baseOptions.request = request;\r\n        baseOptions.onSuccess = response => {\r\n            callback && callback(response);\r\n            this.element.triggerHandler('ondatachange', [{\r\n                entityId: this.get_entityId(),\r\n                entity: this.entity,\r\n                type: 'undelete'\r\n            }]);\r\n        };\r\n\r\n        var thisOptions = this.getUndeleteOptions(callback);\r\n        var finalOptions = extend(baseOptions, thisOptions);\r\n        this.undeleteHandler(finalOptions, callback);\r\n    }\r\n\r\n    private _readonly: boolean;\r\n\r\n    public get readOnly(): boolean {\r\n        return this.get_readOnly();\r\n    }\r\n\r\n    public set readOnly(value: boolean) {\r\n        this.set_readOnly(value);\r\n    }\r\n\r\n    public get_readOnly() {\r\n        return !!this._readonly;\r\n    }\r\n\r\n    public set_readOnly(value: boolean) {\r\n        if (!!this._readonly != !!value) {\r\n            this._readonly = !!value;\r\n            this.updateInterface();\r\n            this.updateTitle();\r\n        }\r\n    }\r\n\r\n    protected getInsertPermission(): string {\r\n        return null;\r\n    }\r\n\r\n    protected getUpdatePermission(): string {\r\n        return null;\r\n    }\r\n\r\n    protected getDeletePermission(): string {\r\n        return null;\r\n    }\r\n\r\n    protected hasDeletePermission() {\r\n        var deletePermission = this.getDeletePermission();\r\n        return deletePermission == null || Authorization.hasPermission(deletePermission);\r\n    }\r\n\r\n    protected hasInsertPermission() {\r\n        var insertPermission = this.getInsertPermission();\r\n        return insertPermission == null || Authorization.hasPermission(insertPermission);\r\n    }\r\n\r\n    protected hasUpdatePermission() {\r\n        var updatePermission = this.getUpdatePermission();\r\n        return updatePermission == null || Authorization.hasPermission(updatePermission);\r\n    }\r\n\r\n    protected hasSavePermission(): boolean {\r\n        return this.isNew() ? this.hasInsertPermission() : this.hasUpdatePermission();\r\n    }\r\n\r\n    protected editClicked: boolean;\r\n\r\n    protected isViewMode() {\r\n        return this.useViewMode() && this.isEditMode() && !this.editClicked;\r\n    }\r\n\r\n    protected useViewMode() {\r\n        return false;\r\n    }\r\n\r\n    protected getFallbackTemplate() {\r\n        return `<div class=\"s-DialogContent\">\r\n    <div id=\"~_Toolbar\" class=\"s-DialogToolbar\">\r\n    </div>\r\n    <div class=\"s-Form\">\r\n        <form id=\"~_Form\" action=\"\">\r\n            <div class=\"fieldset\">\r\n                <div id=\"~_PropertyGrid\"></div>\r\n                <div class=\"clear\"></div>\r\n            </div>\r\n        </form> \r\n    </div>\r\n</div>`;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { postToService, PropertyItem, serviceCall, ServiceRequest, ServiceResponse, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { QuickSearchInput } from \"../datagrid/quicksearchinput\";\r\nimport { TemplatedDialog } from \"../dialogs/templateddialog\";\r\nimport { PropertyGrid } from \"./propertygrid\";\r\nimport { Widget } from \"./widget\";\r\n\r\nexport namespace Reporting {\r\n    export interface ReportDialogOptions {\r\n        reportKey?: string;\r\n    }\r\n\r\n    @Decorators.registerClass('Serenity.Reporting.ReportDialog')\r\n    export class ReportDialog extends TemplatedDialog<ReportDialogOptions> {\r\n        constructor(opt: ReportDialogOptions) {\r\n            super(opt);\r\n\r\n            if (opt.reportKey) {\r\n                this.loadReport(opt.reportKey);\r\n            }\r\n        }\r\n\r\n        protected propertyGrid: PropertyGrid;\r\n        protected propertyItems: PropertyItem[];\r\n        protected reportKey: string;\r\n\r\n        protected createPropertyGrid(): void {\r\n            if (this.propertyGrid) {\r\n                this.byId('PropertyGrid').html('').attr('class', '');\r\n                this.propertyGrid = null;\r\n            }\r\n            this.propertyGrid = (new PropertyGrid(this.byId('PropertyGrid'), {\r\n                idPrefix: this.idPrefix,\r\n                useCategories: true,\r\n                items: this.propertyItems\r\n            })).init(null);\r\n        }\r\n\r\n        loadReport(reportKey: string): void {\r\n            serviceCall({\r\n                service: 'Report/Retrieve', request: { ReportKey: reportKey },\r\n                onSuccess: (response: ReportRetrieveResponse) => {\r\n                    this.reportKey = response.ReportKey ?? reportKey;\r\n                    this.propertyItems = response.Properties || [];\r\n                    this.dialogTitle = response.Title;\r\n                    this.createPropertyGrid();\r\n                    var set = response.InitialSettings;\r\n                    if (set == null) {\r\n                        set = new Object();\r\n                    }\r\n                    this.propertyGrid.load(set);\r\n                    this.toolbar.findButton('print-preview-button').toggle(!response.IsDataOnlyReport);\r\n                    this.toolbar.findButton('export-pdf-button').toggle(!response.IsDataOnlyReport);\r\n                    this.toolbar.findButton('export-docx-button').toggle(!response.IsDataOnlyReport);\r\n                    this.dialogOpen(null);\r\n                }\r\n            });\r\n        }\r\n\r\n        executeReport(targetFrame: string, exportType: string): void {\r\n            if (!this.validateForm()) {\r\n                return;\r\n            }\r\n            var parameters = new Object();\r\n            this.propertyGrid.save(parameters);\r\n            postToService({\r\n                service: 'Report/Execute',\r\n                request: {\r\n                    ReportKey: this.reportKey,\r\n                    DesignId: 'Default',\r\n                    ExportType: exportType,\r\n                    Parameters: parameters\r\n                }, target: targetFrame\r\n            });\r\n\r\n        }\r\n\r\n        protected getToolbarButtons() {\r\n            var buttons = [];\r\n            buttons.push({\r\n                title: '\u00D6nizleme', cssClass: 'print-preview-button', onClick: () => {\r\n                    this.executeReport('_blank', null);\r\n                }\r\n            });\r\n            buttons.push({\r\n                title: 'PDF', cssClass: 'export-pdf-button', onClick: () => {\r\n                    this.executeReport('', 'Pdf');\r\n                }\r\n            });\r\n            buttons.push({\r\n                title: 'Excel', cssClass: 'export-xlsx-button', onClick: () => {\r\n                    this.executeReport('', 'Xlsx');\r\n                }\r\n            });\r\n            buttons.push({\r\n                title: 'Word', cssClass: 'export-docx-button', onClick: () => {\r\n                    this.executeReport('', 'Docx');\r\n                }\r\n            });\r\n            return buttons;\r\n        }\r\n    }\r\n\r\n    export interface ReportExecuteRequest extends ServiceRequest {\r\n        ExportType?: string;\r\n        ReportKey?: string;\r\n        DesignId?: string;\r\n        Parameters?: any;\r\n    }\r\n\r\n    @Decorators.registerClass('Serenity.Reporting.ReportPage')\r\n    export class ReportPage extends Widget<any> {\r\n        constructor(div: JQuery) {\r\n            super(div);\r\n\r\n            $('.report-link').click((e) => this.reportLinkClick(e));\r\n            $('div.line').click((e) => this.categoryClick(e));\r\n            var self = this;\r\n            new QuickSearchInput($('#QuickSearchInput'), {\r\n                onSearch: function (field, text, done) {\r\n                    self.updateMatchFlags(text);\r\n                    done(true);\r\n                }\r\n            });\r\n        }\r\n\r\n        protected updateMatchFlags(text: string) {\r\n            var liList = $('#ReportList').find('li').removeClass('non-match');\r\n            text = trimToNull(text);\r\n            if (text == null) {\r\n                liList.children('ul').hide();\r\n                liList.show().removeClass('expanded');\r\n                return;\r\n            }\r\n            var parts = text.replace(',', ' ').split(' ');\r\n            for (var i = 0; i < parts.length; i++) {\r\n                parts[i] = trimToNull(Select2.util.stripDiacritics(parts[i]).toUpperCase());\r\n            }\r\n            var reportItems = liList.filter('.report-item');\r\n            reportItems.each(function (i1, e) {\r\n                var x = $(e);\r\n                var title = Select2.util.stripDiacritics((x.text() ?? '').toUpperCase());\r\n                for (var $t1 = 0; $t1 < parts.length; $t1++) {\r\n                    var p = parts[$t1];\r\n                    if (p != null && !(title.indexOf(p) !== -1)) {\r\n                        x.addClass('non-match');\r\n                        break;\r\n                    }\r\n                }\r\n            });\r\n            var matchingItems = reportItems.not('.non-match');\r\n            var visibles = matchingItems.parents('li').add(matchingItems);\r\n            var nonVisibles = liList.not(visibles);\r\n            nonVisibles.hide().addClass('non-match');\r\n            visibles.show();\r\n            if (visibles.length <= 100) {\r\n                liList.children('ul').show();\r\n                liList.addClass('expanded');\r\n            }\r\n        }\r\n\r\n        protected categoryClick(e: JQueryEventObject) {\r\n            var li = $(e.target).closest('li');\r\n            if (li.hasClass('expanded')) {\r\n                li.find('ul').hide('fast');\r\n                li.removeClass('expanded');\r\n                li.find('li').removeClass('expanded');\r\n            }\r\n            else {\r\n                li.addClass('expanded');\r\n                li.children('ul').show('fast');\r\n                if (li.children('ul').children('li').length === 1 && !li.children('ul').children('li').hasClass('expanded')) {\r\n                    li.children('ul').children('li').children('.line').click();\r\n                }\r\n            }\r\n        }\r\n\r\n        protected reportLinkClick(e: JQueryEventObject) {\r\n            e.preventDefault();\r\n            var dialog = new ReportDialog({ reportKey: $(e.target).data('key') });\r\n        }\r\n    }\r\n\r\n    export interface ReportRetrieveRequest extends ServiceRequest {\r\n        ReportKey?: string;\r\n    }\r\n\r\n    export interface ReportRetrieveResponse extends ServiceResponse {\r\n        ReportKey?: string;\r\n        Properties?: PropertyItem[];\r\n        Title?: string;\r\n        InitialSettings?: any;\r\n        IsDataOnlyReport?: boolean;\r\n    }\r\n}\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IGetEditValue, IReadOnly, ISetEditValue, IStringValue } from \"../../interfaces\";\r\nimport { LookupEditorBase, LookupEditorOptions } from \"./lookupeditor\";\r\n\r\n// legacy, don't use!\r\n@Decorators.registerEditor('Serenity.AsyncLookupEditor',\r\n    [ISetEditValue, IGetEditValue, IStringValue, IReadOnly])\r\nexport class AsyncLookupEditor extends LookupEditorBase<LookupEditorOptions, any> {\r\n    constructor(hidden: JQuery, opt: LookupEditorOptions) {\r\n        super(hidden, opt);\r\n    }\r\n\r\n    getLookupKey() {\r\n        return (this.options.lookupKey ?? super.getLookupKey());\r\n    }\r\n}\r\n\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\n\r\nexport interface ScriptContext {\r\n}\r\n\r\n@Decorators.registerClass('Serenity.ScriptContext')\r\nexport class ScriptContext {\r\n}", "\uFEFFimport { Decorators } from \"../decorators\";\r\n\r\n@Decorators.registerInterface('Serenity.IAsyncInit')\r\nexport class IAsyncInit {\r\n}", "\uFEFFimport { Widget } from \"./widget\";\r\n\r\nexport namespace WX {\r\n    export function getWidget<TWidget>(element: JQuery, type: any) {\r\n        return element.getWidget<TWidget>(type);\r\n    }\r\n\r\n    export var getWidgetName = Widget.getWidgetName;\r\n\r\n    export function hasOriginalEvent(e: any): boolean {\r\n        return !!!(typeof (e.originalEvent) === 'undefined');\r\n    }\r\n\r\n    export function change(widget: any, handler: any): void {\r\n        widget.change(handler)\r\n    }\r\n    \r\n    export function changeSelect2(widget: any, handler: any): void {\r\n        widget.changeSelect2(handler);\r\n    }\r\n\r\n    export function getGridField(widget: Widget<any>): JQuery {\r\n        return widget.getGridField();\r\n    }\r\n}\r\n\r\n", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { Widget } from \"./widget\";\r\nimport { LazyLoadHelper } from \"../helpers/lazyloadhelper\";\r\n\r\nexport interface GoogleMapOptions {\r\n    latitude?: any;\r\n    longitude?: any;\r\n    zoom?: any;\r\n    mapTypeId?: any;\r\n    markerTitle?: string;\r\n    markerLatitude?: any;\r\n    markerLongitude?: any;\r\n}\r\n\r\n@Decorators.registerEditor('Serenity.GoogleMap', [])\r\n@Decorators.element('<div/>')\r\nexport class GoogleMap extends Widget<GoogleMapOptions> {\r\n\r\n    private map: any;\r\n\r\n    constructor(container: JQuery, opt: GoogleMapOptions) {\r\n        super(container, opt);\r\n\r\n        // @ts-ignore\r\n        var center = new google.m ?? s.LatLng(\r\n            this.options.latitude  ?? 0,\r\n            this.options.longitude ?? 0);\r\n\r\n        var mapOpt: any = new Object();\r\n        mapOpt.center = center;\r\n        mapOpt.mapTypeId = this.options.mapTypeId ?? 'roadmap';\r\n        mapOpt.zoom = this.options.zoom ?? 15;\r\n        mapOpt.zoomControl = true;\r\n        // @ts-ignore\r\n        this.map = new google.maps.Map(container[0], mapOpt);\r\n\r\n        if (this.options.markerTitle != null) {\r\n            var markerOpt: any = new Object();\r\n\r\n            var lat = this.options.markerLatitude;\r\n            if (lat == null) {\r\n                lat = this.options.latitude ?? 0;\r\n            }\r\n            var lon = this.options.markerLongitude;\r\n            if (lon == null) {\r\n                lon = this.options.longitude ?? 0;\r\n            }\r\n            // @ts-ignore\r\n            markerOpt.position = new google.maps.LatLng(lat, lon);\r\n            markerOpt.map = this.map;\r\n            markerOpt.title = this.options.markerTitle;\r\n            markerOpt.animation = 2;\r\n            // @ts-ignore\r\n            new google.maps.Marker(markerOpt);\r\n        }\r\n\r\n        LazyLoadHelper.executeOnceWhenShown(container, () => {\r\n            // @ts-ignore\r\n            google.maps.event.trigger(this.map, 'resize', []);\r\n            this.map.setCenter(center);\r\n            // in case it wasn't visible (e.g. in dialog)\r\n        });\r\n    }\r\n\r\n    get_map(): any {\r\n        return this.map;\r\n    }\r\n}", "\uFEFFimport { Decorators } from \"../../decorators\";\r\nimport { IStringValue } from \"../../interfaces\";\r\nimport { isEmptyOrNull, isValue, ListRequest, ListResponse, RetrieveResponse, safeCast, serviceCall, ServiceOptions, text, trimToNull } from \"@serenity-is/corelib/q\";\r\nimport { ValidationHelper } from \"../helpers/validationhelper\";\r\nimport { Widget } from \"../widgets/widget\";\r\nimport { WX } from \"../widgets/wx\";\r\n\r\n@Decorators.registerEditor('Serenity.Select2AjaxEditor', [IStringValue])\r\n@Decorators.element('<input type=\"hidden\" />')\r\nexport class Select2AjaxEditor<TOptions, TItem> extends Widget<TOptions> implements IStringValue {\r\n    pageSize: number = 50;\r\n\r\n    constructor(hidden: JQuery, opt: TOptions) {\r\n        super(hidden, opt);\r\n\r\n        var emptyItemText = this.emptyItemText();\r\n        if (emptyItemText != null)\r\n            hidden.attr(\"placeholder\", emptyItemText);\r\n\r\n        hidden.select2(this.getSelect2Options());\r\n\r\n        hidden.attr(\"type\", \"text\"); // jquery validate to work\r\n\r\n        hidden.on(\"change.\" + this.uniqueName, (e, x) => {\r\n            if (WX.hasOriginalEvent(e) || !x) {\r\n                if (ValidationHelper.getValidator(hidden) != null)\r\n                    hidden.valid();\r\n            }\r\n        });\r\n    }\r\n\r\n    protected emptyItemText(): string {\r\n        var txt = this.element.attr('placeholder');\r\n        if (txt == null) {\r\n            txt = text('Controls.SelectEditor.EmptyItemText');\r\n        }\r\n        return txt;\r\n    }\r\n\r\n    protected getService(): string {\r\n        throw new Error(\"Not implemented!\");\r\n    }\r\n\r\n    protected query(request: ListRequest, callback: (p1: ListResponse<any>) => void): void {\r\n        var options: ServiceOptions<any> = {\r\n            blockUI: false,\r\n            service: this.getService() + '/List',\r\n            request: request,\r\n            onSuccess: function (response) {\r\n                callback(response);\r\n            }\r\n        };\r\n        this.executeQuery(options);\r\n    }\r\n\r\n    protected executeQuery(options: ServiceOptions<ListResponse<any>>): void {\r\n        serviceCall(options);\r\n    }\r\n\r\n    protected queryByKey(key: string, callback: (p1: any) => void): void {\r\n        var options: ServiceOptions<any> = {\r\n            blockUI: false,\r\n            service: this.getService() + '/Retrieve',\r\n            request: { EntityId: key },\r\n            onSuccess: function (response) {\r\n                callback(response.Entity);\r\n            }\r\n        };\r\n        this.executeQueryByKey(options);\r\n    }\r\n\r\n    protected executeQueryByKey(options: ServiceOptions<RetrieveResponse<any>>): void {\r\n        serviceCall(options);\r\n    }\r\n\r\n    protected getItemKey(item: any): string {\r\n        return null;\r\n    }\r\n\r\n    protected getItemText(item: any): string {\r\n        return null;\r\n    }\r\n\r\n    protected getTypeDelay(): number {\r\n        return 200;\r\n    }\r\n\r\n    protected getSelect2Options(): Select2Options {\r\n        var emptyItemText = this.emptyItemText();\r\n        var queryTimeout = 0;\r\n        return {\r\n            minimumResultsForSearch: 10,\r\n            placeHolder: (!isEmptyOrNull(emptyItemText) ? emptyItemText : null),\r\n            allowClear: isValue(emptyItemText),\r\n            query: query => {\r\n                var request = {\r\n                    ContainsText: trimToNull(query.term), Skip: (query.page - 1) * this.pageSize, Take: this.pageSize + 1\r\n                };\r\n\r\n                if (queryTimeout !== 0) {\r\n                    window.clearTimeout(queryTimeout);\r\n                }\r\n\r\n                var select2 = $(this.element).data('select2');\r\n                select2 && select2.search && select2.search.removeClass('select2-active').parent().removeClass('select2-active');\r\n\r\n                queryTimeout = window.setTimeout(() => {\r\n                    select2 && select2.search.addClass('select2-active').parent().addClass('select2-active');\r\n\r\n                    this.query(request, response => {\r\n                        query.callback({\r\n                            results: response.Entities.slice(0, this.pageSize).map(x => {\r\n                                return { id: this.getItemKey(x), text: this.getItemText(x), source: x };\r\n                            }), more: response.Entities.length >= this.pageSize\r\n                        });\r\n                    });\r\n                }, this.getTypeDelay());\r\n\r\n            },\r\n            initSelection: (element, callback) => {\r\n                var val = element.val();\r\n                if (isEmptyOrNull(val)) {\r\n                    callback(null);\r\n                    return;\r\n                }\r\n                this.queryByKey(val, result => {\r\n                    callback((result == null ? null : {\r\n                        id: this.getItemKey(result),\r\n                        text: this.getItemText(result),\r\n                        source: result\r\n                    }));\r\n                });\r\n            }\r\n        };\r\n    }\r\n\r\n    protected addInplaceCreate(title: string): void {\r\n        var self = this;\r\n        $('<a><b/></a>').addClass('inplace-button inplace-create')\r\n            .attr('title', title).insertAfter(this.element).click(function (e) {\r\n                self.inplaceCreateClick(e);\r\n            });\r\n\r\n        this.get_select2Container().add(this.element)\r\n            .addClass('has-inplace-button');\r\n    }\r\n\r\n    protected inplaceCreateClick(e: any): void {\r\n    }\r\n\r\n    protected get_select2Container(): JQuery {\r\n        return this.element.prevAll('.select2-container');\r\n    }\r\n\r\n    get_value(): string {\r\n        return safeCast(this.element.select2('val'), String);\r\n    }\r\n\r\n    get value(): string {\r\n        return this.get_value();\r\n    }\r\n\r\n    set_value(value: string) {\r\n        if (value !== this.get_value()) {\r\n            var el = this.element;\r\n            el.select2('val', value);\r\n            el.data('select2-change-triggered', true);\r\n            try {\r\n                el.triggerHandler('change', [true]); // valueSet: true\r\n            }\r\n            finally {\r\n                el.data('select2-change-triggered', false);\r\n            }\r\n        }\r\n    }\r\n\r\n    set value(v: string) {\r\n        this.set_value(v);\r\n    }\r\n}"],
  "mappings": "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",
  "names": ["ColumnSelection", "RetrieveColumnSelection", "SummaryType", "Criteria", "addAttribute", "addTypeMember", "MemberType", "ISlickFormatter", "regClass", "regIntf", "regEnum", "startsWith", "Attr", "name", "target", "regClass", "EnumKeyAttribute", "value", "__decorateClass", "DisplayNameAttribute", "displayName", "CategoryAttribute", "category", "ColumnsKeyAttribute", "CssClassAttribute", "cssClass", "DefaultValueAttribute", "DialogTypeAttribute", "EditorAttribute", "EditorOptionAttribute", "key", "EditorTypeAttributeBase", "editorType", "editorParams", "EditorTypeAttribute", "ElementAttribute", "EntityTypeAttribute", "FilterableAttribute", "FlexifyAttribute", "FormKeyAttribute", "GeneratedCodeAttribute", "origin", "HiddenAttribute", "HintAttribute", "hint", "IdPropertyAttribute", "InsertableAttribute", "IsActivePropertyAttribute", "ItemNameAttribute", "LocalTextPrefixAttribute", "MaximizableAttribute", "MaxLengthAttribute", "maxLength", "NamePropertyAttribute", "OneWayAttribute", "OptionAttribute", "OptionsTypeAttribute", "PanelAttribute", "PlaceholderAttribute", "ReadOnlyAttribute", "RequiredAttribute", "isRequired", "ResizableAttribute", "ResponsiveAttribute", "ServiceAttribute", "UpdatableAttribute", "Decorators", "registerClass", "nameOrIntf", "intf2", "registerInterface", "regIntf", "registerEditor", "registerEnum", "enumKey", "regEnum", "addAttribute", "registerEnumType", "registerFormatter", "ISlickFormatter", "option", "propertyKey", "isGetSet", "startsWith", "memberName", "addTypeMember", "MemberType", "dialogType", "editor", "attr", "element", "filterable", "flexify", "itemName", "maximizable", "optionsType", "panel", "resizable", "responsive", "service", "IBooleanValue", "__decorateClass", "Decorators", "IDoubleValue", "__decorateClass", "Decorators", "IDialog", "__decorateClass", "Decorators", "IEditDialog", "__decorateClass", "Decorators", "IGetEditValue", "__decorateClass", "Decorators", "IReadOnly", "__decorateClass", "Decorators", "ISetEditValue", "__decorateClass", "Decorators", "IStringValue", "__decorateClass", "Decorators", "IValidateRequired", "__decorateClass", "Decorators", "registerEnum", "CaptureOperationType", "registerEnum", "isEmptyOrNull", "ReflectionUtils", "getPropertyValue", "o", "property", "d", "getter", "camelCase", "makeCamelCase", "setPropertyValue", "value", "setter", "s", "hasNonUppercase", "numUppercaseChars", "index", "Config", "Exception", "notifyError", "endsWith", "getType", "isAssignableFrom", "DialogTypeRegistry", "search", "typeName", "dialogType", "getType", "isAssignableFrom", "IDialog", "ns", "Config", "knownTypes", "tryGet", "key", "endsWith", "get", "type", "message", "notifyError", "Exception", "ArgumentNullException", "Config", "endsWith", "Exception", "format", "getAttributes", "getType", "getTypeFullName", "getTypes", "isEmptyOrNull", "startsWith", "globalObj", "knownTypes", "EditorTypeRegistry", "get", "key", "_a", "initialize", "editorType", "type", "fullName", "editorAttr", "EditorAttribute", "attrKey", "k", "kx", "setTypeKeysWithoutEditorSuffix", "reset", "keys", "setWithoutSuffix", "t", "suffix", "p", "Config", "Exception", "format", "getAttributes", "getTypeFullName", "getTypes", "isEnum", "notifyError", "startsWith", "EnumTypeRegistry", "knownTypes", "tryGet", "key", "type", "fullName", "enumKeyAttr", "EnumKeyAttribute", "k", "get", "message", "ISlickFormatter", "executeOnceWhenVisible", "executeEverytimeWhenVisible", "LazyLoadHelper", "PrefixedContext", "idPrefix", "id", "type", "jQueryPatch", "$", "applyJQueryUIFixes", "event", "orig", "elems", "events", "elem", "i", "e", "cloned", "addValRule", "ArgumentNullException", "Config", "Exception", "format", "getAttributes", "getInstanceType", "getTypeFullName", "getTypeName", "isAssignableFrom", "notifyError", "replaceAll", "startsWith", "reactPatch", "_a", "_b", "globalObj", "Widget", "element", "options", "getInstanceType", "Exception", "format", "e", "getTypeName", "type", "classList", "fullClass", "replaceAll", "getTypeFullName", "k", "Config", "startsWith", "v", "i", "s", "editorType", "elementAttr", "getAttributes", "ElementAttribute", "elementHtml", "eventClass", "rule", "addValRule", "handler", "valueSet", "params", "widget", "isAssignableFrom", "IDialog", "action", "__decorateClass", "Decorators", "w", "widgetName", "data", "key", "ArgumentNullException", "message", "notifyError", "jQueryPatch", "htmlEncode", "isEmptyOrNull", "startsWith", "PopupMenuButton", "Widget", "div", "opt", "e", "_a", "_b", "menu", "uq", "x", "__decorateClass", "Decorators", "PopupToolButton", "Toolbar", "options", "container", "buttons", "currentCount", "i", "button", "b", "cssClass", "btn", "isEmptyOrNull", "text", "htmlEncode", "klass", "startsWith", "e1", "action", "className", "el", "canLoadScriptData", "Config", "format", "getBaseType", "getInstanceType", "getTemplate", "getTypeFullName", "getTypeName", "replaceAll", "startsWith", "text", "TemplatedWidget", "Widget", "id", "type", "s", "dollar", "getTypeName", "getInstanceType", "fullName", "getTypeFullName", "templateNames", "cachedName", "name", "k", "Config", "startsWith", "canLoadScriptData", "replaceAll", "getBaseType", "templateName", "script", "template", "getTemplate", "format", "widgetMarkup", "end", "idx", "key", "txt", "text", "__decorateClass", "Decorators", "bsModalMarkup", "closePanel", "Config", "dialogButtonToBS", "dialogButtonToUI", "endsWith", "getAttributes", "getInstanceType", "isEmptyOrNull", "layoutFillHeight", "newBodyDiv", "parseInteger", "positionToastContainer", "validateOptions", "flexY", "flexX", "Flexify", "Widget", "container", "options", "LazyLoadHelper", "designWidth", "designHeight", "tabs", "element", "xFactor", "yFactor", "width", "initialWidth", "height", "initialHeight", "containers", "tabPanels", "i", "e", "DialogExtensions", "dialogResizable", "dialog", "w", "h", "mw", "mh", "dlg", "dialogMaximizable", "dialogFlexify", "Flexify", "TemplatedDialog", "TemplatedWidget", "options", "newBodyDiv", "panelAttr", "getAttributes", "getInstanceType", "PanelAttribute", "Config", "ResponsiveAttribute", "element", "name", "cssSize", "endsWith", "i", "parseInteger", "opt", "dialogClass", "size", "dialog", "sizeHelper", "modal", "e", "type", "DialogExtensions", "FlexifyAttribute", "MaximizableAttribute", "self", "_a", "_b", "title", "modalClass", "markup", "bsModalMarkup", "footer", "buttons", "x", "dialogButtonToBS", "toolbarDiv", "hotkeyContext", "Toolbar", "form", "valOptions", "validateOptions", "asPanel", "uniqueName", "container", "closePanel", "index", "el", "positionToastContainer", "dialogButtonToUI", "ResizableAttribute", "value", "pt", "isEmptyOrNull", "oldTitle", "tabsDiv", "dlg", "uiDialog", "data", "pos", "layoutFillHeight", "d", "__decorateClass", "Decorators", "IDialog", "validateOptions", "TemplatedPanel", "TemplatedWidget", "container", "options", "i", "e", "tabsDiv", "toolbarDiv", "opt", "Toolbar", "form", "valOptions", "validateOptions", "Exception", "validatorAbortHandler", "ValidationHelper", "asyncSubmit", "form", "validateBeforeSave", "submitHandler", "validator", "valSettings", "submit", "getValidator", "element", "VX", "addValidationRule", "eventClass", "rule", "removeValidationRule", "validateElement", "widget", "findElementWithRelativeId", "isEmptyOrNull", "notifyError", "CascadedWidgetLink", "parentType", "widget", "parentChange", "e", "isEmptyOrNull", "parent", "findElementWithRelativeId", "notifyError", "value", "__decorateClass", "Decorators", "TabsExtensions", "setDisabled", "tabs", "tabKey", "isDisabled", "ibk", "indexByKey", "index", "toggle", "visible", "activeTabKey", "href", "prefix", "lastIndex", "el", "selectTab", "getInstanceType", "getMembers", "isInstanceOfType", "MemberType", "ReflectionOptionsSetter", "set", "target", "options", "type", "getInstanceType", "propByName", "fieldByName", "props", "getMembers", "MemberType", "propList", "x", "a", "isInstanceOfType", "OptionAttribute", "DisplayNameAttribute", "k", "ReflectionUtils", "fields", "fieldList", "x1", "$t2", "k1", "keys", "k2", "v", "cc", "p", "func", "f", "any", "Authorization", "Culture", "extend", "getAttributes", "getTypeName", "isBS3", "isBS5Plus", "isEmptyOrNull", "startsWith", "text", "trimToEmpty", "trimToNull", "tryGetText", "cast", "isInstanceOfType", "isTrimmedEmpty", "parseDecimal", "safeCast", "text", "tryGetText", "EditorUtils", "getDisplayText", "editor", "_a", "_b", "_c", "select2", "data", "value", "getValue", "tryGetText", "dummy", "target", "saveValue", "item", "getEditValue", "safeCast", "IGetEditValue", "stringValue", "IStringValue", "booleanValue", "IBooleanValue", "doubleValue", "IDoubleValue", "setValue", "source", "loadValue", "setEditValue", "ISetEditValue", "cast", "value1", "d", "isInstanceOfType", "isTrimmedEmpty", "parseDecimal", "v", "setReadonly", "elements", "isReadOnly", "index", "el", "elx", "type", "setReadOnly", "widget", "readOnly", "IReadOnly", "setRequired", "isRequired", "req", "IValidateRequired", "gridField", "hasSupItem", "text", "setContainerReadOnly", "container", "i", "e", "w", "Widget", "PropertyGrid", "Widget", "div", "opt", "title", "animate", "intoView", "items", "useTabs", "any", "x", "isEmptyOrNull", "itemsWithoutTab", "f", "itemsWithTab", "ul", "tc", "tabIndex", "i", "tab", "trimToEmpty", "tabItems", "j", "li", "isBS3", "isBS5Plus", "tabID", "prefix", "pane", "container", "_a", "_b", "categoryIndexes", "categoriesDiv", "useCategories", "linkContainer", "fieldContainer", "priorCategory", "item", "category", "categoryDiv", "editor", "collapsed", "img", "e", "text", "getKey", "startsWith", "local", "tryGetText", "local1", "fieldDiv", "splitted", "editorId", "hint", "prefix1", "placeHolder", "prefix2", "label", "editorType", "EditorTypeRegistry", "elementAttr", "getAttributes", "ElementAttribute", "elementHtml", "element", "editorParams", "optionsType", "optionsAttr", "OptionsTypeAttribute", "extend", "getTypeName", "ReflectionOptionsSetter", "order", "result", "categoryOrder", "trimToNull", "split", "s", "x1", "idx", "itemIndex", "itemCategory", "name1", "cat1", "self", "y", "c", "xcategory", "ycategory", "c1", "c2", "Culture", "index", "value", "source", "target", "EditorUtils", "widget", "isReadOnly", "elements", "isRequired", "maxLength", "val", "PropertyGridMode", "Authorization", "readOnly", "hidden", "callback", "__decorateClass", "Decorators", "endsWith", "getAttributes", "getForm", "getInstanceType", "getTypeFullName", "PropertyPanel", "TemplatedPanel", "container", "options", "pgDiv", "pgOptions", "PropertyGrid", "attributes", "getAttributes", "getInstanceType", "FormKeyAttribute", "name", "getTypeFullName", "px", "endsWith", "formKey", "getForm", "entity", "value", "__decorateClass", "Decorators", "SubDialogHelper", "bindToDataChange", "dialog", "owner", "dataChange", "useTimeout", "widgetName", "e", "dci", "triggerDataChange", "triggerDataChanged", "element", "bubbleDataChange", "cascade", "cascadedDialog", "ofElement", "cascadedDialogOffset", "endsWith", "getAttributes", "getFormData", "getFormDataAsync", "getInstanceType", "getTypeFullName", "isEmptyOrNull", "ScriptData", "text", "PropertyDialog", "TemplatedDialog", "opt", "__async", "text", "pgDiv", "pgOptions", "PropertyGrid", "attributes", "getAttributes", "getInstanceType", "FormKeyAttribute", "name", "getTypeFullName", "px", "endsWith", "_a", "formKey", "ScriptData", "isEmptyOrNull", "getFormData", "getFormDataAsync", "entity", "value", "__decorateClass", "Decorators", "StringEditor", "Widget", "input", "value", "__decorateClass", "Decorators", "IStringValue", "PasswordEditor", "StringEditor", "input", "__decorateClass", "Decorators", "TextAreaEditor", "Widget", "input", "opt", "_a", "_b", "value", "__decorateClass", "Decorators", "IStringValue", "BooleanEditor", "Widget", "value", "__decorateClass", "Decorators", "IBooleanValue", "Culture", "extend", "formatNumber", "parseDecimal", "DecimalEditor", "Widget", "input", "opt", "_a", "_b", "numericOptions", "extend", "val", "parseDecimal", "value", "formatNumber", "v", "Culture", "__decorateClass", "Decorators", "IDoubleValue", "extend", "formatNumber", "isTrimmedEmpty", "parseInteger", "trimToNull", "IntegerEditor", "Widget", "input", "opt", "_a", "_b", "numericOptions", "extend", "DecimalEditor", "val", "isTrimmedEmpty", "trimToNull", "parseInteger", "value", "formatNumber", "v", "__decorateClass", "Decorators", "IDoubleValue", "addValidationRule", "Culture", "format", "formatDate", "Invariant", "isEmptyOrNull", "parseDate", "parseISODateTime", "replaceAll", "text", "today", "datePickerIconSvg", "DateEditor", "Widget", "input", "_a", "inp", "inst", "e", "today", "addValidationRule", "e1", "value", "isEmptyOrNull", "Invariant", "formatDate", "format", "text", "Culture", "v", "parseISODateTime", "val", "replaceAll", "isNumeric", "c", "_b", "x", "parseDate", "d", "__decorateClass", "Decorators", "IStringValue", "IReadOnly", "jQueryDatepickerInitialization", "order", "s", "culture", "addOption", "addValidationRule", "Culture", "format", "formatDate", "formatISODateTimeUTC", "Invariant", "isEmptyOrNull", "parseDate", "parseISODateTime", "round", "text", "today", "trunc", "tryGetText", "DateTimeEditor", "Widget", "input", "opt", "_a", "_b", "_c", "_d", "DateEditor", "e", "after", "e3", "timeOpt", "t", "addOption", "addValidationRule", "e1", "value", "isEmptyOrNull", "Invariant", "format", "text", "formatDate", "before", "e2", "Culture", "result", "datePart", "timePart", "parseDate", "formatISODateTimeUTC", "parseISODateTime", "today", "val", "tryGetText", "v", "EditorUtils", "date", "minutesStep", "m", "trunc", "round", "fromHour", "fromMin", "toHour", "toMin", "stepMins", "list", "hour", "min", "__decorateClass", "Decorators", "IStringValue", "IReadOnly", "addOption", "toId", "TimeEditor", "Widget", "input", "opt", "addOption", "h", "m", "hour", "toId", "minute", "value", "EditorUtils", "__decorateClass", "Decorators", "IDoubleValue", "IReadOnly", "isEmptyOrNull", "trimToNull", "tryGetText", "EmailEditor", "Widget", "input", "opt", "spanAt", "domain", "validator", "isEmptyOrNull", "e", "e1", "e2", "_a", "value", "element", "tryGetText", "domainValue", "trimToNull", "parts", "v", "__decorateClass", "Decorators", "IStringValue", "IReadOnly", "EmailAddressEditor", "StringEditor", "input", "__decorateClass", "Decorators", "trimToNull", "URLEditor", "StringEditor", "input", "validator", "value", "trimToNull", "__decorateClass", "Decorators", "IStringValue", "Enum", "getAttributes", "getLookup", "isEmptyOrNull", "tryGetText", "RadioButtonEditor", "Widget", "input", "opt", "_a", "isEmptyOrNull", "enumType", "EnumTypeRegistry", "enumKey", "enumKeyAttr", "getAttributes", "EnumKeyAttribute", "values", "Enum", "x", "name", "tryGetText", "lookup", "getLookup", "item", "textValue", "text", "idValue", "id", "value", "label", "inputs", "checks", "v", "__decorateClass", "Decorators", "IStringValue", "IReadOnly", "any", "Authorization", "isArray", "isEmptyOrNull", "isTrimmedEmpty", "startsWith", "text", "trimToEmpty", "trimToNull", "Select2Editor", "Widget", "hidden", "opt", "emptyItemText", "select2Options", "e", "valueSet", "text", "query", "results", "_a", "item", "value", "items", "isEmptyOrNull", "typeTimeout", "queryPromise", "pageSize", "searchQuery", "trimToNull", "select2", "result", "initPromise", "element", "callback", "val", "isMultiple", "idList", "x", "v", "any", "z", "isAutoComplete", "list", "item2", "it", "key", "source", "disabled", "addTitle", "editTitle", "self", "inplaceButton", "isNew", "values", "e3", "q", "index", "values1", "Authorization", "getName", "s", "isTrimmedEmpty", "isAsyncSource", "x1", "property", "isArray", "target", "getText", "term", "contains", "filter", "startsWith", "el", "selectedValue", "selectedValues", "str", "readOnly", "parent", "EditorUtils", "CascadedWidgetLink", "p", "fld", "itemKey", "ReflectionUtils", "dialogTypeKey", "dialogType", "DialogTypeRegistry", "entity", "dialog", "SubDialogHelper", "dci", "id", "id1", "idx1", "editItem", "trimToEmpty", "__decorateClass", "Decorators", "ISetEditValue", "IGetEditValue", "IStringValue", "IReadOnly", "isEmptyOrNull", "SelectEditor", "Select2Editor", "hidden", "opt", "isEmptyOrNull", "_a", "items", "isStrings", "item", "key", "text", "__decorateClass", "Decorators", "startsWith", "DateYearEditor", "SelectEditor", "hidden", "opt", "_a", "_b", "years", "minYear", "maxYear", "startsWith", "i", "i1", "__decorateClass", "Decorators", "Enum", "getAttributes", "tryGetText", "EnumEditor", "Select2Editor", "hidden", "opt", "_a", "enumType", "EnumTypeRegistry", "enumKey", "enumKeyAttr", "getAttributes", "EnumKeyAttribute", "values", "Enum", "x", "name", "tryGetText", "__decorateClass", "Decorators", "endsWith", "getInstanceType", "getLookup", "getLookupAsync", "getTypeFullName", "reloadLookup", "ScriptData", "LookupEditorBase", "Select2Editor", "input", "opt", "self", "ScriptData", "key", "getTypeFullName", "getInstanceType", "idx", "endsWith", "getLookupAsync", "getLookup", "lookup", "item", "textValue", "items", "query", "results", "x", "getText", "dialogTypeKey", "entity", "term", "reloadLookup", "__decorateClass", "Decorators", "LookupEditor", "hidden", "ColumnSelection", "Criteria", "isEmptyOrNull", "resolveUrl", "serviceCall", "startsWith", "ServiceLookupEditorBase", "Select2Editor", "input", "opt", "dialogTypeKey", "service", "startsWith", "url", "resolveUrl", "include", "idField", "textField", "val", "isEmptyOrNull", "fld", "idList", "query", "Criteria", "request", "ColumnSelection", "results", "response", "items", "serviceCall", "__decorateClass", "Decorators", "ServiceLookupEditor", "hidden", "endsWith", "isEmptyOrNull", "isTrimmedEmpty", "resolveUrl", "text", "trimToNull", "HtmlContentEditor", "Widget", "textArea", "opt", "id", "isTrimmedEmpty", "e", "value", "trimToNull", "text", "LazyLoadHelper", "config", "x", "_a", "CKEDITOR", "lang", "x1", "resolveUrl", "instance", "v", "isEmptyOrNull", "path", "endsWith", "script", "__decorateClass", "Decorators", "IStringValue", "IReadOnly", "HtmlNoteContentEditor", "HtmlReportContentEditor", "MaskedEditor", "Widget", "input", "opt", "_a", "value", "__decorateClass", "Decorators", "IStringValue", "addValidationRule", "isEmptyOrNull", "text", "Recaptcha", "Widget", "div", "opt", "_a", "src", "lng", "valInput", "gro", "input", "self", "addValidationRule", "e", "isEmptyOrNull", "text", "value", "__decorateClass", "Decorators", "IStringValue", "blockUI", "blockUndo", "endsWith", "format", "iframeDialog", "isEmptyOrNull", "notifyError", "replaceAll", "resolveUrl", "round", "startsWith", "text", "UploadHelper", "addUploadInput", "options", "uploadInput", "e", "data", "response", "opt", "_a", "xhr", "json", "html", "e1", "data1", "percent", "checkImageConstraints", "file", "fileSizeDisplay", "fileNameSizeDisplay", "name", "bytes", "byteSize", "suffix", "sizeParts", "value", "hasImageExtension", "filename", "thumbFileName", "idx", "dbFileUrl", "colorBox", "link", "populateFileSymbols", "container", "items", "displayOriginalName", "urlPrefix", "index", "item", "li", "isImage", "editLink", "thumb", "originalName", "fileName", "endsWith", "extend", "isEmptyOrNull", "isInstanceOfType", "isTrimmedEmpty", "replaceAll", "startsWith", "text", "trimToNull", "FileUploadEditor", "Widget", "div", "opt", "isEmptyOrNull", "Toolbar", "uio", "UploadHelper", "response", "name", "data", "newEntity", "validator", "text", "displayOriginalName", "isTrimmedEmpty", "trimToNull", "addButton", "delButton", "value", "e", "copy", "extend", "stringValue", "idx", "v", "property", "target", "source", "_a", "s", "replaceAll", "__decorateClass", "Decorators", "IReadOnly", "IGetEditValue", "ISetEditValue", "IValidateRequired", "ImageUploadEditor", "MultipleFileUploadEditor", "self", "addFileButton", "i", "x", "ev", "val", "isInstanceOfType", "json", "startsWith", "endsWith", "MultipleImageUploadEditor", "ArgumentNullException", "Criteria", "delegateCombine", "delegateRemove", "formatDate", "isArray", "isEmptyOrNull", "isTrimmedEmpty", "notifyWarning", "parseDate", "text", "toId", "tryGetText", "QuickFilterBar", "Widget", "container", "options", "_a", "filters", "f", "filter", "opt", "ArgumentNullException", "item", "title", "quickFilter", "isEmptyOrNull", "widget", "e", "submitHandler", "request", "value", "EditorUtils", "active", "args", "e1", "x", "field", "end", "DateEditor", "e2", "active1", "isTrimmedEmpty", "active2", "parseDate", "notifyWarning", "text", "Criteria", "next", "formatDate", "w", "l", "v1", "v2", "text1", "text2", "tryGetText", "w1", "w2", "state", "isArray", "useUtc", "DateTimeEditor", "i", "x1", "yes", "no", "items", "trueText", "falseText", "SelectEditor", "toId", "action", "delegateCombine", "delegateRemove", "type", "el", "__decorateClass", "Decorators", "isEmptyOrNull", "isValue", "text", "trim", "QuickSearchInput", "Widget", "input", "opt", "_a", "_b", "text", "trim", "self", "isValue", "a", "menu", "item", "field", "e", "PopupMenuButton", "e1", "value", "isEmptyOrNull", "qsf", "_c", "done", "results", "__decorateClass", "Decorators", "FilterOperators", "ArgumentNullException", "Criteria", "Culture", "delegateCombine", "delegateRemove", "text", "tryGetText", "FilterStore", "fields", "ArgumentNullException", "x", "y", "titleX", "tryGetText", "titleY", "Culture", "field", "items", "inParens", "currentBlock", "isBlockOr", "criteria", "i", "line", "Criteria", "displayText", "text", "value", "delegateCombine", "delegateRemove", "__decorateClass", "Decorators", "ArgumentNullException", "Config", "Criteria", "deepClone", "endsWith", "Exception", "extend", "format", "formatDate", "getInstanceType", "getTypeFullName", "getTypeName", "getTypes", "isAssignableFrom", "isEmptyOrNull", "parseISODateTime", "startsWith", "text", "tryGetText", "IFiltering", "__decorateClass", "Decorators", "IQuickFiltering", "BaseFiltering", "value", "list", "FilterOperators", "Exception", "format", "getTypeName", "getInstanceType", "op", "_a", "_b", "tryGetText", "field", "values", "result", "text", "state", "input", "ArgumentNullException", "filter", "StringEditor", "deepClone", "Filtering", "name", "BaseEditorFiltering", "editorType", "Widget", "isEmptyOrNull", "opt", "extend", "EditorUtils", "DateFiltering", "DateEditor", "BooleanFiltering", "DateTimeFiltering", "DateTimeEditor", "date", "parseISODateTime", "next", "criteria", "dateValue", "formatDate", "nextValue", "Criteria", "DecimalFiltering", "DecimalEditor", "EditorFiltering", "EditorTypeRegistry", "e", "EnumFiltering", "EnumEditor", "IntegerFiltering", "IntegerEditor", "LookupFiltering", "LookupEditor", "ops", "ServiceLookupFiltering", "ServiceLookupEditor", "StringFiltering", "FilteringTypeRegistry", "knownTypes", "initialize", "type", "getTypes", "isAssignableFrom", "fullName", "getTypeFullName", "k", "Config", "startsWith", "kx", "setTypeKeysWithoutFilterHandlerSuffix", "suffix", "endsWith", "p", "reset", "get", "key", "formatterType", "FilterWidgetBase", "TemplatedWidget", "div", "opt", "FilterStore", "value", "__decorateClass", "Decorators", "cast", "isEmptyOrNull", "text", "tryGetText", "FilterFieldSelect", "Select2Editor", "hidden", "fields", "_a", "_b", "field", "tryGetText", "isEmptyOrNull", "text", "opt", "__decorateClass", "Decorators", "FilterOperatorSelect", "source", "op", "title", "FilterPanel", "FilterWidgetBase", "div", "value", "items", "item", "row", "divl", "fieldSelect", "operatorSelect", "filtering", "filterLines", "errorText", "i", "line", "criteria", "result", "index", "fieldInput", "val", "popupField", "emptyRow", "isLastRowOr", "parenDiv", "e", "andor", "fieldSel", "opSelect", "select", "fieldName", "isEmpty", "operators", "cast", "IFiltering", "filteringType", "FilteringTypeRegistry", "editorDiv", "ReflectionOptionsSetter", "firstInput", "$t1", "ops", "x", "rows", "inParen", "i1", "row1", "divParen", "lp", "rp", "notifyError", "text", "FilterDialog", "TemplatedDialog", "FilterPanel", "text", "notifyError", "__decorateClass", "Decorators", "text", "trimToNull", "FilterDisplayBar", "FilterWidgetBase", "div", "text", "openFilterDialog", "e", "dialog", "FilterDialog", "e1", "displayText", "trimToNull", "__decorateClass", "Decorators", "extend", "text", "SlickPager", "Widget", "div", "o", "extend", "v", "text", "self", "e", "opt", "sel", "nx", "ctype", "view", "info", "pages", "newp", "nv", "r1", "r2", "stat", "attrEncode", "Authorization", "clearKeys", "Culture", "htmlEncode", "isEmptyOrNull", "replaceAll", "safeCast", "serviceCall", "startsWith", "text", "tryGetText", "ArgumentNullException", "attrEncode", "Config", "Culture", "endsWith", "Enum", "Exception", "format", "formatDate", "formatNumber", "getAttributes", "getTypeFullName", "getTypes", "htmlEncode", "isAssignableFrom", "isEmptyOrNull", "ISlickFormatter", "parseDecimal", "parseISODateTime", "replaceAll", "resolveUrl", "safeCast", "startsWith", "tryGetText", "IInitializeColumn", "__decorateClass", "Decorators", "BooleanFormatter", "ctx", "_a", "_b", "text", "tryGetText", "htmlEncode", "CheckboxFormatter", "DateFormatter", "Culture", "value", "format", "date", "parseISODateTime", "formatDate", "DateTimeFormatter", "EnumFormatter", "EnumTypeRegistry", "enumType", "name", "Enum", "enumKeyAttr", "getAttributes", "EnumKeyAttribute", "enumKey", "getTypeFullName", "isEmptyOrNull", "FileDownloadFormatter", "dbFile", "safeCast", "downloadUrl", "originalName", "attrEncode", "filename", "replaceAll", "resolveUrl", "column", "ISlickFormatter", "MinuteFormatter", "hour", "minute", "hourStr", "minuteStr", "NumberFormatter", "formatNumber", "dbl", "parseDecimal", "UrlFormatter", "_c", "_d", "url", "startsWith", "display", "s", "FormatterTypeRegistry", "knownTypes", "setTypeKeysWithoutFormatterSuffix", "suffix", "k", "endsWith", "p", "initialize", "types", "getTypes", "type", "isAssignableFrom", "fullName", "Config", "kx", "get", "key", "ArgumentNullException", "formatterType", "Exception", "reset", "GridRowSelectionMixin", "grid", "options", "e", "p", "item", "id", "i", "e1", "u", "clearKeys", "items", "x", "id1", "selectAllButton", "keys", "k", "getMixin", "ctx", "mixin", "isChecked", "__decorateClass", "Decorators", "GridRadioSelectionMixin", "key", "row", "cell", "value", "column", "GridSelectAllButtonHelper", "update", "getSelected", "toolbar", "btn", "Toolbar", "define", "getGrid", "getId", "setSelected", "text", "onClick", "_a", "tryGetText", "view", "makeSelected", "GridUtils", "addToggleButton", "toolDiv", "cssClass", "callback", "hint", "initial", "div", "pressed", "addIncludeDeletedToggle", "includeDeleted", "oldSubmit", "addQuickSearchInput", "fields", "onChange", "input", "v", "searchText", "searchField", "lastDoneEvent", "addQuickSearchInputCustom", "field", "query", "done", "ui", "container", "onSearch", "QuickSearchInput", "makeOrderable", "handleMove", "moveRowsPlugin", "data", "data1", "$t1", "makeOrderableWithUpdateRequest", "getDisplayOrder", "service", "getUpdateRequest", "rows", "insertBefore", "_b", "order", "index", "next", "serviceCall", "response", "PropertyItemSlickConverter", "toSlickColumns", "result", "toSlickColumn", "Authorization", "name", "isEmptyOrNull", "formatterType", "FormatterTypeRegistry", "formatter", "ReflectionOptionsSetter", "initializer", "safeCast", "IInitializeColumn", "SlickFormatting", "getEnumText", "enumKey", "EnumFormatter", "treeToggle", "getView", "indent", "spacer", "idx", "nextIndent", "date", "format", "Culture", "htmlEncode", "DateFormatter", "dateTime", "checkBox", "number", "NumberFormatter", "getItemType", "link", "getItemId", "itemLinkText", "itemType", "extraClass", "encode", "replaceAll", "attrEncode", "itemLink", "idField", "getText", "SlickHelper", "setDefaults", "columns", "localTextPrefix", "col", "startsWith", "SlickTreeHelper", "filterCustom", "getParent", "parent", "loop", "filterById", "getParentId", "parentId", "setCollapsed", "collapsed", "setCollapsedFlag", "setIndents", "depth", "depths", "line", "toggleClick", "target", "Authorization", "Criteria", "debounce", "deepClone", "endsWith", "extend", "getAttributes", "getColumnsData", "getColumnsDataAsync", "getInstanceType", "getTypeFullName", "getTypeName", "htmlEncode", "indexOf", "isEmptyOrNull", "isInstanceOfType", "layoutFillHeight", "LayoutTimer", "ScriptData", "setEquality", "startsWith", "trimEnd", "trimToNull", "tryGetText", "RemoteView", "Grid", "DataGrid", "Widget", "container", "options", "self", "getTypeName", "getInstanceType", "layout", "LayoutTimer", "debounce", "buttons", "_a", "__async", "attrType", "getAttributes", "responsiveHeight", "madeAutoHeight", "shouldAutoHeight", "i", "e", "layoutFillHeight", "filters", "QuickFilterBar", "filter", "pre", "x", "Authorization", "item", "_b", "quick", "name", "title", "tryGetText", "filteringType", "FilteringTypeRegistry", "DateFiltering", "DateTimeFiltering", "BooleanFiltering", "q", "f", "trueText", "falseText", "filtering", "isInstanceOfType", "IQuickFiltering", "ReflectionOptionsSetter", "FilterOperators", "extend", "deepClone", "type", "field", "el", "isEmptyOrNull", "GridUtils", "index", "activeFieldName", "deletedFieldName", "value", "itemClass", "columns", "SlickHelper", "delta", "scale", "col", "LazyLoadHelper", "column", "FilterStore", "c", "s", "visibleColumns", "slickOptions", "grid", "Grid", "sortBy", "mapped", "endsWith", "trimEnd", "row", "p", "e1", "p1", "e2", "p2", "e3", "p3", "entityOrId", "itemType", "cell", "target", "SlickFormatting", "rows", "d", "view", "view1", "response", "view2", "include", "criteria", "Criteria", "setEquality", "array", "key", "opt", "RemoteView", "x1", "y", "list", "attr", "FilterableAttribute", "filterBarDiv", "FilterDisplayBar", "pagerDiv", "SlickPager", "toolbarDiv", "Toolbar", "idField", "text", "cssClass", "encode", "ColumnsKeyAttribute", "columnsKey", "ScriptData", "getColumnsData", "getColumnsDataAsync", "propertyItems", "PropertyItemSlickConverter", "oldFormat", "css", "ctx", "htmlEncode", "ctx1", "LocalTextPrefixAttribute", "IdPropertyAttribute", "IsActivePropertyAttribute", "getKey", "localTextPrefix", "local", "yes", "no", "path", "getTypeFullName", "storage", "json", "trimToNull", "startsWith", "settings", "flags", "colById", "updateColById", "cl", "$t1", "visible", "newColumns", "$t2", "$t3", "c1", "$t4", "x2", "column1", "sortColumns", "x3", "a", "b", "$t5", "x4", "column2", "x5", "items", "includeDeletedToggle", "widget", "state", "loadState", "EditorUtils", "qsInput", "qsWidget", "QuickSearchInput", "sort", "indexOf", "saveState", "getDisplayText", "filterLabel", "displayText", "__decorateClass", "Decorators", "IReadOnly", "Authorization", "centerDialog", "Culture", "htmlEncode", "Router", "text", "trimToNull", "ColumnPickerDialog", "TemplatedDialog", "QuickSearchInput", "fld", "txt", "done", "trimToNull", "x", "e", "text", "grid", "onClick", "picker", "initialSettings", "visible", "Router", "arg", "liByKey", "el", "last", "id", "li", "key", "newColumns", "col", "opt", "allowHide", "htmlEncode", "c", "hidden", "Authorization", "hiddenColumns", "b", "Culture", "evt", "centerDialog", "__decorateClass", "Decorators", "htmlEncode", "toGrouping", "tryFirst", "TreeGridMixin", "options", "dg", "idProperty", "getId", "item", "e", "src", "SlickTreeHelper", "oldViewFilter", "oldProcessData", "response", "col", "tryFirst", "x", "SlickFormatting", "ctx", "htmlEncode", "items", "getParentId", "result", "byId", "toGrouping", "byParentId", "visited", "takeChildren", "theParentId", "child", "parentId", "Culture", "getLookup", "htmlEncode", "isEmptyOrNull", "ScriptData", "trimToNull", "tryGetText", "CheckTreeEditor", "DataGrid", "div", "opt", "items", "itemById", "item", "isEmptyOrNull", "parent", "property", "target", "source", "value", "selectAllText", "self", "buttons", "GridSelectAllButtonHelper", "x", "x1", "x2", "v", "_a", "tryGetText", "result", "SlickTreeHelper", "i", "response", "row", "cell", "checkedOrPartial", "anyChanged", "view", "threeState", "allsel", "allSelected", "selected", "selectedChange", "sub", "columns", "SlickFormatting", "ctx", "cls", "htmlEncode", "oldIndexes", "list", "$t1", "y", "c", "Culture", "trimToNull", "i1", "select", "__decorateClass", "Decorators", "IGetEditValue", "ISetEditValue", "IReadOnly", "CheckLookupEditor", "options", "ScriptData", "GridUtils", "field", "text", "val", "key", "fld", "itemKey", "ReflectionUtils", "lookup", "getLookup", "_b", "EditorUtils", "CascadedWidgetLink", "Widget", "p", "Authorization", "endsWith", "format", "getInstanceType", "getTypeFullName", "isEmptyOrNull", "LT", "replaceAll", "resolveUrl", "Router", "safeCast", "text", "tryGetText", "EntityGrid", "DataGrid", "container", "options", "_", "args", "oldRequests", "parts", "Router", "result", "isEmptyOrNull", "attr", "EntityTypeAttribute", "name", "getTypeFullName", "getInstanceType", "px", "endsWith", "DisplayNameAttribute", "LT", "tryGetText", "ItemNameAttribute", "format", "text", "buttons", "ColumnPickerDialog", "noText", "entityOrId", "dlg", "dialog", "safeCast", "IEditDialog", "itemType", "ServiceAttribute", "replaceAll", "opt", "resolveUrl", "hash", "insertPermission", "Authorization", "EditorUtils", "SubDialogHelper", "e", "dci", "callback", "dialogClass", "Widget", "d", "DialogTypeRegistry", "DialogTypeAttribute", "__decorateClass", "Decorators", "any", "Authorization", "confirm", "endsWith", "Exception", "extend", "format", "getAttributes", "getFormData", "getFormDataAsync", "getInstanceType", "getTypeFullName", "isArray", "isEmptyOrNull", "LT", "notifySuccess", "replaceAll", "safeCast", "ScriptData", "serviceCall", "startsWith", "text", "tryGetText", "validatorAbortHandler", "EntityDialog", "TemplatedDialog", "opt", "__async", "entity", "value", "_a", "titleFormat", "text", "title", "format", "isEmptyOrNull", "isDeletedProperty", "callback", "options", "serviceCall", "self", "request", "baseOptions", "response", "thisOptions", "finalOptions", "extend", "attrType", "getAttributes", "getInstanceType", "typeAttributes", "EntityTypeAttribute", "name", "getTypeFullName", "px", "endsWith", "attributes", "FormKeyAttribute", "LocalTextPrefixAttribute", "ItemNameAttribute", "LT", "es", "tryGetText", "NamePropertyAttribute", "IdPropertyAttribute", "IsActivePropertyAttribute", "ServiceAttribute", "replaceAll", "entityOrId", "done", "fail", "action", "scriptType", "entityId", "ex1", "ex", "Exception", "asPanel", "data", "idField", "id", "validatorAbortHandler", "pgDiv", "pgOptions", "any", "x", "localGridDiv", "items", "item1", "langs", "copy", "lang", "PropertyGrid", "newValue", "langsTuple", "safeCast", "isArray", "language", "key", "valueByName", "item", "widget", "widget1", "idx", "hint", "k", "result", "pair", "prefix", "startsWith", "formKey", "ScriptData", "getFormData", "getFormDataAsync", "typ", "ent", "eid", "dci", "req", "ValidationHelper", "notifySuccess", "list", "response1", "id1", "confirm", "cloneEntity", "Widget", "w", "SubDialogHelper", "clone", "isActiveField", "isDeletedField", "EditorUtils", "isLocalizationMode", "hasSavePermission", "viewMode", "readOnly", "TabsExtensions", "deletePermission", "Authorization", "insertPermission", "updatePermission", "__decorateClass", "Decorators", "IEditDialog", "IReadOnly", "postToService", "serviceCall", "trimToNull", "Reporting", "ReportDialog", "TemplatedDialog", "opt", "PropertyGrid", "reportKey", "serviceCall", "response", "_a", "set", "targetFrame", "exportType", "parameters", "postToService", "buttons", "__decorateClass", "Decorators", "ReportPage", "Widget", "div", "e", "self", "QuickSearchInput", "field", "text", "done", "liList", "trimToNull", "parts", "i", "reportItems", "i1", "x", "title", "$t1", "p", "matchingItems", "visibles", "nonVisibles", "li", "dialog", "AsyncLookupEditor", "LookupEditorBase", "hidden", "opt", "_a", "__decorateClass", "Decorators", "ISetEditValue", "IGetEditValue", "IStringValue", "IReadOnly", "ScriptContext", "__decorateClass", "Decorators", "IAsyncInit", "__decorateClass", "Decorators", "WX", "getWidget", "element", "type", "Widget", "hasOriginalEvent", "e", "change", "widget", "handler", "changeSelect2", "getGridField", "GoogleMap", "Widget", "container", "opt", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "center", "mapOpt", "markerOpt", "lat", "lon", "LazyLoadHelper", "__decorateClass", "Decorators", "isEmptyOrNull", "isValue", "safeCast", "serviceCall", "text", "trimToNull", "Select2AjaxEditor", "Widget", "hidden", "opt", "emptyItemText", "e", "x", "WX", "ValidationHelper", "txt", "text", "request", "callback", "options", "response", "serviceCall", "key", "item", "queryTimeout", "isEmptyOrNull", "isValue", "query", "trimToNull", "select2", "element", "val", "result", "title", "self", "safeCast", "value", "el", "v", "__decorateClass", "Decorators", "IStringValue"]
}
